# JavaScript é¢å‘å¯¹è±¡

## å¯¹è±¡ & å±æ€§

ECMA-262 å°†å¯¹è±¡å®šä¹‰ä¸ºä¸€ç»„é”®å€¼å¯¹çš„æ— åºé›†åˆã€‚åœ¨å¯¹è±¡ä¸­ï¼Œé”®ç§°ä¸ºå±æ€§ï¼Œæ¯ä¸ªå±æ€§éœ€è¦æ˜ å°„åˆ°ä¸€ä¸ªå€¼ï¼Œå€¼å¯ä»¥æ˜¯æ•°æ®æˆ–è€…å‡½æ•°ã€‚

### å±æ€§çš„ç±»å‹

ECMA-262 ä½¿ç”¨ä¸€äº›ã€Œ **å†…éƒ¨ç‰¹æ€§** ã€æ¥æè¿°å±æ€§çš„ç‰¹å¾ã€‚å¼€å‘è€…ä¸èƒ½åœ¨ JavaScript ä¸­ç›´æ¥è®¿é—®è¿™äº›ç‰¹æ€§ã€‚

ECMA-262 è§„èŒƒä¼šç”¨ä¸¤ä¸ªä¸­æ‹¬å·æŠŠç‰¹æ€§çš„åç§°æ‹¬èµ·æ¥ï¼Œæ¥è¡¨ç¤ºå®ƒæ˜¯å†…éƒ¨ç‰¹æ€§ï¼Œæ¯”å¦‚ `[[Enumerable]]`ã€‚

---

å¯¹è±¡ä¸­çš„å±æ€§åˆ†ä¸¤ç§ï¼šæ•°æ®å±æ€§ & è®¿é—®å™¨å±æ€§ã€‚

#### æ•°æ®å±æ€§

æ•°æ®å±æ€§åŒ…å«ä¸€ä¸ªä¿å­˜æ•°æ®å€¼çš„ä½ç½®ã€‚åœ¨è¿™ä¸ªä½ç½®å¯ä»¥è¯»å–å’Œå†™å…¥å€¼ã€‚æ•°æ®å±æ€§æœ‰ 4 ä¸ªæè¿°å…¶è¡Œä¸ºçš„ç‰¹æ€§ã€‚

- `[[Configurable]]`ï¼šè¡¨ç¤ºèƒ½å¦é€šè¿‡ `delete` åˆ é™¤å±æ€§ä»è€Œé‡æ–°å®šä¹‰å±æ€§ï¼Œèƒ½å¦ä¿®æ”¹å±æ€§çš„ç‰¹æ€§ï¼Œæˆ–è€…èƒ½å¦æŠŠå±æ€§ä¿®æ”¹ä¸ºè®¿é—®å™¨å±æ€§ã€‚åƒå‰é¢ä¾‹å­ä¸­é‚£æ ·ç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰çš„å±æ€§ï¼Œå®ƒä»¬çš„è¿™ä¸ªç‰¹æ€§é»˜è®¤å€¼ä¸º `true`ã€‚
- `[[Enumerable]]`ï¼šè¡¨ç¤ºèƒ½å¦é€šè¿‡ `for-in` å¾ªç¯è¿”å› (éå†) å±æ€§ã€‚åƒå‰é¢ä¾‹å­ä¸­é‚£æ ·ç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰çš„å±æ€§ï¼Œå®ƒä»¬çš„è¿™ä¸ªç‰¹æ€§é»˜è®¤å€¼ä¸º `true`ã€‚
- `[[Writable]]`ï¼šè¡¨ç¤ºèƒ½å¦ä¿®æ”¹å±æ€§çš„å€¼ã€‚åƒå‰é¢ä¾‹å­ä¸­é‚£æ ·ç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰çš„å±æ€§ï¼Œå®ƒä»¬çš„è¿™ä¸ªç‰¹æ€§é»˜è®¤å€¼ä¸º `true`ã€‚
- `[[Value]]`ï¼šåŒ…å«è¿™ä¸ªå±æ€§çš„æ•°æ®å€¼ã€‚è¯»å–å±æ€§å€¼çš„æ—¶å€™ï¼Œä»è¿™ä¸ªä½ç½®è¯»ï¼›å†™å…¥å±æ€§å€¼çš„æ—¶å€™ï¼ŒæŠŠæ–°å€¼ä¿å­˜åœ¨è¿™ä¸ªä½ç½®ã€‚è¿™ä¸ªç‰¹æ€§çš„é»˜è®¤å€¼ä¸º `undefined`ã€‚

è¦ä¿®æ”¹å±æ€§é»˜è®¤çš„ç‰¹æ€§ï¼Œå¿…é¡»ä½¿ç”¨ `Object.defineProperty()` æ–¹æ³•. è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š

- å±æ€§æ‰€åœ¨çš„å¯¹è±¡
- å±æ€§çš„åå­—
- ä¸€ä¸ªæè¿°ç¬¦å¯¹è±¡ descriptorã€‚å±æ€§å¿…é¡»æ˜¯ï¼š`configurable`ã€`enumerable`ã€`writable` å’Œ `value`ã€‚è®¾ç½®å…¶ä¸­çš„ä¸€æˆ–å¤šä¸ªå€¼ï¼Œå¯ä»¥ä¿®æ”¹å¯¹åº”çš„ç‰¹æ€§å€¼ã€‚

```js
var person = {};
person.name = "Greg";
alert(person.name); //"Greg"

// name å±æ€§å€¼æ”¹æˆ "Nicholas", å¹¶ä¸”è®¾ç½®ä¸ºä¸å¯ä¿®æ”¹å±æ€§å€¼
Object.defineProperty(person, "name", {
  writable: false,
  value: "Nicholas",
});

alert(person.name); //"Nicholas"
person.name = "Greg";
alert(person.name); //"Nicholas"
```

```js
var person = {};
Object.defineProperty(person, "name", {
  configurable: false,
  value: "Nicholas",
});

//æŠ›å‡ºé”™è¯¯
Object.defineProperty(person, "name", {
  configurable: true,
  value: "Nicholas",
});
```

ä¸€æ—¦æŠŠå±æ€§å®šä¹‰ä¸ºä¸å¯é…ç½® `configurable: false` çš„ï¼Œå°±ä¸èƒ½å†æŠŠå®ƒå˜å›å¯é…ç½®äº†ã€‚æ­¤æ—¶ï¼Œå†è°ƒç”¨ `Object.defineProperty()` æ–¹æ³•ä¿®æ”¹é™¤ `writable` ä¹‹å¤–çš„ç‰¹æ€§ï¼Œéƒ½ä¼šå¯¼è‡´é”™è¯¯.

åœ¨è°ƒç”¨`Object.defineProperty()`æ–¹æ³•æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œ`configurable`ã€`enumerable` å’Œ `writable` ç‰¹æ€§çš„é»˜è®¤å€¼éƒ½æ˜¯ `false`ã€‚

#### è®¿é—®å™¨å±æ€§

è®¿é—®å™¨å±æ€§ä¸åŒ…å«æ•°æ®å€¼ï¼›å®ƒä»¬åŒ…å«ä¸€å¯¹ `getter` å’Œ `setter` å‡½æ•°ï¼ˆä¸æ˜¯å¿…éœ€çš„ï¼‰

- åœ¨è¯»å–è®¿é—®å™¨å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨ `getter` å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è´Ÿè´£è¿”å›æœ‰æ•ˆçš„å€¼ï¼›
- åœ¨å†™å…¥è®¿é—®å™¨å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨ `setter` å‡½æ•°å¹¶ä¼ å…¥æ–°å€¼ï¼Œè¿™ä¸ªå‡½æ•°è´Ÿè´£å†³å®šå¦‚ä½•å¤„ç†æ•°æ®ã€‚

è®¿é—®å™¨å±æ€§æœ‰å¦‚ä¸‹ 4 ä¸ªç‰¹æ€§ã€‚

- `[[Configurable]]`ï¼šè¡¨ç¤ºèƒ½å¦é€šè¿‡ `delete` åˆ é™¤å±æ€§ä»è€Œé‡æ–°å®šä¹‰å±æ€§ï¼Œèƒ½å¦ä¿®æ”¹å±æ€§çš„ç‰¹æ€§ï¼Œæˆ–è€…èƒ½å¦æŠŠå±æ€§ä¿®æ”¹ä¸ºæ•°æ®å±æ€§ã€‚å¯¹äºç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰çš„å±æ€§ï¼Œè¿™ä¸ªç‰¹æ€§çš„é»˜è®¤å€¼ä¸º `true`ã€‚
- `[[Enumerable]]`ï¼šè¡¨ç¤ºèƒ½å¦é€šè¿‡ `for-in` å¾ªç¯è¿”å›å±æ€§ã€‚å¯¹äºç›´æ¥åœ¨å¯¹è±¡ä¸Šå®šä¹‰çš„å±æ€§ï¼Œè¿™ä¸ªç‰¹æ€§çš„é»˜è®¤å€¼ä¸º `true`ã€‚
- `[[Get]]`ï¼šåœ¨è¯»å–å±æ€§æ—¶è°ƒç”¨çš„å‡½æ•°ã€‚é»˜è®¤å€¼ä¸º `undefined`ã€‚
- `[[Set]]`ï¼šåœ¨å†™å…¥å±æ€§æ—¶è°ƒç”¨çš„å‡½æ•°ã€‚é»˜è®¤å€¼ä¸º `undefined`ã€‚

è®¿é—®å™¨å±æ€§ä¸èƒ½ç›´æ¥å®šä¹‰ï¼Œå¿…é¡»ä½¿ç”¨ `Object.defineProperty()` æ¥å®šä¹‰ã€‚

```js
var book = {
  // åŠ  ä¸‹åˆ’çº¿ ("_") è¡¨ç¤ºåªèƒ½é€šè¿‡å¯¹è±¡æ–¹æ³•è®¿é—®çš„å±æ€§
  _year: 2004,
  edition: 1,
};

Object.defineProperty(book, "year", {
  get: function() {
    return this._year;
  },
  set: function(newValue) {
    if (newValue > 2004) {
      this._year = newValue;
      this.edition += newValue - 2004;
    }
  },
});

book.year = 2005;
alert(book.edition); //2
```

è®¾ç½®è®¿é—®å™¨å±æ€§çš„å€¼æ—¶ï¼Œå…è®¸é¡ºå¸¦ä¿®æ”¹å…¶ä»–å±æ€§çš„å€¼ã€‚

åªæŒ‡å®š `getter` æ„å‘³ç€å±æ€§æ˜¯ä¸èƒ½å†™ï¼Œå°è¯•å†™å…¥å±æ€§ä¼šè¢«å¿½ç•¥ã€‚åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå°è¯•å†™å…¥åªæŒ‡å®šäº† `getter` å‡½æ•°çš„å±æ€§ä¼šæŠ›å‡ºé”™è¯¯ã€‚ç±»ä¼¼åœ°ï¼ŒåªæŒ‡å®š `setter` å‡½æ•°çš„å±æ€§ä¹Ÿä¸èƒ½è¯»ï¼Œå¦åˆ™åœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šè¿”å› `undefined`ï¼Œè€Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡ºé”™è¯¯ã€‚

#### `Object.defineProperties()`

ECMAScript æä¾›äº† `Object.defineProperties()` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å¯ä»¥é€šè¿‡å¤šä¸ªæè¿°ç¬¦ä¸€æ¬¡æ€§å®šä¹‰å¤šä¸ªå±æ€§ã€‚å®ƒæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

- è¦ä¸ºä¹‹æ·»åŠ æˆ–ä¿®æ”¹å±æ€§çš„å¯¹è±¡ã€‚
- ä¸€ä¸ªæè¿°ç¬¦å¯¹è±¡ï¼Œå…¶å±æ€§ä¸è¦æ·»åŠ æˆ–ä¿®æ”¹çš„å±æ€§ä¸€ä¸€å¯¹åº”ã€‚

```js
let book = {};
Object.defineProperties(book, {
  year_: {
    value: 2017,
  },

  edition: {
    value: 1,
  },

  year: {
    get() {
      return this.year_;
    },

    set(newValue) {
      if (newValue > 2017) {
        this.year_ = newValue;
        this.edition += newValue - 2017;
      }
    },
  },
});
```

#### `Object.getOwnPropertyDescriptor()`

ä½¿ç”¨`Object.getOwnPropertyDescriptor()` æ–¹æ³•å¯ä»¥å–å¾—æŒ‡å®šå±æ€§çš„å±æ€§æè¿°ç¬¦å¯¹è±¡ã€‚æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

- å±æ€§æ‰€åœ¨çš„å¯¹è±¡ã€‚
- è¦å–å¾—å…¶æè¿°ç¬¦çš„å±æ€§åã€‚

```js
let descriptor = Object.getOwnPropertyDescriptor(book, "year");
console.log(descriptor);
// Object { get: get(), set: set(newValue), enumerable: false, configurable: false }

let descriptor = Object.getOwnPropertyDescriptor(book, "year_");
console.log(descriptor);
// Object { value: 2017, writable: false, enumerable: false, configurable: false }
```

ECMAScript 2017 æ–°å¢äº† `Object.getOwnPropertyDescriptors()` é™æ€æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å®é™…ä¸Šä¼šåœ¨æ¯ä¸ªè‡ªæœ‰å±æ€§ä¸Šè°ƒç”¨ `Object.defineProperties()` å¹¶åœ¨ä¸€ä¸ªæ–°å¯¹è±¡ä¸­è¿”å›å®ƒä»¬ã€‚

```js
console.log(Object.getOwnPropertyDescriptors(book));
// {
//   edition: {
//     configurable: false,
//     enumerable: false,
//     value: 1,
//     writable: false
//   },
//   year: {
//     configurable: false,
//     enumerable: false,
//     get: f(),
//     set: f(newValue),
//   },
//   year_: {
//     configurable: false,
//     enumerable: false,
//     value: 2019,
//     writable: false
//   }
// }
```

### åˆå¹¶å¯¹è±¡

ã€Œ åˆå¹¶ Merge ã€çš„æ„æ€æ˜¯ï¼ŒæŠŠæºå¯¹è±¡æ‰€æœ‰çš„æœ¬åœ°å±æ€§ä¸€èµ·å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ä¸Šã€‚æœ‰æ—¶å€™è¿™ç§æ“ä½œä¹Ÿè¢«ç§°ä¸ºã€Œ æ··å…¥ Mixin ã€

ECMAScript 6 ä¸“é—¨ä¸ºåˆå¹¶å¯¹è±¡æä¾›äº† `Object.assign()` æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªç›®æ ‡å¯¹è±¡å’Œä¸€ä¸ªæˆ–å¤šä¸ªæºå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œç„¶åå°†æ¯ä¸ªæºå¯¹è±¡ä¸­ã€Œ å¯æšä¸¾å±æ€§ ã€å’Œã€Œ è‡ªæœ‰å±æ€§ ã€å¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ã€‚

- ã€Œ å¯æšä¸¾å±æ€§ ã€`Object.propertyIsEnumerable()` è¿”å› `true`
- ã€Œ è‡ªæœ‰å±æ€§ ã€`Object.hasOwnProperty()` è¿”å› `true`

```js
let dest = {};
let src = { id: "src" };

let result = Object.assign(dest, src);

// Object.assignä¿®æ”¹ç›®æ ‡å¯¹è±¡
// ä¹Ÿä¼šè¿”å›ä¿®æ”¹åçš„ç›®æ ‡å¯¹è±¡
console.log(dest === result); // true
console.log(dest !== src); // true
console.log(result); // { id: src }
console.log(dest); // { id: src }

/**
 * å¤šä¸ªæºå¯¹è±¡
 */
let dest = {};

let result = Object.assign(dest, { a: "foo" }, { b: "bar" });

console.log(result); // { a: foo, b: bar }
```

`Object.assign()` å®é™…ä¸Šå¯¹æ¯ä¸ªæºå¯¹è±¡æ‰§è¡Œçš„æ˜¯æµ…å¤åˆ¶ã€‚

å¹¶ä¸”ï¼Œå¦‚æœå¤šä¸ªæºå¯¹è±¡éƒ½æœ‰ç›¸åŒçš„å±æ€§ï¼Œåˆ™ä½¿ç”¨æœ€åä¸€ä¸ªå¤åˆ¶çš„å€¼ã€‚

```js
/**
 * æµ…å¤åˆ¶
 */

let dest = {};
let src = { a: {} };

Object.assign(dest, src);

// æµ…å¤åˆ¶æ„å‘³ç€åªä¼šå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨
console.log(dest); // { a :{} }
console.log(dest.a === src.a); // true

/**
 * è¦†ç›–å±æ€§
 */
let dest = { id: "dest" };

let result = Object.assign(
  dest,
  { id: "src1", a: "foo" },
  { id: "src2", b: "bar" }
);

// Object.assignä¼šè¦†ç›–é‡å¤çš„å±æ€§
console.log(result); // { id: src2, a: foo, b: bar }
```

å¦‚æœèµ‹å€¼æœŸé—´å‡ºé”™ï¼Œåˆ™æ“ä½œä¼šä¸­æ­¢å¹¶é€€å‡ºï¼ŒåŒæ—¶æŠ›å‡ºé”™è¯¯ã€‚`Object.assign()` æ²¡æœ‰ â€œå›æ»šâ€ çš„æ¦‚å¿µï¼Œå› æ­¤å®ƒæ˜¯ä¸€ä¸ªå°½åŠ›è€Œä¸ºã€å¯èƒ½åªä¼šå®Œæˆéƒ¨åˆ†å¤åˆ¶çš„æ–¹æ³•ã€‚

```js
let dest = {};
let src = {
  a: "foo",
  get b() {
    // Object.assign()åœ¨è°ƒç”¨è¿™ä¸ªè·å–å‡½æ•°æ—¶ä¼šæŠ›å‡ºé”™è¯¯
    throw new Error();
  },
  c: "bar",
};

try {
  Object.assign(dest, src);
} catch (e) {}

// Object.assign()æ²¡åŠæ³•å›æ»šå·²ç»å®Œæˆçš„ä¿®æ”¹
// å› æ­¤åœ¨æŠ›å‡ºé”™è¯¯ä¹‹å‰ï¼Œç›®æ ‡å¯¹è±¡ä¸Šå·²ç»å®Œæˆçš„ä¿®æ”¹ä¼šç»§ç»­å­˜åœ¨ï¼š
console.log(dest); // { a: foo }
```

### å¢å¼ºçš„å¯¹è±¡è¯­æ³•

ECMAScript 6 ä¸ºå®šä¹‰å’Œæ“ä½œå¯¹è±¡æ–°å¢äº†å¾ˆå¤šæå…¶æœ‰ç”¨çš„è¯­æ³•ç³–ç‰¹æ€§ã€‚

#### å±æ€§å€¼ç®€å†™

å½“å±æ€§åå’Œå±æ€§å€¼æ‰€ç”¨çš„æ ‡è¯†ç¬¦ä¸€æ ·æ—¶ï¼Œå°±å¯ä»¥çœç•¥ `:` ç®€å†™ä¸ºä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚

```js
var name = "Matt";

var person = {
  name: name,
};

// ç®€å†™ä¸º

var person = {
  name,
};

console.log(person); // { name: 'Matt' }
```

#### å¯è®¡ç®—å±æ€§

åœ¨å¼•å…¥å¯è®¡ç®—å±æ€§ä¹‹å‰ï¼Œå¦‚æœæƒ³ä½¿ç”¨å˜é‡çš„å€¼ä½œä¸ºå±æ€§ï¼Œé‚£ä¹ˆå¿…é¡»å…ˆå£°æ˜å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ä¸­æ‹¬å·è¯­æ³•æ¥æ·»åŠ å±æ€§ã€‚

```js
const nameKey = "name";
const ageKey = "age";
const jobKey = "job";

let person = {};
person[nameKey] = "Matt";
person[ageKey] = 27;
person[jobKey] = "Software engineer";

console.log(person); // { name: 'Matt', age: 27, job: 'Software engineer' }
```

å¯è®¡ç®—å±æ€§ï¼Œå…è®¸å¯¹è±¡å­—é¢é‡ä¸­å®ŒæˆåŠ¨æ€å±æ€§èµ‹å€¼ã€‚ä¸­æ‹¬å·åŒ…å›´çš„å¯¹è±¡å±æ€§é”®å‘Šè¯‰ JS å¼•æ“è¿è¡Œæ—¶å°†å…¶ä½œä¸º JavaScript è¡¨è¾¾å¼è€Œä¸æ˜¯å­—ç¬¦ä¸²æ¥æ±‚å€¼ã€‚

```js
const nameKey = "name";
const ageKey = "age";
const jobKey = "job";

let person = {
  [nameKey]: "Matt",
  [ageKey]: 27,
  [jobKey]: "Software engineer",
};

console.log(person); // { name: 'Matt', age: 27, job: 'Software engineer' }
```

å¯è®¡ç®—å±æ€§æœ¬èº«å¯ä»¥æ˜¯å¤æ‚çš„è¡¨è¾¾å¼ã€‚

```js
const nameKey = "name";
const ageKey = "age";
const jobKey = "job";
let uniqueToken = 0;

function getUniqueKey(key) {
  return "${key}_${uniqueToken++}";
}

let person = {
  [getUniqueKey(nameKey)]: "Matt",
  [getUniqueKey(ageKey)]: 27,
  [getUniqueKey(jobKey)]: "Software engineer",
};

console.log(person); // { name_0: 'Matt', age_1: 27, job_2: 'Software engineer' }
```

#### ç®€å†™æ–¹æ³•å

åœ¨ç»™å¯¹è±¡å®šä¹‰æ–¹æ³•æ—¶ï¼Œé€šå¸¸éƒ½è¦å†™ä¸€ä¸ªæ–¹æ³•åã€å†’å·ï¼Œç„¶åå†å¼•ç”¨ä¸€ä¸ªåŒ¿åå‡½æ•°è¡¨è¾¾å¼ã€‚

```js
let person = {
  sayName: function(name) {
    console.log("My name is ${name}");
  },
};
```

ç°åœ¨å¯ä»¥ç®€å†™ä¸ºï¼š

```js
let person = {
  sayName(name) {
    console.log("My name is ${name}");
  },
};

person.sayName("Matt"); // My name is Matt
```

ç®€å†™æ–¹æ³•åä¸å¯è®¡ç®—å±æ€§é”®ç›¸äº’å…¼å®¹ï¼š

```js
const methodKey = "sayName";

let person = {
  [methodKey](name) {
    console.log("My name is ${name}");
  },
};

person.sayName("Matt"); // My name is Matt
```

è®¿é—®å™¨å±æ€§çš„ Getter å’Œ Setter å‡½æ•°ä¹Ÿæœ‰ç®€å†™æ–¹å¼ï¼š

```js
let person = {
  name_: "",
  get name() {
    return this.name_;
  },
  set name(name) {
    this.name_ = name;
  },
  sayName() {
    console.log("My name is ${this.name_}");
  },
};

person.name = "Matt";
person.sayName(); // My name is Matt
```

### å¯¹è±¡è§£æ„è¯­æ³•

ã€Œ **å¯¹è±¡è§£æ„** ã€å°±æ˜¯ä½¿ç”¨ä¸å¯¹è±¡åŒ¹é…çš„ç»“æ„æ¥å®ç°å¯¹è±¡å±æ€§èµ‹å€¼ã€‚

ä½¿ç”¨è§£æ„ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç±»ä¼¼å¯¹è±¡å­—é¢é‡çš„ç»“æ„ä¸­ï¼Œå£°æ˜å¤šä¸ªå˜é‡ï¼ŒåŒæ—¶æ‰§è¡Œå¤šä¸ªèµ‹å€¼æ“ä½œã€‚

```js
// ä¸ä½¿ç”¨å¯¹è±¡è§£æ„
var person = {
  name: "Matt",
  age: 27,
};

var personName = person.name,
  personAge = person.age;

// ä½¿ç”¨å¯¹è±¡è§£æ„
var person = {
  name: "Matt",
  age: 27,
};

var { name: personName, age: personAge } = person;

console.log(personName); // Matt
console.log(personAge); // 27
```

å¦‚æœå˜é‡ç›´æ¥ä½¿ç”¨å±æ€§çš„åç§°ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ç®€å†™è¯­æ³•ã€‚

```js
let person = {
  name: "Matt",
  age: 27,
};

let { name, age } = person;

console.log(name); // Matt
console.log(age); // 27
```

è§£æ„å¹¶ä¸è¦æ±‚å˜é‡å¿…é¡»åœ¨è§£æ„è¡¨è¾¾å¼ä¸­å£°æ˜ã€‚ä¸è¿‡ï¼Œå¦‚æœæ˜¯ç»™äº‹å…ˆå£°æ˜çš„å˜é‡èµ‹å€¼ï¼Œåˆ™èµ‹å€¼è¡¨è¾¾å¼å¿…é¡»åŒ…å«åœ¨ä¸€å¯¹æ‹¬å· `()` ä¸­ã€‚

```js
let personName, personAge;

let person = {
  name: "Matt",
  age: 27,
};

({ name: personName, age: personAge } = person);
// ä¸‹é¢è¿™ç§å†™æ³•æ˜¯é”™è¯¯çš„ï¼š
// { name: personName, age: personAge } = person;

console.log(personName, personAge); // Matt, 27
```

#### è®¾ç½®é»˜è®¤å€¼

å¦‚æœå¼•ç”¨çš„å±æ€§ä¸å­˜åœ¨ï¼Œåˆ™è¯¥å˜é‡çš„å€¼å°±æ˜¯ `undefined`ã€‚

ä¹Ÿå¯ä»¥åœ¨è§£æ„èµ‹å€¼çš„åŒæ—¶å®šä¹‰é»˜è®¤å€¼ï¼Œè¿™é€‚ç”¨äºå¼•ç”¨çš„å±æ€§ä¸å­˜åœ¨äºæºå¯¹è±¡ä¸­çš„æƒ…å†µã€‚

```js
et person = {
  name: 'Matt',
  age: 27
};

var { name, job } = person;

console.log(name);  // Matt
console.log(job);   // undefined

// è®¾ç½®é»˜è®¤å€¼
var { name, job = 'Software engineer' } = person;

console.log(name); // Matt
console.log(job);  // Software engineer
```

#### å¯¹åŸºæœ¬ç±»å‹ä½¿ç”¨è§£æ„

å½“æºæ•°æ®æ˜¯ä¸€ä¸ªåŸºæœ¬ç±»å‹æ—¶ï¼Œä¼š JS å¼•æ“ä¼šè°ƒç”¨ `ToObject()` æ–¹æ³• ( å†…éƒ¨æ–¹æ³•ï¼Œè¿è¡Œæ—¶ç¯å¢ƒä¸å¯è®¿é—® ) å°†å…¶è½¬æ¢ä¸ºå¯¹è±¡ã€‚

`null` å’Œ `undefined` ä¸èƒ½è¢«è§£æ„ï¼Œå¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚

```js
let { length } = "foobar";
console.log(length); // 6

let { constructor: c } = 4;
console.log(c === Number); // true
```

#### åµŒå¥—è§£æ„

è§£æ„èµ‹å€¼å¯ä»¥ä½¿ç”¨åµŒå¥—ç»“æ„ï¼Œä»¥åŒ¹é…åµŒå¥—çš„å±æ€§ã€‚

```js
let person = {
  name: "Matt",
  age: 27,
  job: {
    title: "Software engineer",
  },
};

// å£°æ˜titleå˜é‡å¹¶å°†person.job.titleçš„å€¼èµ‹ç»™å®ƒ
let {
  job: { title },
} = person;

console.log(title); // Software engineer
```

#### éƒ¨åˆ†è§£æ„

è§£æ„æ“ä½œå¦‚æœä¸­é€”å‘ç”Ÿé”™è¯¯ï¼Œæ˜¯ä¸ä¼šå›æ»šçš„ã€‚å¦‚æœä¸€ä¸ªè§£æ„è¡¨è¾¾å¼æ¶‰åŠå¤šä¸ªèµ‹å€¼ï¼Œå¼€å§‹çš„èµ‹å€¼æˆåŠŸè€Œåé¢çš„èµ‹å€¼å‡ºé”™ï¼Œåˆ™æ•´ä¸ªè§£æ„èµ‹å€¼åªä¼šå®Œæˆä¸€éƒ¨åˆ†ã€‚

```js
let person = {
  name: "Matt",
  age: 27,
};

let personName, personBar, personAge;

try {
  // person.fooæ˜¯undefinedï¼Œå› æ­¤ä¼šæŠ›å‡ºé”™è¯¯
  ({
    name: personName,
    foo: { bar: personBar },
    age: personAge,
  } = person);
} catch (e) {}

console.log(personName, personBar, personAge);
// Matt, undefined, undefined
```

#### å‚æ•°ä¸Šä¸‹æ–‡åŒ¹é…

åœ¨å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­è¿›è¡Œè§£æ„èµ‹å€¼ï¼Œå¯ä»¥åœ¨å‡½æ•°ç­¾åä¸­å£°æ˜åœ¨å‡½æ•°ä½“å†…ä½¿ç”¨å±€éƒ¨å˜é‡ã€‚

```js
let person = {
  name: "Matt",
  age: 27,
};

function printPerson(foo, { name, age }, bar) {
  console.log(arguments);
  console.log(name, age);
}

function printPerson2(foo, { name: personName, age: personAge }, bar) {
  console.log(arguments);
  console.log(personName, personAge);
}

printPerson("1st", person, "2nd");
// ['1st', { name: 'Matt', age: 27 }, '2nd']
// 'Matt', 27

printPerson2("1st", person, "2nd");
// ['1st', { name: 'Matt', age: 27 }, '2nd']
// 'Matt', 27
```

### å±æ€§ & å¯¹è±¡æ‰€å±å…³ç³»æ£€æµ‹

åœ¨å¼€å‘ä¸­, æˆ‘ä»¬éœ€è¦åˆ¤æ–­å±æ€§ä¸å¯¹è±¡çš„æ‰€å±å…³ç³». æ£€æµ‹æ–¹æ³•æœ‰å¦‚ä¸‹å‡ ç§:

#### `in` è¿ç®—ç¬¦

`in` æ“ä½œç¬¦, å·¦è¾¹æ˜¯å±æ€§å(å­—ç¬¦ä¸²), å³è¾¹æ˜¯å¯¹è±¡. å¦‚æœå¯¹è±¡çš„è‡ªæœ‰å±æ€§æˆ–ç»§æ‰¿å±æ€§ä¸­åŒ…å«è¿™ä¸ªå±æ€§, åˆ™è¿”å› `true`

```js
var obj = {
  a: 123,
};

"a" in obj; // true è‡ªæœ‰å±æ€§
"toString" in obj; // true ç»§æ‰¿å±æ€§
```

#### hasOwnProperty()

`hasOwnProperty()` å¯ä»¥ç”¨æ¥åˆ¤æ–­å±æ€§æ˜¯å¦ä¸ºå¯¹è±¡è‡ªæœ‰å±æ€§. å‚æ•°ä¸ºå±æ€§åçš„å­—ç¬¦ä¸²å½¢å¼.

```js
var obj = {
  a: 123,
};

obj.hasOwnProperty("a"); // true
```

#### hasPrototypeProperty()

`hasPrototypeProperty()` å¯ä»¥ç”¨æ¥åˆ¤æ–­å±æ€§æ˜¯å¦ä¸ºåŸå‹å¯¹è±¡è‡ªæœ‰å±æ€§.

```js
function Person() {}

Person.prototype.name = "Nicholas";
Person.prototype.age = 29;
Person.prototype.job = "Software Engineer";
Person.prototype.sayName = function() {
  console.log(this.name);
};

let person = new Person();
console.log(hasPrototypeProperty(person, "name")); // true

person.name = "Greg";
console.log(hasPrototypeProperty(person, "name")); // false
```

### å±æ€§æšä¸¾

#### for/in å¾ªç¯

for/in å¾ªç¯ç”¨äºéå†å¯¹è±¡ä¸­æ‰€æœ‰å¯æšä¸¾çš„å±æ€§ ( ä¸ä¸€å®šæ˜¯è‡ªæœ‰çš„ ). åœ¨å¾ªç¯ä¸­, éå†å‡ºçš„å±æ€§åç§°è¢«èµ‹å€¼ç»™å¾ªç¯å˜é‡.

```js
var o = {
  a: 1,
  b: 2,
  c: 3,
};

for (prop in o) {
  console.log(prop); // ä¾æ¬¡è¾“å‡º a, b, c
}
```

#### Object.keys()

`Object.keys()` è¿”å›ä¸€ä¸ªæ•°ç»„, æ•°ç»„ç”±å¯¹è±¡çš„ "å¯æšä¸¾çš„è‡ªæœ‰å±æ€§çš„åç§°" ç»„æˆ (ä¸å« Symbol å±æ€§).

æ“ä½œä¸­å¼•å…¥ç»§æ‰¿çš„å±æ€§ä¼šè®©é—®é¢˜å¤æ‚åŒ–ï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬åªå…³å¿ƒå¯¹è±¡è‡ªèº«çš„å±æ€§ã€‚æ‰€ä»¥ï¼Œå°½é‡ä¸è¦ç”¨ `for...in` å¾ªç¯ï¼Œè€Œç”¨ `Object.keys()` ä»£æ›¿ã€‚

#### Object.getOwnPropertyNames()

`Object.getOwnPropertyNames()` è¿”å›ä¸€ä¸ªæ•°ç»„, æ•°ç»„ç”±å¯¹è±¡çš„ "è‡ªæœ‰å±æ€§åç§°" ç»„æˆ (ä¸å« Symbol å±æ€§), è€Œä¸ä»…ä»…æ˜¯å¯æšä¸¾çš„.

#### Object.getOwnPropertySymbols()

`Object.getOwnPropertySymbols()` è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡ "è‡ªæœ‰" çš„æ‰€æœ‰ Symbol å±æ€§çš„é”®åã€‚

```js
let k1 = Symbol("k1"),
  k2 = Symbol("k2");

let o = {
  1: 1,
  first: "first",
  [k1]: "sym2",
  second: "second",
  0: 0,
};

o[k2] = "sym2";
o[3] = 3;
o.third = "third";
o[2] = 2;

console.log(Object.getOwnPropertyNames(o));
// ["0", "1", "2", "3", "first", "second", "third"]

console.log(Object.getOwnPropertySymbols(o));
// [Symbol(k1), Symbol(k2)]
```

#### Reflect.ownKeys()

`Reflect.ownKeys()` è¿”å›ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«å¯¹è±¡ "è‡ªèº«" çš„æ‰€æœ‰é”®åï¼Œä¸ç®¡é”®åæ˜¯ Symbol æˆ–å­—ç¬¦ä¸²ï¼Œä¹Ÿä¸ç®¡æ˜¯å¦å¯æšä¸¾ã€‚

### å±æ€§å€¼æšä¸¾

ECMAScript 2017 æ–°å¢äº†ä¸¤ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºå°†å¯¹è±¡å†…å®¹è½¬æ¢ä¸ºåºåˆ—åŒ–çš„ï¼Œå¯è¿­ä»£çš„æ ¼å¼ã€‚

- `Object.values()` è¿”å›å±æ€§å€¼çš„æ•°ç»„ã€‚
- `Object.entries()` è¿”å›é”®/å€¼å¯¹çš„æ•°ç»„ã€‚

ç¬¦å·å±æ€§ä¼šè¢«å¿½ç•¥ã€‚

```js
const sym = Symbol();
const o = {
  foo: "bar",
  baz: 1,
  qux: {},
  [sym]: "foo",
};

console.log(Object.values(o));
// ["bar", 1, {}]

console.log(Object.entries(o));
// [["foo", "bar"], ["baz", 1], ["qux", {}]]
```

å¦å¤–ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ‰§è¡Œå¯¹è±¡çš„æµ…å¤åˆ¶ï¼š

```js
const o = {
  qux: {},
};

console.log(Object.values(o)[0] === o.qux);
// true

console.log(Object.entries(o)[0][1] === o.qux);
// true
```

## åˆ›å»ºå¯¹è±¡

### Object æ„é€ å‡½æ•° & å¯¹è±¡å­—é¢é‡

åˆ›å»ºè‡ªå®šä¹‰å¯¹è±¡ï¼Œé€šå¸¸æ–¹å¼æ˜¯åˆ›å»º Object çš„ä¸€ä¸ªæ–°å®ä¾‹ï¼Œç„¶åå†ç»™å®ƒæ·»åŠ å±æ€§å’Œæ–¹æ³•ã€‚

```js
let person = new Object();

person.name = "Nicholas";
person.age = 29;
person.job = "Software Engineer";
person.sayName = function() {
  console.log(this.name);
};
```

æ›´ç®€ä¾¿çš„æ–¹å¼ï¼Œæ˜¯ä½¿ç”¨å¯¹è±¡å­—é¢é‡ã€‚

```js
let person = {
  name: "Nicholas",
  age: 29,
  job: "Software Engineer",
  sayName() {
    console.log(this.name);
  },
};
```

ECMAScript 5.1 å¹¶æ²¡æœ‰æ­£å¼æ”¯æŒé¢å‘å¯¹è±¡çš„ç»“æ„ï¼Œæ¯”å¦‚ç±»æˆ–ç»§æ‰¿ã€‚ECMAScript 6 å¼€å§‹æ­£å¼æ”¯æŒç±»å’Œç»§æ‰¿ï¼Œä½†ä»…ä»…æ˜¯å°è£…äº† ES5.1 æ„é€ å‡½æ•°åŠ åŸå‹ç»§æ‰¿æ¨¡å¼çš„è¯­æ³•ç³–ã€‚

åœ¨å®é™…å¼€å‘æ—¶ï¼Œæˆ‘ä»¬ä¼˜å…ˆä½¿ç”¨ ES6 æä¾›çš„ç±»å’Œç»§æ‰¿è¯­æ³•ç³–ã€‚ä½†æ˜¯å¯¹äºå®ƒçš„åº•å±‚æ¦‚å¿µæˆ‘ä»¬ä»æ—§éœ€è¦æœ‰ä¸ªäº†è§£ã€‚

### å·¥å‚æ¨¡å¼

å·¥å‚æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºæŠ½è±¡åˆ›å»ºç‰¹å®šå¯¹è±¡çš„è¿‡ç¨‹ã€‚

```js
function createPerson(name, age, job) {
  let o = new Object();
  o.name = name;
  o.age = age;
  o.job = job;
  o.sayName = function() {
    console.log(this.name);
  };
  return o;
}

let person1 = createPerson("Nicholas", 29, "Software Engineer");
let person2 = createPerson("Greg", 27, "Doctor");
```

å·¥å‚æ¨¡å¼è™½ç„¶è§£å†³äº†åˆ›å»ºå¤šä¸ªç›¸ä¼¼å¯¹è±¡çš„é—®é¢˜ï¼Œä½†å´æ²¡æœ‰è§£å†³å¯¹è±¡è¯†åˆ«çš„é—®é¢˜ï¼Œå³æ€æ ·çŸ¥é“ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹ã€‚

### æ„é€ å‡½æ•°æ¨¡å¼

æ„é€ å‡½æ•°å¯ç”¨æ¥åˆ›å»ºç‰¹å®šç±»å‹çš„å¯¹è±¡, ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼å°†å‰é¢çš„ä¾‹å­é‡å†™å¦‚ä¸‹ã€‚

```js
function Person(name, age, job) {
  this.name = name;
  this.age = age;
  this.job = job;
  this.sayName = function() {
    alert(this.name);
  };
}

var person1 = new Person("Nicholas", 29, "Software Engineer");
var person2 = new Person("Greg", 27, "Doctor");
```

æ„é€ å‡½æ•° å’Œ å·¥å‚æ¨¡å¼ ç›¸æ¯”:

- æ²¡æœ‰æ˜¾å¼åœ°åˆ›å»ºå¯¹è±¡ï¼›
- ç›´æ¥å°†å±æ€§å’Œæ–¹æ³•èµ‹ç»™äº† `this` å¯¹è±¡ï¼›
- æ²¡æœ‰ `return` è¯­å¥ã€‚

ç”¨æ„é€ å‡½æ•°åˆ›å»ºæ–°å®ä¾‹ï¼Œå¿…é¡»ä½¿ç”¨ `new` æ“ä½œç¬¦ã€‚ä»¥è¿™ç§æ–¹å¼è°ƒç”¨æ„é€ å‡½æ•°å®é™…ä¸Šä¼šç»å†ä»¥ä¸‹ 4 ä¸ªæ­¥éª¤ï¼š

- åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼›
- å°†æ–°å¯¹è±¡ä½œä¸ºæ„é€ å‡½æ•°çš„ä½œç”¨åŸŸï¼ˆå› æ­¤ `this` å°±æŒ‡å‘äº†è¿™ä¸ªæ–°å¯¹è±¡ï¼‰ï¼›
- æ‰§è¡Œæ„é€ å‡½æ•°ä¸­çš„ä»£ç ï¼ˆä¸ºè¿™ä¸ªæ–°å¯¹è±¡æ·»åŠ å±æ€§ï¼‰ï¼›
- è¿”å›æ–°å¯¹è±¡ã€‚

ç”¨æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡å®ä¾‹, æœ‰ä¸€ä¸ª `constructor` å±æ€§, æŒ‡å‘æ„é€ å‡½æ•°:

å‰é¢çš„ä¾‹å­é‡Œ:

```js
alert(person1.constructor == Person); //true
alert(person2.constructor == Person); //true
```

`instanceof` æ“ä½œç¬¦, å¯ä»¥ç”¨æ¥æ£€æµ‹å¯¹è±¡ç±»å‹:

ä¾‹å­ä¸­åˆ›å»ºçš„æ‰€æœ‰å¯¹è±¡æ—¢æ˜¯ `Object` çš„å®ä¾‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ `Person` çš„å®ä¾‹. æ‰€æœ‰å¯¹è±¡å‡ç»§æ‰¿è‡ª `Object`

```js
alert(person1 instanceof Object); //true
alert(person1 instanceof Person); //true
alert(person2 instanceof Object); //true
alert(person2 instanceof Person); //true
```

#### å°†æ„é€ å‡½æ•°å½“ä½œå‡½æ•°

æ„é€ å‡½æ•°ä¸å…¶ä»–å‡½æ•°çš„å”¯ä¸€åŒºåˆ«ï¼Œå°±åœ¨äºè°ƒç”¨å®ƒä»¬çš„æ–¹å¼ä¸åŒ.

- åªè¦é€šè¿‡ `new` æ“ä½œç¬¦æ¥è°ƒç”¨ï¼Œé‚£å®ƒå°±å¯ä»¥ä½œä¸ºæ„é€ å‡½æ•°ã€‚
- å¦‚æœä¸é€šè¿‡ `new` æ“ä½œç¬¦æ¥è°ƒç”¨ï¼Œé‚£å®ƒè·Ÿæ™®é€šå‡½æ•°ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆä¸¤æ ·ã€‚`this` æŒ‡å‘å…¨å±€å¯¹è±¡ `window`ã€‚

```js
// å½“ä½œæ„é€ å‡½æ•°ä½¿ç”¨
var person = new Person("Nicholas", 29, "Software Engineer");
person.sayName(); // "Nicholas"

// ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨
Person("Greg", 27, "Doctor"); // æ·»åŠ åˆ° window
window.sayName(); //"Greg"

// åœ¨å¦ä¸€ä¸ªå¯¹è±¡çš„ä½œç”¨åŸŸä¸­è°ƒç”¨
var o = new Object();
Person.call(o, "Kristen", 25, "Nurse");
o.sayName(); // "Kristen"
```

#### æ„é€ å‡½æ•°çš„é—®é¢˜

ä½¿ç”¨æ„é€ å‡½æ•°çš„ä¸»è¦é—®é¢˜ï¼Œå°±æ˜¯æ¯ä¸ªæ–¹æ³•éƒ½è¦åœ¨æ¯ä¸ªå®ä¾‹ä¸Šé‡æ–°åˆ›å»ºä¸€éã€‚

ä¾‹å­ä¸­ï¼Œ`person1` å’Œ `person2` éƒ½æœ‰ä¸€ä¸ªåä¸º `sayName()` çš„æ–¹æ³•ï¼Œä½†é‚£ä¸¤ä¸ªæ–¹æ³•ä¸æ˜¯åŒä¸€ä¸ª Function çš„å®ä¾‹ã€‚ è¿™æ ·ä¸åŒå®ä¾‹ä¸Šçš„åŒåå‡½æ•°æ˜¯ä¸ç›¸ç­‰çš„.

```js
alert(person1.sayName == person2.sayName); //false
```

é€šè¿‡æŠŠå‡½æ•°å®šä¹‰è½¬ç§»åˆ°æ„é€ å‡½æ•°å¤–éƒ¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜:

```js
function Person(name, age, job) {
  this.name = name;
  this.age = age;
  this.job = job;
  this.sayName = sayName;
}

function sayName() {
  alert(this.name);
}

var person1 = new Person("Nicholas", 29, "Software Engineer");
var person2 = new Person("Greg", 27, "Doctor");
```

ä½†æ˜¯è¿™æ ·çš„è¯, åœ¨å¤–éƒ¨å®šä¹‰çš„æ–¹æ³•å°±æˆäº†å…¨å±€å‡½æ•°, è‡ªå®šä¹‰çš„å¼•ç”¨ç±»å‹ä¸æ¯«æ²¡æœ‰å°è£…æ€§. è¿™äº›é—®é¢˜å¯ä»¥é€šè¿‡ä½¿ç”¨åŸå‹æ¨¡å¼æ¥è§£å†³ã€‚

### åŸå‹æ¨¡å¼

åˆ›å»ºçš„æ¯ä¸ªå‡½æ•°éƒ½æœ‰ä¸€ä¸ª `prototype`ï¼ˆåŸå‹ï¼‰å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè€Œè¿™ä¸ªå¯¹è±¡çš„ç”¨é€”æ˜¯åŒ…å«å¯ä»¥ç”±ç‰¹å®šç±»å‹çš„æ‰€æœ‰å®ä¾‹å…±äº«çš„å±æ€§å’Œæ–¹æ³•ã€‚

ä¸€èˆ¬æ¥è¯´å¼€å‘ä¸­æˆ‘ä»¬å¸Œæœ›æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å®ä¾‹å±æ€§, ä½†æ˜¯å…±äº«æ–¹æ³•. æ‰€ä»¥å¼€å‘ä¸­æˆ‘ä»¬**ç»„åˆä½¿ç”¨æ„é€ å‡½æ•°æ¨¡å¼ & åŸå‹æ¨¡å¼**ã€‚æŠŠå®ä¾‹å±æ€§æ”¾åœ¨æ„é€ å‡½æ•°, æŠŠå…±äº«çš„å±æ€§å’Œæ–¹æ³•æ”¾åœ¨åŸå‹å¯¹è±¡ä¸­.

```js
function Person(name, age, job) {
  this.name = name;
  this.age = age;
  this.job = job;
  this.friends = ["Shelby", "Court"];
}

Person.prototype.sayName = function() {
  alert(this.name);
};

var person1 = new Person("Nicholas", 29, "Software Engineer");
var person2 = new Person("Greg", 27, "Doctor");

person1.friends.push("Van");
alert(person1.friends); //"Shelby,Count,Van"
alert(person2.friends); //"Shelby,Count"
alert(person1.friends === person2.friends); //false
alert(person1.sayName === person2.sayName); //true
```

#### ç†è§£åŸå‹å¯¹è±¡

åŸå‹å¯¹è±¡é»˜è®¤æœ‰ä¸€ä¸ª `constructor`ï¼ˆæ„é€ å‡½æ•°ï¼‰å±æ€§ï¼Œè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªæŒ‡å‘åŸå‹å¯¹è±¡æ‰€å±æ„é€ å‡½æ•°æŒ‡é’ˆ.

å½“è°ƒç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹åï¼Œè¯¥å®ä¾‹çš„å†…éƒ¨å°†åŒ…å«ä¸€ä¸ªæŒ‡é’ˆ `[[Prototype]]`ï¼ˆå†…éƒ¨å±æ€§ï¼‰ï¼ŒæŒ‡å‘æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚åœ¨å¾ˆå¤šæµè§ˆå™¨ä¸Š, å¯¹è±¡ä¸­çš„ `__proto__` å±æ€§æŒ‡å‘åŸå‹å¯¹è±¡ã€‚

![2020-09-12-05-27-05](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-12-05-27-05.png)

å¯ä»¥é€šè¿‡ `isPrototypeOf()` æ–¹æ³•æ¥ç¡®å®šå¯¹è±¡ä¹‹é—´æ˜¯å¦å­˜åœ¨åŸå‹ä¸å®ä¾‹çš„å…³ç³». ä»æœ¬è´¨ä¸Šè®²ï¼Œå¦‚æœå®ä¾‹å¯¹è±¡çš„ `[[Prototype]]` æŒ‡å‘è°ƒç”¨ `isPrototypeOf()` æ–¹æ³•çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±è¿”å› `true`

`Object.getPrototypeOf()` å¯ä»¥è¿”å› `[[Prototype]]` æŒ‡å‘çš„åŸå‹å¯¹è±¡.

#### å¯¹è±¡å­—é¢é‡é‡å†™åŸå‹å¯¹è±¡

å¯ä»¥ç”¨ä¸€ä¸ªåŒ…å«æ‰€æœ‰å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡å­—é¢é‡æ¥é‡å†™æ•´ä¸ªåŸå‹å¯¹è±¡

```js
function Person() {}

Person.prototype = {
  name: "Nicholas",
  age: 29,
  job: "Software Engineer",
  sayName: function() {
    alert(this.name);
  },
};
```

å‰é¢è¯´åŸå‹å¯¹è±¡çš„ `constructor` å±æ€§æŒ‡å‘åŸå‹å¯¹è±¡æ‰€åœ¨æ„é€ å‡½æ•°. ä½¿ç”¨å¯¹è±¡å­—é¢é‡é‡å†™åŸå‹å¯¹è±¡, `constructor` å±æ€§ä¹Ÿå°±è¢«æ”¹å†™äº†.

å¯ä»¥æ‰‹åŠ¨è®¾ç½® `constructor` å±æ€§çš„å€¼.

```js
function Person() {}

Person.prototype = {
  constructor: Person,
  name: "Nicholas",
  age: 29,
  job: "Software Engineer",
  sayName: function() {
    alert(this.name);
  },
};
```

æ³¨æ„ï¼Œä»¥è¿™ç§æ–¹å¼é‡è®¾ `constructor` å±æ€§ä¼šå¯¼è‡´å®ƒçš„ `[[Enumerable]]` ç‰¹æ€§è¢«è®¾ç½®ä¸º `true`ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŸç”Ÿçš„ `constructor` å±æ€§æ˜¯ä¸å¯æšä¸¾çš„

è¿™æ—¶å¯ä»¥ç”¨ `Object.defineProperty()` æ–¹æ³•æ¥è®¾ç½® `constructor`

```js
Object.defineProperty(Person.prototype, "constructor", {
  enumerable: false,
  value: Person,
});
```

#### æŠŠåŸå‹å¯¹è±¡å°è£…åœ¨æ„é€ å‡½æ•°ä¸­

åœ¨æ„é€ å‡½æ•°å¤–å®šä¹‰åŸå‹å¯¹è±¡, å¯èƒ½è¿˜æ˜¯ç¼ºä¹å°è£…æ€§. å¯ä»¥æ”¹æˆé€šè¿‡åœ¨æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–åŸå‹. åœ¨åˆæ¬¡è°ƒç”¨æ„é€ å‡½æ•°çš„æ—¶å€™åˆå§‹åŒ–åŸå‹.

```js
function Person(name, age, job) {
  //å±æ€§
  this.name = name;
  this.age = age;
  this.job = job;

  //æ–¹æ³•
  if (typeof this.sayName != "function") {
    Person.prototype.sayName = function() {
      alert(this.name);
    };
  }
}

var friend = new Person("Nicholas", 29, "Software Engineer");
friend.sayName();
```

ä¸Šé¢ä¾‹å­ä¸­, åªåœ¨ `sayName()` æ–¹æ³•ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šå°†å®ƒæ·»åŠ åˆ°åŸå‹ä¸­ã€‚è¿™æ®µä»£ç åªä¼šåœ¨åˆæ¬¡è°ƒç”¨æ„é€ å‡½æ•°æ—¶æ‰ä¼šæ‰§è¡Œã€‚æ­¤åï¼ŒåŸå‹å·²ç»å®Œæˆåˆå§‹åŒ–ã€‚

#### `Object.create()` æ–¹æ³•

Object.create() æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œä½¿ç”¨ä¸€ä¸ªç°æœ‰çš„å¯¹è±¡æ¥ä½œä¸ºæ–°åˆ›å»ºçš„å¯¹è±¡çš„åŸå‹ ( `__proto__` å±æ€§çš„å€¼ )

```js
const person = {
  isHuman: false,
  printIntroduction: function() {
    console.log(`My name is ${this.name}. Am I human? ${this.isHuman}`);
  },
};
const me = Object.create(person); // me.__proto__ === person
```

`Object.create()` æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

- `proto` å¿…å¡«å‚æ•°ï¼Œæ˜¯æ–°å¯¹è±¡çš„åŸå‹å¯¹è±¡ã€‚å¦‚æœè¿™ä¸ªå‚æ•°æ˜¯ `null`ï¼Œé‚£æ–°å¯¹è±¡å°±å½»å½»åº•åº•æ˜¯ä¸ªç©ºå¯¹è±¡ã€‚
- `propertiesObject` æ˜¯å¯é€‰å‚æ•°ï¼Œæ˜¯æ·»åŠ åˆ°æ–°å¯¹è±¡ä¸Šçš„å¯æšä¸¾çš„å±æ€§ï¼ŒåŠå…¶æè¿°ç¬¦çš„å¯¹è±¡ï¼Œè¿™äº›æ˜¯æ–°åˆ›å»ºå¯¹è±¡çš„è‡ªå®šä¹‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¯ç”¨ `hasOwnProperty()` è·å–çš„ï¼Œè€Œä¸æ˜¯åŸå‹å¯¹è±¡ä¸Šçš„ã€‚

```js
var bb = Object.create(null, {
  a: {
    value: 2,
    writable: true,
    configurable: true,
  },
});
console.dir(bb); // {a: 2}
console.log(bb.__proto__); // undefined
console.log(bb.__proto__ === Object.prototype); // false
console.log(bb instanceof Object); // false æ²¡æœ‰ç»§æ‰¿`Object.prototype`ä¸Šçš„ä»»ä½•å±æ€§å’Œæ–¹æ³•ï¼Œæ‰€ä»¥åŸå‹é“¾ä¸Šä¸ä¼šå‡ºç°Object
```

## ç»§æ‰¿

ç®€å•å›é¡¾ä¸€ä¸‹æ„é€ å‡½æ•°ã€åŸå‹å’Œå®ä¾‹çš„å…³ç³»ï¼šæ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ŒåŸå‹å¯¹è±¡éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆ `constructor`ï¼Œè€Œå®ä¾‹éƒ½åŒ…å«ä¸€ä¸ªæŒ‡å‘åŸå‹å¯¹è±¡çš„å†…éƒ¨æŒ‡é’ˆ `[[Prototype]]`ã€‚

### åŸå‹é“¾

åŸå‹é“¾æ˜¯å®ç°ç»§æ‰¿çš„ä¸»è¦æ–¹æ³•, åŸºæœ¬æ€æƒ³æ˜¯è®©çˆ¶ç±»å‹çš„å®ä¾‹ï¼Œä½œä¸ºå­ç±»å‹çš„åŸå‹å¯¹è±¡,ã€‚æ­¤æ—¶å­ç±»å‹çš„å®ä¾‹ï¼Œå°†å…±äº«ä½œä¸ºåŸå‹çš„çˆ¶ç±»å‹å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•ï¼Œä¹Ÿå°±å®ç°äº†å¯¹äºçˆ¶ç±»å‹çš„ç»§æ‰¿ã€‚

ä½œä¸ºå­ç±»å‹çš„åŸå‹å¯¹è±¡çš„çˆ¶ç±»å‹å®ä¾‹ï¼Œå°†åŒ…å«ä¸€ä¸ªæŒ‡å‘çˆ¶ç±»å‹åŸå‹çš„æŒ‡é’ˆã€‚åƒè¿™æ ·å±‚å±‚é€’è¿›ï¼Œå°±æ„æˆäº†åŸå‹çš„é“¾æ¡ã€‚è¿™å°±æ˜¯æ‰€è°“åŸå‹é“¾çš„åŸºæœ¬æ¦‚å¿µã€‚

```js
function SuperType() {
  this.property = true;
}

SuperType.prototype.getSuperValue = function() {
  return this.property;
};

function SubType() {
  this.subproperty = false;
}

//ç»§æ‰¿äº†SuperType
SubType.prototype = new SuperType();

SubType.prototype.getSubValue = function() {
  return this.subproperty;
};

var instance = new SubType();

alert(instance.getSuperValue()); //true
```

è¿™ä¸ªä¾‹å­ä¸­çš„å®ä¾‹ä»¥åŠæ„é€ å‡½æ•°å’ŒåŸå‹ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾:

![2020-09-12-08-18-54](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-12-08-18-54.png)

#### ç¡®å®šåŸå‹å’Œå®ä¾‹çš„å…³ç³»

å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥ç¡®å®šåŸå‹å’Œå®ä¾‹ä¹‹é—´çš„å…³ç³»ã€‚ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨ `instanceof` æ“ä½œç¬¦:

åªè¦æ“ä½œç¬¦å‰é¢å®ä¾‹å¯¹è±¡çš„åŸå‹é“¾ä¸­, å­˜åœ¨æ“ä½œç¬¦åé¢ç±»å‹çš„å®ä¾‹å¯¹è±¡, å°±è¿”å› `true`:

```js
alert(instance instanceof Object); //true
alert(instance instanceof SuperType); //true
alert(instance instanceof SubType); //true
```

ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨ `isPrototypeOf()` æ–¹æ³•ã€‚åŒæ ·ï¼Œåªè¦æ˜¯åŸå‹é“¾ä¸­å‡ºç°è¿‡çš„åŸå‹ï¼Œéƒ½å¯ä»¥è¯´æ˜¯è¯¥åŸå‹é“¾æ‰€æ´¾ç”Ÿçš„å®ä¾‹çš„åŸå‹ï¼Œå› æ­¤ `isPrototypeOf()` æ–¹æ³•ä¹Ÿä¼šè¿”å› `true`

```js
alert(Object.prototype.isPrototypeOf(instance)); //true
alert(SuperType.prototype.isPrototypeOf(instance)); //true
alert(SubType.prototype.isPrototypeOf(instance)); //true
```

---

`Object.getPrototypeOf` æ–¹æ³•è¿”å›æŒ‡å®šå¯¹è±¡çš„åŸå‹ã€‚

```js
Object.getPrototypeOf(instance); // Object { property: true, getSubValue: getSubValue() }
Object.getPrototypeOf(instance) instanceof SuperType; // true
```

å› æ­¤ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•åˆ¤æ–­ï¼Œä¸€ä¸ªç±»æ˜¯å¦ç»§æ‰¿äº†å¦ä¸€ä¸ªç±»ã€‚

#### é‡å†™æ·»åŠ è¶…ç±»å‹ä¸­çš„æ–¹æ³•

ç»™åŸå‹æ·»åŠ æ–¹æ³•çš„ä»£ç ä¸€å®šè¦æ”¾åœ¨æ›¿æ¢åŸå‹çš„è¯­å¥ä¹‹å

```js
function SuperType() {
  this.property = true;
}

SuperType.prototype.getSuperValue = function() {
  return this.property;
};

function SubType() {
  this.subproperty = false;
}

//ç»§æ‰¿äº†SuperType
SubType.prototype = new SuperType();

//æ·»åŠ æ–°æ–¹æ³•
SubType.prototype.getSubValue = function() {
  return this.subproperty;
};

//é‡å†™è¶…ç±»å‹ä¸­çš„æ–¹æ³•
SubType.prototype.getSuperValue = function() {
  return false;
};

var instance = new SubType();
alert(instance.getSuperValue()); //false
```

#### åŸå‹é“¾çš„é—®é¢˜

ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯, å› ä¸ºåŸå‹ä¸­çš„å±æ€§ä¼šè¢«å…¶å®ä¾‹å…±äº«. åœ¨é€šè¿‡åŸå‹æ¥å®ç°ç»§æ‰¿æ—¶ï¼Œå®ä¾‹å®é™…ä¸Šä¼šå˜æˆå¦ä¸€ä¸ªç±»å‹çš„åŸå‹ã€‚åŸå…ˆçš„å®ä¾‹å±æ€§ä¹Ÿå°±é¡ºç†æˆç« åœ°å˜æˆäº†ç°åœ¨çš„åŸå‹å±æ€§äº†ã€‚

```js
function SuperType() {
  this.colors = ["red", "blue", "green"];
}

function SubType() {}

//ç»§æ‰¿äº†SuperType
SubType.prototype = new SuperType();

var instance1 = new SubType();
instance1.colors.push("black");
alert(instance1.colors); //"red,blue,green,black"

var instance2 = new SubType();
alert(instance2.colors); //"red,blue,green,black"
```

ç¬¬äºŒä¸ªé—®é¢˜æ˜¯, åœ¨åˆ›å»ºå­ç±»å‹çš„å®ä¾‹æ—¶ï¼Œä¸èƒ½å‘è¶…ç±»å‹çš„æ„é€ å‡½æ•°ä¸­ä¼ é€’å‚æ•°ã€‚å®é™…ä¸Šï¼Œåº”è¯¥è¯´æ˜¯æ²¡æœ‰åŠæ³•åœ¨ä¸å½±å“æ‰€æœ‰å¯¹è±¡å®ä¾‹çš„æƒ…å†µä¸‹ï¼Œç»™è¶…ç±»å‹çš„æ„é€ å‡½æ•°ä¼ é€’å‚æ•°ã€‚

### å€Ÿç”¨æ„é€ å‡½æ•°

å€Ÿç”¨æ„é€ å‡½æ•°, ä¹Ÿå«åšä¼ªé€ å¯¹è±¡æˆ–ç»å…¸ç»§æ‰¿, æ€æƒ³æ˜¯åœ¨å­ç±»å‹æ„é€ å‡½æ•°çš„å†…éƒ¨è°ƒç”¨è¶…ç±»å‹æ„é€ å‡½æ•°. é€šè¿‡ä½¿ç”¨ `apply()` å’Œ `call()` æ–¹æ³•å¯ä»¥åœ¨ï¼ˆå°†æ¥ï¼‰æ–°åˆ›å»ºçš„å¯¹è±¡ä¸Šæ‰§è¡Œæ„é€ å‡½æ•°.

å‰é¢è¯´ `this` æŒ‡å‘å‡½æ•°è°ƒç”¨æ—¶æ‰€åœ¨çš„æ‰§è¡Œç¯å¢ƒ, æˆ–è€…è¯´è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å¯¹è±¡. åœ¨åˆ›å»ºå­ç±»å‹çš„å®ä¾‹çš„æ—¶å€™ `call()` æ–¹æ³•, è®©è¶…ç±»å‹çš„ `this` æŒ‡å‘æ–°å®ä¾‹.

```js
function SuperType() {
  this.colors = ["red", "blue", "green"];
}

function SubType() {
  //ç»§æ‰¿äº†SuperType
  SuperType.call(this);
}

var instance1 = new SubType();

instance1.colors.push("black");
alert(instance1.colors); //"red,blue,green,black"

var instance2 = new SubType();
alert(instance2.colors); //"red,blue,green"
```

é€šè¿‡ä½¿ç”¨ `call()` æ–¹æ³•ï¼ˆæˆ– `apply()` æ–¹æ³•ä¹Ÿå¯ä»¥ï¼‰ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨ï¼ˆæœªæ¥å°†è¦ï¼‰æ–°åˆ›å»ºçš„ `SubType` å®ä¾‹çš„ç¯å¢ƒä¸‹è°ƒç”¨äº† `SuperType` æ„é€ å‡½æ•°ã€‚è¿™æ ·ä¸€æ¥ï¼Œå°±ä¼šåœ¨æ–° `SubType` å¯¹è±¡ä¸Šæ‰§è¡Œ `SuperType()` å‡½æ•°ä¸­å®šä¹‰çš„æ‰€æœ‰å¯¹è±¡åˆå§‹åŒ–ä»£ç ã€‚ç»“æœï¼Œ `SubType` çš„æ¯ä¸ªå®ä¾‹å°±éƒ½ä¼šå…·æœ‰è‡ªå·±çš„ `colors` å±æ€§çš„å‰¯æœ¬äº†ã€‚

#### ä¼ é€’å‚æ•°

é€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°, å¯ä»¥åœ¨å­ç±»å‹æ„é€ å‡½æ•°ä¸­å‘è¶…ç±»å‹æ„é€ å‡½æ•°ä¼ é€’å‚æ•°

```js
function SuperType(name) {
  this.name = name;
}

function SubType() {
  //ç»§æ‰¿äº†SuperTypeï¼ŒåŒæ—¶è¿˜ä¼ é€’äº†å‚æ•°
  SuperType.call(this, "Nicholas");

  //å®ä¾‹å±æ€§
  this.age = 29;
}

var instance = new SubType();
alert(instance.name); //"Nicholas";
alert(instance.age); //29
```

#### å€Ÿç”¨æ„é€ å‡½æ•°çš„é—®é¢˜

ä½†æ˜¯è¿™æ ·çš„è¯, ç»§æ‰¿æ¥çš„æ–¹æ³•éƒ½åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ï¼Œå› æ­¤å‡½æ•°å¤ç”¨å°±æ— ä»è°ˆèµ·äº†ã€‚

### ç»„åˆç»§æ‰¿

ç»„åˆç»§æ‰¿, ä¹Ÿå«åšã€Œ ä¼ªç»å…¸ç»§æ‰¿ ã€, æŒ‡çš„æ˜¯å°†åŸå‹é“¾å’Œå€Ÿç”¨æ„é€ å‡½æ•°çš„æŠ€æœ¯ç»„åˆåˆ°ä¸€å—ã€‚

æ€è·¯æ˜¯ä½¿ç”¨åŸå‹é“¾å®ç°å¯¹åŸå‹å±æ€§å’Œæ–¹æ³•çš„ç»§æ‰¿ï¼Œè€Œé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥å®ç°å¯¹å®ä¾‹å±æ€§çš„ç»§æ‰¿ã€‚è¿™æ ·ï¼Œæ—¢é€šè¿‡åœ¨åŸå‹ä¸Šå®šä¹‰æ–¹æ³•å®ç°äº†å‡½æ•°å¤ç”¨ï¼Œåˆèƒ½å¤Ÿä¿è¯æ¯ä¸ªå®ä¾‹éƒ½æœ‰å®ƒè‡ªå·±çš„å±æ€§ã€‚

```js
function SuperType(name) {
  this.name = name;
  this.colors = ["red", "blue", "green"];
}

SuperType.prototype.sayName = function() {
  alert(this.name);
};

function SubType(name, age) {
  //ç»§æ‰¿å±æ€§
  // å› ä¸ºåœ¨è¿™é‡Œä¼ é€’å‚æ•°, SubType åŸå‹ä¸­çš„ SuperType å±æ€§ä¼šè¢«è¦†ç›–
  SuperType.call(this, name);

  this.age = age;
}

//ç»§æ‰¿æ–¹æ³•
SubType.prototype = new SuperType();

// å› ä¸º SubType åŸå‹æ˜¯ SuperType å®ä¾‹, æ‰€ä»¥ åŸå‹çš„ construtor æŒ‡å‘çš„æ˜¯è¶…ç±»å‹, è¦æ‰‹åŠ¨è®¾ç½®.
SubType.prototype.constructor = SubType;
SubType.prototype.sayAge = function() {
  alert(this.age);
};

var instance1 = new SubType("Nicholas", 29);
instance1.colors.push("black");
alert(instance1.colors); //"red,blue,green,black"
instance1.sayName(); //"Nicholas";
instance1.sayAge(); //29

var instance2 = new SubType("Greg", 27);
alert(instance2.colors); //"red,blue,green"
instance2.sayName(); //"Greg";
instance2.sayAge(); //27
```

è¿™ç§æ˜¯ JavaScript ä¸­æœ€å¸¸ç”¨çš„ç»§æ‰¿æ¨¡å¼ã€‚

## ç±»

å¯ä»¥çœ‹å‡ºï¼Œå‰é¢æ‰€è®²çš„å®ç°ç»§æ‰¿çš„ä»£ç éå¸¸å†—é•¿å’Œæ··ä¹±ã€‚

ECMAScript 6 æ–°å¼•å…¥çš„ `class` å…³é”®å­—å…·æœ‰æ­£å¼å®šä¹‰ç±»çš„èƒ½åŠ›ã€‚è¡¨é¢ä¸Šçœ‹èµ·æ¥å¯ä»¥æ”¯æŒæ­£å¼çš„é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œä½†å®é™…ä¸Šå®ƒèƒŒåä½¿ç”¨çš„ä»ç„¶æ˜¯åŸå‹å’Œæ„é€ å‡½æ•°çš„æ¦‚å¿µã€‚

```js
// ES5 åŸå‹æ¨¡å¼
function Point(x, y) {
  this.x = x;
  this.y = y;
}

Point.prototype.toString = function() {
  return "(" + this.x + ", " + this.y + ")";
};

var p = new Point(1, 2);
```

ä¸Šé¢ä»£ç ç”¨ `class` æ”¹å†™çš„è¯ä¸º:

```js
class Point {
  constructor(x, y) {
    this.x = x;
    this.y = y;
  }

  toString() {
    return "(" + this.x + ", " + this.y + ")";
  }
}

var p = new Point(1, 2);
```

`constructor` æ–¹æ³•ï¼Œè¿™å°±æ˜¯æ„é€ æ–¹æ³•ï¼Œè€Œ `this` å…³é”®å­—åˆ™ä»£è¡¨å®ä¾‹å¯¹è±¡ã€‚

å®šä¹‰ â€œç±»â€ çš„æ–¹æ³•çš„æ—¶å€™ï¼Œå‰é¢ä¸éœ€è¦åŠ ä¸Š `function` è¿™ä¸ªå…³é”®å­—ï¼Œç›´æ¥æŠŠå‡½æ•°å®šä¹‰æ”¾è¿›å»äº†å°±å¯ä»¥äº†ã€‚å¦å¤–ï¼Œæ–¹æ³•ä¹‹é—´ä¸éœ€è¦é€—å· `,` åˆ†éš”ï¼ŒåŠ äº†ä¼šæŠ¥é”™ã€‚

åˆ›å»ºå®ä¾‹çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ç›´æ¥å¯¹ "ç±»" ä½¿ç”¨ `new` å‘½ä»¤ï¼Œè·Ÿæ„é€ å‡½æ•°çš„ç”¨æ³•å®Œå…¨ä¸€è‡´ã€‚

```js
class Point {
  // ...
}

typeof Point; // "function"
Point === Point.prototype.constructor; // true
```

ä¸Šé¢ä»£ç è¡¨æ˜, å…¶å® ES6 çš„ç±»ï¼Œå®Œå…¨å¯ä»¥çœ‹ä½œæ„é€ å‡½æ•°çš„å¦ä¸€ç§å†™æ³•ã€‚ç±»çš„æ•°æ®ç±»å‹å°±æ˜¯å‡½æ•°ï¼Œç±»æœ¬èº«å°±æŒ‡å‘æ„é€ å‡½æ•°ã€‚ç±»çš„æ‰€æœ‰æ–¹æ³•ä¹Ÿéƒ½å®šä¹‰åœ¨ç±»çš„ `prototype` å±æ€§ä¸Šé¢ã€‚

---

ä¸ ES5 ä¸åŒçš„æ˜¯, ç±»çš„å†…éƒ¨æ‰€æœ‰å®šä¹‰çš„æ–¹æ³•ï¼Œéƒ½æ˜¯ä¸å¯æšä¸¾çš„. è¿™ä¸€ç‚¹ä¸ ES5 çš„è¡Œä¸ºä¸ä¸€è‡´ã€‚

ç±»ä¸å­˜åœ¨å‡½æ•°æå‡ hoistï¼Œè¿™ä¸€ç‚¹ä¸ ES5 å®Œå…¨ä¸åŒã€‚

```js
new Foo(); // ReferenceError
class Foo {}
```

### é™æ€æ–¹æ³• & é™æ€å±æ€§

æ‰€æœ‰åœ¨ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œéƒ½ä¼šè¢«å®ä¾‹ç»§æ‰¿ã€‚å¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•å‰ï¼ŒåŠ ä¸Š `static` å…³é”®å­—ï¼Œå°±è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ä¼šè¢«å®ä¾‹ç»§æ‰¿ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨ï¼Œè¿™å°±ç§°ä¸º â€œ**é™æ€æ–¹æ³•**â€ã€‚

```js
class Foo {
  static classMethod() {
    return "hello";
  }
}

Foo.classMethod(); // 'hello'

var foo = new Foo();
foo.classMethod();
// TypeError: foo.classMethod is not a function
```

æ³¨æ„ï¼Œå¦‚æœé™æ€æ–¹æ³•åŒ…å« `this` å…³é”®å­—ï¼Œè¿™ä¸ª `this` æŒ‡çš„æ˜¯ç±»ï¼Œè€Œä¸æ˜¯å®ä¾‹ã€‚

---

"**é™æ€å±æ€§**" æŒ‡çš„æ˜¯ Class æœ¬èº«çš„å±æ€§ï¼Œè€Œä¸æ˜¯å®šä¹‰åœ¨å®ä¾‹å¯¹è±¡ä¸Šçš„å±æ€§ã€‚

```js
class Foo {}

Foo.prop = 1;
Foo.prop; // 1
```

ä¸Šé¢çš„å†™æ³•ä¸º `Foo` ç±»å®šä¹‰äº†ä¸€ä¸ªé™æ€å±æ€§ `prop`ã€‚

ç°åœ¨æœ‰ä¸€ä¸ªææ¡ˆæä¾›äº†ç±»çš„é™æ€å±æ€§ï¼Œå†™æ³•æ˜¯åœ¨å®ä¾‹å±æ€§æ³•çš„å‰é¢ï¼ŒåŠ ä¸Š `static` å…³é”®å­—ã€‚

```js
class MyClass {
  static myStaticProp = 42;

  constructor() {}
}

const x = new MyClass();
console.log(x.myStaticProp); // undefined
console.log(MyClass.myStaticProp); // 42
```

### extends ç»§æ‰¿

Class å¯ä»¥é€šè¿‡ `extends` å…³é”®å­—å®ç°ç»§æ‰¿ï¼Œè¿™æ¯” ES5 çš„é€šè¿‡ä¿®æ”¹åŸå‹é“¾å®ç°ç»§æ‰¿ï¼Œè¦æ¸…æ™°å’Œæ–¹ä¾¿å¾ˆå¤šã€‚

```js
class Point {
  constructor(x, y) {
    this.x = x;
    this.y = y;
  }
}

class ColorPoint extends Point {
  constructor(x, y, color) {
    super(x, y); // è°ƒç”¨çˆ¶ç±»çš„ constructor(x, y)
    this.color = color;
  }

  toString() {
    return this.color + " " + super.toString(); // è°ƒç”¨çˆ¶ç±»çš„toString()
  }
}

let cp = new ColorPoint(25, 8, "green");

cp instanceof ColorPoint; // true
cp instanceof Point; // true
```

#### super

`super` å…³é”®å­—ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œè¡¨ç¤ºçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç”¨æ¥æ–°å»ºçˆ¶ç±»çš„ `this` å¯¹è±¡ã€‚

å­ç±»å¿…é¡»åœ¨ `constructor` æ–¹æ³•ä¸­è°ƒç”¨ `super` æ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®ä¾‹æ—¶ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºå­ç±»è‡ªå·±çš„ `this` å¯¹è±¡ï¼Œå¿…é¡»å…ˆé€šè¿‡çˆ¶ç±»çš„æ„é€ å‡½æ•°å®Œæˆå¡‘é€ ï¼Œå¾—åˆ°ä¸çˆ¶ç±»åŒæ ·çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ï¼Œåœ¨æ­¤åŸºç¡€åŠ ä¸Šå­ç±»è‡ªå·±çš„å®ä¾‹å±æ€§å’Œæ–¹æ³•ã€‚

ä¸Šé¢ä»£ç ä¸­ `super()` ç›¸å½“äº `Point.prototype.constructor.call(this)`

âš ï¸ æ³¨æ„: çˆ¶ç±»çš„é™æ€æ–¹æ³•ï¼Œä¹Ÿä¼šè¢«å­ç±»ç»§æ‰¿

#### ç±»çš„ prototype å±æ€§ & **proto** å±æ€§

å‰é¢è¯´è¿‡, ES5 å®ç°ä¹‹ä¸­ï¼Œæ¯ä¸€ä¸ªå®ä¾‹éƒ½æœ‰ `__proto__` å±æ€§ï¼ŒæŒ‡å‘å¯¹åº”çš„æ„é€ å‡½æ•°çš„ `prototype` å±æ€§ã€‚Class ä½œä¸ºæ„é€ å‡½æ•°çš„è¯­æ³•ç³–ï¼ŒåŒæ—¶æœ‰ `prototype` å±æ€§å’Œ `__proto__` å±æ€§

- å­ç±»çš„ `__proto__` å±æ€§ï¼Œè¡¨ç¤ºæ„é€ å‡½æ•°çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»ã€‚
- å­ç±»çš„ `prototype` å±æ€§çš„ `__proto__` å±æ€§ï¼Œè¡¨ç¤ºæ–¹æ³•çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»çš„ `prototype` å±æ€§ã€‚

```js
class A {}

class B extends A {}

B.__proto__ === A; // true
B.prototype.__proto__ === A.prototype; // true
```

å¯ä»¥è¿™æ ·ç†è§£ï¼šä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå­ç±»ï¼ˆBï¼‰çš„åŸå‹ï¼ˆ`__proto__` å±æ€§ï¼‰æ˜¯çˆ¶ç±»ï¼ˆAï¼‰ï¼›ä½œä¸ºä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå­ç±»ï¼ˆBï¼‰çš„åŸå‹å¯¹è±¡ï¼ˆ`prototype` å±æ€§ï¼‰æ˜¯çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼ˆ`prototype` å±æ€§ï¼‰çš„å®ä¾‹ã€‚

å­ç±»å®ä¾‹çš„ `__proto__` å±æ€§çš„ `__proto__` å±æ€§ï¼ŒæŒ‡å‘çˆ¶ç±»å®ä¾‹çš„ `__proto__` å±æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå­ç±»çš„åŸå‹çš„åŸå‹ï¼Œæ˜¯çˆ¶ç±»çš„åŸå‹ã€‚

```js
var p1 = new Point(2, 3);
var p2 = new ColorPoint(2, 3, "red");

p2.__proto__ === p1.__proto__; // false
p2.__proto__.__proto__ === p1.__proto__; // true
```

### æŠ½è±¡ç±»

è™½ç„¶ ECMAScript æ²¡æœ‰ä¸“é—¨æ”¯æŒæŠ½è±¡ç±»ï¼Œä½†é€šè¿‡ `new.target` ä¹Ÿå¾ˆå®¹æ˜“å®ç°ã€‚`new.target` ä¿å­˜é€šè¿‡ `new` å…³é”®å­—è°ƒç”¨çš„ç±»æˆ–å‡½æ•°ã€‚é€šè¿‡åœ¨å®ä¾‹åŒ–æ—¶æ£€æµ‹ `new.target` æ˜¯ä¸æ˜¯å½“å‰ç±»ï¼Œå¯ä»¥é˜»æ­¢å¯¹å½“å‰ç±»çš„å®ä¾‹åŒ–ï¼š

```js
// æŠ½è±¡åŸºç±»
class Vehicle {
  constructor() {
    console.log(new.target);
    if (new.target === Vehicle) {
      throw new Error("Vehicle cannot be directly instantiated");
    }
  }
}

// æ´¾ç”Ÿç±»
class Bus extends Vehicle {}

new Bus(); // class Bus {}
new Vehicle(); // class Vehicle {}
// Error: Vehicle cannot be directly instantiated
```

å¦å¤–ï¼Œé€šè¿‡åœ¨æŠ½è±¡ç±»æ„é€ å‡½æ•°ä¸­è¿›è¡Œæ£€æŸ¥ï¼Œå¯ä»¥è¦æ±‚æ´¾ç”Ÿç±»å¿…é¡»å®šä¹‰æŸä¸ªæ–¹æ³•ã€‚å› ä¸ºåŸå‹æ–¹æ³•åœ¨è°ƒç”¨ç±»æ„é€ å‡½æ•°ä¹‹å‰å°±å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ `this` å…³é”®å­—æ¥æ£€æŸ¥ç›¸åº”çš„æ–¹æ³•ã€‚

```js
// æŠ½è±¡åŸºç±»
class Vehicle {
  constructor() {
    if (new.target === Vehicle) {
      throw new Error("Vehicle cannot be directly instantiated");
    }

    if (!this.foo) {
      throw new Error("Inheriting class must define foo()");
    }

    console.log("success!");
  }
}

// æ´¾ç”Ÿç±»
class Bus extends Vehicle {
  foo() {}
}

// æ´¾ç”Ÿç±»
class Van extends Vehicle {}

new Bus(); // success!
new Van(); // Error: Inheriting class must define foo()
```

## ä»£ç† Proxy & åå°„ Reflect

ECMAScript 6 æ–°å¢çš„ä»£ç†å’Œåå°„ç‰¹æ€§ï¼Œå…è®¸å¼€å‘è€…ç»™ç›®æ ‡å¯¹è±¡å®šä¹‰ä¸€ä¸ªå…³è”çš„ä»£ç†å¯¹è±¡ï¼Œè€Œè¿™ä¸ªä»£ç†å¯¹è±¡å¯ä»¥ä½œä¸ºæŠ½è±¡çš„ç›®æ ‡å¯¹è±¡æ¥ä½¿ç”¨ï¼Œå¯¹äºä»£ç†å¯¹è±¡çš„æ“ä½œéƒ½ä¼šè½¬å‘åˆ°ç›®æ ‡å¯¹è±¡ä¸Šã€‚

### ä»£ç†åŸºç¡€

æœ€ç®€å•çš„ä»£ç†æ˜¯ç©ºä»£ç†ï¼Œå³é™¤äº†ä½œä¸ºä¸€ä¸ªæŠ½è±¡çš„ç›®æ ‡å¯¹è±¡ï¼Œä»€ä¹ˆä¹Ÿä¸åšã€‚

ä½¿ç”¨ `Proxy` æ„é€ å‡½æ•°åˆ›çš„ã€‚è¿™ä¸ªæ„é€ å‡½æ•°æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡ & å¤„ç†ç¨‹åºå¯¹è±¡ã€‚

è¦åˆ›å»ºç©ºä»£ç†ï¼Œå¯ä»¥ä¼ ä¸€ä¸ªç®€å•çš„å¯¹è±¡å­—é¢é‡ä½œä¸ºå¤„ç†ç¨‹åºå¯¹è±¡

```js
const target = {
  id: "target",
};

const handler = {};

const proxy = new Proxy(target, handler);

// idå±æ€§ä¼šè®¿é—®åŒä¸€ä¸ªå€¼
console.log(target.id); // target
console.log(proxy.id); // target

// ç»™ç›®æ ‡å±æ€§èµ‹å€¼ä¼šåæ˜ åœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Š
// å› ä¸ºä¸¤ä¸ªå¯¹è±¡è®¿é—®çš„æ˜¯åŒä¸€ä¸ªå€¼
target.id = "foo";
console.log(target.id); // foo
console.log(proxy.id); // foo

// ç»™ä»£ç†å±æ€§èµ‹å€¼ä¼šåæ˜ åœ¨ä¸¤ä¸ªå¯¹è±¡ä¸Š
// å› ä¸ºè¿™ä¸ªèµ‹å€¼ä¼šè½¬ç§»åˆ°ç›®æ ‡å¯¹è±¡
proxy.id = "bar";
console.log(target.id); // bar
console.log(proxy.id); // bar

// hasOwnProperty()æ–¹æ³•åœ¨ä¸¤ä¸ªåœ°æ–¹
// éƒ½ä¼šåº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡
console.log(target.hasOwnProperty("id")); // true
console.log(proxy.hasOwnProperty("id")); // true

// Proxy.prototypeæ˜¯undefined
// å› æ­¤ä¸èƒ½ä½¿ç”¨instanceofæ“ä½œç¬¦
console.log(target instanceof Proxy); // TypeError: Function has non-object prototype 'undefined' in instanceof check
console.log(proxy instanceof Proxy); // TypeError: Function has non-object prototype 'undefined' in instanceof check

// ä¸¥æ ¼ç›¸ç­‰å¯ä»¥ç”¨æ¥åŒºåˆ†ä»£ç†å’Œç›®æ ‡
console.log(target === proxy); // false
```

#### å¯æ’¤é”€ä»£ç†

ä½¿ç”¨ `new Proxy()` åˆ›å»ºçš„æ™®é€šä»£ç†ï¼Œä»£ç†å¯¹è±¡ä¸ç›®æ ‡å¯¹è±¡ä¹‹é—´çš„è”ç³»ä¼šåœ¨ä»£ç†å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå†…ä¸€ç›´æŒç»­å­˜åœ¨ã€‚

`Proxy` æä¾› `revocable()` æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ”¯æŒå¯æ’¤é”€ä»£ç†å¯¹è±¡ä¸ç›®æ ‡å¯¹è±¡çš„å…³è”ã€‚

- é€šè¿‡è°ƒç”¨ä»£ç†å¯¹è±¡çš„æ’¤é”€å‡½æ•° `revoke()` å°±å¯ä»¥æ–­å¼€ä»£ç†å¯¹è±¡ä¸ç›®æ ‡å¯¹è±¡ä¹‹é—´çš„å…³ç³»ã€‚
- æ’¤é”€ä»£ç†çš„æ“ä½œæ˜¯ä¸å¯é€†çš„ã€‚

```js
const target = {
  foo: "bar",
};

const handler = {
  get() {
    return "intercepted";
  },
};

const { proxy, revoke } = Proxy.revocable(target, handler);

console.log(proxy.foo); // intercepted
console.log(target.foo); // bar

revoke(); // æ–­å¼€

console.log(proxy.foo); // TypeError
```

### ä»£ç†æ•è·å™¨ & åå°„æ–¹æ³•

ã€Œ æ•è·å™¨ Trap ã€å°±æ˜¯åœ¨å¤„ç†ç¨‹åºå¯¹è±¡ä¸­å®šä¹‰çš„ â€œåŸºæœ¬æ“ä½œçš„æ‹¦æˆªå™¨â€ã€‚

- æ¯ä¸ªå¤„ç†ç¨‹åºå¯¹è±¡å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªæ•è·å™¨ï¼Œæ¯ä¸ªæ•è·å™¨éƒ½å¯¹åº”ä¸€ç§åŸºæœ¬æ“ä½œã€‚
- æ¯æ¬¡åœ¨ä»£ç†å¯¹è±¡ä¸Šè°ƒç”¨è¿™äº›åŸºæœ¬æ“ä½œæ—¶ï¼Œä»£ç†å¯ä»¥åœ¨è¿™äº›æ“ä½œä¼ æ’­åˆ°ç›®æ ‡å¯¹è±¡ä¹‹å‰å…ˆè°ƒç”¨æ•è·å™¨å‡½æ•°ã€‚

ğŸŒ° ä¾‹å¦‚ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ª `get()` æ•è·å™¨ã€‚åœ¨ä»£ç†å¯¹è±¡ä¸Šæ‰§è¡Œ `proxy[property]`ã€`proxy.property` æˆ– `Object.create(proxy)[property]` ç­‰æ“ä½œéƒ½ä¼šè§¦å‘åŸºæœ¬çš„ `get()` æ“ä½œä»¥è·å–å±æ€§ã€‚

æ³¨æ„ï¼Œåªæœ‰åœ¨ä»£ç†å¯¹è±¡ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œæ‰ä¼šè§¦å‘æ•è·å™¨ã€‚åœ¨ç›®æ ‡å¯¹è±¡ä¸Šæ‰§è¡Œè¿™äº›æ“ä½œä»ç„¶ä¼šäº§ç”Ÿæ­£å¸¸çš„è¡Œä¸ºã€‚

```js
const target = {
  foo: "bar",
};

const handler = {
  // æ•è·å™¨åœ¨å¤„ç†ç¨‹åºå¯¹è±¡ä¸­ä»¥æ–¹æ³•åä¸ºé”®
  get() {
    return "handler override";
  },
};

const proxy = new Proxy(target, handler);

console.log(target.foo); // bar
console.log(proxy.foo); // handler override

console.log(target["foo"]); // bar
console.log(proxy["foo"]); // handler override

console.log(Object.create(target)["foo"]); // bar
console.log(Object.create(proxy)["foo"]); // handler override
```

#### æ•è·å™¨å‚æ•° & åå°„ API

æ‰€æœ‰æ•è·å™¨éƒ½å¯ä»¥è®¿é—®ç›¸åº”çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼Œ`get()` æ•è·å™¨ä¼šæ¥æ”¶åˆ°ç›®æ ‡å¯¹è±¡ã€è¦æŸ¥è¯¢çš„å±æ€§å’Œä»£ç†å¯¹è±¡ä¸‰ä¸ªå‚æ•°ã€‚

```js
const target = {
  foo: "bar",
};

const handler = {
  get(trapTarget, property, receiver) {
    console.log(trapTarget === target);
    console.log(property);
    console.log(receiver === proxy);
  },
};

const proxy = new Proxy(target, handler);

proxy.foo;
// true
// foo
// true
```

æœ‰äº†è¿™äº›å‚æ•°ï¼Œå°±å¯ä»¥é‡å»ºè¢«æ•è·æ–¹æ³•çš„åŸå§‹è¡Œä¸ºï¼š

```js
const target = {
  foo: "bar",
};

const handler = {
  get(trapTarget, property, receiver) {
    return trapTarget[property];
  },
};

const proxy = new Proxy(target, handler);

console.log(proxy.foo); // bar
console.log(target.foo); // bar
```

ä½†æ˜¯å¹¶ä¸æ˜¯æ¯ä¸ªåŸå§‹è¡Œä¸ºéƒ½å¦‚ `get()` è¿™ä¹ˆç®€å•ï¼Œå®é™…ä¸Šï¼Œå¼€å‘è€…å¹¶ä¸éœ€è¦æ‰‹åŠ¨é‡å»ºåŸå§‹è¡Œä¸ºã€‚

å¤„ç†ç¨‹åºå¯¹è±¡ä¸­æ‰€æœ‰å¯ä»¥æ•è·çš„æ–¹æ³•éƒ½æœ‰å¯¹åº”çš„ã€Œ **åå°„ API æ–¹æ³•** ã€è¿™äº›æ–¹æ³•ä¸æ•è·å™¨çš„æ‹¦æˆªæ–¹æ³•å…·æœ‰ç›¸åŒçš„åç§°å’Œå‡½æ•°ç­¾åï¼Œè€Œä¸”ä¹Ÿå…·æœ‰ä¸è¢«æ‹¦æˆªæ–¹æ³•ç›¸åŒçš„è¡Œä¸ºã€‚

å› æ­¤ï¼Œä½¿ç”¨åå°„ API æ–¹æ³•å°±å¯ä»¥é‡å»ºåŸå§‹è¡Œä¸ºã€‚

```js
const target = {
  foo: "bar",
};

const handler = {
  get() {
    return Reflect.get(...arguments);
  },
};

const proxy = new Proxy(target, handler);

console.log(proxy.foo); // bar
console.log(target.foo); // bar
```

#### æ•è·å™¨ä¸å˜å¼

æ•è·å¤„ç†ç¨‹åºçš„è¡Œä¸ºå¿…é¡»éµå¾ª â€œæ•è·å™¨ä¸å˜å¼â€ã€‚æ•è·å™¨ä¸å˜å¼å› æ–¹æ³•ä¸åŒè€Œå¼‚ï¼Œä½†é€šå¸¸éƒ½ä¼šé˜²æ­¢æ•è·å™¨å®šä¹‰å‡ºç°è¿‡äºåå¸¸çš„è¡Œä¸ºã€‚

ğŸŒ° æ¯”å¦‚ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æœ‰ä¸€ä¸ªä¸å¯é…ç½®ä¸”ä¸å¯å†™çš„æ•°æ®å±æ€§ï¼Œé‚£ä¹ˆåœ¨ `get()` æ•è·å™¨è¿”å›ä¸€ä¸ªä¸è¯¥å±æ€§ä¸åŒçš„å€¼æ—¶ï¼Œä¼šæŠ›å‡º `TypeError`ï¼š

```js
const target = {};
Object.defineProperty(target, "foo", {
  configurable: false,
  writable: false,
  value: "bar",
});

const handler = {
  get() {
    return "qux";
  },
};

const proxy = new Proxy(target, handler);

console.log(proxy.foo);
// TypeError
```

#### æ•è·å™¨ç§ç±»

ä»£ç†å¯ä»¥æ•è· 13 ç§ä¸åŒçš„åŸºæœ¬æ“ä½œã€‚è¿™äº›æ“ä½œæœ‰å„è‡ªä¸åŒçš„åå°„ API æ–¹æ³•ã€å‚æ•°ã€å…³è” ECMAScript æ“ä½œå’Œä¸å˜å¼ã€‚

æœ‰å‡ ç§ä¸åŒçš„ JavaScript æ“ä½œä¼šè°ƒç”¨åŒä¸€ä¸ªæ•è·å™¨å¤„ç†ç¨‹åºã€‚

**`get()` æ•è·å™¨**ä¼šåœ¨è·å–å±æ€§å€¼çš„æ“ä½œä¸­è¢«è°ƒç”¨ã€‚

- åå°„ APIï¼š`Reflect.get()`
- è¿”å›å€¼ï¼šè¿”å›å€¼æ— é™åˆ¶
- æ‹¦æˆªçš„æ“ä½œï¼š
  - `proxy.property`
  - `proxy[property]`
  - `Object.create(proxy)[property]`
  - `Reflect.get(proxy, property, receiver)`
- æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š
  - `target`ï¼šç›®æ ‡å¯¹è±¡ã€‚
  - `property`ï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²é”®å±æ€§ã€‚
  - `receiver`ï¼šä»£ç†å¯¹è±¡æˆ–ç»§æ‰¿ä»£ç†å¯¹è±¡çš„å¯¹è±¡ã€‚
- æ•è·å™¨ä¸å˜å¼ï¼š
  - å¦‚æœ `target.property` ä¸å¯å†™ä¸”ä¸å¯é…ç½®ï¼Œåˆ™å¤„ç†ç¨‹åºè¿”å›çš„å€¼å¿…é¡»ä¸ `target.property` åŒ¹é…ã€‚
  - å¦‚æœ `target.property` ä¸å¯é…ç½®ä¸” `[[Get]]` ç‰¹æ€§ä¸º `undefined`ï¼Œå¤„ç†ç¨‹åºçš„è¿”å›å€¼ä¹Ÿå¿…é¡»æ˜¯ `undefined`ã€‚

```js
const myTarget = {};

const proxy = new Proxy(myTarget, {
  get(target, property, receiver) {
    console.log("get()");
    return Reflect.get(...arguments);
  },
});

proxy.foo;
// get()
```

---

**`set()` æ•è·å™¨**ä¼šåœ¨è®¾ç½®å±æ€§å€¼çš„æ“ä½œä¸­è¢«è°ƒç”¨ã€‚

- åå°„ APIï¼š`Reflect.set()`
- è¿”å›å€¼ï¼šè¿”å› `true` è¡¨ç¤ºæˆåŠŸï¼›è¿”å› `false` è¡¨ç¤ºå¤±è´¥ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ä¼šæŠ›å‡º TypeErrorã€‚
- æ‹¦æˆªçš„æ“ä½œï¼š
  - `proxy.property = value`
  - `proxy[property] = value`
  - `Object.create(proxy)[property] = value`
  - `Reflect.set(proxy, property, value, receiver)`
- æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š
  - `target`ï¼šç›®æ ‡å¯¹è±¡ã€‚
  - `property`ï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²é”®å±æ€§ã€‚
  - `value`ï¼šè¦èµ‹ç»™å±æ€§çš„å€¼ã€‚
  - `receiver`ï¼šæ¥æ”¶æœ€åˆèµ‹å€¼çš„å¯¹è±¡ã€‚
- æ•è·å™¨ä¸å˜å¼
  - å¦‚æœ `target.property` ä¸å¯å†™ä¸”ä¸å¯é…ç½®ï¼Œåˆ™ä¸èƒ½ä¿®æ”¹ç›®æ ‡å±æ€§çš„å€¼ã€‚
  - å¦‚æœ `target.property` ä¸å¯é…ç½®ä¸” `[[Set]]` ç‰¹æ€§ä¸º `undefined`ï¼Œåˆ™ä¸èƒ½ä¿®æ”¹ç›®æ ‡å±æ€§çš„å€¼ã€‚
  - åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå¤„ç†ç¨‹åºä¸­è¿”å› `false` ä¼šæŠ›å‡º `TypeError`ã€‚

```js
const myTarget = {};

const proxy = new Proxy(myTarget, {
  set(target, property, value, receiver) {
    console.log("set()");
    return Reflect.set(...arguments);
  },
});

proxy.foo = "bar";
// set()
```

---

**`has()` æ•è·å™¨**ä¼šåœ¨ `in` æ“ä½œç¬¦ä¸­è¢«è°ƒç”¨ã€‚

- åå°„ APIï¼š`Reflect.has()`
- è¿”å›å€¼ï¼šå¿…é¡»è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦å­˜åœ¨ã€‚è¿”å›éå¸ƒå°”å€¼ä¼šè¢«è½¬å‹ä¸ºå¸ƒå°”å€¼ã€‚
- æ‹¦æˆªçš„æ“ä½œï¼š
  - `property in proxy`
  - `property in Object.create(proxy)`
  - `with(proxy) {(property);}`
  - `Reflect.has(proxy, property)`
- æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š
  - `target`ï¼šç›®æ ‡å¯¹è±¡ã€‚
  - `property`ï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²é”®å±æ€§ã€‚
- æ•è·å™¨ä¸å˜å¼
  - å¦‚æœ `target.property` å­˜åœ¨ä¸”ä¸å¯é…ç½®ï¼Œåˆ™å¤„ç†ç¨‹åºå¿…é¡»è¿”å› `true`ã€‚
  - å¦‚æœ `target.property`å­˜åœ¨ä¸”ç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œåˆ™å¤„ç†ç¨‹åºå¿…é¡»è¿”å› `true`ã€‚

```js
const myTarget = {};

const proxy = new Proxy(myTarget, {
  has(target, property) {
    console.log("has()");
    return Reflect.has(...arguments);
  },
});

"foo" in proxy;
// has()
```

---

**`defineProperty()` æ•è·å™¨**ä¼šåœ¨ `Object.defineProperty()` ä¸­è¢«è°ƒç”¨ã€‚

- åå°„ APIï¼š`Reflect.defineProperty()`
- è¿”å›å€¼ï¼š`defineProperty()` å¿…é¡»è¿”å›å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå±æ€§æ˜¯å¦æˆåŠŸå®šä¹‰ã€‚è¿”å›éå¸ƒå°”å€¼ä¼šè¢«è½¬å‹ä¸ºå¸ƒå°”å€¼ã€‚
- æ‹¦æˆªçš„æ“ä½œï¼š
  - `Object.defineProperty(proxy, property, descriptor)`
  - `Reflect.defineProperty(proxy, property, descriptor)`
- æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š
  - `target`ï¼šç›®æ ‡å¯¹è±¡ã€‚
  - `property`ï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²é”®å±æ€§ã€‚
  - `descriptor`ï¼šåŒ…å«å¯é€‰çš„`enumerable`ã€`configurable`ã€`writable`ã€`value`ã€`get` å’Œ `set` å®šä¹‰çš„å¯¹è±¡ã€‚
- æ•è·å™¨ä¸å˜å¼ï¼š
  - å¦‚æœç›®æ ‡å¯¹è±¡ä¸å¯æ‰©å±•ï¼Œåˆ™æ— æ³•å®šä¹‰å±æ€§ã€‚
  - å¦‚æœç›®æ ‡å¯¹è±¡æœ‰ä¸€ä¸ªå¯é…ç½®çš„å±æ€§ï¼Œåˆ™ä¸èƒ½æ·»åŠ åŒåçš„ä¸å¯é…ç½®å±æ€§ã€‚
  - å¦‚æœç›®æ ‡å¯¹è±¡æœ‰ä¸€ä¸ªä¸å¯é…ç½®çš„å±æ€§ï¼Œåˆ™ä¸èƒ½æ·»åŠ åŒåçš„å¯é…ç½®å±æ€§ã€‚

```js
const myTarget = {};

const proxy = new Proxy(myTarget, {
  defineProperty(target, property, descriptor) {
    console.log("defineProperty()");
    return Reflect.defineProperty(...arguments);
  },
});

Object.defineProperty(proxy, "foo", { value: "bar" });
// defineProperty()
```

---

**`getOwnPropertyDescriptor()` æ•è·å™¨**ä¼šåœ¨ `Object.getOwnPropertyDescriptor()` ä¸­è¢«è°ƒç”¨ã€‚

- åå°„ APIï¼š`Reflect.getOwnPropertyDescriptor()`
- è¿”å›å€¼ï¼š`getOwnPropertyDescriptor()` å¿…é¡»è¿”å›å¯¹è±¡ï¼Œæˆ–è€…åœ¨å±æ€§ä¸å­˜åœ¨æ—¶è¿”å› `undefined`ã€‚
- æ‹¦æˆªçš„æ“ä½œï¼š
  - `Object.getOwnPropertyDescriptor(proxy, property)`
  - `Reflect.getOwnPropertyDescriptor(proxy, property)`
- æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š
  - `target`ï¼šç›®æ ‡å¯¹è±¡ã€‚
  - `property`ï¼šå¼•ç”¨çš„ç›®æ ‡å¯¹è±¡ä¸Šçš„å­—ç¬¦ä¸²é”®å±æ€§ã€‚
- æ•è·å™¨ä¸å˜å¼ï¼š
  - å¦‚æœè‡ªæœ‰çš„ `target.property` å­˜åœ¨ä¸”ä¸å¯é…ç½®ï¼Œåˆ™å¤„ç†ç¨‹åºå¿…é¡»è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥å±æ€§å­˜åœ¨çš„å¯¹è±¡ã€‚
  - å¦‚æœè‡ªæœ‰çš„ `target.property` å­˜åœ¨ä¸”å¯é…ç½®ï¼Œåˆ™å¤„ç†ç¨‹åºå¿…é¡»è¿”å›è¡¨ç¤ºè¯¥å±æ€§å¯é…ç½®çš„å¯¹è±¡ã€‚
  - å¦‚æœè‡ªæœ‰çš„ `target.property` å­˜åœ¨ä¸” `target` ä¸å¯æ‰©å±•ï¼Œåˆ™å¤„ç†ç¨‹åºå¿…é¡»è¿”å›ä¸€ä¸ªè¡¨ç¤ºè¯¥å±æ€§å­˜åœ¨çš„å¯¹è±¡ã€‚
  - å¦‚æœ `target.property` ä¸å­˜åœ¨ä¸” `target` ä¸å¯æ‰©å±•ï¼Œåˆ™å¤„ç†ç¨‹åºå¿…é¡»è¿”å› `undefined` è¡¨ç¤ºè¯¥å±æ€§ä¸å­˜åœ¨ã€‚
  - å¦‚æœ `target.property` ä¸å­˜åœ¨ï¼Œåˆ™å¤„ç†ç¨‹åºä¸èƒ½è¿”å›è¡¨ç¤ºè¯¥å±æ€§å¯é…ç½®çš„å¯¹è±¡ã€‚

```js
const myTarget = {};

const proxy = new Proxy(myTarget, {
  getOwnPropertyDescriptor(target, property) {
    console.log("getOwnPropertyDescriptor()");
    return Reflect.getOwnPropertyDescriptor(...arguments);
  },
});

Object.getOwnPropertyDescriptor(proxy, "foo");
// getOwnPropertyDescriptor()
```

---

deleteProperty()

---

ownKeys()

---

getPrototypeOf()

---

setPrototypeOf()

---

isExtensible()

---

preventExtensions()

---

**`apply()` æ•è·å™¨**ä¼šåœ¨è°ƒç”¨å‡½æ•°æ—¶ä¸­è¢«è°ƒç”¨ã€‚

- åå°„ API æ–¹æ³•: `Reflect.apply()`
- è¿”å›å€¼ï¼šè¿”å›å€¼æ— é™åˆ¶ã€‚
- æ‹¦æˆªçš„æ“ä½œ
  - `proxy(...argumentsList)`
  - `Function.prototype.apply(thisArg, argumentsList)`
  - `Function.prototype.call(thisArg, ...argumentsList)`
  - `Reflect.apply(target, thisArgument, argumentsList)`
- æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š
  - `target`ï¼šç›®æ ‡å¯¹è±¡ã€‚
  - `thisArg`ï¼šè°ƒç”¨å‡½æ•°æ—¶çš„ `this` å‚æ•°ã€‚
  - `argumentsList`ï¼šè°ƒç”¨å‡½æ•°æ—¶çš„å‚æ•°åˆ—è¡¨ã€‚
- æ•è·å™¨ä¸å˜å¼ï¼š
  - `target` å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°å¯¹è±¡ã€‚

```js
const myTarget = () => {};

const proxy = new Proxy(myTarget, {
  apply(target, thisArg, ...argumentsList) {
    console.log("apply()");
    return Reflect.apply(...arguments);
  },
});

proxy();
// apply()
```

---

**`construct()` æ•è·å™¨**ä¼šåœ¨ `new` æ“ä½œç¬¦ä¸­è¢«è°ƒç”¨ã€‚

- åå°„ APIï¼š`Reflect.construct()`
- è¿”å›å€¼ï¼š`construct()` å¿…é¡»è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚
- æ‹¦æˆªçš„æ“ä½œï¼š
  - `new proxy(...argumentsList)`
  - `Reflect.construct(target, argumentsList, newTarget)`
- æ•è·å™¨å¤„ç†ç¨‹åºå‚æ•°ï¼š
  - `target`ï¼šç›®æ ‡æ„é€ å‡½æ•°ã€‚
  - `argumentsList`ï¼šä¼ ç»™ç›®æ ‡æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ã€‚
  - `newTarget`ï¼šæœ€åˆè¢«è°ƒç”¨çš„æ„é€ å‡½æ•°ã€‚
- æ•è·å™¨ä¸å˜å¼ï¼š
  - `target` å¿…é¡»å¯ä»¥ç”¨ä½œæ„é€ å‡½æ•°ã€‚

```js
const myTarget = function() {};

const proxy = new Proxy(myTarget, {
  construct(target, argumentsList, newTarget) {
    console.log("construct()");
    return Reflect.construct(...arguments);
  },
});

new proxy();
// construct()
```

### ä»£ç†æ¨¡å¼

ä½¿ç”¨ä»£ç†å¯ä»¥åœ¨ä»£ç ä¸­å®ç°ä¸€äº›æœ‰ç”¨çš„ç¼–ç¨‹æ¨¡å¼ã€‚

#### è·Ÿè¸ªå±æ€§è®¿é—®

é€šè¿‡æ•è· `get`ã€`set` å’Œ `has` ç­‰æ“ä½œï¼Œå¯ä»¥çŸ¥é“å¯¹è±¡å±æ€§ä»€ä¹ˆæ—¶å€™è¢«è®¿é—®ã€è¢«æŸ¥è¯¢ã€‚

```js
const user = {
  name: "Jake",
};

const proxy = new Proxy(user, {
  get(target, property, receiver) {
    console.log("Getting ${property}");

    return Reflect.get(...arguments);
  },
  set(target, property, value, receiver) {
    console.log("Setting ${property}=${value}");

    return Reflect.set(...arguments);
  },
});

proxy.name; // Getting name
proxy.age = 27; // Setting age=27
```

#### éšè—å±æ€§

```js
const hiddenProperties = ["foo", "bar"];
const targetObject = {
  foo: 1,
  bar: 2,
  baz: 3,
};
const proxy = new Proxy(targetObject, {
  get(target, property) {
    if (hiddenProperties.includes(property)) {
      return undefined;
    } else {
      return Reflect.get(...arguments);
    }
  },
  has(target, property) {
    if (hiddenProperties.includes(property)) {
      return false;
    } else {
      return Reflect.has(...arguments);
    }
  },
});

// get()
console.log(proxy.foo); // undefined
console.log(proxy.bar); // undefined
console.log(proxy.baz); // 3

// has()
console.log("foo" in proxy); // false
console.log("bar" in proxy); // false
console.log("baz" in proxy); // true
```

#### å±æ€§éªŒè¯

å› ä¸ºæ‰€æœ‰èµ‹å€¼æ“ä½œéƒ½ä¼šè§¦å‘ `set()` æ•è·å™¨ï¼Œæ‰€ä»¥å¯ä»¥æ ¹æ®æ‰€èµ‹çš„å€¼å†³å®šæ˜¯å…è®¸è¿˜æ˜¯æ‹’ç»èµ‹å€¼ã€‚

```js
const target = {
  onlyNumbersGoHere: 0,
};

const proxy = new Proxy(target, {
  set(target, property, value) {
    if (typeof value !== "Number") {
      return false;
    } else {
      return Reflect.set(...arguments);
    }
  },
});

proxy.onlyNumbersGoHere = 1;
console.log(proxy.onlyNumbersGoHere); // 1
proxy.onlyNumbersGoHere = "2";
console.log(proxy.onlyNumbersGoHere); // 1
```

#### å‡½æ•°å‚æ•°éªŒè¯

å¯ä»¥è®©å‡½æ•°åªæ¥æ”¶æŸç§ç±»å‹çš„å€¼ï¼Œæˆ–è€…ç¼–å†™å…¶ä»–éªŒè¯é€»è¾‘ã€‚

```js
function median(...nums) {
  return nums.sort()[Math.floor(nums.length / 2)];
}

const proxy = new Proxy(median, {
  apply(target, thisArg, ...argumentsList) {
    for (const arg of argumentsList) {
      if (typeof arg !== "number") {
        throw "Non-number argument provided";
      }
    }
    return Reflect.apply(...arguments);
  },
});

console.log(proxy(4, 7, 1)); // 4
console.log(proxy(4, "7", 1));
// Error: Non-number argument provided
```

ç±»ä¼¼åœ°ï¼Œå¯ä»¥è¦æ±‚å®ä¾‹åŒ–æ—¶å¿…é¡»ç»™æ„é€ å‡½æ•°ä¼ å‚ï¼š

```js
class User {
  constructor(id) {
    this.id_ = id;
  }
}

const proxy = new Proxy(User, {
  construct(target, argumentsList, newTarget) {
    if (argumentsList[0] === undefined) {
      throw "User cannot be instantiated without id";
    } else {
      return Reflect.construct(...arguments);
    }
  },
});

new proxy(1);

new proxy();
// Error: User cannot be instantiated without id
```

#### æ•°æ®ç»‘å®š & å¯è§‚å¯Ÿå¯¹è±¡

å¯ä»¥å°†è¢«ä»£ç†çš„ç±»ç»‘å®šåˆ°ä¸€ä¸ªå…¨å±€å®ä¾‹é›†åˆï¼Œè®©æ‰€æœ‰åˆ›å»ºçš„å®ä¾‹éƒ½è¢«æ·»åŠ åˆ°è¿™ä¸ªé›†åˆä¸­ï¼š

```js
const userList = [];

class User {
  constructor(name) {
    this.name_ = name;
  }
}

const proxy = new Proxy(User, {
  construct() {
    const newUser = Reflect.construct(...arguments);
    userList.push(newUser);
    return newUser;
  },
});

new proxy("John");
new proxy("Jacob");
new proxy("Jingleheimerschmidt");

console.log(userList); // [User {}, User {}, User{}]
```

è¿˜å¯ä»¥æŠŠé›†åˆç»‘å®šåˆ°ä¸€ä¸ªäº‹ä»¶åˆ†æ´¾ç¨‹åºï¼Œæ¯æ¬¡æ’å…¥æ–°å®ä¾‹æ—¶éƒ½ä¼šå‘é€æ¶ˆæ¯ï¼š

```js
const userList = [];

function emit(newValue) {
  console.log(newValue);
}

const proxy = new Proxy(userList, {
  set(target, property, value, receiver) {
    const result = Reflect.set(...arguments);
    if (result) {
      emit(Reflect.get(target, property, receiver));
    }
    return result;
  },
});

proxy.push("John");
// John
proxy.push("Jacob");
// Jacob
```
