# Git æ”»ç•¥

> **æ‘˜è¦**: æœ¬æ–‡è®²è§£ Git æ˜¯ä»€ä¹ˆ, æœ‰ä»€ä¹ˆç”¨, å¦‚ä½•ç”¨ Git è¿›è¡Œç‰ˆæœ¬æ§åˆ¶, ä»¥åŠ  å¤§å‚çš„ç‰ˆæœ¬ç®¡ç†ç­–ç•¥.

## Git å¹²ä»€ä¹ˆçš„?

[Git å®˜ç½‘](https://git-scm.com/)

**Git æ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚**

ç‰ˆæœ¬æ§åˆ¶æ˜¯ä¸€ç§ç”¨æ¥ "**è®°å½•æ–‡ä»¶å†…å®¹å˜åŒ–çš„ç³»ç»Ÿï¼Œå…è®¸å¯¹æŒ‡å®šç‰ˆæœ¬çš„ä¿®è®¢æƒ…å†µè¿›è¡ŒæŸ¥é˜…ï¼Œè¿½æº¯**"ã€‚Git æ˜¯ç›®å‰ä¸šç•Œæœ€æµè¡Œçš„ç‰ˆæœ¬æ§åˆ¶ç³»çµ±.

Git æ˜¯åˆ†å¸ƒå¼çš„, **æ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ï¼Œåœ¨å„è‡ªçš„èŠ‚ç‚¹ä¸Šéƒ½æœ‰ç‹¬ç«‹çš„ä¸€ä»½å®Œæ•´çš„ç‰ˆæœ¬åº“**ã€‚

- åˆ†å¸ƒå¼çš„å¥½å¤„æ˜¯ï¼Œå³ä½¿ä¸€ä¸ªäººçš„ç”µè„‘å‡ºé—®é¢˜äº†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»å…¶ä»–äººé‚£é‡Œå…‹éš†ä¸€ä»½ç‰ˆæœ¬åº“ã€‚
- åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿé€šå¸¸ä¹Ÿæœ‰ä¸€å°å……å½“â€œä¸­å¤®æœåŠ¡å™¨â€çš„ç”µè„‘ï¼Œä½†è¿™ä¸ªæœåŠ¡å™¨çš„ä½œç”¨ä»…ä»…æ˜¯ç”¨æ¥æ–¹ä¾¿ â€œäº¤æ¢â€ å¤§å®¶çš„ä¿®æ”¹ï¼Œæ²¡æœ‰å®ƒå¤§å®¶ä¹Ÿä¸€æ ·å¹²æ´».

## Git åŸºç¡€

### åˆå§‹åŒ–ä»“åº“

åœ¨ä¸€ä¸ªç›®å½•ä¸‹ä½¿ç”¨ `git init` æŒ‡ä»¤åˆå§‹åŒ–é€™å€‹ç›®éŒ„ï¼Œè®“ Git é–‹å§‹å°é€™å€‹ç›®éŒ„é€²è¡Œç‰ˆæœ¬æ§åˆ¶ã€‚

é€™å€‹æŒ‡ä»¤æœƒåœ¨é€™å€‹ç›®éŒ„è£¡å»ºç«‹äº†ä¸€å€‹ `.git` éšè—ç›®å½•. è¿™ä¸ªç›®å½•æ˜¯ Git æ¥ç®¡ç†ç‰ˆæœ¬åº“çš„, å®ƒå°†é»˜è®¤è®°å½•é¡¹ç›®ç›®å½•ä¸­ä»»ä½•æ–‡ä»¶çš„æ”¹åŠ¨ã€‚å¦‚æœæŠŠ `.git` ç›®å½•åˆ é™¤äº†ï¼Œç‰ˆæœ¬è®°å½•ä¹Ÿå°±éƒ½æ²¡æœ‰äº†.

### æ–‡ä»¶çŠ¶æ€ & å·¥ä½œåŒºåŸŸ

åœ¨ Git ä¸­æ–‡ä»¶æœ‰ä¸¤ç§çŠ¶æ€ï¼š**å·²è·Ÿè¸ªï¼ˆtrackedï¼‰** å’Œ **æœªè·Ÿè¸ªï¼ˆuntrackedï¼‰**ã€‚

**å·²è·Ÿè¸ªï¼ˆtrackedï¼‰** åˆåˆ†ä¸ºï¼š

- **å·²ä¿®æ”¹ï¼ˆmodifiedï¼‰**
- **å·²æš‚å­˜ï¼ˆstagedï¼‰**
- **å·²æäº¤ï¼ˆcommittedï¼‰**

---

è¢« Git ç®¡ç†çš„é¡¹ç›®æœ‰ä¸‰ä¸ªå·¥ä½œåŒºåŸŸï¼š

- **å·¥ä½œåŒº Working Directory**: æœ¬åœ°çš„å·¥ä½œç›®å½•ï¼Œå±äºæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿã€‚
- **æš‚å­˜åŒº Staging Area**ï¼šæš‚å­˜æœ¬åœ°æ–‡ä»¶çš„æ”¹åŠ¨ï¼Œå‡†å¤‡å°†æ¥è¿›è¡Œæäº¤ã€‚å­˜æ”¾åœ¨`.git`ç›®å½•ä¸‹çš„ `index` æ–‡ä»¶ï¼ˆ`.git/index`ï¼‰ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠæš‚å­˜åŒºæœ‰æ—¶ä¹Ÿå«ä½œç´¢å¼• Indexã€‚
- **ç‰ˆæœ¬åº“ Repository**ï¼šå‚¨å­˜æäº¤çš„ç‰ˆæœ¬è®°å½•ã€‚`.git` ç›®å½•å°±æ˜¯ Git çš„æœ¬åœ°ç‰ˆæœ¬åº“ï¼Œä¸ç®—æ˜¯å·¥ä½œåŒºçš„æ–‡ä»¶ç›®å½•ã€‚

![2020-09-19-09-28-21](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-19-09-28-21.png)

### æ£€æŸ¥å½“å‰æ–‡ä»¶çŠ¶æ€

åœ¨ä¸€ä¸ªç©ºç›®å½•ä¸‹æ‰§è¡Œ `git init`. ä¹‹åä½¿ç”¨å‘½ä»¤ `git status` æ¥æŸ¥çœ‹è¿™ä¸ªç›®å½•çš„çŠ¶æ€.

```bash
$ git status
On branch master

Initial commit

nothing to commit (create/copy files and use "git add" to track)
```

è¡¨ç¤ºç›®å½•ä¸­æ²¡æœ‰ä¸œè¥¿å¯ä»¥æäº¤.

### è·Ÿè¸ªæ–°æ–‡ä»¶

åœ¨é¡¹ç›®ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„ README æ–‡ä»¶ã€‚ å¦‚æœä¹‹å‰å¹¶ä¸å­˜åœ¨è¿™ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ `git status` å‘½ä»¤ï¼Œä½ å°†çœ‹åˆ°ä¸€ä¸ªæ–°çš„æœªè·Ÿè¸ªæ–‡ä»¶ï¼š

```bash
On branch master
Untracked files:
  (use "git add <file>..." to include in what will be committed)

    readme.md

nothing added to commit but untracked files present (use "git add" to track)
```

åœ¨çŠ¶æ€æŠ¥å‘Šä¸­å¯ä»¥çœ‹åˆ°æ–°å»ºçš„ README æ–‡ä»¶å‡ºç°åœ¨ Untracked files ä¸‹é¢ã€‚ æœªè·Ÿè¸ªçš„æ–‡ä»¶æ„å‘³ç€ Git åœ¨ä¹‹å‰çš„å¿«ç…§ï¼ˆæäº¤ï¼‰ä¸­æ²¡æœ‰è¿™äº›æ–‡ä»¶.

---

ç°åœ¨ç”¨ `git add` è·Ÿè¸ª `readme.md` æ–‡ä»¶.

```bash
On branch master

No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)

	new file:   readme.md
```

åªè¦åœ¨ Changes to be committed è¿™è¡Œä¸‹é¢çš„ï¼Œå°±è¯´æ˜æ˜¯å·²æš‚å­˜çŠ¶æ€ã€‚ å¦‚æœæ­¤æ—¶æäº¤ï¼Œé‚£ä¹ˆè¯¥æ–‡ä»¶æ­¤æ—¶æ­¤åˆ»çš„ç‰ˆæœ¬å°†è¢«ç•™å­˜åœ¨å†å²è®°å½•ä¸­ã€‚

### æš‚å­˜å·²ä¿®æ”¹æ–‡ä»¶

ç°åœ¨ä¿®æ”¹ä¸€ä¸‹ä¹‹å‰è¢«è·Ÿè¸ªçš„ `readme.md` æ–‡ä»¶. ç„¶åå†æ‰§è¡Œ `git status`

```bash
On branch master

No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)

	new file:   readme.md

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   readme.md
```

`readme.md` å‡ºç°åœ¨ Changes not staged for commit è¿™è¡Œä¸‹é¢ï¼Œè¯´æ˜å·²è·Ÿè¸ªæ–‡ä»¶çš„å†…å®¹å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†è¿˜æ²¡æœ‰æ”¾åˆ°æš‚å­˜åŒºã€‚è¦æš‚å­˜è¿™ä¸ªå˜åŠ¨ï¼Œéœ€è¦è¿è¡Œ `git add` å‘½ä»¤ã€‚

æ³¨æ„ï¼Œ`git add` è¿™ä¸ªå‘½ä»¤å°†å¯ä»¥ç†è§£ä¸º â€œ**æ·»åŠ å˜åŠ¨åˆ°ä¸‹ä¸€æ¬¡æäº¤ä¸­**â€ è€Œä¸æ˜¯ â€œå°†ä¸€ä¸ªæ–‡ä»¶æ·»åŠ åˆ°æäº¤ä¸­â€ã€‚

---

æ·»åŠ å®Œå, åœ¨æ‰§è¡Œ `git status`

```bash
On branch master

No commits yet

Changes to be committed:
  (use "git rm --cached <file>..." to unstage)

	new file:   readme.md
```

å˜åŠ¨å·²æš‚å­˜ï¼Œä¸‹æ¬¡æäº¤æ—¶å°±ä¼šä¸€å¹¶è®°å½•åˆ°ä»“åº“ã€‚

### æäº¤æ›´æ–°

ä½¿ç”¨ `git commit` å‘½ä»¤å°†å·²æš‚å­˜çš„æ–‡ä»¶è¿›è¡Œæäº¤.è¿™ç§æ–¹å¼ä¼šå¯åŠ¨ã€Œ æ–‡æœ¬ç¼–è¾‘å™¨ ã€è¾“å…¥æœ¬æ¬¡æäº¤çš„è¯´æ˜ã€‚(é»˜è®¤ä¼šå¯ç”¨ shell çš„ç¯å¢ƒå˜é‡ `$EDITOR` æ‰€æŒ‡å®šçš„è½¯ä»¶ï¼Œä¸€èˆ¬éƒ½æ˜¯ vim æˆ– emacsã€‚)

ä¹Ÿå¯ä»¥åœ¨ `commit` å‘½ä»¤åæ·»åŠ  `-m` é€‰é¡¹ï¼Œå°†æäº¤ä¿¡æ¯ä¸å‘½ä»¤æ”¾åœ¨åŒä¸€è¡Œ

```bash
$ git commit -m "Story 182: Fix benchmarks for speed"
[master 463dc4f] Story 182: Fix benchmarks for speed
 2 files changed, 2 insertions(+)
 create mode 100644 README
```

æäº¤åå®ƒä¼šå‘Šè¯‰ä½ ï¼š

- å½“å‰æ˜¯åœ¨å“ªä¸ªåˆ†æ”¯ï¼ˆ`master`ï¼‰æäº¤çš„
- æœ¬æ¬¡æäº¤çš„å®Œæ•´ SHA-1 æ ¡éªŒå’Œæ˜¯ä»€ä¹ˆï¼ˆ`463dc4f`ï¼‰ï¼Œ
- åœ¨æœ¬æ¬¡æäº¤ä¸­ï¼Œæœ‰å¤šå°‘æ–‡ä»¶ä¿®è®¢è¿‡ï¼Œå¤šå°‘è¡Œæ·»åŠ å’Œåˆ æ”¹è¿‡ã€‚

`commit` å‘½ä»¤åŠ ä¸Š `-a` é€‰é¡¹ï¼ŒGit å°±ä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰**å·²è·Ÿè¸ª**çš„æ–‡ä»¶ä¸Šçš„æ‰€æœ‰å˜åŠ¨ï¼Œæš‚å­˜èµ·æ¥ä¸€å¹¶æäº¤ï¼Œè·³è¿‡ `git add` æ­¥éª¤

---

å¦‚æœæ­¤æ¬¡æäº¤æš‚å­˜åŒºæ²¡æœ‰ä»»ä½•å˜åŠ¨, ä½†ä»æ—§æƒ³è¦æäº¤ï¼Œåˆ™éœ€è¦åŠ ä¸Š `--allow-empty` å‚æ•°.

```bash
$ git commit --allow-empty -m "ç©ºçš„"
[master 76a5b84] ç©ºçš„
```

### æ ¡éªŒå’Œ

æ”¹åŠ¨åœ¨æäº¤å‰ï¼Œä¼šåŸºäºæ–‡ä»¶çš„å†…å®¹ & ç›®å½•ç»“æ„è®¡ç®—å‡ºä¸€ä¸ª SHA-1 æ•£åˆ—å€¼ï¼Œä½œä¸ºå½“å‰æäº¤çš„å”¯ä¸€ç´¢å¼• IDï¼Œç§°ä¸ºã€Œ **æ ¡éªŒå’Œ** ã€

SHA-1 æ•£åˆ—æ˜¯ä¸€ä¸ªç”± 40 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ0-9 å’Œ a-fï¼‰ç»„æˆå­—ç¬¦ä¸²ã€‚

```bash
# ä¸€ä¸ª SHA-1 æ•£åˆ—å€¼ï¼š
24b9da6552252987aa493b52f8696cd6d3b00373
```

### æš‚å­˜ & æäº¤æ—¶å‘ç”Ÿäº†ä»€ä¹ˆ

**Git ä¿å­˜çš„ä¸æ˜¯æ–‡ä»¶çš„å˜åŒ–æˆ–è€…å·®å¼‚ï¼Œè€Œæ˜¯ä¸€ç³»åˆ—ä¸åŒæ—¶åˆ»çš„æ–‡ä»¶å¿«ç…§**ã€‚

åœ¨è¿›è¡Œæäº¤æ“ä½œæ—¶ï¼ŒGit ä¼šä¿å­˜ä¸€ä¸ªæäº¤å¯¹è±¡ï¼ˆcommit objectï¼‰, è¯¥æäº¤å¯¹è±¡ä¼šåŒ…å«ä¸€ä¸ªæŒ‡å‘å†…å®¹å¿«ç…§çš„æŒ‡é’ˆ, è¿˜åŒ…å«äº†ä½œè€…çš„å§“åå’Œé‚®ç®±ã€æäº¤æ—¶è¾“å…¥çš„ä¿¡æ¯ä»¥åŠæŒ‡å‘å®ƒçš„çˆ¶å¯¹è±¡çš„æŒ‡é’ˆã€‚

é¦–æ¬¡æäº¤äº§ç”Ÿçš„æäº¤å¯¹è±¡æ²¡æœ‰çˆ¶å¯¹è±¡ï¼Œæ™®é€šæäº¤æ“ä½œäº§ç”Ÿçš„æäº¤å¯¹è±¡æœ‰ä¸€ä¸ªçˆ¶å¯¹è±¡ï¼Œè€Œç”±å¤šä¸ªåˆ†æ”¯åˆå¹¶äº§ç”Ÿçš„æäº¤å¯¹è±¡æœ‰å¤šä¸ªçˆ¶å¯¹è±¡ã€‚

å‡è®¾ç°åœ¨æœ‰ä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œé‡Œé¢åŒ…å«äº†ä¸‰ä¸ªå°†è¦è¢«æš‚å­˜å’Œæäº¤çš„æ–‡ä»¶ã€‚

1. `git add` æš‚å­˜æ“ä½œä¼šä¸º**æ¯ä¸€ä¸ªæ–‡ä»¶è®¡ç®— "æ ¡éªŒå’Œ"**ï¼Œç„¶åä¼šæŠŠå½“å‰ç‰ˆæœ¬çš„æ–‡ä»¶å¿«ç…§ä¿å­˜åˆ° Git ä»“åº“ä¸­ï¼ˆ Git ä½¿ç”¨ blob å¯¹è±¡æ¥ä¿å­˜å®ƒä»¬ ï¼‰ï¼Œæœ€ç»ˆå°†æ ¡éªŒå’ŒåŠ å…¥åˆ°æš‚å­˜åŒºåŸŸç­‰å¾…æäº¤.
2. å½“ä½¿ç”¨ `git commit` è¿›è¡Œæäº¤æ“ä½œæ—¶ï¼ŒGit ä¼šå…ˆè®¡ç®—**æ¯ä¸€ä¸ªå­ç›®å½•çš„æ ¡éªŒå’Œ**ï¼Œç„¶ååœ¨ Git ä»“åº“ä¸­è¿™äº›æ ¡éªŒå’Œä¿å­˜ä¸º "æ ‘å¯¹è±¡"ã€‚
3. éšåï¼ŒGit ä¾¿ä¼š**åˆ›å»ºä¸€ä¸ªæäº¤å¯¹è±¡**ï¼Œå®ƒé™¤äº†åŒ…å«ä¸Šé¢æåˆ°çš„æäº¤ä¿¡æ¯å¤–ï¼Œè¿˜åŒ…å«æŒ‡å‘åˆšåˆ›å»ºçš„æ ‘å¯¹è±¡çš„æŒ‡é’ˆã€‚å¦‚æ­¤ä¸€æ¥ï¼ŒGit å°±å¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™é‡ç°æ­¤æ¬¡ä¿å­˜çš„å¿«ç…§ã€‚

![2020-09-19-20-10-54](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-19-20-10-54.png)

æ•´å¥—æµç¨‹ä¸‹æ¥ï¼ŒGit ä»“åº“ä¸­å…±åˆ›å»ºäº†äº”ä¸ªå¯¹è±¡ï¼š

- ä¸‰ä¸ª blob å¯¹è±¡ï¼Œä¿å­˜ç€æ–‡ä»¶å¿«ç…§ã€‚
- ä¸€ä¸ªæ ‘å¯¹è±¡ï¼Œè®°å½•ç€ç›®å½•ç»“æ„ï¼Œå’Œå¯¹ blob å¯¹è±¡çš„ç´¢å¼•ã€‚
- ä¸€ä¸ªæäº¤å¯¹è±¡ï¼ŒåŒ…å«ç€æŒ‡å‘æ ‘å¯¹è±¡çš„æŒ‡é’ˆï¼Œå’Œæ‰€æœ‰æäº¤ä¿¡æ¯ã€‚

### çŠ¶æ€ç®€è§ˆ

`git status` å‘½ä»¤çš„è¾“å‡ºååˆ†è¯¦ç»†ï¼Œä½†å…¶ç”¨è¯­æœ‰äº›ç¹çã€‚ å¦‚æœä½ ä½¿ç”¨ `git status -s` å‘½ä»¤æˆ– `git status --short` å‘½ä»¤ï¼Œä½ å°†å¾—åˆ°ä¸€ç§æ›´ä¸ºç´§å‡‘çš„æ ¼å¼è¾“å‡ºã€‚

```bash
$ git status -s
 M README
MM Rakefile
A  lib/git.rb
M  lib/simplegit.rb
?? LICENSE.txt
```

- æ–°æ·»åŠ çš„æœªè·Ÿè¸ªæ–‡ä»¶å‰é¢æœ‰ `??` æ ‡è®°ã€‚
- æ–°æ·»åŠ åˆ°æš‚å­˜åŒºä¸­çš„æ–‡ä»¶å‰é¢æœ‰ `A` æ ‡è®°ã€‚
- ä¿®æ”¹è¿‡çš„æ–‡ä»¶å‰é¢æœ‰ `M` æ ‡è®°ã€‚
  - å‡ºç°åœ¨å³è¾¹çš„ `M` è¡¨ç¤ºè¯¥æ–‡ä»¶è¢«ä¿®æ”¹äº†ä½†æ˜¯è¿˜æ²¡æ”¾å…¥æš‚å­˜åŒºã€‚
  - å‡ºç°åœ¨é å·¦è¾¹çš„ `M` è¡¨ç¤ºè¯¥æ–‡ä»¶è¢«ä¿®æ”¹äº†å¹¶æ”¾å…¥äº†æš‚å­˜åŒºã€‚
  - æ–‡ä»¶å‰é¢æœ‰ä¸¤ä¸ª `MM`, è¡¨ç¤ºåœ¨å·¥ä½œåŒºè¢«ä¿®æ”¹å¹¶æäº¤åˆ°æš‚å­˜åŒºåï¼Œåˆåœ¨å·¥ä½œåŒºä¸­è¢«ä¿®æ”¹äº†ã€‚

### ç§»é™¤æ–‡ä»¶

`git rm` å‘½ä»¤ï¼Œç”¨ä»¥ç§»é™¤æŒ‡å®šæ–‡ä»¶çš„ã€Œ å·²è·Ÿè¸ª ã€çŠ¶æ€ï¼Œå°†å…¶ä» Git ä»“åº“ä¸­ç§»é™¤ã€‚åŒæ—¶ï¼Œå°†å…¶ä»å·¥ä½œç›®å½•ä¸­ç§»é™¤ã€‚

`git rm -r` å‘½ä»¤ï¼Œç”¨ä»¥åˆ é™¤ç›®å½•ã€‚

`git rm --cached` å‘½ä»¤ï¼ŒæŠŠæ–‡ä»¶ä» Git ä»“åº“ä¸­ç§»é™¤ï¼Œä½†ä»ç„¶å¸Œæœ›ä¿ç•™åœ¨å½“å‰å·¥ä½œç›®å½•ä¸­ã€‚

å¦‚æœ**å·²è¿½è¸ªæ–‡ä»¶åˆ é™¤ä¹‹å‰ä¿®æ”¹è¿‡ï¼Œå¹¶ä¸”å·²ç»æ”¾åˆ°æš‚å­˜åŒº**çš„è¯ï¼š

- ä½¿ç”¨ `git rm -f` å‘½ä»¤ï¼Œå°†æ–‡ä»¶å¼ºåˆ¶åˆ é™¤ã€‚
- ä½¿ç”¨ `git rm --cached` å‘½ä»¤ï¼Œå°†å…¶ä» Git ä»“åº“åˆ é™¤ï¼Œä½†æ–‡ä»¶ä»æ—§ä¿å­˜åœ¨å·¥ä½œç›®å½•ã€‚

è¿™æ˜¯ä¸€ç§å®‰å…¨ç‰¹æ€§ï¼Œç”¨äºé˜²æ­¢è¯¯åˆ è¿˜æ²¡æœ‰æäº¤çš„æ›´æ”¹ã€‚

```bash
(base) bogon:test xiangliu$ git status -s
M  test1
(base) bogon:test xiangliu$ git rm test1
error: the following file has changes staged in the index:
    test1
(use --cached to keep the file, or -f to force removal)
```

å¦‚æœåªæ˜¯ç®€å•åœ°ä»å·¥ä½œç›®å½•ä¸­æ‰‹å·¥åˆ é™¤æ–‡ä»¶ï¼Œåˆ é™¤æ“ä½œè¢«å½“åš Change çœ‹å¾…ã€‚è¿è¡Œ `git status` æ—¶å°±ä¼šçœ‹åˆ°ï¼Œåˆ é™¤å˜åŠ¨å‡ºç°åœ¨ â€œChanges not staged for commitâ€ éƒ¨åˆ†ã€‚

### å¿½ç•¥æ–‡ä»¶

æœ‰äº›æ–‡ä»¶æ— éœ€çº³å…¥ Git çš„ç®¡ç†ï¼Œä¹Ÿä¸å¸Œæœ›å®ƒä»¬æ€»å‡ºç°åœ¨æœªè·Ÿè¸ªæ–‡ä»¶åˆ—è¡¨ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º `.gitignore` çš„æ–‡ä»¶ï¼Œåˆ—å‡ºè¦å¿½ç•¥çš„æ–‡ä»¶æ¨¡å¼ã€‚

æ¯”å¦‚:

```bash
*.[oa]
*~
```

ç¬¬ä¸€è¡Œå‘Šè¯‰ Git å¿½ç•¥æ‰€æœ‰ä»¥ .o æˆ– .a ç»“å°¾çš„æ–‡ä»¶ã€‚ç¬¬äºŒè¡Œå‘Šè¯‰ Git å¿½ç•¥æ‰€æœ‰ä»¥æ³¢æµªç¬¦ï¼ˆ~ï¼‰ç»“å°¾çš„æ–‡ä»¶.

è¦å…»æˆä¸€å¼€å§‹å°±è®¾ç½®å¥½ `.gitignore` æ–‡ä»¶çš„ä¹ æƒ¯ï¼Œä»¥å…å°†æ¥è¯¯æäº¤æ— ç”¨çš„æ–‡ä»¶.

`.gitignore` çš„åŒ¹é…æ¨¡å¼è§„åˆ™å¦‚ä¸‹ï¼š

- ä½¿ç”¨æ ‡å‡†çš„ `glob` æ¨¡å¼åŒ¹é…ã€‚
- æ‰€æœ‰ç©ºè¡Œæˆ–è€…ä»¥ `ï¼ƒ` å¼€å¤´çš„è¡Œéƒ½ä¼šè¢« Git å¿½ç•¥ã€‚
- åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ`/`ï¼‰å¼€å¤´ï¼Œé˜²æ­¢é€’å½’ã€‚
- åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ`/`ï¼‰ç»“å°¾ï¼ŒæŒ‡å®šç›®å½•ã€‚
- è¦å¿½ç•¥æŒ‡å®šæ¨¡å¼ä»¥å¤–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥åœ¨æ¨¡å¼å‰åŠ  `!` å–åã€‚

`glob` æ¨¡å¼æ˜¯æŒ‡ shell æ‰€ä½¿ç”¨çš„ç®€åŒ–äº†çš„æ­£åˆ™è¡¨è¾¾å¼:

- æ˜Ÿå·ï¼ˆ`*`ï¼‰åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦;
- `[abc]` åŒ¹é…ä»»ä½•ä¸€ä¸ªåˆ—åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦;
- é—®å·ï¼ˆ`?`ï¼‰åªåŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦;
- å¦‚æœåœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨çŸ­åˆ’çº¿åˆ†éš”ä¸¤ä¸ªå­—ç¬¦ï¼Œè¡¨ç¤ºæ‰€æœ‰åœ¨è¿™ä¸¤ä¸ªå­—ç¬¦èŒƒå›´å†…çš„éƒ½å¯ä»¥åŒ¹é…ï¼ˆæ¯”å¦‚ `[0-9]` è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ 0 åˆ° 9 çš„æ•°å­—ï¼‰;
- ä½¿ç”¨ä¸¤ä¸ªæ˜Ÿå· (`**`) è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸­é—´ç›®å½•ï¼Œæ¯”å¦‚`a/**/z` å¯ä»¥åŒ¹é… `a/z`, `a/b/z` æˆ– `a/b/c/z`ç­‰ã€‚

ä¸‹é¢æœ‰äº›ä¾‹å­:

```bash
# no .a files
*.a

# but do track lib.a, even though you're ignoring .a files above
!lib.a

# only ignore the TODO file in the current directory, not subdir/TODO
/TODO

# ignore all files in the build/ directory
build/

# ignore doc/notes.txt, but not doc/server/arch.txt
doc/*.txt

# ignore all .pdf files in the doc/ directory
doc/**/*.pdf
```

### é‡ç½® ( æ’¤é”€ ) æäº¤

#### reset æŒ‡ä»¤

**`reset` æŒ‡ä»¤ï¼Œè®¾ç½®å½“å‰æ‰€åœ¨åˆ†æ”¯æ‰€æŒ‡å‘çš„æäº¤å¯¹è±¡**ã€‚

**`^` ç¬¦è™Ÿè¡¨ç¤ºã€Œ å‰ä¸€æ¬¡ ã€çš„æ„æ€**.

```bash
# è®©å½“å‰æ‰€åœ¨åˆ†æ”¯æŒ‡å‘ï¼Œå½“å‰æäº¤å¯¹è±¡çš„å‰ä¸€ä¸ªæäº¤å¯¹è±¡ã€‚
$ git reset HEAD^
```

å¦‚æœæ˜¯ `HEAD^^` å‰‡æ˜¯å¾€å‰å…©æ¬¡ï¼Œä»¥æ­¤é¡æ¨ã€‚ä¸éå¦‚æœè¦å€’é€€äº”æ¬¡ï¼Œé€šå¸¸ä¸æœƒå¯« `HEAD^^^^^`ï¼Œè€Œæœƒå¯«æˆ `HEAD~5`ã€‚

å‡å¦‚ `HEAD` æŒ‡å‘ `master` åˆ†æ”¯çš„ `e12d8ef` æäº¤å¯¹è±¡. é‚£ä¹ˆè¿˜å¯ä»¥å†™æˆ:

```bash
# master åˆ†æ”¯æŒ‡å‘æäº¤å¯¹è±¡çš„å‰ä¸€ä¸ªæäº¤å¯¹è±¡ã€‚
$ git reset master^
# æ ¡éªŒå’Œ ID ä¸º e12d8ef çš„æäº¤å¯¹è±¡çš„å‰ä¸€ä¸ªæäº¤å¯¹è±¡ã€‚
$ git reset e12d8ef^
```

è¿™ä¸ªæŒ‡ä»¤æœ‰ä¸‰ä¸ªå¸¸ç”¨å‚æ•°: `--soft`, `--hard`, `--mixed`

- `--mixed` æ˜¯ `reset` æŒ‡ä»¤çš„é»˜è®¤å‚æ•°. å®ƒå°†é‡ç½® `HEAD` åˆ°å¦å¤–ä¸€ä¸ªæäº¤, å¹¶ä¸”é‡ç½®æš‚å­˜åŒºï¼Œä½†ä½ å·¥ä½œåŒºçš„æ–‡ä»¶ä¸ä¼šè¢«æ›´æ”¹ã€‚é‡ç½®å‰æ‰€åšçš„æ›´æ”¹ï¼Œéƒ½å˜æˆäº†ã€Œ æœªæš‚å­˜ï¼Œæœªè·Ÿè¸ª ã€çš„çŠ¶æ€ã€‚
- `--soft` å‚æ•°é‡ç½® `HEAD` åˆ°å¦å¤–ä¸€ä¸ªæäº¤ï¼Œä½†æš‚å­˜åŒºå’Œå·¥ä½œåŒºéƒ½ä¸ä¼šå˜åŒ–ã€‚
- `--hard` å‚æ•°ï¼Œä¼šè®©æš‚å­˜åŒºå’Œå·¥ä½œåŒºéƒ½ä¼šé‡ç½®åˆ°ç›®æ ‡æäº¤æ‰€å¤„çš„çŠ¶æ€ã€‚æ‰€æœ‰ä¸ç›®æ ‡æäº¤ä¹‹é—´çš„å˜æ›´ï¼Œéƒ½ä¼šè¢«ä¸¢å¼ƒã€‚

![gif](https://mmbiz.qpic.cn/mmbiz_gif/meG6Vo0MeviaPS2ZgOV7sV3qpnhsB4LFO8dmv56PCuicTzZTVL6lVp541picccqwMAU36EhACmJCMttPvBJl8tXjQ/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)
![gif](https://mmbiz.qpic.cn/mmbiz_gif/meG6Vo0MeviaPS2ZgOV7sV3qpnhsB4LFOsiboiaLTHUnlyorlyicvxZtRT9tQD4fcX2VponJIcFUpZHbKKdP5p31vQ/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)

::: details-open ğŸŒ° ä¾‹å­ï¼š

å‡å¦‚æˆ‘ä»¬åœ¨ç›®å½•ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–‡ä»¶å« `myFile.md`, å¹¶ä¸”è¿›è¡Œäº†æäº¤.

```bash
bogon:git_practice xiangliu$ git log --oneline
0935e0d (HEAD -> master) add my file
2e0425c first commit
```

ä½¿ç”¨ `git reset HEAD^` å, æ‰§è¡Œ `git status` çœ‹åˆ° `myFile.md` ä¸ºæœªè·Ÿè¸ªçŠ¶æ€, ä½†æ–‡ä»¶ä»åœ¨å·¥ä½œåŒºä¸­.

```bash
On branch master
Untracked files:
  (use "git add <file>..." to include in what will be committed)

	myFile.md

nothing added to commit but untracked files present (use "git add" to track)
```

ä½¿ç”¨ `git reset HEAD^ --soft` å, æ‰§è¡Œ `git status` çœ‹åˆ° `myFile.md` åœ¨æš‚å­˜åŒº, ç­‰å¾…æäº¤.

```bash
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

	new file:   myFile.md
```

ä½¿ç”¨ `git reset HEAD^ --hard` å, `myFile.md` ç›´æ¥æ²¡äº†.

å› ä¸ºä½¿ç”¨äº† `reset` å, é‡ç½®åˆ°çš„æäº¤å¯¹è±¡ä¹‹åçš„æäº¤ä»ç„¶å­˜åœ¨. é€šè¿‡ `reset` å†é‡ç½®å›ä½ è¦çš„æäº¤å°±å¯ä»¥å†è¿”å›å». å¦‚æœä½ æ‰¾ä¸åˆ°ä½ æƒ³è¦çš„æäº¤å¯¹è±¡çš„æ ¡éªŒå’Œæ˜¯ä»€ä¹ˆäº†, å¯ä»¥é€šè¿‡ `git reflog` å‘½ä»¤. å®ƒå¯ä»¥æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æ‰€æœ‰æ“ä½œè®°å½•ï¼ŒåŒ…æ‹¬å·²ç»è¢«åˆ é™¤çš„æäº¤è®°å½•

:::

#### revert æŒ‡ä»¤

å‡å¦‚æƒ³æ’¤é”€æ‰æœ€è¿‘çš„ä¸€æ¬¡æäº¤ã€‚å¯ä»¥è¾“å…¥ä¸‹é¢æŒ‡ä»¤ï¼š

å®ƒä¼šä¿ç•™åŸæ¥çš„æäº¤, å¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„æäº¤æ¥è¡¨ç¤ºæ’¤é”€æ“ä½œã€‚

```bash
$ git revert HEAD --no-edit
# --no-edit åƒæ•¸ï¼Œè¡¨ç¤ºä¸ç¼–è¾‘æäº¤ä¿¡æ¯ã€‚

#$ git revert HEAD^  æ’¤é”€æœ€è¿‘ä¸€æ¬¡ï¼Œä»¥åŠæœ€è¿‘ä¸€æ¬¡æäº¤çš„å‰ä¸€æ¬¡æäº¤
#$ git revert [commit] ä¸€ç›´æ’¤é”€åˆ°æŒ‡å®šæäº¤çš„å‰ä¸€æ¬¡æäº¤ä¸ºæ­¢
```

![2020-09-20-13-59-34](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-13-59-34.png)

å¦‚æœæƒ³å†æ¢å¤ä¹‹å‰çš„æäº¤ï¼š

- ä¸€ç§æ–¹æ³•æ˜¯ï¼Œå†ç”¨ä¸€æ¬¡ `revert` æ‰§è¡Œã€Œ æ’¤é”€çš„æ’¤é”€ ã€
- å¦ä¸€ç§æ–¹æ³•ï¼Œç”¨ `reset` æŒ‡ä»¤ï¼Œè®©åˆ†æ”¯æŒ‡å‘æƒ³è¦çš„æä»·ä¸Šã€‚

### æŸ¥çœ‹æäº¤å†å²

ä½¿ç”¨ `git log` å‘½ä»¤æŸ¥çœ‹æäº¤å†å²ã€‚

é»˜è®¤ä¸ç”¨ä»»ä½•å‚æ•°çš„è¯ï¼Œä¼šæŒ‰æäº¤æ—¶é—´ï¼Œç”±æ–°åˆ°æ—§åˆ—å‡ºæ‰€æœ‰çš„æäº¤ä¿¡æ¯ï¼š

- SHA-1 æ ¡éªŒå’Œ
- ä½œè€…çš„åå­—
- ç”µå­é‚®ä»¶åœ°å€
- æäº¤æ—¶é—´
- æäº¤è¯´æ˜

```bash
garrikliu:a xiangliu$ git log
commit fb3afcd7ad8151207cec0ace9a6550c3e1589f81 (HEAD)
Author: Garrik-Liu <garrikliu@Gmail.com>
Date:   Mon Feb 4 16:55:48 2019 +0800

    deleted readme

commit 022abc8b56edac279d3aa28981913e378bca136b
Author: Garrik-Liu <garrikliu@Gmail.com>
Date:   Sun Feb 3 09:56:44 2019 +0800

    add readme.md
```

å¯ä»¥åŠ ä¸Š `-2` å‚æ•°ï¼Œæ¥ä»…æ˜¾ç¤ºæœ€è¿‘ä¸¤æ¬¡æäº¤ã€‚åŒç† `-3` å°±æ˜¯æœ€è¿‘çš„ä¸‰æ¬¡æäº¤ã€‚

```js
(base) bogon:test xiangliu$ git log -1
commit cb171cbaa507ba9663ce776e8fd071d48bf9e9b6 (HEAD -> master)
Author: Garrik-Liu <garrikliu@Gmail.com>
Date:   Sat Sep 19 09:41:45 2020 +0800

    add test1
```

ä½¿ç”¨ `--stat` é€‰é¡¹ï¼ŒæŸ¥çœ‹æ¯æ¬¡æäº¤çš„è¯¦ç»†ä¿¡æ¯ã€‚

```bash
commit a11bef06a3f659402fe7563abf99ad00de2209e6
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Sat Mar 15 10:31:28 2008 -0700

    first commit

 README           |  6 ++++++
 Rakefile         | 23 +++++++++++++++++++++++
 lib/simplegit.rb | 25 +++++++++++++++++++++++++
 3 files changed, 54 insertions(+)
```

é€šè¿‡é€‰é¡¹ `--pretty` æ¥ä½¿ç”¨æŒ‡å®šçš„æ ¼å¼å±•ç¤ºæäº¤å†å²ã€‚å®ƒæœ‰ä¸€äº›å†…å»ºçš„å­é€‰é¡¹ä¾›ä½ ä½¿ç”¨ï¼š

- `oneline` å°†æ¯ä¸ªæäº¤æ”¾åœ¨ä¸€è¡Œæ˜¾ç¤ºã€‚

å…·ä½“ä½¿ç”¨ç»†èŠ‚ï¼Œè¯·å‚è€ƒ[æ–‡æ¡£](https://git-scm.com/docs/pretty-formats)ã€‚

```bash
$ git log --pretty=oneline
ca82a6dff817ec66f44342007202690a93763949 changed the version number
085bb3bcb608e1e8451d4b2432f8ecbe6306e7e7 removed unnecessary test
a11bef06a3f659402fe7563abf99ad00de2209e6 first commit
```

### æŸ¥çœ‹æ“ä½œå†å²

ä½¿ç”¨ `git reflog` æŒ‡ä»¤ï¼Œå¯ä»¥æ˜¾ç¤ºæ‰€æœ‰å·²æ‰§è¡Œæ“ä½œçš„æ—¥å¿—ã€‚

å¦‚æœä½ ä¸å¹¸çŠ¯é”™äº†ï¼Œä½ å¯ä»¥ä½¿ç”¨ `git reflog` çš„ä¿¡æ¯é€šè¿‡é‡ç½® HEAD è½»æ¾åœ°å›åˆ°æƒ³è¦çš„æäº¤ä¸Šã€‚

![2020-09-20-14-07-43](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-14-07-43.gif)

å‡è®¾ï¼Œæˆ‘ä»¬ä¸æƒ³åˆå¹¶åˆ†æ”¯äº†ã€‚æ‰§è¡Œ `git reflog` å‘½ä»¤ï¼Œæˆ‘ä»¬çœ‹åˆ°åˆå¹¶ä¹‹å‰çš„ä»“åº“çŠ¶æ€ä½äº `HEAD@{1}` è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬ä½¿ç”¨ `git reset` æŒ‡ä»¤å°† `HEAD` å¤´æŒ‡å‘ `HEAD@{1}`ã€‚

### æ‰“æ ‡ç­¾

Git å¯ä»¥ç»™å†å²ä¸­çš„æŸä¸€ä¸ªæäº¤æ‰“ä¸Šæ ‡ç­¾ã€‚

å¸¸è§ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œä½¿ç”¨è¿™ä¸ªåŠŸèƒ½æ¥æ ‡è®°ç‰ˆæœ¬å‘å¸ƒç»“ç‚¹ï¼Œä¾‹å¦‚ `v1.0`ï¼Œ`v2.1`ï¼Œ`v3.0`ã€‚

#### åˆ—å‡ºæ ‡ç­¾

`git tag` åˆ—å‡ºå·²æœ‰æ ‡ç­¾

```bash
$ git tag
v0.1
v1.3
```

`-l` å‚æ•°å¯ä»¥æŸ¥å·ç‰¹å®šæ ‡ç­¾

```bash
$ git tag -l 'v1.8.5*'
v1.8.5
v1.8.5-rc0
v1.8.5-rc1
v1.8.5-rc2
```

#### åˆ›å»ºæ ‡ç­¾

Git ä½¿ç”¨ä¸¤ç§ä¸»è¦ç±»å‹çš„æ ‡ç­¾ï¼š

- **è½»é‡æ ‡ç­¾**ï¼ˆlightweightï¼‰åªæ˜¯å¯¹ä¸€ä¸ªç‰¹å®šæäº¤çš„å¼•ç”¨ã€‚
- **é™„æ³¨æ ‡ç­¾**ï¼ˆannotatedï¼‰æ˜¯å­˜å‚¨åœ¨ Git ä»“åº“ä¸­çš„ä¸€ä¸ªå®Œæ•´å¯¹è±¡ã€‚å…¶ä¸­åŒ…å«ï¼š
  - æ‰“æ ‡ç­¾è€…çš„åå­—
  - ç”µå­é‚®ä»¶åœ°å€
  - æ—¥æœŸæ—¶é—´
  - ä¸€ä¸ªæ ‡ç­¾ä¿¡æ¯

é€šå¸¸å»ºè®®åˆ›å»ºã€Œ é™„æ³¨æ ‡ç­¾ ã€ï¼Œè¿™æ ·ä½ å¯ä»¥æ‹¥æœ‰ä»¥ä¸Šæ‰€æœ‰ä¿¡æ¯ã€‚

---

åˆ›å»ºã€Œ **è½»é‡æ ‡ç­¾** ã€åªéœ€è¦æä¾›æ ‡ç­¾åå­—:

```bash
$ git tag v1.4-lw
$ git tag
v0.1
v1.3
v1.4
v1.4-lw
v1.5
```

åœ¨æ ‡ç­¾ä¸Šè¿è¡Œ `git show`ï¼Œä½ ä¸ä¼šçœ‹åˆ°é¢å¤–çš„æ ‡ç­¾ä¿¡æ¯ã€‚ å‘½ä»¤åªä¼šæ˜¾ç¤ºå‡ºæäº¤ä¿¡æ¯ï¼š

```bash
$ git show v1.4-lw
commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Mon Mar 17 21:52:11 2008 -0700

    changed the version number
```

åˆ›å»ºä¸€ä¸ªã€Œ **é™„æ³¨æ ‡ç­¾** ã€, æœ€ç®€å•çš„æ–¹å¼æ˜¯å½“ä½ åœ¨è¿è¡Œ `tag` å‘½ä»¤æ—¶æŒ‡å®š `-a` é€‰é¡¹ï¼š

```bash
$ git tag -a v1.4 -m 'my version 1.4'
$ git tag
v0.1
v1.3
v1.4
```

`-m` é€‰é¡¹æŒ‡å®šäº†ä¸€æ¡å°†ä¼šå­˜å‚¨åœ¨æ ‡ç­¾ä¸­çš„ä¿¡æ¯ã€‚ å¦‚æœæ²¡æœ‰ä¸ºé™„æ³¨æ ‡ç­¾æŒ‡å®šä¸€æ¡ä¿¡æ¯ï¼ŒGit ä¼šè¿è¡Œç¼–è¾‘å™¨è¦æ±‚ä½ è¾“å…¥ä¿¡æ¯ã€‚

ä½¿ç”¨ `git show` å‘½ä»¤å¯ä»¥çœ‹åˆ°æ ‡ç­¾ä¿¡æ¯ä¸å¯¹åº”çš„æäº¤ä¿¡æ¯ï¼š

```bash
$ git show v1.4
tag v1.4
Tagger: Ben Straub <ben@straub.cc>
Date:   Sat May 3 20:19:12 2014 -0700

my version 1.4

commit ca82a6dff817ec66f44342007202690a93763949
Author: Scott Chacon <schacon@gee-mail.com>
Date:   Mon Mar 17 21:52:11 2008 -0700

    changed the version number
```

å¦‚æœè¦ç»™ **è¿‡å»çš„æäº¤** æ‰“æ ‡ç­¾, éœ€è¦åœ¨å‘½ä»¤çš„æœ«å°¾æŒ‡å®šæäº¤çš„æ ¡éªŒå’Œ

```bash
$ git tag -a v1.2 9fceb02
```

#### åˆ é™¤æ ‡ç­¾

å‘½ä»¤ `git tag -d <tagname>` å¯ä»¥åˆ é™¤æŒ‡å®šæ ‡ç­¾:

```bash
$ git tag -d v1.4-lw
Deleted tag 'v1.4-lw' (was e7d5add)
```

## ä½¿ç”¨åˆ†æ”¯

### åˆ†æ”¯ç®€ä»‹

**Git çš„åˆ†æ”¯ï¼Œå…¶å®æœ¬è´¨ä¸Šä»…ä»…æ˜¯æŒ‡å‘æäº¤å¯¹è±¡çš„æŒ‡é’ˆ**ã€‚

![2020-09-19-20-10-35](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-19-20-10-35.png)

ç”±äº Git çš„åˆ†æ”¯å®è´¨ä¸Šä»…æ˜¯åŒ…å«æ‰€æŒ‡å¯¹è±¡æ ¡éªŒå’Œçš„æ–‡ä»¶ï¼Œæ‰€ä»¥å®ƒçš„åˆ›å»ºå’Œé”€æ¯éƒ½å¼‚å¸¸é«˜æ•ˆã€‚ åˆ›å»ºä¸€ä¸ªæ–°åˆ†æ”¯å°±ç›¸å½“äºå¾€ä¸€ä¸ªæ–‡ä»¶ä¸­å†™å…¥ 41 ä¸ªå­—èŠ‚ï¼ˆ40 ä¸ªå­—ç¬¦å’Œ 1 ä¸ªæ¢è¡Œç¬¦ï¼‰

### HEAD

HEAD æ˜¯ä¸€å€‹æŒ‡é’ˆï¼ŒæŒ‡å‘æŸä¸€å€‹åˆ†æ”¯ï¼Œå¯ä»¥æŠŠ HEAD ç•¶åšã€Œ **ç›®å‰æ‰€åœ¨åˆ†æ”¯** ã€çœ‹å¾…ã€‚åœ¨ `.git` ç›®éŒ„è£¡æœ‰ä¸€å€‹æª”åç‚º HEAD çš„æ–‡ä»¶ï¼Œè¨˜éŒ„è‘— HEAD æ‰€æŒ‡å‘çš„åˆ†æ”¯ã€‚

```dash
$ cat .git/HEAD
ref: refs/heads/master
```

### åˆ†æ”¯åˆ›å»º

ä½¿ç”¨ `git branch` å‘½ä»¤åˆ›å»ºæ–°åˆ†æ”¯, ä¼šåœ¨å½“å‰æ‰€åœ¨çš„æäº¤å¯¹è±¡ä¸Šåˆ›å»ºä¸€ä¸ªæŒ‡é’ˆ.

```bash
git branch testing
```

ä½¿ç”¨ `git log` å‘½ä»¤çš„ `--decorate` å‚æ•°, å¯ä»¥æŸ¥çœ‹å„ä¸ªåˆ†æ”¯å½“å‰æ‰€æŒ‡çš„å¯¹è±¡ã€‚

```bash
$ git log --oneline --decorate
f30ab (HEAD, master, testing) add feature #32 - ability to add new
34ac2 fixed bug #1328 - stack overflow under certain conditions
98ca9 initial commit of my project
```

### åˆ†æ”¯åˆ‡æ¢

è¦åˆ‡æ¢åˆ°ä¸€ä¸ªå·²å­˜åœ¨çš„åˆ†æ”¯ï¼Œä½ éœ€è¦ä½¿ç”¨ `git checkout` å‘½ä»¤ã€‚

```bash
$ git checkout testing
```

å¦‚æœæƒ³æ–°å»ºä¸€ä¸ªåˆ†æ”¯, åŒæ—¶åˆ‡æ¢åˆ°è¿™ä¸ªåˆ†æ”¯ä¸Šå¯ä»¥ä½¿ç”¨ `git checkout` çš„ `-b` å‚æ•°.

```bash
$ git checkout -b testing
```

æŠŠåˆ†æ”¯åˆ‡æ¢å› master. HEAD æŒ‡å› master åˆ†æ”¯ï¼ŒåŒæ—¶å·¥ä½œç›®å½•æ¢å¤æˆ master åˆ†æ”¯æ‰€æŒ‡å‘çš„å¿«ç…§å†…å®¹ã€‚ç„¶ååœ¨ master åˆ†æ”¯ä¸Š, åšä¸€äº›å†…å®¹ä¿®æ”¹, å¹¶ä¸”æäº¤, åˆ™é¡¹ç›®å‡ºç°åˆ†æ”¯åˆ†å‰æƒ…å†µ.

![advance-master](https://i.loli.net/2019/02/19/5c6b71064e0f2.png)

ä½¿ç”¨ `git log` å‘½ä»¤æŸ¥çœ‹åˆ†å‰å†å²ã€‚ è¿è¡Œ `git log --oneline --decorate --graph --all` ï¼Œå®ƒä¼šè¾“å‡ºä½ çš„æäº¤å†å²ã€å„ä¸ªåˆ†æ”¯çš„æŒ‡å‘ä»¥åŠé¡¹ç›®çš„åˆ†æ”¯åˆ†å‰æƒ…å†µã€‚

```bash
$ git log --oneline --decorate --graph --all
* c2b9e (HEAD, master) made other changes
| * 87ab2 (testing) made a change
|/
* f30ab add feature #32 - ability to add new formats to the
* 34ac2 fixed bug #1328 - stack overflow under certain conditions
* 98ca9 initial commit of my project
```

### åˆå¹¶åˆ†æ”¯

ä½¿ç”¨ `git merge` å‘½ä»¤å¯ä»¥åˆå¹¶åˆ†æ”¯.

```bash
$ git checkout master
$ git merge hotfix
Updating f42c576..3a0874c
Fast-forward
 index.html | 2 ++
 1 file changed, 2 insertions(+)
```

ä¸Šé¢å‘½ä»¤é‡Œ, åˆ‡æ¢åˆ° `master` åˆ†æ”¯, ç„¶åæŠŠ `hotfix` åˆ†æ”¯åˆå¹¶è¿›æ¥.

![basic-branching-4](https://i.loli.net/2019/02/19/5c6b711339866.png)

å¦‚æœé¡ºç€ä¸€ä¸ªåˆ†æ”¯èµ°ä¸‹å»èƒ½å¤Ÿåˆ°è¾¾å¦ä¸€ä¸ªåˆ†æ”¯ï¼Œé‚£ä¹ˆ Git åœ¨åˆå¹¶ä¸¤è€…çš„æ—¶å€™ï¼Œåªä¼šç®€å•çš„å°†æŒ‡é’ˆå‘å‰æ¨è¿›ï¼Œè¿™è¢«ç§°ä¸ºã€Œ **fast-forward å¿«è¿›åˆå¹¶** ã€è¿™ç§æƒ…å†µä¸‹çš„åˆå¹¶æ“ä½œæ²¡æœ‰éœ€è¦è§£å†³çš„åˆ†æ­§ã€‚

å½“å‰ `master` åˆ†æ”¯æ‰€æŒ‡å‘çš„æäº¤ï¼Œæ˜¯è¦åˆå¹¶è¿›æ¥çš„åˆ†æ”¯æ‰€æŒ‡å‘çš„æäº¤çš„ç›´æ¥ä¸Šæ¸¸ï¼Œæ‰€ä»¥ Git åªæ˜¯ç®€å•çš„å°† `master` åˆ†æ”¯çš„æŒ‡é’ˆå‘å‰ç§»åŠ¨ã€‚

![2020-09-19-21-45-53](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-19-21-45-53.gif)

å¦‚æœè¦åˆå¹¶ä¸¤ä¸ªä¹‹é—´å­˜åœ¨åˆ†å‰çš„åˆ†æ”¯ã€‚Git å°±éœ€è¦åšã€Œ **no-fast-forward åˆå¹¶** ã€äº†ã€‚

Git ä¼šä½¿ç”¨ä¸¤ä¸ªåˆ†æ”¯æ‰€æŒ‡å‘çš„æäº¤, ä»¥åŠè¿™ä¸¤ä¸ªåˆ†æ”¯ä¸Šçš„ç¬¬ä¸€ä¸ªå…±åŒæäº¤ï¼Œåšä¸€ä¸ªç®€å•çš„ä¸‰æ–¹åˆå¹¶ã€‚Git ä¼šåœ¨å½“å‰åˆ†æ”¯ï¼ˆ active branch ï¼‰ä¸Šé¢å¤–åˆ›å»ºä¸€ä¸ªæ–°çš„ã€Œ **åˆå¹¶æäº¤** merging commit ã€è¿™æ¡æäº¤è®°å½•æ—¢æŒ‡å‘å½“å‰åˆ†æ”¯ï¼ŒåˆæŒ‡å‘åˆå¹¶åˆ†æ”¯ã€‚

![2020-09-19-21-50-00](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-19-21-50-00.png)

![2020-09-19-21-50-39](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-19-21-50-39.png)

![2020-09-20-13-20-56](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-13-20-56.gif)

å¦‚æœä½ åœ¨ä¸¤ä¸ªä¸åŒçš„åˆ†æ”¯ä¸­ï¼Œå¯¹åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€ä¸ªéƒ¨åˆ†è¿›è¡Œäº†ä¸åŒçš„ä¿®æ”¹ï¼Œã€Œ **å†²çª** conflict ã€å°±ä¼šå‡ºç°ã€‚

åˆå¹¶æ—¶ Git ä¼šç­‰å¾…ä½ å»è§£å†³åˆå¹¶äº§ç”Ÿçš„å†²çªã€‚ ä½ å¯ä»¥ä½¿ç”¨ `git status` å‘½ä»¤æ¥æŸ¥çœ‹é‚£äº›ï¼ŒåŒ…å«åˆå¹¶å†²çªçš„ï¼Œå¤„äºæœªåˆå¹¶ï¼ˆ unmerged ï¼‰çŠ¶æ€çš„æ–‡ä»¶ï¼š

```bash
# å°è¯•åˆå¹¶
$ git merge iss53
Auto-merging iss53
CONFLICT (content): Merge conflict in iss53
Automatic merge failed; fix conflicts and then commit the result.

# æŸ¥çœ‹åŒ…å«å†²çªçš„æ–‡ä»¶
$ git status
On branch master
You have unmerged paths.
  (fix conflicts and run "git commit")

Unmerged paths:
  (use "git add <file>..." to mark resolution)

    both modified:      index.html

no changes added to commit (use "git add" and/or "git commit -a")
```

åœ¨ä½ è§£å†³äº†æ‰€æœ‰æ–‡ä»¶é‡Œçš„å†²çªä¹‹åï¼Œå¯¹æ¯ä¸ªæ–‡ä»¶ä½¿ç”¨ `git add` å‘½ä»¤æ¥å°†å…¶æ ‡è®°ä¸ºå†²çªå·²è§£å†³ï¼Œå¹¶æš‚å­˜ã€‚ä¹‹åè¾“å…¥ `git commit` æ¥å®Œæˆåˆå¹¶æäº¤ã€‚

### åˆ é™¤åˆ†æ”¯

åœ¨åˆå¹¶å®Œä¹‹å, ä½ å¯ä»¥ç”¨ `git branch -d` æ¥åˆ é™¤æ‰ä¸éœ€è¦çš„åˆ†æ”¯ã€‚

```js
$ git branch -d iss53
Deleted branch iss53 (was aa722a3).
```

### æŸ¥çœ‹åˆ†æ”¯åˆ—è¡¨

`git branch` å‘½ä»¤å¦‚æœä¸åŠ ä»»ä½•å‚æ•°è¿è¡Œå®ƒï¼Œä¼šå¾—åˆ°å½“å‰æ‰€æœ‰åˆ†æ”¯çš„ä¸€ä¸ªåˆ—è¡¨

```bash
$ git branch
  iss53
* master
  testing
```

`*` è¡¨ç¤ºå½“å‰ HEAD æŒ‡é’ˆæ‰€æŒ‡å‘çš„åˆ†æ”¯. è¿™æ„å‘³ç€å¦‚æœåœ¨è¿™æ—¶å€™æäº¤ï¼Œmaster åˆ†æ”¯å°†ä¼šéšç€æ–°çš„å·¥ä½œå‘å‰ç§»åŠ¨ã€‚

### æŸ¥çœ‹åˆ†æ”¯æœ€åæäº¤

å¦‚æœéœ€è¦æŸ¥çœ‹æ¯ä¸€ä¸ªåˆ†æ”¯çš„æœ€åä¸€æ¬¡æäº¤ï¼Œå¯ä»¥è¿è¡Œ `git branch -v` å‘½ä»¤ï¼š

```bash
$ git branch -v
  iss53   93b412c fix javascript issue
* master  7a98805 Merge branch 'iss53'
  testing 782fd34 add scott to the author list in the readmes
```

#### æŸ¥çœ‹ã€Œ å·²åˆå¹¶ / æœªåˆå¹¶ ã€åˆ†æ”¯

`--merged` ä¸ `--no-merged` é€‰é¡¹å¯ä»¥è¿‡æ»¤åˆ†æ”¯åˆ—è¡¨ä¸­ï¼Œå·²åˆå¹¶æˆ–æœªåˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„åˆ†æ”¯ã€‚

åœ¨è¿™ä¸ªåˆ—è¡¨ä¸­åˆ†æ”¯åå­—å‰æ²¡æœ‰ `*` å·çš„åˆ†æ”¯ï¼Œä»£è¡¨å·²ç»å°†å®ƒä»¬çš„å·¥ä½œæ•´åˆåˆ°äº†å¦ä¸€ä¸ªåˆ†æ”¯ä¸­ã€‚é€šå¸¸å¯ä»¥ä½¿ç”¨ `git branch -d` åˆ é™¤æ‰ã€‚

```bash
$ git branch --merged
  iss53
* master
```

### å˜åŸº

ä½¿ç”¨ `rebase` å‘½ä»¤ï¼Œæ‰§è¡Œå˜åŸºæ“ä½œï¼Œå°†ä¸€æ¡åˆ†æ”¯ä¸Šçš„æäº¤ï¼ŒæŒ‰ç…§åŸæœ‰æ¬¡åºä¾æ¬¡åº”ç”¨åˆ°å¦ä¸€åˆ†æ”¯ä¸Šã€‚

![2020-09-20-13-21-54](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-13-21-54.gif)

```bash
$ git checkout experiment
$ git rebase master
First, rewinding head to replay your work on top of it...
Applying: added staged command
```

ä½¿ç”¨ `git rebase [basebranch] [topicbranch]` å‘½ä»¤å¯ä»¥ç›´æ¥å°† Topic Branch åˆ†æ”¯ï¼Œå³ experimentï¼Œå˜åŸºåˆ° Base Branch åˆ†æ”¯ä¸Šï¼Œå³ masterã€‚

è¿™æ ·åšèƒ½çœå»ä½ å…ˆåˆ‡æ¢åˆ° experiment åˆ†æ”¯ï¼Œå†å¯¹å…¶æ‰§è¡Œå˜åŸºå‘½ä»¤çš„å¤šä¸ªæ­¥éª¤ã€‚

```bash
$ git rebase master experiment
```

![2020-09-20-09-05-50](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-09-05-50.png)

å˜åŸºæ“ä½œä½¿å¾—æäº¤å†å²æ›´åŠ æ•´æ´ã€‚ åœ¨ä¸€æ¡ç»è¿‡å˜åŸºçš„åˆ†æ”¯ä¸Šï¼Œå°½ç®¡å®é™…çš„å¼€å‘å·¥ä½œæ˜¯å¹¶è¡Œçš„ï¼Œä½†å®ƒä»¬çœ‹ä¸Šå»å°±åƒæ˜¯ä¸²è¡Œçš„ä¸€æ ·ï¼Œæäº¤å†å²æ˜¯ä¸€æ¡ç›´çº¿æ²¡æœ‰åˆ†å‰ã€‚

#### äº¤äº’å¼å˜åŸº

ä½¿ç”¨ `git rebase -i` é€‰é¡¹ï¼Œè¿›å…¥äº¤äº’å¼å˜åŸºæ¨¡å¼ã€‚Git ä¼šæ‰“å¼€æ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæäº¤è®°å½•æŒ‰ç…§ã€Œ ä»æ—§åˆ°æ–° ã€æ’åˆ—ã€‚

åœ¨æ¯ä¸€æ¡æäº¤ä¸Šï¼Œå¯ä»¥åº”ç”¨å¾ˆå¤šç§æ“ä½œæ¨¡å¼ï¼š

- `pick`ï¼Œç®€å†™ `p`ï¼šç•™ä¸‹æ­¤æäº¤ã€‚
- `reword`ï¼Œç®€å†™ `r`ï¼šç•™ä¸‹æ­¤æäº¤ï¼Œä½†ä¿®æ”¹æäº¤ä¿¡æ¯ã€‚
- `edit`ï¼Œç®€å†™ `e`ï¼šä¿®æ”¹æ­¤æäº¤ã€‚
- `squash`ï¼Œç®€å†™ `s`ï¼šå°†æ­¤æäº¤åˆå¹¶åˆ°ä¹‹å‰çš„æäº¤ä¸­ã€‚
- `fixup`ï¼Œç®€å†™ `f`ï¼šå°†å½“å‰æäº¤åˆå¹¶åˆ°ä¹‹å‰çš„æäº¤ä¸­ï¼Œä¸ä¿ç•™æäº¤æ¶ˆæ¯ã€‚
- `drop`ï¼Œç®€å†™ `d`ï¼šåˆ é™¤æäº¤ã€‚
- `exec`ï¼Œç®€å†™ `x`ï¼šåœ¨æ¯ä¸€ä¸ªéœ€è¦å˜åŸºçš„æäº¤ä¸Šæ‰§è¡Œä¸€æ¡å‘½ä»¤ã€‚

æœ€å¸¸è§çš„åº”ç”¨åœºæ™¯å°±æ˜¯ï¼Œåˆå¹¶æäº¤è®°å½•ã€‚

![2020-09-20-13-20-00](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-13-20-00.gif)

#### å˜åŸºçš„é£é™©

å˜åŸºçš„å‡†åˆ™ï¼š

- åªæŠŠå˜åŸºæ“ä½œå½“ä½œæ˜¯åœ¨æ¨é€å‰ï¼Œæ¸…ç†æäº¤çš„å·¥å…·ã€‚
- **åªå¯¹å°šæœªæ¨é€æˆ–åˆ†äº«ç»™åˆ«äººçš„æœ¬åœ°æäº¤æ‰§è¡Œå˜åŸºæ“ä½œï¼Œä»ä¸å¯¹å·²æ¨é€è‡³åˆ«å¤„çš„æäº¤æ‰§è¡Œå˜åŸºæ“ä½œ**ã€‚

---

å˜åŸºæ“ä½œçš„å®è´¨æ˜¯ä¸¢å¼ƒä¸€äº›ç°æœ‰çš„æäº¤ï¼Œç„¶åç›¸åº”åœ°æ–°å»ºä¸€äº›å†…å®¹ä¸€æ ·ä½†å®é™…ä¸Šä¸åŒçš„æäº¤ã€‚

å¦‚æœä½ å·²ç»å°†æäº¤æ¨é€è‡³æŸä¸ªä»“åº“ï¼Œè€Œå…¶ä»–äººä¹Ÿå·²ç»ä»è¯¥ä»“åº“æ‹‰å–æäº¤ï¼Œå¹¶è¿›è¡Œäº†åç»­å·¥ä½œã€‚

æ­¤æ—¶ï¼Œå¦‚æœä½ ç”¨ `git rebase` å‘½ä»¤é‡æ–°æ•´ç†äº†æäº¤å¹¶å†æ¬¡æ¨é€ï¼Œä½ çš„åŒä¼´å› æ­¤å°†ä¸å¾—ä¸å†æ¬¡å°†ä»–ä»¬æ‰‹å¤´çš„å·¥ä½œä¸ä½ çš„æäº¤è¿›è¡Œæ•´åˆï¼Œå¦‚æœæ¥ä¸‹æ¥ä½ è¿˜è¦æ‹‰å–å¹¶æ•´åˆä»–ä»¬ä¿®æ”¹è¿‡çš„æäº¤ï¼Œäº‹æƒ…å°±ä¼šå˜å¾—ä¸€å›¢ç³Ÿã€‚

ğŸŒ° çœ‹ä¸ªä¾‹å­:

å‡è®¾ä½ ä»ä¸€ä¸ªä¸­å¤®æœåŠ¡å™¨å…‹éš†ç„¶ååœ¨å®ƒçš„åŸºç¡€ä¸Šè¿›è¡Œäº†ä¸€äº›å¼€å‘ã€‚ ä½ çš„æäº¤å†å²å¦‚å›¾æ‰€ç¤ºï¼š

![2020-09-20-11-01-45](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-11-01-45.png)

ç„¶åï¼ŒæŸäººåˆå‘ä¸­å¤®æœåŠ¡å™¨æäº¤äº†ä¸€äº›ä¿®æ”¹ï¼Œå…¶ä¸­è¿˜åŒ…æ‹¬ä¸€æ¬¡åˆå¹¶ã€‚ ä½ æŠ“å–äº†è¿™äº›åœ¨è¿œç¨‹åˆ†æ”¯ä¸Šçš„ä¿®æ”¹ï¼Œå¹¶å°†å…¶åˆå¹¶åˆ°ä½ æœ¬åœ°çš„å¼€å‘åˆ†æ”¯ï¼Œç„¶åä½ çš„æäº¤å†å²å°±ä¼šå˜æˆè¿™æ ·ï¼š

![2020-09-20-11-02-09](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-11-02-09.png)

æ¥ä¸‹æ¥ï¼Œè¿™ä¸ªäººåˆå†³å®šæŠŠåˆå¹¶æ“ä½œå›æ»šï¼Œæ”¹ç”¨å˜åŸºï¼›ç»§è€Œåˆç”¨ `git push --force` å‘½ä»¤è¦†ç›–äº†æœåŠ¡å™¨ä¸Šçš„æäº¤å†å²ã€‚ ä¹‹åä½ ä»æœåŠ¡å™¨æŠ“å–æ›´æ–°ï¼Œä¼šå‘ç°å¤šå‡ºæ¥ä¸€äº›æ–°çš„æäº¤ã€‚

![2020-09-20-11-02-24](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-11-02-24.png)

ç»“æœå°±æ˜¯ä½ ä»¬ä¸¤äººçš„å¤„å¢ƒéƒ½ååˆ†å°´å°¬ã€‚ å¦‚æœä½ æ‰§è¡Œ `git pull` å‘½ä»¤ï¼Œä½ å°†åˆå¹¶æ¥è‡ªä¸¤æ¡æäº¤å†å²çš„å†…å®¹ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„åˆå¹¶æäº¤ï¼Œæœ€ç»ˆä»“åº“ä¼šå¦‚å›¾æ‰€ç¤ºï¼š

![2020-09-20-11-01-32](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-11-01-32.png)

æ­¤æ—¶å¦‚æœä½ æ‰§è¡Œ `git log` å‘½ä»¤ï¼Œä½ ä¼šå‘ç°æœ‰ä¸¤ä¸ªæäº¤çš„ä½œè€…ã€æ—¥æœŸã€æ—¥å¿—å±…ç„¶æ˜¯ä¸€æ ·çš„ï¼Œè¿™ä¼šä»¤äººæ„Ÿåˆ°æ··ä¹±ã€‚ æ­¤å¤–ï¼Œå¦‚æœä½ å°†è¿™ä¸€å †åˆæ¨é€åˆ°æœåŠ¡å™¨ä¸Šï¼Œä½ å®é™…ä¸Šæ˜¯å°†é‚£äº›å·²ç»è¢«å˜åŸºæŠ›å¼ƒçš„æäº¤åˆæ‰¾äº†å›æ¥ï¼Œè¿™ä¼šä»¤äººæ„Ÿåˆ°æ›´åŠ æ··ä¹±ã€‚ å¾ˆæ˜æ˜¾å¯¹æ–¹å¹¶ä¸æƒ³åœ¨æäº¤å†å²ä¸­çœ‹åˆ° C4 å’Œ C6ï¼Œå› ä¸ºä¹‹å‰å°±æ˜¯ä»–æŠŠè¿™ä¸¤ä¸ªæäº¤é€šè¿‡å˜åŸºä¸¢å¼ƒçš„ã€‚

#### ç”¨å˜åŸºè§£å†³å˜åŸº

é‡åˆ°ä¸Šè¿°æƒ…å†µï¼Œä¸è¦æ‰§è¡Œåˆå¹¶ï¼Œè€Œæ˜¯æ‰§è¡Œ `git rebase teamone/master`, Git å°†ä¼šï¼š

- æ£€æŸ¥å“ªäº›æäº¤æ˜¯æˆ‘ä»¬çš„åˆ†æ”¯ä¸Šç‹¬æœ‰çš„ï¼ˆ C2ï¼ŒC3ï¼ŒC4ï¼ŒC6ï¼ŒC7 ï¼‰
- æ£€æŸ¥å…¶ä¸­å“ªäº›æäº¤ä¸æ˜¯åˆå¹¶æ“ä½œçš„ç»“æœï¼ˆ C2ï¼ŒC3ï¼ŒC4 ï¼‰
- æ£€æŸ¥å“ªäº›æäº¤çš„å†…å®¹æ˜¯ç›®æ ‡åˆ†æ”¯ä¸å…·å¤‡çš„ï¼ˆ åªæœ‰ C2 å’Œ C3ï¼Œå› ä¸º C4 å…¶å®å°±æ˜¯ C4' ï¼‰
- æŠŠè¿™äº›æäº¤åº”ç”¨åœ¨ `teamone/master` ä¸Šé¢

![2020-09-20-11-01-12](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-11-01-12.png)

æœ¬ä¾‹ä¸­ä½¿ç”¨ `git pull --rebase` å‘½ä»¤å¯ä»¥å®Œæˆä¸Šè¿°æ“ä½œ. å®ƒçš„æ„æ€æ˜¯å…ˆ `git fetch`ï¼Œå† `git rebase teamone/master`ã€‚

## è¿œç¨‹ä»“åº“

è¿œç¨‹ä»“åº“æ˜¯æŒ‡ï¼Œæ‰˜ç®¡åœ¨ç½‘ç»œä¸­çš„ç‰ˆæœ¬åº“. ä¸ä»–äººåä½œæ—¶, å¯ä»¥åœ¨è¿™ä¸ªè¿œç¨‹ä»“åº“ä¸Šæ ¹æ®éœ€è¦ã€Œ Push æ¨é€ ã€æˆ–ã€Œ Fetch æ‹‰å– ã€æ•°æ®ã€‚

ä¸‹å›¾å„æŒ‡ä»¤ä¸è¿œç«¯åº“ï¼Œæœ¬åœ°åº“ï¼Œæš‚å­˜åŒºï¼Œå·¥ä½œç›®å½•ä¹‹é—´çš„å…³ç³»ï¼š

![2020-09-20-13-28-15](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-13-28-15.png)

### æ·»åŠ è¿œç¨‹ä»“åº“

#### æ·»åŠ è¿œç¨‹åº“

åœºæ™¯: å…ˆæœ‰æœ¬åœ°åº“, åæœ‰è¿œç¨‹åº“

è¿è¡Œ `git remote add <shortname> <url>` æ·»åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ä»“åº“ï¼ŒåŒæ—¶å¯ä»¥ä¸ºä»“åº“æŒ‡å®šä¸€ä¸ªåå­—ã€‚

```bash
$ git remote
origin
$ git remote add pb https://github.com/paulboone/ticgit
$ git remote -v
origin	https://github.com/schacon/ticgit (fetch)
origin	https://github.com/schacon/ticgit (push)
pb	https://github.com/paulboone/ticgit (fetch)
pb	https://github.com/paulboone/ticgit (push)
```

#### ä»ç°æœ‰ä»“åº“å…‹éš†

åº”ç”¨åœºæ™¯: å…ˆæœ‰è¿œç¨‹åº“, åæœ‰æœ¬åœ°åº“

ä½¿ç”¨ `git clone [url]` æŒ‡ä»¤æŠŠè¿œç¨‹åº“å…‹éš†åˆ°æœ¬åœ°ã€‚å…‹éš†çš„è¿œç¨‹ä»“åº“é»˜è®¤åç§° `origin`ã€‚

```bash
$ git clone git://github.com/schacon/grit.git
```

å¦‚æœä½ æƒ³åœ¨å…‹éš†è¿œç¨‹ä»“åº“çš„æ—¶å€™ï¼Œè‡ªå®šä¹‰æœ¬åœ°ä»“åº“çš„ç›®å½•åï¼Œå¯ä»¥åœ¨å‘½ä»¤æœ«å°¾æŒ‡å®šæ–°çš„åå­—ã€‚

```bash
# git clone <ç‰ˆæœ¬åº“çš„ç½‘å€> <æœ¬åœ°ç›®å½•å>
$ git clone git://github.com/schacon/grit.git myFolder
```

### æŸ¥çœ‹è¿œç¨‹ä»“åº“

è¿è¡Œ `git remote` å‘½ä»¤ï¼Œå®ƒä¼šåˆ—å‡ºå½“å‰ä»“åº“é…ç½®çš„æ¯ä¸€ä¸ªè¿œç¨‹ä»“åº“çš„åå­—ã€‚

```bash
$ git remote
origin
```

é€‰é¡¹ `-v`ï¼Œä¼šæ˜¾ç¤ºï¼Œæ¯ä¸ªè¿œç¨‹ä»“åº“æ‰§è¡Œ `fetch` å’Œ `pull` æ“ä½œæ—¶å¯¹åº”çš„ URLã€‚

```bash
$ git remote -v
origin	https://github.com/schacon/ticgit (fetch)
origin	https://github.com/schacon/ticgit (push)
```

å¦‚æœæƒ³è¦æŸ¥çœ‹æŸä¸€ä¸ªè¿œç¨‹ä»“åº“çš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ `git remote show [remote-name]` å‘½ä»¤

```bash
$ git remote show origin
* remote origin
  Fetch URL: https://github.com/schacon/ticgit
  Push  URL: https://github.com/schacon/ticgit
  HEAD branch: master
  Remote branches:
    master                               tracked
    dev-branch                           tracked
  Local branch configured for 'git pull':
    master merges with remote master
  Local ref configured for 'git push':
    master pushes to master (up to date)
```

### æ‹‰å– fetch & æŠ“å– pull

`git fetch [remote-name]` å‘½ä»¤ä¼šè®¿é—®è¿œç¨‹ä»“åº“ï¼Œä»ä¸­ **æ‹‰å–** æ‰€æœ‰ä½ è¿˜æ²¡æœ‰çš„æ•°æ®ã€‚ æ‰§è¡Œå®Œæˆåï¼Œä½ å°†ä¼šæ‹¥æœ‰é‚£ä¸ªè¿œç¨‹ä»“åº“ä¸­æ‰€æœ‰åˆ†æ”¯çš„å¼•ç”¨ï¼Œå¯ä»¥éšæ—¶åˆå¹¶æˆ–æŸ¥çœ‹ã€‚

`git fetch` å‘½ä»¤å¹¶ä¸ä¼šè‡ªåŠ¨åˆå¹¶æˆ–ä¿®æ”¹ä½ å½“å‰çš„å·¥ä½œã€‚

![2020-09-20-13-26-16](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-13-26-16.gif)

`git pull` å‘½ä»¤ç­‰åŒäº `git fetch` + `git merge`ã€‚ä¸ä½†æ‹‰å–ï¼Œè¿˜ä¼šè¿›è¡Œåˆå¹¶ã€‚

### æ¨é€åˆ°è¿œç¨‹ä»“åº“

ä½¿ç”¨å‘½ä»¤ `git push [remote-name] [branch-name]` å°†ä½ æœ¬åœ°çš„å†…å®¹æ¨é€åˆ°è¿œç«¯æœåŠ¡å™¨.

Push æŒ‡ä»¤å…¶å¯¦åšäº†å¹¾ä»¶äº‹ï¼š

- æŠŠ `[branch-name]` é€™å€‹åˆ†æ”¯çš„å…§å®¹ï¼Œæ¨å‘ `[remote-name]` é€™å€‹ä½ç½®ã€‚
- åœ¨ `[remote-name]` é‚£å€‹è¿œç«¯ä¸Šï¼Œå¦‚æœ `[branch-name]` ä¸å­˜åœ¨ï¼Œå°±å»ºç«‹ä¸€å€‹å«åš `[branch-name]` çš„åŒååˆ†æ”¯ã€‚
- ä½†å¦‚æœè¿œç«¯ä¸Šå°±å­˜åœ¨ `[branch-name]` åˆ†æ”¯ï¼Œä¾¿ä¼šè®© `[branch-name]` åˆ†æ”¯æŒ‡å‘æœ€æ–°çš„æäº¤ä¸Šã€‚

åªæœ‰å½“ä½ æœ‰æ‰€å…‹éš†æœåŠ¡å™¨çš„å†™å…¥æƒé™ï¼Œå¹¶ä¸”ä¹‹å‰æ²¡æœ‰äººæ¨é€è¿‡æ—¶ï¼Œè¿™æ¡å‘½ä»¤æ‰èƒ½ç”Ÿæ•ˆã€‚ å½“ä½ å’Œå…¶ä»–äººåœ¨åŒä¸€æ—¶é—´å…‹éš†ï¼Œä»–ä»¬å…ˆæ¨é€åˆ°ä¸Šæ¸¸ç„¶åä½ å†æ¨é€åˆ°ä¸Šæ¸¸ï¼Œä½ çš„æ¨é€å°±ä¼šæ¯«æ— ç–‘é—®åœ°è¢«æ‹’ç»ã€‚

ä½ å¿…é¡»å…ˆå°†ä»–ä»¬çš„å·¥ä½œ `fetch` æŠ“å–ä¸‹æ¥ï¼Œå¹¶å°†å…¶åˆå¹¶ `merge` è¿›ä½ çš„å·¥ä½œåæ‰èƒ½æ¨é€ã€‚`git pull` æ‹‰å–å‘½ä»¤å¯ä»¥ç›´æ¥å¸®ä½ å®ç°è¿™ä¸¤æ­¥ã€‚

#### upstream ä¸Šæ¸¸

å¯ä»¥ç»™åˆ†æ”¯è®¾å®šä¸€ä¸ªã€Œ **ä¸Šæ¸¸ upstream** ã€åˆ†æ”¯ã€‚**åœ¨åˆ†æ”¯ä¸Šæ‰§è¡Œ `pull`, `fetch`, `push` å‘½ä»¤æ—¶ï¼Œä¸éœ€è¦é¢å¤–çš„å‚æ•°ï¼Œé»˜è®¤å°†ä¸Šæ¸¸åˆ†æ”¯ä½œä¸ºç›®æ ‡**ã€‚

- é€šå¸¸ upstream æ˜¯è¿œç«¯æœåŠ¡å™¨ä¸Šçš„æŸä¸ªåˆ†æ”¯ï¼Œä½†ä¹Ÿå¯ä»¥è®¾å®šä¸ºåœ¨æœ¬åœ°ç«¯çš„å…¶å®ƒåˆ†æ”¯ã€‚

é€šè¿‡ `git push -u [è¿œç¨‹æœåŠ¡å™¨] [æœ¬åœ°åˆ†æ”¯:è¿œç«¯åˆ†æ”¯]` æŒ‡ä»¤æ¥è®¾å®š upstreamã€‚

```bash
$ git push -u origin master:master
```

- ä¸Šé¢æŒ‡ä»¤å°†è¿œç«¯ `origin` ä¸Šçš„ `master` åˆ†æ”¯è¨­å®šç‚ºæœ¬åœ° `master` åˆ†æ”¯çš„ä¸Šæ¸¸ upstreamã€‚
- å½“ç›´æ¥æ‰§è¡Œ `git push` æŒ‡ä»¤æ˜¯ï¼Œå°±ä¼šæŠŠæœ¬åœ° master åˆ†æ”¯ä¸Šçš„å†…å®¹ï¼Œæ›´æ–°åˆ°è¿œç«¯çš„ master åˆ†æ”¯ä¸Šã€‚å¦‚æœè¿œç«¯ä¸å­˜åœ¨ master åˆ†æ”¯ï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªã€‚

ä¸Šé¢çš„æŒ‡ä»¤å¯ä»¥ç®€å†™ä¸ºï¼š

```bash
$ git push origin master
```

å¦‚æœè¿œç«¯çš„åˆ†æ”¯åå’Œæœ¬åœ°çš„ä¸åŒï¼Œåˆ™ä¸èƒ½ç®€å†™ï¼š

```bash
$ git push origin master:cat
```

### è¿œç¨‹ä»“åº“çš„ç§»é™¤ä¸é‡å‘½å

è¿è¡Œ `git remote rename` å»ä¿®æ”¹ä¸€ä¸ªè¿œç¨‹ä»“åº“çš„ç®€å†™å

```bash
$ git remote rename pb paul
$ git remote
origin
paul
```

ä½¿ç”¨ `git remote rm` ç§»é™¤ä¸€ä¸ªè¿œç¨‹ä»“åº“

```bash
$ git remote rm paul
$ git remote
origin
```

## ä¿®æ”¹å†å²è®°å½•

### ä¿®æ”¹æäº¤ä¿¡æ¯

#### ä¿®æ”¹æœ€è¿‘ä¸€æ¬¡æäº¤

è¦ä¿®æ”¹æœ€å¾Œä¸€æ¬¡çš„ Commit è¨Šæ¯ï¼Œåªè¦ç›´æ¥åœ¨ Commit æŒ‡ä»¤å¾Œé¢åŠ ä¸Š `--amend` åƒæ•¸å³å¯ï¼š

```bash
$ git commit --amend -m "Welcome To Facebook"
[master 614a90c] Welcome To Facebook
Date: Wed Aug 16 05:42:56 2017 +0800
1 file changed, 0 insertions(+), 0 deletions(-)
create mode 100644 config/database.yml
```

#### ä¿®æ”¹æ›´æ—©çš„æäº¤

å¯ä»¥ä½¿ç”¨ `rebase` å‘½ä»¤çš„äº’åŠ¨æ¨¡å¼æ¥ä¿®æ”¹æ›´æ—©çš„æäº¤ä¿¡æ¯.

```bash
# æŸ¥çœ‹æäº¤è®°å½•
$ git log --oneline
27f6ed6 (HEAD -> master) add dog 2
2bab3e7 add dog 1
ca40fc9 add 2 cats
1de2076 add cat 2
cd82f29 add cat 1
382a2a5 add database settings
bb0c9c2 init commit

# å˜åŸº
$ git rebase -i bb0c9c2
```

```bash
pick 382a2a5 add database settings
pick cd82f29 add cat 1
pick 1de2076 add cat 2
pick ca40fc9 add 2 cats
pick 2bab3e7 add dog 1
pick 27f6ed6 add dog 2

# Rebase bb0c9c2..27f6ed6 onto bb0c9c2 (6 commands)
#
# Commands:
# p, pick = use commit
# r, reword = use commit, but edit the commit message
# e, edit = use commit, but stop for amending
# s, squash = use commit, but meld into previous commit
# f, fixup = like "squash", but discard this commit's log message
# x, exec = run command (the rest of the line) using shell
# d, drop = remove commit
#
# These lines can be re-ordered; they are executed from top to bottom.
#
# If you remove a line here THAT COMMIT WILL BE LOST.
#
# However, if you remove everything, the rebase will be aborted.
#
# Note that empty commits are commented out
```

å°†æƒ³è¦æ”¹ä¿¡æ¯çš„æäº¤å‰é¢çš„ `pick` æ”¹æˆ `reword`ï¼Œæˆ–æ˜¯ `r`, å°±è¡¨ç¤ºå¾…æœƒæˆ‘è¦ä¾†ä¿®æ”¹é€™å…©æ¬¡æäº¤çš„ä¿¡æ¯.

å› ä¸ºæäº¤æ”¹å˜äº†, æäº¤çš„ SHA-1 ä¹Ÿå°±æ”¹å˜äº†. ä¹‹å¾Œçš„ Commit å› ç‚ºå‰é¢çš„æ­·å²æ”¹äº†ï¼Œæ‰€ä»¥å¾Œé¢æ•´ä¸²çš„ Commit å…¨éƒ¨éƒ½é‡æ–°åšå‡ºæ–°çš„ Commit å‡ºä¾†æ›¿ä»£èˆŠçš„ Commitã€‚

### åˆå¹¶å¤šä¸ªæäº¤

`rebase` çš„äº’åŠ¨æ¨¡å¼åŒæ ·ä¹Ÿå¯ä»¥åˆå¹¶å¤šä¸ªæäº¤, ä»¥æ¥è®©æäº¤å†å²æ›´ç®€æ´.

æŠŠæƒ³è¦åˆå¹¶çš„æäº¤å‰çš„æŒ‡ä»¤æ”¹æˆ `squash` æˆ– `s`. ä¹Ÿå¯ä»¥ç”¨ `fixup` å®ƒä¸ `squash` ç›¸åŒï¼Œä½†ä¸ä¼šä¿å­˜å½“å‰ commit çš„æäº¤ä¿¡æ¯

```bash
pick 382a2a5 add database settings
pick cd82f29 add cat 1
squash 1de2076 add cat 2
squash ca40fc9 add 2 cats
pick 2bab3e7 add dog 1
squash 27f6ed6 add dog 2
```

- æœ€å¾Œä¸€è¡Œçš„ `27f6ed6` æœƒè·Ÿå‰ä¸€å€‹ Commit `2bab3e7` é€²è¡Œåˆä½µ
- å€’æ•¸ç¬¬ä¸‰è™Ÿçš„ `ca40fc9` æœƒè·Ÿå‰ä¸€å€‹ Commit `1de2076` åˆä½µï¼Œä½†å› ç‚º `1de2076` åˆæœƒå†å¾€å‰ä¸€å€‹ Commit `cd82f29` åˆä½µ

å­˜æª”ä¸¦é›¢é–‹ Vim ç·¨è¼¯å™¨å¾Œï¼Œå®ƒæœƒé–‹å§‹é€²è¡Œ Rebaseï¼Œè€Œåœ¨ Squash çš„éç¨‹ä¸­ï¼Œå®ƒé‚„æœƒè·³å‡º Vim ç·¨è¼¯å™¨è®“ä½ ç·¨è¼¯ä¸€ä¸‹è¨Šæ¯

![squash1](https://i.loli.net/2019/02/20/5c6cdf896c1d5.png)

æŠŠè¨Šæ¯æ”¹æˆã€Œadd all catsã€ï¼š

![squash2](https://i.loli.net/2019/02/20/5c6cdf94aac1e.png)

### å°†ä¸€ä¸ªæäº¤æ‹†æˆå¤šä¸ª

å¦‚æœä½ åœ¨ä¸€ä¸ªæäº¤é‡Œåšäº†å¤šå‡ºæ”¹åŠ¨, ä½ ä¹‹åæƒ³æŠŠå®ƒæ‹†æˆå¤šä¸ªæäº¤, åŒæ¨£ä¹Ÿå¯ä½¿ç”¨äº’å‹•æ¨¡å¼çš„ Rebase ä¾†æ“ä½œ.

```bash
$ git log --oneline
27f6ed6 (HEAD -> master) add dog 2
2bab3e7 add dog 1
ca40fc9 add 2 cats
1de2076 add cat 2
cd82f29 add cat 1
382a2a5 add database settings
bb0c9c2 init commit
```

å‡å¦‚ `ca40fc9` é€™å€‹ Commit ä¸€å£æ°£å¢åŠ äº†å…©å€‹æª”æ¡ˆï¼Œæˆ‘æƒ³æŠŠå®ƒæ‹†æˆå…©å€‹æäº¤. æˆ‘ä»¬éœ€è¦è¿›å…¥äº’åŠ¨æ¨¡å¼, æŠŠè¦æ‹†çš„é‚£å€‹ Commit çš„ `pick` æ”¹æˆ `edit`:

```bash
pick 382a2a5 add database settings
pick cd82f29 add cat 1
pick 1de2076 add cat 2
edit ca40fc9 add 2 cats
pick 2bab3e7 add dog 1
pick 27f6ed6 add dog 2
```

Rebase åœ¨åŸ·è¡Œåˆ° `ca40fc9` é€™å€‹ Commit çš„æ™‚å€™å°±æœƒåœä¸‹ä¾†ï¼š

![split1](https://i.loli.net/2019/02/20/5c6ce0ef3d2bb.png)

`HEAD` æŒ‡å‘ `ca40fc9`, æˆ‘ä»¬é€šè¿‡ `reset` æŒ‡ä»¤åˆ°è¿™ä¸ªæäº¤çš„ä¸Šä¸€ä¸ªæäº¤.

```bash
$ git reset HEAD^
```

è¿™ä¸¤ä¸ªæäº¤ä¹‹é—´çš„æ”¹åŠ¨éƒ½å¤„äº ã€ æœªæš‚å­˜ ã€çŠ¶æ€. æ ¹æ®ä½ è‡ªå·±çš„éœ€è¦é€šè¿‡ `add` å’Œ `commit` æ¥è¿›è¡Œæäº¤.

ç­‰ä½ å¼„å®Œäº†, åˆ¥å¿˜äº†ç¾åœ¨é‚„æ˜¯è™•æ–¼ Rebase ç‹€æ…‹ï¼Œé€šè¿‡ `--continue` å‚æ•°æ¥è®© Rebase æ‰§è¡Œå®Œ.

```bash
$ git rebase --continue
Successfully rebased and updated refs/heads/master.
```

## å…¶ä»–

### æ–­å¤´ Detached HEAD æ˜¯ä»€ä¹ˆ?

æ­£å¸¸æƒ…å†µä¸‹ï¼Œ`HEAD` æœƒæŒ‡å‘æŸä¸€å€‹åˆ†æ”¯ï¼Œè€Œåˆ†æ”¯æœƒæŒ‡å‘æŸä¸€å€‹æäº¤ã€‚å½“ `HEAD` æ²¡æœ‰æŒ‡å‘ä¸€ä¸ªåˆ†æ”¯çš„æ—¶å€™, è¿™ä¸ªçŠ¶æ€å°±è¢«ç§°ä¸ºã€Œ **Detached HEAD æ–­å¤´** ã€

å¯èƒ½ç™¼ç”Ÿé€™å€‹ç‹€æ…‹çš„åŸå› æœ‰ï¼š

- ä½¿ç”¨ `checkout` æŒ‡ä»¤ç›´æ¥è·³åˆ°æŸå€‹æäº¤ï¼Œè€Œé‚£å€‹æäº¤å‰›å¥½ç›®å‰æ²’æœ‰åˆ†æ”¯æŒ‡è‘—å®ƒã€‚
- `rebase` çš„éç¨‹å…¶å¯¦ä¹Ÿæ˜¯è™•æ–¼ä¸æ–·çš„ `detached HEAD` ç‹€æ…‹ã€‚
- åˆ‡æ›åˆ°æŸå€‹é ç«¯åˆ†æ”¯çš„æ™‚å€™ã€‚

è®©æˆ‘ä»¬æ¥è¯´ä¸ªæ›´å…·ä½“çš„ä¾‹å­:

![2020-09-20-14-02-31](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-14-02-31.png)
å‡å¦‚æˆ‘ä½¿ç”¨ `checkout` æŒ‡ä»¤åˆ‡æ›è‡³ `add cat 1` é‚£å€‹ `commmit`. åŒæ—¶ `HEAD` ä¹Ÿå°±æŒ‡å‘äº†é‚£ä¸ªæäº¤. å› ä¸ºæ²¡æœ‰åˆ†æ”¯æŒ‡å‘è¿™ä¸ªæäº¤, æ‰€æœ‰å¤„äº `detached HEAD` çŠ¶æ€.

![2020-09-20-14-02-45](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-14-02-45.png)
è¿™ä¸ªæ—¶å€™å¦‚æœå†è¿›è¡Œä¸€æ¬¡æäº¤.

```bash
$ touch no-head.html

$ git add no-head.html

$ git commit -m "add a no-head file"
[detached HEAD b6d204e] add no-head file
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 no-head.html
```

![2020-09-20-14-02-59](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-09-20-14-02-59.png)

å› ä¸ºå¹¶æ²¡æœ‰ä¸€ä¸ªåˆ†æ”¯æŒ‡å‘è¿™ä¸ªæ–°çš„æäº¤, åªæ˜¯ `HEAD` åœ¨æŒ‡å‘å®ƒ. å¦‚æœä¹‹åæˆ‘è®© `HEAD` å†æŒ‡å‘å…¶ä»–åˆ†æ”¯. è¿™ä¸ªæäº¤å°±ä¸å®¹æ˜“è¢«æ‰¾åˆ°äº†, é™¤éæˆ‘è®°ä½å®ƒçš„ SHA-1 æ ¡éªŒå’Œã€‚

å¦‚æœé‚„æƒ³ç•™ä¸‹é€™å€‹æäº¤ï¼Œå°±çµ¦å®ƒä¸€å€‹åˆ†æ”¯æŒ‡è‘—å®ƒå°±è¡Œäº†.

```bash
$ git branch new_branch b6d204e
$ git checkout new_branch
```

æˆ–è€…

```bash
$ git checkout -b new_branch b6d204e
Switched to a new branch 'new_branch'
```

### Git Flow

Git ä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼ç‰ˆæœ¬ç³»ç»Ÿï¼Œä¸å¯é¿å…æ¶‰åŠåˆ°å¤šäººåä½œã€‚

åä½œå¿…é¡»æœ‰ä¸€ä¸ªè§„èŒƒçš„å·¥ä½œæµç¨‹ï¼Œè®©å¤§å®¶æœ‰æ•ˆåœ°åˆä½œï¼Œä½¿å¾—é¡¹ç›®äº•äº•æœ‰æ¡åœ°å‘å±•ä¸‹å»ã€‚

ä¸‹é¢ä»‹ç»çš„å·¥ä½œæµç¨‹æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼šéƒ½é‡‡ç”¨"**åŠŸèƒ½é©±åŠ¨å¼å¼€å‘**"ï¼ˆFeature-driven developmentï¼Œç®€ç§° FDDï¼‰ã€‚

å®ƒæŒ‡çš„æ˜¯ï¼Œéœ€æ±‚æ˜¯å¼€å‘çš„èµ·ç‚¹ï¼Œå…ˆæœ‰éœ€æ±‚å†æœ‰åŠŸèƒ½åˆ†æ”¯ï¼ˆfeature branchï¼‰æˆ–è€…è¡¥ä¸åˆ†æ”¯ï¼ˆhotfix branchï¼‰ã€‚å®Œæˆå¼€å‘åï¼Œè¯¥åˆ†æ”¯å°±åˆå¹¶åˆ°ä¸»åˆ†æ”¯ï¼Œç„¶åè¢«åˆ é™¤ã€‚

å›¢é˜Ÿå¼€å‘ä¸­ï¼Œéµå¾ªä¸€ä¸ªåˆç†ã€æ¸…æ™°çš„ Git ä½¿ç”¨æµç¨‹ï¼Œæ˜¯éå¸¸é‡è¦çš„ã€‚

![bg2015080501](https://i.loli.net/2019/02/20/5c6d0dba2e04c.png)

- **ç¬¬ä¸€æ­¥ï¼šæ–°å»ºåˆ†æ”¯**

æ¯æ¬¡å¼€å‘æ–°åŠŸèƒ½ï¼Œéƒ½åº”è¯¥æ–°å»ºä¸€ä¸ªå•ç‹¬çš„åˆ†æ”¯

```bash
# è·å–ä¸»å¹²æœ€æ–°ä»£ç 
$ git checkout master
$ git pull

# æ–°å»ºä¸€ä¸ªå¼€å‘åˆ†æ”¯myfeature
$ git checkout -b myfeature
```

- **ç¬¬äºŒæ­¥ï¼šæäº¤åˆ†æ”¯ commit**
- **ç¬¬ä¸‰æ­¥ï¼šæ’°å†™æäº¤ä¿¡æ¯**

å¥½çš„æäº¤ä¿¡æ¯å¯ä»¥å¸®åŠ©ä½ æ›´å¥½çš„å†å°†æ¥æŸ¥é˜…ä½ ä¹‹å‰çš„ä»£ç æäº¤. æˆ‘åœ¨ä¸‹é¢ **çŸ¥è¯†/æŠ€å·§** ç« èŠ‚æœ‰æ¶‰åŠæäº¤ä¿¡æ¯çš„å†…å®¹.

- **ç¬¬å››æ­¥ï¼šä¸ä¸»å¹²åŒæ­¥**

```bash
$ git fetch origin
$ git rebase origin/master
```

- **ç¬¬äº”æ­¥ï¼šåˆå¹¶ commit**

åˆ†æ”¯å¼€å‘å®Œæˆåï¼Œå¾ˆå¯èƒ½æœ‰ä¸€å † commitï¼Œä½†æ˜¯åˆå¹¶åˆ°ä¸»å¹²çš„æ—¶å€™ï¼Œå¾€å¾€å¸Œæœ›åªæœ‰ä¸€ä¸ªï¼ˆæˆ–æœ€å¤šä¸¤ä¸‰ä¸ªï¼‰commitï¼Œè¿™æ ·ä¸ä»…æ¸…æ™°ï¼Œä¹Ÿå®¹æ˜“ç®¡ç†ã€‚

å‰é¢è®²è¿‡ç”¨ `rebase` åˆå¹¶

å¦å¤–ä¸€ç§åˆå¹¶æäº¤çš„ç®€ä¾¿æ–¹æ³•ï¼Œå°±æ˜¯å…ˆç”¨ `reset` æ’¤é”€è¿‡å»å¤šä¸ªæäº¤ï¼Œç„¶åå†å»ºä¸€ä¸ªæ–°çš„.

- **ç¬¬å…­æ­¥ï¼šæ¨é€åˆ°è¿œç¨‹ä»“åº“**

åˆå¹¶æäº¤åï¼Œå°±å¯ä»¥æ¨é€å½“å‰åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“äº†ã€‚

```bash
$ git push --force origin myfeature
```

`git push` å‘½ä»¤è¦åŠ ä¸Š `force` å‚æ•°ï¼Œå› ä¸º `rebase` ä»¥åï¼Œåˆ†æ”¯å†å²æ”¹å˜äº†ï¼Œè·Ÿè¿œç¨‹åˆ†æ”¯ä¸ä¸€å®šå…¼å®¹ï¼Œæœ‰å¯èƒ½è¦å¼ºè¡Œæ¨é€.

- **ç¬¬ä¸ƒæ­¥ï¼šå‘å‡º Pull Request**

æäº¤åˆ°è¿œç¨‹ä»“åº“ä»¥åï¼Œå°±å¯ä»¥å‘å‡º Pull Request åˆ° `master` åˆ†æ”¯ï¼Œç„¶åè¯·æ±‚åˆ«äººè¿›è¡Œä»£ç  Reviewï¼Œç¡®è®¤å¯ä»¥åˆå¹¶åˆ° `master`ã€‚

### Commit Messgae æ¨¡æ¿

æˆ‘ä½¿ç”¨çš„æ ¼å¼ä¸º:

```bash
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†(ä½¿ç”¨ç©ºè¡Œåˆ†å‰²):

- æ ‡é¢˜è¡Œ: å¿…å¡«, æè¿°ä¸»è¦ä¿®æ”¹ç±»å‹å’Œå†…å®¹
- ä¸»é¢˜å†…å®¹: æè¿°ä¸ºä»€ä¹ˆä¿®æ”¹, åšäº†ä»€ä¹ˆæ ·çš„ä¿®æ”¹, ä»¥åŠå¼€å‘çš„æ€è·¯ç­‰ç­‰
- é¡µè„šæ³¨é‡Š: æ”¾ Breaking Changes æˆ– Closed Issue

- `type`: æäº¤çš„ç±»å‹
  - `feat`: æ–°ç‰¹æ€§
  - `fix`: ä¿®æ”¹é—®é¢˜
  - `refactor`: ä»£ç é‡æ„
  - `docs`: æ–‡æ¡£ä¿®æ”¹
  - `style`: ä»£ç æ ¼å¼ä¿®æ”¹, (æ³¨æ„ä¸æ˜¯ CSS ä¿®æ”¹)
  - `test`: æµ‹è¯•ç”¨ä¾‹ä¿®æ”¹
  - `chore`: å…¶ä»–ä¿®æ”¹, æ¯”å¦‚æ„å»ºæµç¨‹, ä¾èµ–ç®¡ç†.
- `scope`: commit å½±å“çš„èŒƒå›´, æ¯”å¦‚: route, component, utils, buildâ€¦
- `subject`: commit çš„æ¦‚è¿°, å»ºè®®ç¬¦åˆ "50/72 formatting"
- `body`: commit å…·ä½“ä¿®æ”¹å†…å®¹, å¯ä»¥åˆ†ä¸ºå¤šè¡Œ, å»ºè®®ç¬¦åˆ "50/72 formatting"
- `footer`: ä¸€äº›å¤‡æ³¨, é€šå¸¸æ˜¯ BREAKING CHANGE æˆ–ä¿®å¤çš„ bug çš„é“¾æ¥.

é€šè¿‡ä¿®æ”¹ `~/.gitconfig` å¯ä»¥æ·»åŠ æ¨¡æ¿, æ¯æ¬¡æäº¤çš„æ—¶å€™åœ¨ vim ä¸­å¸¦å‡º, æ—¶åˆ»æé†’è‡ªå·±:

## å‚è€ƒ

- [å›¾è§£å¸¸ç”¨çš„ Git æŒ‡ä»¤å«ä¹‰](https://mp.weixin.qq.com/s?__biz=MjM5MTA1MjAxMQ==&mid=2651236225&idx=1&sn=dfda35481d2cf2c3435c5e9802a1dc81&chksm=bd497e058a3ef713a8020acf25e2d159d36dfad35b04b94fcfb41158fec571e2d43c617d7f05&mpshare=1&scene=1&srcid=&sharer_sharetime=1586565597279&sharer_shareid=9fc6c269db99975622f194cd8f0eba8f%23rd)
