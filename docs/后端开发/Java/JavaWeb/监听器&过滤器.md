# 监听器 & 过滤器

## 监听器

#### 代理设计模式

- 什么是代理模式：当某一个对象发生某一个事件时，通知另一个对象，让另一个对象做某事
- 代理设计模式步骤：
  - 定义协议；
  - 遵守协议；
  - 成为代理；
  - 调用代理方法；
- 监听器的内部使用的就是代理模式；

#### 监听器

- 什么是监听器：

  - 能监听某个对象的状态变化的组件；
  - 在 Java Web，中用来监听 “域对象“ 的变化；
    - request 域;
    - session 域;
    - servletContext 域;

- 监听器相关的概念：

  - 事件源：被监听的对象；
  - 监听器：监听事件源的对象；
  - 注册监听器：监听器与事件源相绑定；
  - 响应行为：监听到事件源变化时，去做什么事情；

- 监听器划分：
  - 三个监听域对象的创建与销毁：
    - ServletContextListener
    - HttpSessionListener
    - ServletRequestListener
  - 三个监听域对象当中属性变化：
    - ServletContextAttributeListener
    - HttpSessionAttributeListener
    - ServletRequestAttributeListener

#### 监听器编写步骤

- 编写一个监听器类去实现监听器接口：
  - ![2020-2-7-23-17-4.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-7-23-17-4.png)
- web.xml 中进行配置：
  - ![2020-2-7-23-17-18.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-7-23-17-18.png)

## 过滤器

#### 过滤器介绍

- filter 是对客户端访问资源的过滤，符合条件放行，不符合条件不放行；
- 并且可以对目标资源，访问前后进行逻辑处理；
- 过滤器的访问流程：
  - 在发送一个请求时， web 容器会先到 filter 当中，创建三个参数，res，req，chain；
  - 请求在过滤器当中，被放行之后，才能够访问到对应的资源；
  - 中间的过滤器可能有多个，在一个过滤器当中，可以调用另外一个过滤器；

![2020-2-7-23-20-35.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-7-23-20-35.png)

#### 过滤器编写步骤

- 编写一个过滤器类去实现 Filter 接口；
  - ![2020-2-7-23-23-13.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-7-23-23-13.png)
- 在 web.xml 中进行配置：
  - 配置 filter-class，给声明过滤器；
  - 配置 filter-mapping，指明对哪些资源进行过滤；
  - ![2020-2-7-23-24-51.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-7-23-24-51.png)

#### 过滤器方法

- init 方法：
  - 当 filter 对象创建时调用；
    - 服务器启动时创建 filter 对象；
  - 参数：filterconfig
    - 当前 filter 对象的配置信息；
- dofitter 方法：
  - 当匹配到 mapping 时调用 dofilter；
  - 参数：res，req，FilterChain：
    - FilterChain：
      - 过滤器链对象；
      - 内部维护着各个 filter 的索引，并且知道所有 filter 的顺序；
      - 是根据 mapping 的顺序来执行的；
- destroy 方法：
  - 当 filter 对象销毁时调用；
  - 关闭服务器时销毁对象；
