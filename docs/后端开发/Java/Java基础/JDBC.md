# JDBC

## JDBC å…¥é—¨

### ä»€ä¹ˆæ˜¯ JDBC

**JDBC ä»‹ç»**ï¼š

- å…¨ç§° Java æ•°æ®åº“è¿æ¥ (Java Database Connectivity);
- ç”¨äºåœ¨ Java è¯­è¨€ç¼–ç¨‹ä¸­ä¸æ•°æ®åº“è¿æ¥çš„ APIï¼›
- ç”±ä¸€ç»„ç”¨ Java è¯­è¨€ç¼–å†™çš„â€œç±»â€å’Œâ€œæ¥å£â€ç»„æˆï¼›
- JDBC åŒ…å«äº†æ•°æ®åº“æ“ä½œçš„è§„èŒƒã€‚å®šä¹‰äº†ç›¸å…³çš„ç±»ï¼Œæ¥å£ï¼Œæ–¹æ³•ï¼Œ ä½†æ˜¯å¹¶æ²¡æœ‰æä¾›å…·ä½“å®ç°ï¼›
- å„å¤§æ•°æ®åº“å‚å•†ä¼šæä¾›å¯¹ JDBC çš„å®ç°ï¼›
- ç®€å•è¯´, JDBC æä¾›äº†æ“çºµæ•°æ®åº“çš„æ¥å£ï¼Œä½†æ˜¯æ²¡æœ‰å…·ä½“å®ç°ã€‚ é€šè¿‡å¼•å…¥ä¸åŒçš„é©±åŠ¨åŒ…ï¼ˆ`.jar` æ–‡ä»¶ï¼‰ï¼Œå°±å¯ä»¥è¿æ¥åˆ°ä¸åŒçš„æ•°æ®åº“ï¼›

**JDBC çš„ API é€šå¸¸ç”¨äº**ï¼š

- è¿æ¥åˆ°æ•°æ®åº“
- åˆ›å»º SQL æˆ– MySQL è¯­å¥
- åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œ SQL æˆ– MySQL æŸ¥è¯¢
- æŸ¥çœ‹å’Œä¿®æ”¹æ•°æ®åº“ä¸­çš„æ•°æ®è®°å½•

![2020-1-26-22-48-39.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-48-39.png)

### ä½¿ç”¨ JDBC å»ºç«‹æ•°æ®åº“è¿æ¥

**å»ºç«‹ JDBC è¿æ¥æ‰€æ¶‰åŠä»¥ä¸‹å››ä¸ªæ­¥éª¤**ï¼š

- å¯¼å…¥ JDBC åŒ…ï¼šä½¿ç”¨ `import` è¯­å¥åœ¨ Java ä»£ç å¼€å¤´ä½ç½®å¯¼å…¥æ‰€éœ€çš„ç±»ï¼›
- æ³¨å†Œ JDBC é©±åŠ¨ç¨‹åºï¼šä½¿ JVM å°†æ‰€éœ€çš„é©±åŠ¨ç¨‹åºå®ç°åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€Œå¯ä»¥æ»¡è¶³ JDBC è¯·æ±‚ã€‚ä½¿ç”¨ `Class.forName()` æ–¹æ³•ï¼Œå°†é©±åŠ¨ç¨‹åºçš„ç±»æ–‡ä»¶åŠ¨æ€åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†å…¶è‡ªåŠ¨æ³¨å†Œï¼›
- æ•°æ®åº“ URL é…ç½®ï¼šåˆ›å»ºä¸€ä¸ªæ­£ç¡®æ ¼å¼åŒ–çš„åœ°å€ï¼ŒæŒ‡å‘è¦è¿æ¥åˆ°çš„æ•°æ®åº“ï¼›MySQL URL æ ¼å¼ä¸ºï¼š`jdbc:mysql://hostname/`databaseNameï¼›
- åˆ›å»ºè¿æ¥å¯¹è±¡ï¼šè°ƒç”¨ DriverManager å¯¹è±¡çš„ `getConnection()` æ–¹æ³•æ¥å»ºç«‹å®é™…çš„æ•°æ®åº“è¿æ¥ã€‚

![2020-1-26-22-49-47.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-49-47.png)

### ä½¿ç”¨ JDBC æ“ä½œæ•°æ®åº“

#### åˆ›å»ºæ•°æ®è¡¨

- è¿æ¥ä¸Šæ•°æ®åº“ï¼›
- åˆ›å»ºä½ è¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼›
- æ‰§è¡Œ SQLï¼›
  - é€šè¿‡ `createStatement()` åˆ›å»ºè¦æ‰§è¡Œçš„é™æ€ SQL è¯­å¥çš„ Statement å¯¹è±¡ï¼›
  - é€šè¿‡ Statement å¯¹è±¡çš„ `executeUpdate(sql)` æ–¹æ³•æ¥æ‰§è¡Œè¯­å¥ï¼›
  - è¿”å›ç»“æœï¼š
    - DQL æ“ä½œè¿”å›æŸ¥è¯¢ç»“æœé›†ï¼›
    - DML è¿”å›å—å½±å“çš„è¡Œæ•°ï¼›
    - DDL è¿”å› 0ï¼›
  - é‡Šæ”¾æ•°æ®èµ„æºï¼›
    - é€šè¿‡ Statement å¯¹è±¡ `close()` é‡Šæ”¾èµ„æºï¼›
    - é€šè¿‡ Connction å¯¹è±¡ `close()` é‡Šæ”¾èµ„æºï¼›

![2020-1-26-22-52-29.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-52-29.png)

#### æ‰§è¡Œ DML æ“ä½œ

- æ‰§è¡Œ DML æ“ä½œçš„æ­¥éª¤å’Œä¸Šé¢åˆ›å»ºæ•°æ®è¡¨ç›¸åŒï¼›
- æˆ‘ä»¬æ‹¿â€œæ’å…¥ä¸€æ¡æ–°æ•°æ®â€ä¸¾ä¾‹ï¼š

![2020-1-26-22-52-58.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-52-58.png)
![2020-1-26-22-53-10.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-53-10.png)

#### æ‰§è¡Œ DQL æ“ä½œ

- é€šè¿‡ Statement å¯¹è±¡çš„ `executeQuery(sql)` æ–¹æ³•æ¥æ‰§è¡Œè¯­å¥ï¼›
- `executeQuery` æ–¹æ³•è¿”å›ä¸€ä¸ªæŸ¥è¯¢ç»“æœé›† ResultSetï¼›
- ç»“æœé›†å¸¸ç”¨æ–¹æ³•ï¼š
  - `next()`ï¼šå¦‚æœå½“å‰æŒ‡å‘çš„è¡Œæœ‰ä¸‹ä¸€è¡Œæ•°æ®ï¼Œåˆ™æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€è¡Œï¼›
  - `getXxx(String columnName)` ï¼šè·å–å½“å‰è¡Œä¸­çš„ï¼ŒæŒ‡å®šåˆ—çš„å€¼ã€‚
    - "Xxx" æŒ‡çš„æ˜¯ç›®æ ‡åˆ—çš„æ•°æ®ç±»å‹ï¼›
    - å¦‚æœç±»å‹æ˜¯ Varchar / Char / Textï¼Œåˆ™æ–¹æ³•åä¸º`getString`;
    - å¦‚æœç±»å‹æ˜¯ Int / Integerï¼Œåˆ™æ–¹æ³•åä¸º `getInt`;

![2020-1-26-22-55-0.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-55-0.png)

![2020-1-26-22-55-19.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-55-19.png)

### DAO æ€æƒ³

#### DAO ä»€ä¹ˆæ˜¯

- å½“ç”¨ä¸Šé¢çš„æ–¹æ³•å»é‡å¤åœ°è¿›è¡Œâ€œå¢åˆ æ”¹æŸ¥â€æ“ä½œï¼Œé‡å¤ä»£ç ä¼šå¾ˆå¤šï¼›æ‰€ä»¥æˆ‘ä»¬éœ€è¦å°†è¿™äº›æ“ä½œå°è£…èµ·æ¥ï¼›
- DAOï¼ˆData Access Objectï¼‰æ•°æ®å­˜å–å¯¹è±¡ï¼›
- DAO ä½äºâ€œä¸šåŠ¡é€»è¾‘å±‚â€å’Œâ€œæŒä¹…å±‚â€(æ•°æ®åº“) ä¹‹é—´ï¼Œä»è€Œå®ç°å¯¹æŒä¹…å±‚æ•°æ®è®¿é—®ï¼›

![2020-1-26-22-56-36.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-56-36.png)

#### ORM ä»‹ç»

- ORMï¼ˆObject Relational Mappingï¼‰å¯¹è±¡å…³ç³»æ˜ å°„ï¼›
- å°†å…³ç³»å‹æ•°æ®åº“çš„æ•°æ®æ˜ å°„ä¸ºå¯¹è±¡ï¼Œä»¥å¯¹è±¡çš„å½¢å¼å±•ç°ï¼›
- ORM çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘äººå‘˜ä»¥é¢å‘å¯¹è±¡çš„æ€æƒ³æ¥å®ç°å¯¹æ•°æ®åº“çš„æ“ä½œï¼›

![2020-1-26-22-57-31.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-57-31.png)

![2020-1-26-22-57-40.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-57-40.png)

#### Domain ä»‹ç»

- Domain å°±æ˜¯ä¸€ä¸ªç±»ï¼›
- ç¬¦åˆ JavaBean è§„èŒƒï¼ˆä¸€ä¸ªç±»ä¸­æœ‰å­—æ®µå’Œè¯¥å­—æ®µçš„ Getter å’Œ Setter æ–¹æ³•ï¼‰ï¼›
- ç”¨äºä½œä¸ºç”¨æˆ·å’Œæ•°æ®åº“äº¤äº’çš„ä¸­è½¬ç«™ï¼›
- ç¤ºä¾‹ï¼šä¸‹é¢å°±æ˜¯ä¸€ä¸ª Domain ç±»ï¼š
  - ![2020-1-26-22-58-17.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-22-58-17.png)
  - **ä¿å­˜æ•°æ®**ï¼š
    - é€šè¿‡åˆ›å»º `Stu` Domain å¯¹è±¡æ¥è¿›è¡Œæ•°æ®ä¸­è½¬ï¼›
    - å°† `Stu` ä¼ å…¥ DAO å¯¹è±¡çš„ `save` æ–¹æ³•æ¥ä¿å­˜åˆ°æ•°æ®åº“ï¼›
    - å¦‚æœä¸ç”¨ Domain çš„è¯ï¼Œæˆ‘ä»¬è¦å‘ `save` æ–¹æ³•ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œç°åœ¨ä¸€ä¸ªå‚æ•°å°±å¤Ÿäº†ï¼›
    - ![2020-1-26-23-0-40.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-0-40.png)
  - **è¯»å–æ•°æ®**ï¼š
    - ![2020-1-26-23-1-20.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-1-20.png)

## DAO ç¼–å†™

### DAO è®¾è®¡è§„èŒƒ

#### ç¼–å†™ DAO ç»„ä»¶

- å®šä¹‰ DAO æ¥å£ï¼›
  - å¼€å‘ä¸­ä½¿ç”¨â€œé¢å‘æ¥å£â€ç¼–ç¨‹ï¼›
  - æ¥å£åªç»™å‡ºå‡½æ•°å£°æ˜ï¼Œä½†æ˜¯æ²¡æœ‰ç»™å‡ºå‡½æ•°çš„å…·ä½“å®ç°ï¼›
- ç¼–å†™ DAO å®ç°ç±»ï¼›
  - æ ¹æ®éœ€æ±‚æ¥ç¼–å†™å…·ä½“çš„å®ç°ç±»ï¼›

#### é¢å‘æ¥å£çš„å¥½å¤„

- ä¸šåŠ¡é€»è¾‘æ¸…æ™°ï¼›
- å¢å¼ºä»£ç çš„æ‰©å±•æ€§ï¼Œå¯ç»´æŠ¤æ€§ï¼›
- æ¥å£å’Œå®ç°ç›¸åˆ†ç¦»ï¼Œé€‚åˆå›¢é˜Ÿå¼€å‘ï¼›
- é™ä½è€¦åˆåº¦ï¼Œä¾¿äºæ—¥åè¿­ä»£ï¼›

#### Package åŒ…åè§„èŒƒ

- æ•´ä½“è§„èŒƒï¼š
  - åŸŸå.æ¨¡å—åç§°.ç»„ä»¶åç§°
- DAO åŒ…è§„èŒƒï¼š
  - `com.xxx.jdbc.domain` å­˜å‚¨æ‰€æœ‰çš„ Domain
  - `com.xxx.jdbc.dao` å­˜å‚¨æ‰€æœ‰çš„ DAO æ¥å£
  - `com.xxx.jdbc.dao.impl` å­˜å‚¨æ‰€æœ‰çš„ DAO æ¥å£å®ç°ç±»
  - `com.xxx.jdbc.dao.test` å­˜å‚¨ DAO ç»„ä»¶çš„æµ‹è¯•ç±»

#### Class ç±»åè§„èŒƒ

- domain ç±»ï¼š
  - å­˜å‚¨åœ¨ domain åŒ…ä¸­ã€‚ç”¨äºæè¿°ä¸€ä¸ªå¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ª JavaBeanï¼Œç”¨äºè¡¨ç¤ºæŸä¸€ä¸ªå¯¹è±¡çš„ CRUB å£°æ˜ï¼›
  - å‘½åè§„èŒƒï¼šæ¥å£ + DomainDao
- dao å®ç°ç±»ï¼š
  - å‚¨å­˜åœ¨ dao.impl åŒ…ä¸­ï¼Œç”¨äºè¡¨ç¤º DAO æ¥å£çš„å®ç°ç±»ã€‚
  - å‘½åè§„èŒƒï¼šDomainDao + å®ç°ç±»

### DAO å¼€å‘æ­¥éª¤

- åˆ›å»ºè¡¨
- å»ºç«‹ domain åŒ… & domain ç±»
- å»ºç«‹ dao åŒ… & dao æ¥å£
- å»ºç«‹ dao.impl åŒ… & dao å®ç°ç±»
- æ ¹æ® dao æ¥å£åˆ›å»º dao æµ‹è¯•ç±»
- ç¼–å†™å®ç°ç±»å½“ä¸­ dao çš„å£°æ˜çš„æ–¹æ³•ä½“
- æ¯ç¼–å†™ä¸€ä¸ª dao æ–¹æ³•ï¼Œè¿›è¡ŒåŠŸèƒ½æµ‹è¯•

### DAO ç¼–å†™ - 1ï¼š ç»“æ„æ­å»º

å…ˆåˆ›å»ºå¥½ domain åŒ…ï¼Œdomain ç±»ï¼›dao åŒ…ï¼Œdao æ¥å£ï¼›dao.impl åŒ…ï¼Œdao å®ç°ç±»ï¼›æµ‹è¯•åŒ…ï¼Œæµ‹è¯•ç±»ï¼›

![2020-1-26-23-6-16.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-6-16.png)

#### domain ç±»ï¼š

![2020-1-26-23-7-8.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-7-8.png)

#### dao æ¥å£ï¼š

![2020-1-26-23-7-19.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-7-19.png)

#### dao å®ç°ç±»ï¼š

![2020-1-26-23-9-45.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-9-45.png)

#### æµ‹è¯•ç±»ï¼š

![2020-1-26-23-7-37.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-7-37.png)

### DAO ç¼–å†™ - 2ï¼šç¼–å†™ DAO å®ç°ç±»

#### save æ–¹æ³•ç¼–å†™

![2020-1-26-23-10-35.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-10-35.png)

ç¼–å†™ save æ–¹æ³•å•å…ƒæµ‹è¯•ï¼š

- åœ¨ StudentDaoTest ç±»ä¸­ç¼–å†™å®ƒçš„å•å…ƒæµ‹è¯•æ–¹æ³•ï¼›
- ä½¿ç”¨ **@Test** ä¿®é¥°ç¬¦åˆ›å»ºå•å…ƒæµ‹è¯•ï¼›
- ä¹‹åé€‰ä¸­æ–¹æ³•ï¼Œå³é”® -> Run As -> JUnit Testï¼›
  ![2020-1-26-23-11-26.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-11-26.png)

- æµ‹è¯•æˆåŠŸåæ˜¾å¼å¦‚ä¸‹ï¼š
  ![2020-1-26-23-11-41.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-11-41.png)

#### delete æ–¹æ³•ç¼–å†™

åªè¦æŠŠ SQL è¯­å¥æ”¹å˜å°±å¥½äº†

![2020-1-26-23-13-27.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-13-27.png)

#### update æ–¹æ³•ç¼–å†™

![2020-1-26-23-13-35.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-13-35.png)

#### get æ–¹æ³•ç¼–å†™

- æŠŠ `executeUpdate` æ”¹æˆ `executeQuery`ï¼›
- å¹¶å°†è¿”å›ç»“æœèµ‹ç»™ä¸€ä¸ª ResultSet å¯¹è±¡ï¼›

![2020-1-26-23-13-52.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-13-52.png)

#### getAll æ–¹æ³•ç¼–å†™

åˆ›å»ºä¸€ä¸ªæ•°ç»„æ¥å­˜æ”¾æŸ¥è¯¢åˆ°çš„å¤šä¸ªç»“æœï¼›

![2020-1-26-23-14-43.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-14-43.png)

### DAO ç¼–å†™ - 3ï¼šä»£ç é‡æ„

#### æŠ½å‡ºé…ç½®å˜é‡

- å°†æ•°æ®åº“ URLï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼Œé©±åŠ¨åœ°å€æŠ½å‡ºï¼›
- å£°æ˜ä¸ºâ€œç§æœ‰æˆå‘˜å˜é‡â€ï¼›
  ![2020-1-26-23-15-22.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-15-22.png)

- åœ¨æ–¹æ³•ä¸­é€šè¿‡ `this` å»è·å–æˆå‘˜å˜é‡ï¼š
  ![2020-1-26-23-15-49.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-15-49.png)

#### å°†é…ç½®å˜é‡æŠ½å‡ºåˆ°å·¥å…·ç±»

- ç”±äºä¸Šé¢çš„è¿™äº›é…ç½®å˜é‡å¯èƒ½åœ¨åˆ«çš„ DAO å®ç°ç±»ä¸­ä¹Ÿä¼šè¢«ä½¿ç”¨ï¼›
- æ‰€ä»¥å¯ä»¥å†æŠ½å‡ºæ¥æ”¾åˆ°ä¸€ä¸ªâ€œå·¥å…·ç±»â€ä¸­ï¼š
  - å†åˆ›å»ºä¸€ä¸ª util åŒ…ï¼Œå¹¶åˆ›å»º JDBCUtil ç±»ï¼š
    ![2020-1-26-23-16-35.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-16-35.png)
  - æŠŠé…ç½®å˜é‡è®¾ç½®ä¸º `public static`ï¼›
  - è¿™æ ·å¯ä»¥ç›´æ¥é€šè¿‡â€œå·¥å…·ç±»åâ€æ¥è®¿é—®å˜é‡ï¼›
    ![2020-1-26-23-17-20.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-17-20.png)
- åœ¨ DAO å®ç°ç±»ä¸­ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ JDBCUtil ç±»æ¥è·å–é…ç½®å˜é‡äº†ï¼š
  ![2020-1-26-23-18-3.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-18-3.png)

#### æŠŠ Connection å¯¹è±¡åˆ›å»ºæŠ½å‡ºåˆ°â€œJDBCUtil å·¥å…·ç±»â€

- æŠŠåˆ›å»º Connection å¯¹è±¡çš„è¿‡ç¨‹ï¼Œå°è£…åˆ° JDBCUtil é‡Œï¼š
  ![2020-1-26-23-19-20.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-19-20.png)

- åœ¨å®ç°ç±»ä¸­çš„æ–¹æ³•é‡Œï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ JDBCUtil æ¥è·å–è¿æ¥ï¼š
  ![2020-1-26-23-19-58.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-19-58.png)

- ç”±äºé©±åŠ¨åŠ è½½åªéœ€è¦åŠ è½½ä¸€æ¬¡ï¼›
- å¯ä»¥æŠŠé©±åŠ¨åŠ è½½æ”¾åˆ°é™æ€ä»£ç å—ä¸­ï¼›
  ![2020-1-26-23-46-49.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-46-49.png)

#### æŠŠé‡Šæ”¾èµ„æºæ“ä½œæŠ½å‡ºåˆ° JDBCUtil

![2020-1-26-23-19-3.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-26-23-19-3.png)

## é¢„ç¼–è¯‘

#### Statement æ¥å£

- Statement æ¥å£ç”¨äº Java ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼›
- Statement æ¥å£æœ‰ä¸‰ä¸ªå®ç°ç±»ï¼š
  - Statementï¼šç”¨äºå¯¹æ•°æ®åº“è¿›è¡Œé€šç”¨è®¿é—®ï¼Œä½¿ç”¨çš„æ˜¯é™æ€ SQLï¼›
  - PreparedStatementï¼šç”¨äºé¢„ç¼–è¯‘æ¨¡æ¿ SQL è¯­å¥ï¼Œåœ¨è¿è¡Œæ—¶æ¥å— SQL è¾“å…¥å‚æ•°ï¼›
  - CallableStatementï¼šå…ˆä¸è®²ï¼›

#### é¢„ç¼–è¯‘è¯­å¥

- PreparedStatement å¯¹è±¡ç”¨äºé¢„ç¼–è¯‘æ¨¡æ¿ SQL è¯­å¥ï¼›
- ä½¿ç”¨ ï¼Ÿä½œä¸ºå‚æ•°æ ‡è®°ï¼›
- ä½¿ç”¨ Connection å¯¹è±¡çš„ `prepareStatement(sql)` æ–¹æ³•å°†æ¨¡æ¿è¯­å¥è¿›è¡Œé¢„ç¼–è¯‘ï¼›
- ä½¿ç”¨ `setInt(index, value)` æˆ– `setString(index, value)` æ–¹æ³•å°†å€¼ç»‘å®šåˆ°å‚æ•°ä¸­ï¼›
  - æ¯ä¸ªå‚æ•°æ ‡è®°çš„ä¸‹æ ‡æ˜¯å…¶é¡ºåºä½ç½®ï¼›
  - index ä» 1 å¼€å§‹ç®—èµ·ï¼›
- åŒæ ·ä¹Ÿæ˜¯ç”¨ `executeQuery()` æˆ– `executeUpdate()` æ–¹æ³•æ¥æ‰§è¡Œè¯­å¥ï¼›
  ![2020-1-27-0-15-34.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-15-34.png)

#### é˜²æ­¢ SQL æ³¨å…¥

- é€šè¿‡æŠŠ SQL å‘½ä»¤æ’å…¥åˆ° Web è¡¨å•ä¸­æäº¤ï¼Œæˆ– URL æŸ¥è¯¢å­—æ®µç­‰æ–¹æ³•ï¼Œæ¥è¾¾åˆ°æ¬ºéª—æœåŠ¡å™¨æ‰§è¡Œ SQL å‘½ä»¤çš„ç›®çš„ï¼Œå°±å«åšâ€œSQL æ³¨å…¥â€
  - ğŸŒ° ä¾‹å¦‚ï¼š
    ![2020-1-27-22-43-46.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-22-43-46.png)
  - ä¸Šé¢ç¨‹åºæ‰§è¡Œå®Œï¼Œsql å˜é‡ç­‰äº `select * from user where name = '' OR 1=1 OR '' and pwd='12'`
- PrepareStatement èƒ½å¤Ÿé˜²æ­¢æ³¨å…¥ï¼›
- å®ƒä¼šåœ¨ç‰¹æ®Šç¬¦å·å‰åŠ  `\` è¿›è¡Œè½¬ä¹‰ï¼›

## æ‰¹å¤„ç†

- æ‰¹å¤„ç†æ˜¯ä»€ä¹ˆï¼Ÿ
  - ä¸€æ¬¡æ€§æ‰§è¡Œå¤šæ¡ SQL è¯­å¥ï¼Œå…è®¸å¤šæ¡è¯­å¥ä¸€æ¬¡æ€§æäº¤ç»™æ•°æ®åº“æ‰¹é‡å¤„ç†ï¼›
- æ‰¹å¤„ç†æ–¹æ³•ï¼š
  - `addBatch(String)`ï¼šæ·»åŠ éœ€è¦æ‰¹å¤„ç†çš„ SQL è¯­å¥ï¼›
  - `executeBatch()`ï¼šæ‰§è¡Œæ‰¹å¤„ç†ï¼›
- æ”¯æŒæƒ…å†µï¼š
  - é»˜è®¤ MySQL æ˜¯ä¸æ”¯æŒæ‰¹å¤„ç†çš„ï¼›
  - éœ€è¦åœ¨æ•°æ®åº“ URL åæ·»åŠ ä¸€ä¸ª `rewriteBatchedStatements` å‚æ•°ï¼›
    ![2020-1-27-0-18-41.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-18-41.png)
- ç¤ºä¾‹ï¼šæ‰¹é‡æ·»åŠ  1000 æ¡æ•°æ®ï¼š
  ![2020-1-27-0-19-16.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-19-16.png)

## äº‹åŠ¡å¤„ç†

- é»˜è®¤çŠ¶æ€ä¸‹ï¼Œäº‹åŠ¡æ˜¯è‡ªåŠ¨æäº¤çš„ï¼›
- éœ€è¦è®¾ç½®ä¸ºæ‰‹åŠ¨æäº¤ï¼›
- å¤„ç†äº‹åŠ¡è¿‡ç¨‹ï¼š
  - å…³é—­è‡ªåŠ¨æäº¤ï¼š`conn.setAutoCommit(false)`;
  - æäº¤äº‹åŠ¡ï¼š`conn.commit()`;
  - å‡ºç°å¼‚å¸¸ï¼Œè¿›è¡Œå›æ»šï¼š`conn.rollback()`ï¼›
    - æŠŠæ‰€æœ‰çš„äº‹åŠ¡æ“ä½œç”¨ `try/catch` åŒ…è£¹èµ·æ¥ï¼›
    - åœ¨ `catch` ä¸­ç›‘å¬å¼‚å¸¸ï¼Œè°ƒç”¨ `rollback()` æ–¹æ³•ï¼›
    - åœ¨ `finally` ä¸­æ–­å¼€è¿æ¥ï¼Œé‡Šæ”¾èµ„æºï¼›

![2020-1-27-0-31-40.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-31-40.png)

## äºŒè¿›åˆ¶æ•°æ®

- å›¾ç‰‡ï¼ŒéŸ³é¢‘ï¼Œè§†é¢‘åœ¨ MySQL ä¸­ç”¨ BLOBï¼ˆäºŒè¿›åˆ¶æµï¼‰ç±»å‹å‚¨å­˜ï¼›
- ä½†æ˜¯çœŸå®å¼€å‘ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šå­˜å‚¨äºŒè¿›åˆ¶æ–‡ä»¶ï¼›
- é€šå¸¸æŠŠæ–‡ä»¶å­˜å‚¨çš„è·¯å¾„ä¿å­˜åœ¨æ•°æ®åº“ï¼Œé€šè¿‡è·¯å¾„å»è·å–æ–‡ä»¶ï¼›
- BLOB ç±»å‹ï¼š
  - TINYBLOBï¼š255 å­—èŠ‚
  - BLOBï¼š65535 å­—èŠ‚
  - MEDIUMBLOBï¼š16M
  - LONGBLOGï¼š4G

#### å­˜å‚¨å›¾ç‰‡åˆ°æ•°æ®åº“

- å…ˆåœ¨è¡¨ä¸­åˆ›å»ºå‡ºä¸€ä¸ªå­˜æ”¾å›¾ç‰‡çš„å­—æ®µï¼š
  ![2020-1-27-0-32-52.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-32-52.png)
- é€šè¿‡ FileInputStream ç±»æ¥è¯»å–ç£ç›˜å†…æ–‡ä»¶ï¼š
  ![2020-1-27-0-33-18.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-33-18.png)

#### è¯»å–å›¾ç‰‡ä»æ•°æ®åº“

- é€šè¿‡ `ResultSet` å¯¹è±¡çš„ `getBlob` æ–¹æ³•è·å–äºŒè¿›åˆ¶æ•°æ®ï¼Œè¿”å›å€¼ä¸º `Blob` å¯¹è±¡ï¼›
- é€šè¿‡ `Blob` å¯¹è±¡çš„ `getBinaryStream()` æ–¹æ³•æ¥è·å–å›¾ç‰‡çš„äºŒè¿›åˆ¶æµï¼Œè¿”å›å€¼ä¸º InputStream å¯¹è±¡ï¼›
- é€šè¿‡ `Files.copy` æŠŠäºŒè¿›åˆ¶æµï¼Œå¤åˆ¶åˆ°ç£ç›˜ä¸­ï¼›

![2020-1-27-0-34-9.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-34-9.png)

## è·å–è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®

- åœ¨è®¾è®¡è¡¨æ—¶ï¼Œæœ‰æ—¶ä¼šè®¾ç½®è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®ï¼›
- åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œæœ‰æ—¶æˆ‘ä»¬æƒ³è¦çŸ¥é“ç”Ÿæˆçš„ä¸»é”®æ˜¯ä»€ä¹ˆï¼›
- éœ€æ±‚åœºæ™¯ç¤ºä¾‹ï¼š
  - ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œç¬¬ä¸€æ­¥åªéœ€è¦å¡«å†™ç”¨æˆ·åï¼Œå¯†ç ï¼›
  - æ³¨å†ŒæˆåŠŸåï¼Œéœ€è¦è·³è½¬åˆ°ä¸ªäººä¿¡æ¯å®Œå–„é¡µé¢ï¼Œè¿™æ—¶éœ€è¦ç”¨åˆ°ä¸»é”®çš„å€¼ï¼›
- è·å–æ–¹æ³•ï¼š
  - åˆ›å»ºè¯­å¥æ—¶ï¼Œä¼ å…¥å‚æ•° `Statement.RETURN_GENERATED_KEYS` è¡¨ç¤ºå¯ä»¥è·å–ä¸»é”®ï¼›
  - é€šè¿‡è¯­å¥å¯¹è±¡çš„ `getGeneratedKeys()` æ–¹æ³•è·å¾—ä¸»é”®ï¼›

![2020-1-27-0-35-46.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-35-46.png)

## è¿æ¥æ± 

### è¿æ¥æ± ä»‹ç»

- **æ²¡æœ‰è¿æ¥æ± **ï¼š
  - æ¯ä¸€æ¬¡æ‰§è¡Œ CRUD æ“ä½œä½¿ç”¨æ•°æ®åº“çš„æ—¶å€™ï¼Œéƒ½è¦åˆ›å»ºä¸€ä¸ªæ•°æ®åº“è¿æ¥å¯¹è±¡ï¼›
  - æ¯ä¸€æ¬¡å‘æ•°æ®åº“å»ºç«‹è¿æ¥çš„æ—¶å€™ï¼Œéƒ½è¦è®² Connection åŠ è½½åˆ°å†…å­˜ä¸­ï¼›
  - å½“æ“ä½œæ‰§è¡Œå®Œï¼Œè¿˜è¦æ–­å¼€è¿æ¥ï¼Œè¿™ä¼šå¾ˆæ¶ˆè€—èµ„æºå’Œæ—¶é—´ï¼›
  - æ•°æ®åº“èµ„æºæ²¡æœ‰å¾ˆå¥½åœ°å¾—åˆ°é‡å¤åˆ©ç”¨ï¼›
  - å½“å‡ ç™¾å‡ åƒäººåŒæ—¶è®¿é—®æ•°æ®åº“æ—¶ï¼Œèµ„æºæ¶ˆè€—ä¼šè®©æœåŠ¡å™¨å´©æºƒï¼›
- **è¿æ¥æ± æ˜¯ä»€ä¹ˆ**ï¼š
  - æ± ï¼šä¿å­˜å¯¹è±¡çš„å®¹å™¨ï¼›
  - è¿æ¥æ± ï¼šä¿å­˜æ•°æ®åº“è¿æ¥å¯¹è±¡çš„å®¹å™¨ï¼›
  - ä½œç”¨ï¼š
    - åˆå§‹åŒ–æ—¶åˆ›å»ºä¸€å®šæ•°é‡çš„å¯¹è±¡ï¼Œéœ€è¦æ—¶ç›´æ¥ä»æ± ä¸­å–å‡ºä¸€ä¸ªç©ºé—²å¯¹è±¡ï¼›
    - ç”¨å®Œåå¹¶ä¸ç›´æ¥é‡Šæ”¾æ‰ï¼Œè€Œæ˜¯å†æ”¾åˆ°å¯¹è±¡æ± ä¸­ï¼Œä»¥æ–¹ä¾¿ä¸€ä¸‹æ¬¡å¯¹è±¡è¯·æ±‚å¯ä»¥ç›´æ¥å¤ç”¨ï¼›
    - æ± æŠ€æœ¯ä¼˜åŠ¿æ˜¯ï¼Œå¯ä»¥æ¶ˆé™¤å¯¹è±¡åˆ›å»ºæ‰€å¸¦æ¥çš„å»¶è¿Ÿï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼›
  - æ•°æ®åº“è¿æ¥æ± ï¼š
    - åŸºæœ¬æ€æƒ³å°±æ˜¯ä¸ºæ•°æ®åº“è¿æ¥å»ºç«‹ä¸€ä¸ªâ€œç¼“å†²æ± â€ï¼›
    - é¢„å…ˆåœ¨ç¼“å†²æ± ä¸­æ”¾ä¸€å®šæ•°é‡çš„è¿æ¥ï¼›
    - å½“éœ€è¦å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶ï¼Œåªéœ€ä»â€œç¼“å†²æ± â€ä¸­å–å‡ºä¸€ä¸ªï¼Œä½¿ç”¨å®Œæ¯•å†æ”¾å›å»ï¼›
    - å¯ä»¥é€šè¿‡è®¾ç½®è¿æ¥æ± æœ€å¤§è¿æ¥æ•°æ¥é˜²æ­¢ç³»ç»Ÿæ— å°½åœ°ä¸æ•°æ®åº“è¿æ¥ï¼›
    - å¯ä»¥é€šè¿‡è¿æ¥æ± çš„ç®¡ç†æœºåˆ¶ç›‘æ§æ•°æ®åº“è¿æ¥çš„æ•°é‡ï¼Œä½¿ç”¨æƒ…å†µï¼›

![2020-1-27-0-43-29.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-43-29.png)

- **è¿æ¥æ± ä¸­çš„å±æ€§**ï¼š
  - è¿æ¥æ•°æ®åº“çš„ 4 è¦ç´ ï¼šé©±åŠ¨åç§°ï¼Œæ•°æ®åº“åœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç ï¼›
  - åˆå§‹åŒ–è¿æ¥æ•°ï¼šåˆå§‹åŒ–æ—¶ï¼Œè¿æ¥æ± å½“ä¸­åˆ›å»ºå¤šå°‘ä¸ª Connection å¯¹è±¡ï¼›
  - æœ€å¤§è¿æ¥æ•°ï¼šè¿æ¥æ± å½“ä¸­æœ€å¤šå­˜å‚¨å¤šå°‘ä¸ª Connection å¯¹è±¡ï¼›
  - æœ€å°è¿æ¥æ•°ï¼šè¿æ¥æ± å½“ä¸­æœ€å°‘å­˜å‚¨å¤šå°‘ä¸ª Connection å¯¹è±¡ï¼›
  - æœ€å¤§ç©ºé—²ç©ºé—´ï¼šä¸€ä¸ªè¢«è·å–çš„è¿æ¥å¯¹è±¡ï¼Œåœ¨æŒ‡å®šæ—¶é—´å†…æ²¡æœ‰ä»»ä½•æ“ä½œï¼Œå°±ä¼šè¢«è‡ªåŠ¨é‡Šæ”¾ï¼›
  - æœ€å¤§ç­‰å¾…æ—¶é—´ï¼šåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œå°è¯•è·å–è¿æ¥ï¼Œå¦‚æœè¶…å‡ºæ—¶é—´ï¼Œåˆ™æç¤ºè·å–å¤±è´¥ï¼›

### ä½¿ç”¨æ•°æ®æ± 

- è¿æ¥æ± ä½¿ç”¨ `javax.sql.DataSource` æ¥å£æ¥è¡¨ç¤ºè¿æ¥æ± ï¼›
- DataSource å’Œ JDBC ä¸€æ ·ï¼ŒJava åªæä¾›ä¸€ä¸ªæ¥å£ï¼Œå…·ä½“å®ç°ç”±ç¬¬ä¸‰æ–¹æä¾›ï¼›
- å¸¸è§è¿æ¥æ± ï¼š
  - DBCPï¼šSpring æ¨èï¼Œ Tomcat çš„æ•°æ®æºä½¿ç”¨ï¼›
  - Druidï¼šé˜¿é‡Œå·´å·´å®ç°çš„è¿æ¥æ± ï¼Œå·ç§°æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„ï¼ˆå…¬å¸å°±ç”¨è¿™ä¸ªï¼‰ï¼›
- DataSource æ•°æ®æºå’Œè¿æ¥æ±  Connection Pool æ˜¯åŒä¸€ä¸ªä¸œè¥¿ï¼Œåªæ˜¯å«æ³•ä¸åŒï¼›
- å­¦ä¹ è¿æ¥æ± ä¸»è¦æ˜¯å­¦ä¹ å¦‚ä½•åˆ›å»º DataSource å¯¹è±¡ï¼Œå†ä»ä¸­è·å– Connection å¯¹è±¡ï¼›
- è·å¾— Connection å¯¹è±¡åï¼Œå…¶ä»–æ“ä½œéƒ½å’Œä»¥å‰ä¸€æ ·ï¼›
- ä¸åŒçš„ç¬¬ä¸‰æ–¹è¿æ¥æ± ï¼Œåªæ˜¯åœ¨åˆ›å»º DataSource è¿™æ­¥ä¸Šä¸åŒï¼›

#### ä½¿ç”¨ DBCP

- å¯¼å…¥ jar åŒ…ï¼š
  - commons-dbcp.jaï¼›
  - commons-pool.jarï¼›
  - åˆ«å¿˜äº† build pathï¼›
- åœ¨é¡¹ç›®ä¸­ä½¿ç”¨è¿æ¥æ± æ¥è·å–è¿æ¥ï¼š
  ![2020-1-27-0-45-36.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-45-36.png)
- é…ç½®æ–‡ä»¶
  - é…ç½®æ–‡ä»¶æ˜¯ä»¥ .properties ä¸ºæ‰©å±•åçš„æ–‡ä»¶ï¼›
  - åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬æŠŠè¿æ¥åœ°å€ï¼Œç”¨æˆ·åï¼Œå¯†ç éƒ½å†™åœ¨äº†ä»£ç ä¸­ï¼›
  - ä¸ä¾¿äºåæœŸçš„ç»´æŠ¤ï¼›
  - é…ç½®æ–‡ä»¶çš„ä¹¦å†™ï¼š
    - åˆ›å»ºæ–‡ä»¶åç¼€ propertiesï¼›
    - ä¸éœ€è¦åŠ å¼•å·å’Œç©ºæ ¼ï¼š
      ![2020-1-27-0-46-21.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-46-21.png)
- åœ¨ Java ä¸­ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼š
  - å°†é¡¹ç›®ç›®å½•ä¸­åˆ›å»º Resource Folderï¼›
  - æŠŠé…ç½®æ–‡ä»¶æ”¾è¿›å»ï¼›
  - ç„¶åå¦‚ä¸‹å›¾ä½¿ç”¨ï¼š
    ![2020-1-27-0-47-13.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-47-13.png)
- æ”¹å†™ DBCPï¼š
  - ç›´æ¥å‘ `BasicDataSourceFactory.createDataSource()` æ–¹æ³•ä¼ å…¥é…ç½®å¯¹è±¡ï¼Œè‡ªåŠ¨åˆ›å»ºä½ æ•°æ®æºï¼›
  - éœ€è¦æ³¨æ„ï¼Œé…ç½®æ–‡ä»¶çš„ Key å¦‚ä¸‹ï¼Œä¸èƒ½çå†™ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå±æ€§é…ç½®æ–‡æ¡£ï¼›
    ![2020-1-27-0-48-17.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-48-17.png)

#### ä½¿ç”¨ Druid

- DruidDataSource æ˜¯å…¼å®¹ DBCP çš„ï¼Œä» DBCP è¿ç§»åˆ° DruidDataSourceï¼Œåªéœ€ä¿®æ”¹æ•°æ®æºçš„å®ç°ç±»å°±å¯ä»¥ï¼›

![2020-1-27-0-48-59.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-48-59.png)

## ä»£ç é‡æ„

### å­˜åœ¨çš„é—®é¢˜

- åœ¨ DAO ä¸­æ‰§è¡Œçš„ä¿å­˜ï¼Œæ›´æ–°ï¼Œåˆ é™¤ï¼Œè¿™äº› DML æ“ä½œæœ‰å¤ªå¤šé‡å¤ä»£ç ï¼›
- é‡æ„ä»£ç åŸåˆ™ï¼š
  - åŒä¸€ä¸ªç±»ä¸­ï¼š
    - å‘ç°å¤šä¸ªæ–¹æ³•æœ‰ç›¸åŒçš„ä»£ç ï¼›
    - åˆ™æŠŠä»–ä»¬æŠ½è±¡æˆä¸€ä¸ªæ–¹æ³•ï¼›
    - ä¸åŒçš„åœ°æ–¹é€šè¿‡å‚æ•°ä¼ é€’è¿›å»ï¼›
  - ä¸åŒç±»ä¸­ï¼š
    - ä¸åŒç±»å½“ä¸­å…±åŒçš„ä»£ç æŠ½è±¡åˆ°ä¸€ä¸ªæ–°ç±»ä¸­ï¼›
    - ä¸åŒçš„ç±»å…±äº«æ–°ç±»çš„å†…å®¹ï¼›

### æŠ½å– DML æ–¹æ³•

- æ ¹æ®ç°æœ‰æƒ…å†µï¼Œå¯ä»¥å°†ä¿å­˜ï¼Œæ›´æ–°ï¼Œåˆ é™¤ç­‰ DML æ“ä½œæŠ½è±¡æˆä¸€ä¸ªæ–¹æ³•ï¼›
- ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼š
  - SQL è¯­å¥ / è¯­å¥æ¨¡æ¿ï¼›
  - å¯å˜å‚æ•°ï¼Œè®¾ç½®è¯­å¥çš„å‚æ•°å€¼ï¼›
- è¿”å›å€¼ï¼šint ç±»å‹ï¼Œå—å½±å“çš„è¡Œæ•°ï¼›
  ![2020-1-27-0-54-6.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-54-6.png)
- ä¿®æ”¹ saveï¼Œdeleteï¼Œupdate æ–¹æ³•ï¼š
  ![2020-1-27-0-54-31.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-54-31.png)

### æŠ½è±¡å‡º CRUB æ¨¡æ¿ç±»

- åœ¨ä¸Šä¸€æ­¥æˆ‘ä»¬æŠ½å‡ºäº†é€šç”¨çš„ DML æ‰§è¡Œæ–¹æ³•ï¼›
- å¯ä»¥æƒ³åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šåœ¨åˆ«çš„ DAO å®ç°ç±»ä¸­ä½¿ç”¨ï¼›
- é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†æŠŠè¿™ä¸ªæ–¹æ³•æŠ½è±¡åˆ°ä¸€ä¸ª CRUB æ¨¡æ¿ç±»ï¼›
- æ³¨æ„æ–¹æ³•ç±»å‹æ˜¯ `static`ï¼›

![2020-1-27-0-55-8.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-55-8.png)

### æŠ½å– DQL æ–¹æ³•

- åŒç†ï¼ŒDQL æŸ¥è¯¢æ–¹æ³•ä¹Ÿå¯ä»¥æŠ½å–åˆ° CRUB æ¨¡æ¿ç±»ä¸­ï¼š
  ![2020-1-27-0-56-16.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-56-16.png)
- ä¹‹åæ”¹å†™ `get`ï¼Œ`getAll` æ–¹æ³•ï¼š
  ![2020-1-27-0-56-6.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-56-6.png)
- å­˜åœ¨é—®é¢˜ï¼š
  - ä¸Šé¢ `executeQuery` æ–¹æ³•ä¸­ï¼Œ ç±»å‹å†™æ­»äº†ï¼›
  - åŸå› æ˜¯ä¸çŸ¥é“ä¼šå»å¤„ç†ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ï¼›

### ç»“æœé›†å¤„ç†å™¨

- è§£å†³æ–¹æ³•ï¼š
  - å®šä¹‰ä¸€ä¸ªå¤„ç†ç»“æœé›†æ¥å£ï¼›
    ![2020-1-27-0-57-27.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-57-27.png)
  - åœ¨å…·ä½“çš„ DAO ä¸­å®ç°æ¥å£ï¼›
    ![2020-1-27-0-57-46.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-57-46.png)
  - åˆ›å»º â€œæ¥å£å®ç°å¯¹è±¡â€å¹¶ä¼ ç»™æŸ¥è¯¢å¤„ç†æ–¹æ³•ï¼š
    ![2020-1-27-0-57-57.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-57-57.png)
  - åœ¨æŸ¥è¯¢æ–¹æ³•ä¸­è°ƒç”¨å¤„ç†ç»“æœé›†æ–¹æ³•ï¼š
    ![2020-1-27-0-58-12.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-58-12.png)

### ä½¿ç”¨æ³›å‹

- ä¸Šé¢ç»“æœé›†å¤„ç†å™¨ï¼Œè¿”å› List ç±»å‹å¯¹è±¡ï¼›
- ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›å¯ä»¥è‡ªå·±è®¾å®šè¦è¿”å›çš„ç±»å‹ï¼›
- æˆ‘ä»¬è¿˜å¯ä»¥ç”¨â€œæ³›å‹â€æ¥æ”¹å†™ä¸Šé¢ä»£ç ï¼›
- å£°æ˜æ¥å£æ—¶å®šä¹‰è¿”å›ç±»å‹ä¸º Tï¼š
  ![2020-1-27-0-59-32.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-59-32.png)
- åœ¨å®ç°ç±»ä¸­å»å†³å®šå…·ä½“è¿”å›ç±»å‹ï¼š
  ![2020-1-27-0-59-44.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-59-44.png)
- æŸ¥è¯¢æ–¹æ³•è¿”å›ç±»å‹ä¹Ÿå®šä¸º Tï¼Œå…·ä½“ç±»å‹æ ¹æ®å‚æ•°æ¥å†³å®šï¼š
  ![2020-1-27-0-59-56.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-0-59-56.png)
- åœ¨åˆ›å»ºç»“æœé›†å¤„ç†å™¨æ—¶æŒ‡å®šç±»å‹ï¼š
  ![2020-1-27-1-0-16.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-1-0-16.png)

## å†…çœ

### Class ç±»å‹ä»‹ç»

- Class ç±»æ˜¯ä¸€ä¸ªå…³äºç±»çš„ç±»å‹ï¼›
- é€šè¿‡ Class ç±»æˆ‘ä»¬å¯ä»¥è·å¾—å…³äºä¸€ä¸ªç±»çš„ç›¸å…³ä¿¡æ¯ï¼›
- é€šè¿‡ä¸€ä¸ªç±»çš„ `.class` å±æ€§å¯ä»¥è·å¾—å®ƒå¯¹åº”çš„ Class å¯¹è±¡ï¼›
- Class å¯¹è±¡æ‰§è¡Œ `newInstance()` æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡å­—èŠ‚ç åˆ›å»ºå¯¹åº”çš„å¯¹è±¡ï¼›

![2020-1-27-23-15-26.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-23-15-26.png)

### ä»€ä¹ˆæ˜¯å†…çœ

- å†…çœç”¨æ¥æŸ¥çœ‹å’Œæ“ä½œï¼Œç¬¦åˆ JavaBean è§„èŒƒï¼ˆå±æ€§æœ‰ getter å’Œ setterï¼‰çš„ç±»çš„å±æ€§ï¼›
- é€šè¿‡ Introspector ç±»æ¥è¿›è¡Œå†…çœæ“ä½œï¼›
- `Introspector.getBeanInfo(A.class, B.class)`
  - è·å–æŒ‡å®šç±»çš„ä¿¡æ¯ï¼›
  - ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šè¦è·å–ä¿¡æ¯çš„ç±»ï¼Œæ­¤æ–¹æ³•è¿˜ä¼šè·å–å…¶çˆ¶ç±»çš„ä¿¡æ¯ï¼›
  - ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šåˆ°å“ªä¸ªçˆ¶ç±»ä¸ºæ­¢ï¼Œä¸å†ç»§ç»­å¾€ä¸Šè·å–ï¼›
  - ğŸŒ° å‡å¦‚ï¼ŒA ç±»ï¼Œç»§æ‰¿ B ç±»ã€‚ä¸Šé¢ ğŸ‘† è¿™ç§è°ƒç”¨æ–¹æ³•ï¼Œå°±åªä¼šè·å– A ç±»è‡ªå·±å®šä¹‰çš„ä¿¡æ¯ï¼Œä¸ä¼šç®¡ B ç±»ï¼›
  - è¿”å›å€¼ä¸º BeanInfo å¯¹è±¡ï¼›
- BeanInfo ç±»å‹æ‰§è¡Œ `getPropertyDescriptors` æ–¹æ³•ï¼Œè¿”å›æŒ‡å®šç±»çš„æ‰€æœ‰å±æ€§ä¿¡æ¯ï¼Œè¿”å›ç±»å‹æ˜¯ `PropertyDescriptor` æ•°ç»„ï¼›
- è·å–å±æ€§åï¼š`pd.getName()`
- è·å– get æ–¹æ³•ï¼š`pd.getReadMethod()`
- è·å– set æ–¹æ³•ï¼š`pd.getWriteMethod()`
- åŠ¨æ€è°ƒç”¨æ–¹æ³•ï¼š`æ–¹æ³•å.invode(å¯¹è±¡åç§°, å€¼)`

![2020-1-27-23-23-20.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-27-23-23-20.png)

### ç”¨å†…çœé‡æ„ä»£ç 

![2020-2-1-20-1-34.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-1-20-1-34.png)

- ä¹‹å‰çš„ç»“æœé›†å¤„ç†å™¨ä»æ—§æ˜¯å¯ä»¥ç»§ç»­é‡æ„çš„ï¼›
- è¯¥ç±»ä¸“é—¨å°†ç»“æœé›†ä¸­çš„æ•°æ®å°è£…æˆä¸€ä¸ª Student å¯¹è±¡ï¼›
- å¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ª domainï¼Œå°±éœ€è¦å¤šä¸ªç»“æœé›†å¤„ç†å™¨ï¼›
- ä½†å…¶å®ï¼Œè¿™äº›ç»“æœé›†å¤„ç†å™¨åšçš„éƒ½æ˜¯åŒä¸€ä»¶äº‹ï¼š
  - æŠŠç»“æœé›†ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®å°è£…æˆå¯¹è±¡ï¼›
  - è®¾ç½®å¯¹è±¡çš„å±æ€§ï¼›
- é€šè¿‡**å†…çœ**å°±å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ªé€šç”¨çš„ç»“æœé›†å¤„ç†å™¨ï¼›

è§„å®šï¼š

- æ•°æ®è¡¨ä¸­çš„åˆ—åå¿…é¡»å’Œç±»çš„å±æ€§åä¸€è‡´ï¼›
- è§„å®šæ•°æ®è¡¨ä¸­çš„æ•°æ®ç±»å‹å¿…é¡»å’Œç±»çš„å±æ€§çš„æ•°æ®ç±»å‹åŒ¹é…ï¼›

ç¼–å†™ï¼š

![2020-2-1-20-14-50.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-1-20-14-50.png)

## å°è£…æˆ jar åŒ…

ä¸‹é¢çœ‹ä¸€ä¸‹å¦‚ä½•æŠŠåˆšåˆšå†™çš„é€šç”¨ç»“æœé›†å¤„ç†å™¨ï¼Œæ‰“åŒ…æˆä¸€ä¸ª jar åŒ…ã€‚

exports -> JAR file

![2020-2-1-20-18-35.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-1-20-18-35.png)

é€‰æ‹©è¦å¯¼å‡ºçš„æ–‡ä»¶ -> ç„¶åé€‰æ‹©è¦å¯¼å‡ºçš„ä½ç½® -> Finish

![2020-2-1-20-19-14.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-1-20-19-14.png)

## DBUtils

#### ä»€ä¹ˆæ˜¯ DBUtils

- DBUtils æ˜¯ Apache ç¼–å†™çš„æ•°æ®åº“æ“ä½œå·¥å…·ï¼›
- å°è£…äº†å¯¹ JDBC çš„æ“ä½œï¼Œç®€åŒ–äº† JDBC æ“ä½œï¼›

#### å¸¸ç”¨æ–¹æ³•

- `QueryRunnder(DataSorce ds)`ï¼šåˆ›å»ºè¿æ¥ï¼›
- `update(String sql, Object...obj)`ï¼šæ‰§è¡Œæ›´æ–°ï¼›
- `query(String sql, ResultSetHandler<T> rsh, Object...params)`ï¼šæ‰§è¡ŒæŸ¥è¯¢ï¼›
- `query(sql, new BeanHandler<Student>(Student.class), params)`ï¼šæŠŠæŸ¥è¯¢åˆ°ç»“æœå°è£…æˆä¸€ä¸ªæŒ‡å®šå¯¹è±¡ï¼›
- `query(sql, new BeanListHandler<Student>(Student.class))`ï¼šæŠŠæŸ¥è¯¢ç»“æœå°è£…æˆä¸€ä¸ªæŒ‡å®šå¯¹è±¡é›†åˆï¼›
- `qr.query(sql, new ScalarHandler())`ï¼šæŸ¥è¯¢å•ä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ª Long ç±»å‹
- `qr.query(sql, new MapListHandler())`ï¼šæŠŠæŸ¥è¯¢ç»“æœå°è£…æˆä¸€ä¸ª Map é›†åˆ
- `query(sql, new ColumnListHandler("åˆ—å"))`ï¼šæŸ¥è¯¢æŒ‡å®šçš„åˆ—

#### ä½¿ç”¨ DBUtils æ”¹å†™ä»£ç 

å¼•å…¥ jar åŒ…ï¼Œå¹¶ä¸”ç¼–è¯‘ä¸€ä¸‹ï¼ˆBuild Pathï¼‰ã€‚

![2020-1-31-14-46-48.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-31-14-46-48.png)

æˆ‘ä»¬å…ˆæ”¹ `save` æ–¹æ³•ã€‚åŒç†å…¶ä»–çš„ DML æ“ä½œä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„æ”¹æ³•ã€‚

åœ¨ StudentDaoImpl ä¸­ï¼Œä¼ å…¥æ•°æ®æºåˆ° `QueryRunner`ï¼Œåˆ›å»ºè¿æ¥ã€‚

![2020-1-31-14-54-5.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-31-14-54-5.png)

![2020-1-31-14-55-31.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-31-14-55-31.png)

é€šè¿‡ `updata` æ–¹æ³•æ¥è¿›è¡Œæ“ä½œï¼š

![2020-2-1-20-25-59.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-1-20-25-59.png)

ä¸‹é¢æ¥æ”¹ DQL æ“ä½œã€‚

é€šè¿‡ `query` æ–¹æ³•æ¥è¿›è¡ŒæŸ¥è¯¢ï¼š

![2020-2-1-20-29-38.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-1-20-29-38.png)

å¦‚æœæŸ¥è¯¢ç»“æœæ˜¯å¤šä¸ªçš„è¯ï¼Œè¦æ³¨æ„ `query` æ–¹æ³•çš„å‚æ•°ï¼š

![2020-2-1-20-31-18.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-1-20-31-18.png)
