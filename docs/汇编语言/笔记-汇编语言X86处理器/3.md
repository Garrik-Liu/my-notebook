# Assembly Language Fundamentals

## A Template for Assembly Language Programs

- **Irvine32.inc**: library procedures and setup information for IA-32
  - **.386**: identifies 80386 as required processor. Use .586 for Pentium.
  - **.model**: set the running mode to 32-bit protected mode and use the MS-Windows calling convention
- **main PROC**: label of the entry point of the program
  - first instruction to execute
- **END**: marks the end of the program and identifies the program’s startup procedure
- **exit**: macro that halts the program then returns the control to the caller (here the Win32 console)
- **.data and .code**: beginning of the data segment and code segment

```assembly
.386
.model flat, stdcall
.stack 4096
ExitProcess PROTO, dwExitCode: DWORD
DumpRegs PROTO

.data
   ;data declarations
.code
main PROC
  … ;instructions here
  call DumpRegs
  INVOKE ExitProcess, 0
main ENDP
END main
```

## The FLAT Memory Model

- The `.model flat` directive tells the assembler to generate code that will run in **protected mode** and in **32-bit mode**
- The directives `.code` and `.data` mark the beginning of the code and data segments. They are used only for **protection**:
  - `.code` is read-only
  - `.data` is read and write

## Example: Adding and Subtracting Integers

```assembly
TITLE Add and Subtract           (AddSub.asm)

; This program adds and subtracts 32-bit integers.

INCLUDE Irvine32.inc
.code
main PROC
	mov eax,10000h	; EAX = 10000h
	add eax,40000h	; EAX = 50000h
	sub eax,20000h	; EAX = 30000h
	call DumpRegs	; display registers
	exit
main ENDP
END main
```

## Assemble-Link Execute Cycle

![2020-1-28-11-9-38.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-28-11-9-38.png)

#### Listing File

- Use it to see how your program is compiled
- Contains：
  - source code
  - addresses
  - object code (machine language)
  - segment names
  - symbols (variables, procedures, and constants)

#### Map File

- Information about each program segment:
  - starting address
  - ending address
  - size
  - segment type

## Directives and Instructions

- Assembly language statements are either **directives** or **instructions**
- **Instructions** are executable statements. They are translated by the assembler into machine instructions
- An instruction contains:
  - Label (optional)
  - Mnemonic (required) ; also called “op-code”
  - Operand (depends on the instruction)
  - Comment (optional)

```
call MySub  ;transfer of control
mov  ax,5   ;data transfer
```

- **Directives** tells the assembler how to generate machine code, allocate storage, or define segments. They do not execute at run time;
- Used to declare code, data areas, select memory model, declare procedures, etc.
- not case sensitive

```
count BYTE 50 ;creates 1 byte of storage initialized to 50
```

## Mnemonics and Operands

- Instruction Mnemonics

  - memory aid
  - examples: MOV, ADD, SUB, MUL, INC, DEC

- Operands
  - constant
  - constant expression
  - register
  - memory (data label)

## Data Definition Statement

- A data definition statement declares a variable and allocates memory for the variable.
- All variable declarations are in the **.data** segment of programs

![2020-1-28-11-23-58.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-28-11-23-58.png)

#### Defining BYTE and SBYTE Data

- 8-bit unsigned integer and 8-bit signed integer type

![2020-1-28-11-24-55.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-28-11-24-55.png)

#### Defining [S]Byte Arrays

- A question mark (?) in the initializer leaves the initial value of the variable **undefined**

![2020-1-28-11-25-31.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-28-11-25-31.png)

#### Defining Strings

- A string is implemented as an array of characters

![2020-1-28-11-27-6.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-28-11-27-6.png)

- To continue a single string across multiple lines, end each line with a **comma**:

![2020-1-28-11-28-7.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-28-11-28-7.png)

- End-of-line character sequence:

  - 0Dh = carriage return ; the ‘enter’ or ‘return’ character
  - 0Ah = line feed ; the ‘beginning-of-the-line’ character

- Line continuation character `\`
  - Concatenates two source code lines into a single statement

![2020-1-28-11-30-14.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-28-11-30-14.png)

#### DUP Operator

- Use DUP to allocate (create space for) an array of any type or for a string.
- DUP must be used only with data allocation directives.

![2020-1-28-11-31-35.png](https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-1-28-11-31-35.png)
