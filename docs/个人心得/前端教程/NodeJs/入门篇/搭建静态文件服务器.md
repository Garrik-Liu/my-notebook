# æ­å»ºé™æ€èµ„æºæœåŠ¡å™¨

åœ¨ä¸Šä¸€ç« , æˆ‘ä»¬æ­å»ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„ "Hello World" æœåŠ¡å™¨.  åœ¨è¿™ä¸€ç« é‡Œ, æˆ‘ä»¬è¦ç»§ç»­ä¸Šä¸€ç« æ‰€å­¦çš„çŸ¥è¯†, è¿›ä¸€æ­¥å°è¯•æ­å»º, æä¾›é™æ€èµ„æºçš„æœåŠ¡å™¨.

## ä»€ä¹ˆæ˜¯é™æ€èµ„æºæœåŠ¡å™¨?

é‚£å…ˆè¯´ä»€ä¹ˆæ˜¯ **é™æ€èµ„æº**, å®ƒæŒ‡çš„æ˜¯**ä¸ä¼šè¢«æœåŠ¡å™¨çš„åŠ¨æ€è¿è¡Œæ‰€æ”¹å˜æˆ–è€…ç”Ÿæˆçš„æ–‡ä»¶**.  å®ƒæœ€åˆåœ¨æœåŠ¡å™¨è¿è¡Œä¹‹å‰æ˜¯ä»€ä¹ˆæ ·å­, åˆ°æœåŠ¡å™¨ç»“æŸè¿è¡Œæ—¶, å®ƒè¿˜æ˜¯é‚£ä¸ªæ ·å­.  æ¯”å¦‚å¹³æ—¶å†™çš„ `js`, `css`, `html` æ–‡ä»¶, éƒ½å¯ä»¥ç®—æ˜¯é™æ€èµ„æº.  é‚£ä¹ˆå¾ˆå®¹æ˜“ç†è§£, é™æ€èµ„æºæœåŠ¡å™¨çš„åŠŸèƒ½å°±æ˜¯å‘å®¢æˆ·ç«¯æä¾›é™æ€èµ„æº.  

è¯ä¸å¤šè¯´, å¼€å§‹å†™ä»£ç :

é¦–å…ˆæˆ‘ä»¬çŸ¥é“, å®ƒå…ˆæ˜¯ä¸€ä¸ª "æœåŠ¡å™¨".  é‚£æ ¹æ®ä¸Šä¸€ç« çš„æ‰€å­¦, æˆ‘ä»¬è¦å…ˆç”¨ `http` æ¨¡å—åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡å™¨.

``` js
var http = require('http');

var server = http.createServer(function(req, res) {
    // ä¸šåŠ¡é€»è¾‘, ç­‰ä¼šå„¿å†å†™.
});

server.listen(3000, function() {
    console.log("é™æ€èµ„æºæœåŠ¡å™¨è¿è¡Œä¸­.");
    console.log("æ­£åœ¨ç›‘å¬ 3000 ç«¯å£:")
})
```

## url æ¨¡å—

[url æ¨¡å— - æ–‡æ¡£](http://nodejs.cn/api/url.html)

æœ‰äº† HTTP æœåŠ¡å™¨ä¹‹å, æˆ‘ä»¬å°±å¯ä»¥è·å–ä»å®¢æˆ·ç«¯å‘è¿‡æ¥çš„ HTTP è¯·æ±‚äº†.  

è¯·æ±‚æŠ¥æ–‡ä¸­åŒ…å«ç€è¯·æ±‚ URL. å‰æ–‡è¯´è¿‡, URL ç”¨äºå®šä½ç½‘ç»œä¸Šçš„èµ„æº.  å®¢æˆ·ç«¯é€šè¿‡ URL æ¥æŒ‡æ˜æƒ³è¦çš„æœåŠ¡å™¨ä¸Šèµ„æº.  é‚£ä¹ˆæœåŠ¡å™¨ä¸ºäº†ææ¸…æ¥šå®¢æˆ·ç«¯åˆ°åº•æƒ³è¦ä»€ä¹ˆ, æˆ‘ä»¬éœ€è¦å¤„ç†å’Œè§£æ URL.  åœ¨ Node.js ä¸­, æˆ‘ä»¬ä½¿ç”¨ `url` æ¨¡å—æ¥å®Œæˆè¿™ç±»æ“ä½œ.

æˆ‘ä»¬çŸ¥é“ URL å­—ç¬¦ä¸²æ˜¯å…·æœ‰ç»“æ„çš„å­—ç¬¦ä¸²ï¼ŒåŒ…å«å¤šä¸ªæ„ä¹‰ä¸åŒçš„ç»„æˆéƒ¨åˆ†ã€‚ é€šè¿‡ `url.parse()` å‡½æ•°, URL å­—ç¬¦ä¸²å¯ä»¥è¢«è§£æä¸ºä¸€ä¸ª URL å¯¹è±¡ï¼Œå…¶å±æ€§å¯¹åº”äºå­—ç¬¦ä¸²çš„å„ç»„æˆéƒ¨åˆ†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º.

![Screen Shot 2018-10-05 at 2.18.56 AM](https://i.imgur.com/9ac97ul.png)

---

é‚£ä¹ˆå›åˆ°æˆ‘ä»¬çš„é™æ€æ–‡ä»¶æœåŠ¡å™¨ä»£ç .:

å…ˆåœ¨ `http.createServer` å‡½æ•°è¢«è°ƒç”¨ä¹‹å‰, å¼•å…¥ `url` æ¨¡å—:

``` js
var url = require('url');
```

ç„¶ååœ¨ HTTP æœåŠ¡å™¨é‡Œè§£æè¯·æ±‚ URL.  å®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ URL ä½œä¸ºå±æ€§å­˜æ”¾åœ¨ `http.createServer` çš„å›è°ƒå‡½æ•°å‚æ•°æ‰€æ¥æ”¶çš„è¯·æ±‚å¯¹è±¡é‡Œ, å±æ€§åä¸º `url`.

``` js
var server = http.createServer(function(req, res) {
    var urlObj = url.parse(req.url);
});
```

## path æ¨¡å—

[path æ¨¡å— - æ–‡æ¡£](https://nodejs.org/api/path.html)

æ¥ä¸‹æ¥ä»è§£æåçš„ URL å¯¹è±¡ `urlObj` é‡Œå–å¾—è¯·æ±‚ URL ä¸­çš„è·¯å¾„å(pathname).  è·¯å¾„åä¿å­˜åœ¨ `pathname` å±æ€§é‡Œ.

``` js
var server = http.createServer(function(req, res) {
    var urlObj = url.parse(req.url);
    var urlPathname = urlObj.pathname;
});
```

ä½†æ˜¯å…‰æœ‰ URL å¯¹è±¡é‡Œé¢çš„è·¯å¾„åæ˜¯ä¸å¤Ÿçš„.  æˆ‘ä»¬è¿˜éœ€è¦è·å¾—ç›®æ ‡æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸­æ‰€åœ¨ç›®å½•çš„ç›®å½•å(dirname).

å‡å¦‚è¯´æˆ‘ä»¬çš„é¡¹ç›®ç»“æ„æ˜¯ä¸‹é¢è¿™æ ·çš„:

``` bash
.
â”œâ”€â”€ public
â”‚   â”œâ”€â”€ index.css
â”‚   â””â”€â”€ index.html
â””â”€â”€ server.js
```

æˆ‘ä»¬çš„æœåŠ¡å™¨ä»£ç å†™åœ¨ `server.js` æ–‡ä»¶é‡Œ.  å®¢æˆ·ç«¯æƒ³è¦è¯·æ±‚ä¿å­˜åœ¨ `public` ç›®å½•é‡Œçš„ `index.html` æ–‡ä»¶.  ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ URL çš„æ—¶å€™, ä»–åªçŸ¥é“ä»–æƒ³è¦çš„æ–‡ä»¶å« `index.html`, ä½†è¿™ä¸ªæ–‡ä»¶åœ¨ HTTP æœåŠ¡å™¨æ‰€åœ¨çš„è®¾å¤‡ä¸­çš„ ã€ ç»å¯¹ä½ç½® ã€æ˜¯ä¸è¢«çŸ¥é“çš„.  æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®© HTTP æœåŠ¡å™¨è‡ªå·±å»å¤„ç†è¿™éƒ¨åˆ†æ“ä½œ.

åœ¨è¿™é‡Œå°±éœ€è¦ä½¿ç”¨ Node.js è‡ªå¸¦çš„ `path` æ¨¡å—.  å…¶æä¾›äº†ä¸€äº›å·¥å…·å‡½æ•°ï¼Œç”¨äºå¤„ç†æ–‡ä»¶ä¸ç›®å½•çš„è·¯å¾„.  
ä½¿ç”¨èµ·æ¥å¾ˆç®€å•, é¦–å…ˆè¿˜æ˜¯åœ¨ `http.createServer` å‡½æ•°è¢«è°ƒç”¨ä¹‹å‰, å¼•å…¥ ` path` æ¨¡å—:

``` js
var path = require('path');
```

ä¹‹åæˆ‘ä»¬ç”¨ `path.join` è¿™ä¸ªæ–¹æ³•æ¥æŠŠ ç›®æ ‡æ–‡ä»¶æ‰€åœ¨ç›®å½•çš„ç›®å½•åå’Œè¯·æ±‚ URL ä¸­çš„è·¯å¾„ååˆå¹¶èµ·æ¥.  åœ¨è¿™ä¸ªä¾‹å­ä¸­, å®¢æˆ·ç«¯å¯ä»¥è®¿é—®çš„é™æ€æ–‡ä»¶å…¨éƒ¨åœ¨ `public` è¿™ä¸ªç›®å½•ä¸­, è€Œ `public` ç›®å½•åˆåœ¨ `server.js` æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä¸­.  `server.js` ä¸­ä¿å­˜çš„æ˜¯æˆ‘ä»¬çš„æœåŠ¡å™¨ä»£ç .  

æƒ³è¦è·å¾— `server.js` æ‰€åœ¨ç›®å½•çš„åœ¨æ•´ä¸ªè®¾å¤‡ä¸­çš„ç»å¯¹è·¯å¾„, æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡å™¨ä»£ç ä¸­è°ƒç”¨å˜é‡ `__dirname`, å®ƒæ˜¯å½“å‰æ–‡ä»¶åœ¨è¢«æ¨¡å—åŒ…è£…å™¨åŒ…è£…æ—¶ä¼ å…¥çš„å˜é‡, ä¿å­˜äº†å½“å‰æ¨¡å—çš„ç›®å½•åã€‚

``` js
var server = http.createServer(function(req, res) {
    var urlObj = url.parse(req.url);
    var urlPathname = urlObj.pathname;
    var filePathname = path.join(__dirname, "/public", urlPathname);
});
```

å¦‚æœä½ æƒ³çš„è¯, ä½ å¯ä»¥ç”¨ `console.log(filePathname)` æ¥çœ‹çœ‹æœåŠ¡å™¨è¿è¡Œå, ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„è¯·æ±‚ URL ä¼šè¢«è½¬æ¢æˆä»€ä¹ˆæ ·.

## fs æ¨¡å—


[fs æ¨¡å— - æ–‡æ¡£](http://nodejs.cn/api/fs.html#fs_file_system)

ç°åœ¨æ¥åˆ°äº†æœ€é‡è¦çš„ä¸€æ­¥, è¯»å–ç›®æ ‡æ–‡ä»¶, å¹¶ä¸”è¿”å›æ–‡ä»¶ç»™å®¢æˆ·ç«¯.  

æˆ‘ä»¬éœ€è¦ç”¨ Node.js è‡ªå¸¦çš„ `fs` æ¨¡å—ä¸­çš„ `fs.write` æ–¹æ³•æ¥å®ç°è¿™ä¸€æ­¥.  è¯¥æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç›®æ ‡æ–‡ä»¶çš„è·¯å¾„, æœ€åä¸€ä¸ªå‚æ•°ä¸ºä¸€ä¸ªå›è°ƒå‡½æ•°, å›è°ƒæœ‰ä¸¤ä¸ªå‚æ•° (err, data)ï¼Œå…¶ä¸­ `data` æ˜¯æ–‡ä»¶çš„å†…å®¹, å¦‚æœå‘ç”Ÿé”™è¯¯çš„è¯ `err` ä¿å­˜é”™è¯¯ä¿¡æ¯.  `fs.write` æ–¹æ³•å¯ä»¥åœ¨ç¬¬äºŒä¸ªå‚æ•°ä¸­æŒ‡å®šå­—ç¬¦ç¼–ç , å¦‚æœæœªæŒ‡å®šåˆ™è¿”å›åŸå§‹çš„ buffer.  åœ¨è¿™ä¸ªä¾‹å­ä¸­, æˆ‘ä»¬ä¸è€ƒè™‘è¿™ä¸€é¡¹.

é‚£ä¹ˆå…·ä½“ä»£ç å¦‚ä¸‹:

é¦–å…ˆå¼•å…¥ `fs` æ¨¡å—, æˆ‘å°±ä¸èµ˜è¿°äº†, å‚ç…§å‰é¢å°±å¯ä»¥äº†.  ä¸‹é¢æ˜¯è¯»å–æ–‡ä»¶çš„ä»£ç .

``` js
var server = http.createServer(function(req, res) {
    var urlObj = url.parse(req.url);
    var urlPathname = urlObj.pathname;
    var filePathname = path.join(__dirname, "/public", urlPathname);
    
    fs.readFile(filePathname, (err, data) => {
        // å¦‚æœæœ‰é—®é¢˜è¿”å› 404
        if (err) {
            res.writeHead(404);
            res.write("404 - File is not found!");
            res.end();
        // æ²¡é—®é¢˜è¿”å›æ–‡ä»¶å†…å®¹
        } else {
            res.writeHead(200);
            res.write(data);
            res.end();
        }
    })
});
```

ç°åœ¨æˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ªåŸºæœ¬çš„ã€ é™æ€æ–‡ä»¶æœåŠ¡å™¨ ã€å¯ä»¥åœ¨å…è®¸å®¢æˆ·ç«¯è¯·æ±‚ä¿å­˜åœ¨æœåŠ¡å™¨ä¸­å…¬å¼€çš„é™æ€æ–‡ä»¶äº†.  ä½ å¯ä»¥å°è¯•å¯åŠ¨æœåŠ¡å™¨, ç„¶åè®©æµè§ˆå™¨ä¸­è®¿é—® `http://localhost:3000/index.html`.  æˆ‘çš„æ•ˆæœå¦‚ä¸‹:

![Screen Shot 2018-10-06 at 2.22.08 PM](https://i.imgur.com/hWu58TA.png)

## è®¾ç½® MIME ç±»å‹

[MIME æ–‡æ¡£ - MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types#%E8%AE%BE%E7%BD%AE%E6%AD%A3%E7%A1%AE%E7%9A%84MIME%E7%B1%BB%E5%9E%8B%E7%9A%84%E9%87%8D%E8%A6%81%E6%80%A7)
[Content-Type æ–‡æ¡£ - MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type)

å¤šç”¨é€” Internet é‚®ä»¶æ‰©å±•ï¼ˆMIMEï¼‰ç±»å‹æ˜¯ç”¨ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼æ¥è¡¨ç¤ºæ–‡æ¡£çš„ "æ€§è´¨" å’Œ "æ ¼å¼"ã€‚ ç®€å•è¯´, æµè§ˆå™¨é€šè¿‡ MIME ç±»å‹æ¥ç¡®å®šå¦‚ä½•å¤„ç†æ–‡æ¡£.  å› æ­¤åœ¨å“åº”å¯¹è±¡çš„å¤´éƒ¨è®¾ç½®æ­£ç¡® MIME ç±»å‹æ˜¯éå¸¸é‡è¦çš„.

MIME çš„ç»„æˆç»“æ„éå¸¸ç®€å•: ç”±ç±»å‹ä¸å­ç±»å‹ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­é—´ç”¨ `'/'` åˆ†éš”è€Œç»„æˆ, å…¶ä¸­æ²¡æœ‰ç©ºæ ¼.  MIME ç±»å‹å¯¹å¤§å°å†™ä¸æ•æ„Ÿï¼Œä½†æ˜¯ä¼ ç»Ÿå†™æ³•éƒ½æ˜¯å°å†™.  

ä¾‹å¦‚: 
* `text/plain` : æ˜¯æ–‡æœ¬æ–‡ä»¶é»˜è®¤å€¼ã€‚æ„æ€æ˜¯ æœªçŸ¥çš„æ–‡æœ¬æ–‡ä»¶ ï¼Œæµè§ˆå™¨è®¤ä¸ºæ˜¯å¯ä»¥ç›´æ¥å±•ç¤ºçš„.
* `text/html` : æ˜¯æ‰€æœ‰çš„HTMLå†…å®¹éƒ½åº”è¯¥ä½¿ç”¨è¿™ç§ç±»å‹.
* `image/png` : æ˜¯ PNG æ ¼å¼å›¾ç‰‡çš„ MIME ç±»å‹.

åœ¨æœåŠ¡å™¨ä¸­, æˆ‘ä»¬é€šè¿‡è®¾ç½® `Content-Type` è¿™ä¸ªå“åº”å¤´éƒ¨çš„å€¼, æ¥æŒ‡ç¤ºå“åº”å›å»çš„èµ„æºçš„ MIME ç±»å‹.  åœ¨ Node.js ä¸­, å¯ä»¥å¾ˆæ–¹ä¾¿çš„ç”¨å“åº”å¯¹è±¡çš„ `writeHead` æ–¹æ³•æ¥è®¾ç½®å“åº”çŠ¶æ€ç å’Œå“åº”å¤´éƒ¨.  

å‡å¦‚æˆ‘ä»¬è¦å“åº”ç»™å®¢æˆ·ç«¯ä¸€ä¸ª HTML æ–‡ä»¶, é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ä¸‹é¢è¿™æ¡ä»£ç :

``` js
res.writeHead(200, {"Content-Type":"text/html"});
```

ä½ ä¼šå‘ç°æˆ‘åœ¨ä¸Šé¢çš„é™æ€èµ„æºæœåŠ¡å™¨çš„ä»£ç ä¸­, æ²¡æœ‰è®¾ç½®å“åº”èµ„æºçš„ MIME ç±»å‹.  ä½†å¦‚æœä½ è¯•ç€è¿è¡ŒæœåŠ¡å™¨çš„è¯, ä½ ä¼šå‘ç°é™æ€èµ„æºä¹Ÿä»¥æ­£ç¡®æ–¹å¼è¢«å±•ç¤ºåˆ°äº†æµè§ˆå™¨.  

ä¹‹æ‰€ä»¥ä¼šè¿™æ ·çš„åŸå› æ˜¯åœ¨ç¼ºå¤± MIME ç±»å‹æˆ–å®¢æˆ·ç«¯è®¤ä¸ºæ–‡ä»¶è®¾ç½®äº†é”™è¯¯çš„ MIME ç±»å‹æ—¶ï¼Œæµè§ˆå™¨å¯èƒ½ä¼šé€šè¿‡æŸ¥çœ‹èµ„æºæ¥è¿›è¡ŒçŒœæµ‹ MIME ç±»å‹, å«åš ã€ MIME å—…æ¢ ã€.  ä¸åŒçš„æµè§ˆå™¨åœ¨ä¸åŒçš„æƒ…å†µä¸‹å¯èƒ½ä¼šæ‰§è¡Œä¸åŒçš„æ“ä½œã€‚æ‰€ä»¥ä¸ºäº†ä¿è¯èµ„æºåœ¨æ¯ä¸€ä¸ªæµè§ˆå™¨ä¸‹çš„è¡Œä¸ºä¸€è‡´æ€§, æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨è®¾ç½® MIME ç±»å‹.

é‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬éœ€è¦è·å–åˆ°å‡†å¤‡å“åº”ç»™å®¢æˆ·ç«¯çš„æ–‡ä»¶çš„ **åç¼€å**.  

è¦åšåˆ°è¿™ä¸€æ­¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ `path` æ¨¡å—çš„ `parse` æ–¹æ³•.  è¿™ä¸ªæ–¹æ³•å¯ä»¥å°†ä¸€æ®µè·¯å¾„è§£ææˆä¸€ä¸ªå¯¹è±¡, å…¶ä¸­çš„å±æ€§å¯¹åº”è·¯å¾„çš„å„ä¸ªéƒ¨ä½.

ç»§ç»­å†åˆšæ‰é™æ€æ–‡ä»¶æœåŠ¡å™¨æ¡ˆä¾‹çš„ä»£ç ä¸Šæ·»åŠ :

``` js
var server = http.createServer(function(req, res) {
    var urlObj = url.parse(req.url);
    var urlPathname = urlObj.pathname;
    var filePathname = path.join(__dirname, "/public", urlPathname);
    
    // è§£æåå¯¹è±¡çš„ ext å±æ€§ä¸­ä¿å­˜ç€ç›®æ ‡æ–‡ä»¶çš„åç¼€å
    var ext = path.parse(urlPathname).ext;
    
    // è¯»å–æ–‡ä»¶çš„ä»£ç ...
});
```

è·å–äº†æ–‡ä»¶åç¼€ä¹‹å, æˆ‘ä»¬éœ€è¦æŸ¥æ‰¾å…¶å¯¹åº”çš„ **MIME ç±»å‹**äº†.  è¿™ä¸€æ­¥å¯ä»¥å¾ˆè½»æ¾çš„ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å— [MIME](https://www.npmjs.com/package/mime) æ¥å®ç°.  ä½ å¯ä»¥è‡ªè¡Œå» NPM ä¸Šå»æŸ¥é˜…å®ƒçš„ä½¿ç”¨æ–‡æ¡£.  

å¯¹äºæˆ‘ä»¬ç›®å‰çš„éœ€æ±‚æ¥è¯´, åªéœ€è¦ç”¨åˆ° MIME æ¨¡å—çš„ `getType()` æ–¹æ³•.  è¿™ä¸ªæ–¹æ³•æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•° (åç¼€å), è¿”å›å…¶å¯¹åº”çš„ MIME ç±»å‹, å¦‚æœæ²¡æœ‰å°±è¿”å› `null`.

ä½¿ç”¨çš„è¯, é¦–å…ˆè¦ç”¨ npm å®‰è£… MIME æ¨¡å— ( å¦‚æœä½ è¿˜æ²¡åˆ›å»º package.json æ–‡ä»¶çš„è¯, åˆ«å¿˜äº†å…ˆæ‰§è¡Œ `npm init` )

``` bash
npm install mime --save
```

å®‰è£…å®Œæ¯•. å¼•å…¥æ¨¡å—åˆ°æœåŠ¡å™¨ä»£ç ä¸­, ç„¶åæˆ‘ä»¬å°±ç›´æ¥ç”¨åˆšåˆšè·å¾—çš„åç¼€å»æ‰¾åˆ°å…¶å¯¹åº”çš„ MIME ç±»å‹

``` js
var mime = require('mime');

var server = http.createServer(function(req, res) {
    var urlObj = url.parse(req.url);
    var urlPathname = urlObj.pathname;
    var filePathname = path.join(__dirname, "/public", urlPathname);
    
    // è§£æåå¯¹è±¡çš„ ext å±æ€§ä¸­ä¿å­˜ç€ç›®æ ‡æ–‡ä»¶çš„åç¼€å
    var ext = path.parse(urlPathname).ext;
    // è·å–åç¼€å¯¹åº”çš„ MIME ç±»å‹
    var mimeType = mime.getType(ext);
    
    // è¯»å–æ–‡ä»¶çš„ä»£ç ...
});
```

å¥½äº†, ç°åœ¨æœ€é‡è¦çš„ä¸œè¥¿ MIME ç±»å‹æˆ‘ä»¬å·²ç»å¾—åˆ°äº†.  æ¥ä¸‹æ¥åªè¦åœ¨å“åº”å¯¹è±¡çš„ `writeHead` æ–¹æ³•é‡Œè®¾ç½®å¥½ `Content-Type` å°±è¡Œäº†.

``` js
var server = http.createServer(function(req, res) {
    // ä»£ç çœç•¥...
    var mimeType = mime.getType(ext);

    fs.readFile(filePathname, (err, data) => {
        // å¦‚æœæœ‰é—®é¢˜è¿”å› 404
        if (err) {
            res.writeHead(404, { "Content-Type": "text/plain" });
            res.write("404 - File is not found!");
            res.end();
            // æ²¡é—®é¢˜è¿”å›æ–‡ä»¶å†…å®¹
        } else {
            // è®¾ç½®å¥½å“åº”å¤´
            res.writeHead(200, { "Content-Type": mimeType });
            res.write(data);
            res.end();
        }
    })

});
```

é˜¶æ®µæ€§èƒœåˆ© âœŒï¸ ç°åœ¨è¿è¡ŒæœåŠ¡å™¨, åœ¨æµè§ˆå™¨é‡Œè®¿é—®ä¸€ä¸‹ `localhost:3000/index.html` è¯•è¯•å§!

![Screen_Shot_2018-10-07_at_11_12_19_PM](https://i.imgur.com/FpFASxK.png)

å¯ä»¥çœ‹åˆ°ç°åœ¨ `Content-Type` å·²ç»è¢«æ­£ç¡®è®¾ç½®äº†!

## é‡æ„ä»£ç 

ç°åœ¨æ¥çœ‹çœ‹ä½ çš„ä»£ç , æ˜¯ä¸æ˜¯å¼€å§‹æ„Ÿè§‰æœ‰ç‚¹ä¹±ç³Ÿç³Ÿçš„.  æˆ‘æƒ³èªæ˜çš„ä½ å·²ç»å‘ç°, æ•´ä¸ªé™æ€æ–‡ä»¶æœåŠ¡å™¨çš„ä»£ç å°±æ˜¯åœ¨åšä¸€ä»¶äº‹: å“åº”å›å®¢æˆ·ç«¯æƒ³è¦çš„é™æ€æ–‡ä»¶.  è¿™æ®µä»£ç èŒè´£å•ä¸€, ä¸”å¤ç”¨é¢‘ç‡å¾ˆé«˜.  é‚£ä¹ˆæˆ‘ä»¬æœ‰ç†ç”±å°†å…¶å°è£…æˆä¸€ä¸ªæ¨¡å—.

å…·ä½“çš„è¿‡ç¨‹æˆ‘å°±ä¸èµ˜è¿°äº†. ä»¥ä¸‹æ˜¯æˆ‘çš„æ¨¡å—ä»£ç :

``` js
// readStaticFile.js

// å¼•å…¥ä¾èµ–çš„æ¨¡å—
var path = require('path');
var fs = require('fs');
var mime = require('mime');

function readStaticFile(res, filePathname) {

    var ext = path.parse(filePathname).ext;
    var mimeType = mime.getType(ext);
    
    // åˆ¤æ–­è·¯å¾„æ˜¯å¦æœ‰åç¼€, æœ‰çš„è¯åˆ™è¯´æ˜å®¢æˆ·ç«¯è¦è¯·æ±‚çš„æ˜¯ä¸€ä¸ªæ–‡ä»¶ 
    if (ext) {
        // æ ¹æ®ä¼ å…¥çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„æ¥è¯»å–å¯¹åº”æ–‡ä»¶
        fs.readFile(filePathname, (err, data) => {
            // é”™è¯¯å¤„ç†
            if (err) {
                res.writeHead(404, { "Content-Type": "text/plain" });
                res.write("404 - NOT FOUND");
                res.end();
            } else {
                res.writeHead(200, { "Content-Type": mimeType });
                res.write(data);
                res.end();
            }
        });
        // è¿”å› false è¡¨ç¤º, å®¢æˆ·ç«¯æƒ³è¦çš„ æ˜¯ é™æ€æ–‡ä»¶
        return true;
    } else {
        // è¿”å› false è¡¨ç¤º, å®¢æˆ·ç«¯æƒ³è¦çš„ ä¸æ˜¯ é™æ€æ–‡ä»¶
        return false;
    }
}

// å¯¼å‡ºå‡½æ•°
module.exports = readStaticFile;
```

ç”¨äºè¯»å–é™æ€æ–‡ä»¶çš„æ¨¡å— `readStaticFile` å°è£…å¥½äº†ä¹‹å.  æˆ‘ä»¬å¯ä»¥åœ¨é¡¹ç›®ç›®å½•é‡Œæ–°å»ºä¸€ä¸ª modules ç›®å½•, ç”¨äºå­˜æ”¾æ¨¡å—.  ä»¥ä¸‹æ˜¯æˆ‘ç›®å‰çš„é¡¹ç›®ç»“æ„.

![Screen Shot 2018-10-08 at 3.55.58 PM](https://i.imgur.com/qnWZriD.png)


å°è£…å¥½äº†æ¨¡å—ä¹‹å, æˆ‘ä»¬å°±å¯ä»¥åˆ å»æœåŠ¡å™¨ä»£ç é‡Œé‚£æ®µè¯»å–æ–‡ä»¶çš„ä»£ç äº†, ç›´æ¥å¼•ç”¨æ¨¡å—å°±è¡Œäº†.  ä»¥ä¸‹æ˜¯æˆ‘ä¿®æ”¹åçš„ server.js ä»£ç :

``` js
// server.js 

// å¼•å…¥ç›¸å…³æ¨¡å—
var http = require('http');
var url = require('url');
var path = require('path');
var readStaticFile = require('./modules/readStaticFile');

// æ­å»º HTTP æœåŠ¡å™¨
var server = http.createServer(function(req, res) {
    var urlObj = url.parse(req.url);
    var urlPathname = urlObj.pathname;
    var filePathname = path.join(__dirname, "/public", urlPathname);
    
    // è¯»å–é™æ€æ–‡ä»¶
    readStaticFile(res, filePathname);
});

// åœ¨ 3000 ç«¯å£ç›‘å¬è¯·æ±‚
server.listen(3000, function() {
    console.log("æœåŠ¡å™¨è¿è¡Œä¸­.");
    console.log("æ­£åœ¨ç›‘å¬ 3000 ç«¯å£:")
})
```

ğŸ˜† å¥½å•¦! å¤§åŠŸå‘Šæˆ! åœ¨è¿™ä¸€ç¯‡æˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•è·å–å’Œè§£æå®¢æˆ·ç«¯å‘æ¥çš„è¯·æ±‚ URL, å¦‚ä½•è¯»å–æ–‡ä»¶, è¿˜å°è¯•å°è£…äº†ä¸€ä¸ªæ¨¡å—.  

