<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PL/SQL | Garrik 的笔记</title>
    <meta name="description" content="这里是 Garrik 的前端笔记本">
    
    
    <link rel="preload" href="/front-end-notebook/assets/css/57.styles.6dfca121.css" as="style"><link rel="preload" href="/front-end-notebook/assets/js/app.6994e9bb.js" as="script"><link rel="preload" href="/front-end-notebook/assets/js/6.3cd8cfde.js" as="script"><link rel="prefetch" href="/front-end-notebook/assets/js/29.3cd22780.js"><link rel="prefetch" href="/front-end-notebook/assets/js/1.6bef9c4b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/2.94d75e89.js"><link rel="prefetch" href="/front-end-notebook/assets/js/3.0bcebadc.js"><link rel="prefetch" href="/front-end-notebook/assets/js/4.317f9292.js"><link rel="prefetch" href="/front-end-notebook/assets/js/5.cfaf3383.js"><link rel="prefetch" href="/front-end-notebook/assets/js/7.5cdc449d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/8.14069a7b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/9.d153360a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/10.f5264d15.js"><link rel="prefetch" href="/front-end-notebook/assets/js/11.29cd5dae.js"><link rel="prefetch" href="/front-end-notebook/assets/js/12.2867372d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/13.6b2beb67.js"><link rel="prefetch" href="/front-end-notebook/assets/js/14.ec5b9ad6.js"><link rel="prefetch" href="/front-end-notebook/assets/js/15.3fca4c21.js"><link rel="prefetch" href="/front-end-notebook/assets/js/16.de0e4e11.js"><link rel="prefetch" href="/front-end-notebook/assets/js/17.b2c5e6d4.js"><link rel="prefetch" href="/front-end-notebook/assets/js/18.08a9e23b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/19.d23e3019.js"><link rel="prefetch" href="/front-end-notebook/assets/js/20.b467ce6c.js"><link rel="prefetch" href="/front-end-notebook/assets/js/21.a37cad00.js"><link rel="prefetch" href="/front-end-notebook/assets/js/22.62af5b3e.js"><link rel="prefetch" href="/front-end-notebook/assets/js/23.c2d9fa6a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/24.5f8cb6e7.js"><link rel="prefetch" href="/front-end-notebook/assets/js/25.2e82d418.js"><link rel="prefetch" href="/front-end-notebook/assets/js/26.778e3f1c.js"><link rel="prefetch" href="/front-end-notebook/assets/js/27.dfc16a34.js"><link rel="prefetch" href="/front-end-notebook/assets/js/28.fffaebf7.js"><link rel="prefetch" href="/front-end-notebook/assets/js/0.ab20632c.js"><link rel="prefetch" href="/front-end-notebook/assets/js/30.58f636a4.js"><link rel="prefetch" href="/front-end-notebook/assets/js/31.a19290d8.js"><link rel="prefetch" href="/front-end-notebook/assets/js/32.3bdab13a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/33.1f14abc3.js"><link rel="prefetch" href="/front-end-notebook/assets/js/34.438e41de.js"><link rel="prefetch" href="/front-end-notebook/assets/js/35.67159ed1.js"><link rel="prefetch" href="/front-end-notebook/assets/js/36.35f632cd.js"><link rel="prefetch" href="/front-end-notebook/assets/js/37.ed4b0d3e.js"><link rel="prefetch" href="/front-end-notebook/assets/js/38.686585e3.js"><link rel="prefetch" href="/front-end-notebook/assets/js/39.bc8926ce.js"><link rel="prefetch" href="/front-end-notebook/assets/js/40.cf486b81.js"><link rel="prefetch" href="/front-end-notebook/assets/js/41.a431a76e.js"><link rel="prefetch" href="/front-end-notebook/assets/js/42.bb32bc27.js"><link rel="prefetch" href="/front-end-notebook/assets/js/43.cc4cb9a4.js"><link rel="prefetch" href="/front-end-notebook/assets/js/44.526d635c.js"><link rel="prefetch" href="/front-end-notebook/assets/js/45.9ff10421.js"><link rel="prefetch" href="/front-end-notebook/assets/js/46.f2800cb3.js"><link rel="prefetch" href="/front-end-notebook/assets/js/47.16ef3e13.js"><link rel="prefetch" href="/front-end-notebook/assets/js/48.f253ed89.js"><link rel="prefetch" href="/front-end-notebook/assets/js/49.25d995fd.js"><link rel="prefetch" href="/front-end-notebook/assets/js/50.56db06ee.js"><link rel="prefetch" href="/front-end-notebook/assets/js/51.12202f83.js"><link rel="prefetch" href="/front-end-notebook/assets/js/52.d29e7bb7.js"><link rel="prefetch" href="/front-end-notebook/assets/js/53.0b7edc1d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/54.327a9d3e.js"><link rel="prefetch" href="/front-end-notebook/assets/js/55.61d210d1.js"><link rel="prefetch" href="/front-end-notebook/assets/js/56.05feae6a.js">
    <link rel="stylesheet" href="/front-end-notebook/assets/css/57.styles.6dfca121.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/front-end-notebook/" class="home-link router-link-active"><!----><span class="site-name">
      Garrik 的笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end-notebook/" class="nav-link">主页</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end-notebook/" class="nav-link">主页</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>PL/SQL</span><!----></p><ul class="sidebar-group-items"><li><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#pl-sql-program-blocks" class="sidebar-link">PL/SQL Program Blocks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#declaration-section" class="sidebar-link">Declaration Section</a></li><li class="sidebar-sub-header"><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#body-section" class="sidebar-link">Body Section</a></li><li class="sidebar-sub-header"><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#exception-section" class="sidebar-link">Exception Section</a></li></ul></li><li><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#first-example" class="sidebar-link">First Example</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#implicit-cursors" class="sidebar-link">Implicit Cursors</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#creating-a-stored-procedure" class="sidebar-link">Creating a Stored Procedure</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#deleting-a-stored-procedure" class="sidebar-link">Deleting a stored procedure</a></li></ul></li><li><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#creating-a-user-defined-function-udf" class="sidebar-link">Creating a User-Defined Function (UDF)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#deleting-a-user-defined-function" class="sidebar-link">Deleting a user-defined function</a></li></ul></li><li><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#cursor-for-loop-statement" class="sidebar-link">CURSOR FOR Loop Statement</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#explicit-cursors" class="sidebar-link">Explicit Cursors</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#declaring-an-explicit-cursor" class="sidebar-link">Declaring An Explicit Cursor</a></li><li class="sidebar-sub-header"><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#opening-an-explicit-cursor" class="sidebar-link">Opening An Explicit Cursor</a></li><li class="sidebar-sub-header"><a href="/front-end-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E9%80%9A%E7%94%A8/ols/files/PL_SQL.html#fetching-the-data-rows" class="sidebar-link">Fetching The Data Rows</a></li></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="pl-sql"><a href="#pl-sql" aria-hidden="true" class="header-anchor">#</a> PL/SQL</h1><h2 id="pl-sql-program-blocks"><a href="#pl-sql-program-blocks" aria-hidden="true" class="header-anchor">#</a> PL/SQL Program Blocks</h2><p>PL/SQL stands for Procedural Language extension of SQL</p><p>A PL/SQL program can divided up into three possible sections:</p><ol><li>Declaration Section</li><li>Body Section</li><li>Exception Section</li></ol><p>Note that the Declaration and Exception sections are optional.</p><h3 id="declaration-section"><a href="#declaration-section" aria-hidden="true" class="header-anchor">#</a> Declaration Section</h3><p>Use the Declaration section to declare program variables. Each program variable declaration is of the syntax:</p><div class="language-sql extra-class"><pre class="language-sql"><code>variable_name data_type<span class="token punctuation">;</span>
</code></pre></div><p>Scalar Data Types include:
• VARCHAR2
• CHAR
• DATE
• INTERVAL YEAR TO MONTH
• INTERVAL DAY TO SECOND
• NUMBER
• BINARY_INTEGER, INTEGER, INT, SMALLINT
• DEC, DECIMAL, DOUBLE PRECISION, NUMERIC, REAL, BINARY_FLOAT, BINARY_DOUBLE
• BOOLEAN</p><p>Reference Types</p><p><strong>%TYPE</strong>
This type specifies a variable that references a single database field.</p><p>Syntax:</p><div class="language-sql extra-class"><pre class="language-sql"><code>variable_name tablename<span class="token punctuation">.</span>fieldname<span class="token operator">%</span><span class="token keyword">TYPE</span> 
</code></pre></div><p><strong>%ROWTYPE</strong>
This type specifies a variable that references an entire data record.</p><p>Syntax:</p><div class="language-sql extra-class"><pre class="language-sql"><code>variable_name tablename<span class="token operator">%</span>ROWTYPE 
</code></pre></div><h3 id="body-section"><a href="#body-section" aria-hidden="true" class="header-anchor">#</a> Body Section</h3><p>The Body section contains the actual program statements for the PL/SQL program. It includes:</p><ul><li>Comments
<ul><li>/* Multi-line */</li><li>-- Single line</li></ul></li><li>Arithmetic Operators: +,-,*,/,**</li><li>String Concatenation Operator: ||</li><li>String Functions
<ul><li>LENGTH</li><li>LTRIM</li><li>RTRIM</li><li>UPPER</li><li>LOWER</li><li>INITCAP</li><li>INSTR (one-based index)</li><li>SUBSTR (one-based index)</li></ul></li><li>Assignment Statements (:=)</li><li>Relational Operators: =, &lt;&gt;, !=, &gt;, &gt;=, &lt;, &lt;=</li><li>Logical Operators: NOT, AND, OR</li><li>Decision Statements (IF / THEN / ELSIF / ELSE, CASE)</li><li>Loop Statements (LOOP, WHILE, FOR)</li><li>DML Statements (SELECT, INSERT, UPDATE, DELETE)</li><li>Explicit Cursor Statements (OPEN, FETCH, CLOSE)</li></ul><h4 id="output"><a href="#output" aria-hidden="true" class="header-anchor">#</a> Output</h4><p>To output values to the console, use the functions</p><div class="language-sql extra-class"><pre class="language-sql"><code>DBMS_OUTPUT<span class="token punctuation">.</span>PUT<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
DBMS_OUTPUT<span class="token punctuation">.</span>NEW_LINE<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="assignment-statments"><a href="#assignment-statments" aria-hidden="true" class="header-anchor">#</a> Assignment Statments</h4><p>Use the <code>:=</code> operator to assign a value to a variable.</p><p>E.g.</p><div class="language-sql extra-class"><pre class="language-sql"><code>var :<span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="case-statements"><a href="#case-statements" aria-hidden="true" class="header-anchor">#</a> CASE Statements</h4><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CASE</span> var
    <span class="token keyword">WHEN</span> value1 <span class="token keyword">THEN</span>
       statement1
    <span class="token keyword">WHEN</span> value2 <span class="token keyword">THEN</span>
       statement2
    <span class="token keyword">ELSE</span>
       statement3
<span class="token keyword">END</span> <span class="token keyword">CASE</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CASE</span>
    <span class="token keyword">WHEN</span> boolean_expression1 <span class="token keyword">THEN</span>
       statement1
    <span class="token keyword">WHEN</span> boolean_expression2 <span class="token keyword">THEN</span>
       statement2
    <span class="token keyword">ELSE</span>
       statement3
<span class="token keyword">END</span> <span class="token keyword">CASE</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="loop-types"><a href="#loop-types" aria-hidden="true" class="header-anchor">#</a> Loop Types</h4><p>LOOP ... EXIT</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">LOOP</span>
    <span class="token keyword">IF</span> condition <span class="token keyword">THEN</span>
       <span class="token keyword">EXIT</span><span class="token punctuation">;</span>
    <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><p>LOOP ... EXIT WHEN</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">LOOP</span>
    <span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> condition<span class="token punctuation">;</span>
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><p>WHILE ... LOOP</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHILE</span> condition <span class="token keyword">LOOP</span>
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="loop-continuation"><a href="#loop-continuation" aria-hidden="true" class="header-anchor">#</a> Loop Continuation</h4><p>To continue a loop instead of terminating it, replace <code>EXIT</code> or <code>EXIT WHEN</code> with <code>CONTINUE</code> or <code>CONTINUE WHEN</code>.</p><h4 id="for-loops"><a href="#for-loops" aria-hidden="true" class="header-anchor">#</a> FOR LOOPs</h4><p>In the case of FOR loops, the loop variable is locally declared within the loop statement. That means, it is not necessary to declare the variable in the DECLARE section of the PL/SQL block. Furthermore, a variable declared within the DECLARE section of the PL/SQL block will not be used by the FOR loop.</p><p>FOR LOOP</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">FOR</span> var <span class="token operator">IN</span> <span class="token keyword">start</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">end</span>
<span class="token keyword">LOOP</span>
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><p>REVERSE FOR LOOP</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">FOR</span> var <span class="token operator">IN</span> REVERSE <span class="token keyword">end</span> <span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">start</span>
<span class="token keyword">LOOP</span>
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="exception-section"><a href="#exception-section" aria-hidden="true" class="header-anchor">#</a> Exception Section</h3><p>Use the Exception section to handle run-time exceptions.</p><p>This section can be used to catch specific types of pre-defined exceptions or generically catch undefined exceptions.</p><p>Syntax:</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHEN</span> exception_type <span class="token keyword">THEN</span>
</code></pre></div><p>OR</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WHEN</span> OTHERS <span class="token keyword">THEN</span>
</code></pre></div><p>User-defined exceptions can also be defined (in the Declaration section) and raised (in the Body section).</p><h2 id="first-example"><a href="#first-example" aria-hidden="true" class="header-anchor">#</a> First Example</h2><p>For our first program, we will simply display the numbers from 1 to 10 on the output screen.</p><p>A PL/SQL code block executed inside a script is known as an anonymous PL/SQL block.</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> SERVEROUTPUT <span class="token keyword">ON</span> SIZE <span class="token number">4000</span>

<span class="token comment">/* Our First PL/SQL Program */</span>
<span class="token keyword">DECLARE</span>
	countnum BINARY_INTEGER<span class="token punctuation">;</span>
	<span class="token keyword">limit</span> BINARY_INTEGER :<span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">IF</span> <span class="token keyword">limit</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token keyword">THEN</span> <span class="token comment">-- Check the limit value</span>
		DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">'Invalid count limit.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span>
		<span class="token keyword">FOR</span> countvar <span class="token operator">IN</span> <span class="token number">1.</span><span class="token number">.10</span> <span class="token comment">-- variable countvar is declared local for the FOR loop</span>
		<span class="token keyword">LOOP</span>
			DBMS_OUTPUT<span class="token punctuation">.</span>PUT<span class="token punctuation">(</span>countvar <span class="token operator">||</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">CASE</span> countvar
				<span class="token keyword">WHEN</span> <span class="token number">1</span> <span class="token keyword">THEN</span>
					DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">' At the beginning.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">WHEN</span> <span class="token number">5</span> <span class="token keyword">THEN</span>
					DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">' Half way there.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">WHEN</span> <span class="token number">10</span> <span class="token keyword">THEN</span>
					DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">' Last one.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">ELSE</span>
					DBMS_OUTPUT<span class="token punctuation">.</span>NEW_LINE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">END</span> <span class="token keyword">CASE</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
		DBMS_OUTPUT<span class="token punctuation">.</span>NEW_LINE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">-- Print a new line character</span>

		<span class="token comment">-- Repeat the same loop but using LOOP and EXIT WHEN; replace CASE with IF ... ELSIF ... ELSE</span>
		countnum :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">LOOP</span>
			DBMS_OUTPUT<span class="token punctuation">.</span>PUT<span class="token punctuation">(</span>countnum <span class="token operator">||</span> <span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">IF</span> countnum <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">THEN</span>
				DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">' At the beginning.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ELSIF countnum <span class="token operator">=</span> <span class="token number">5</span> <span class="token keyword">THEN</span>
				DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">' Half way there.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ELSIF countnum <span class="token operator">=</span> <span class="token number">10</span> <span class="token keyword">THEN</span>
				DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">' Last one.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">ELSE</span>
				DBMS_OUTPUT<span class="token punctuation">.</span>NEW_LINE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
			<span class="token keyword">EXIT</span> <span class="token keyword">WHEN</span> countnum <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
			countnum :<span class="token operator">=</span> countnum <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>

	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre></div><h2 id="implicit-cursors"><a href="#implicit-cursors" aria-hidden="true" class="header-anchor">#</a> Implicit Cursors</h2><p>The output of a SELECT query can be assigned to an implicit cursor providing the query returns <strong>exactly one row</strong></p><p>Example:</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> SERVEROUTPUT <span class="token keyword">ON</span> SIZE <span class="token number">4000</span>

<span class="token comment">/* Display the name for manager #7566 and the number of employees the manager manages */</span>

<span class="token keyword">DECLARE</span>
	mgrsearch <span class="token keyword">INTEGER</span> :<span class="token operator">=</span> <span class="token number">7566</span><span class="token punctuation">;</span>
	f_ename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span> <span class="token comment">-- define f_ename to have the same type as emp.ename</span>
	a_count <span class="token keyword">INTEGER</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> ename <span class="token keyword">INTO</span> f_ename <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> empno <span class="token operator">=</span> mgrsearch<span class="token punctuation">;</span>
	<span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">INTO</span> a_count <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> mgr <span class="token operator">=</span> mgrsearch<span class="token punctuation">;</span>
	DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span>f_ename <span class="token operator">||</span> <span class="token string">' manages '</span> <span class="token operator">||</span> a_count <span class="token operator">||</span> <span class="token string">' employee(s).'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">-- Could also have used a subquery.  E.g.</span>
	<span class="token keyword">SELECT</span> ename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> mgr <span class="token operator">=</span> mgrsearch<span class="token punctuation">)</span> <span class="token keyword">INTO</span> f_ename<span class="token punctuation">,</span> a_count <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> empno <span class="token operator">=</span> mgrsearch<span class="token punctuation">;</span>
	DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span>f_ename <span class="token operator">||</span> <span class="token string">' manages '</span> <span class="token operator">||</span> a_count <span class="token operator">||</span> <span class="token string">' employee(s).'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
EXCEPTION
	<span class="token keyword">WHEN</span> NO_DATA_FOUND <span class="token keyword">THEN</span>
		DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">'There is no manager with employee number '</span> <span class="token operator">||</span> mgrsearch <span class="token operator">||</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">WHEN</span> OTHERS <span class="token keyword">THEN</span>
		DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">'An unexpected error has occurred.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre></div><p>If the SELECT statement used with an implicit cursor returns zero rows or more than one row, an error results.</p><p>This program displays the name of employee number 7566 as well as how many employees he manages.</p><p>Common exception types include:</p><ul><li>DUP_VAL_ON_INDEX — an attempt was made to store a duplicate column value on a column with a UNIQUE or PRIMARY KEY constraint</li><li>NO_DATA_FOUND — a SELECT ... INTO statement did not return any rows.</li><li>TOO_MANY_ROWS — a SELECT ... INTO statement returned more than one row.</li><li>INVALID_NUMBER — the program has failed to convert a string into a number.</li><li>ZERO_DIVIDE — a divide by zero has occurred.</li></ul><h2 id="creating-a-stored-procedure"><a href="#creating-a-stored-procedure" aria-hidden="true" class="header-anchor">#</a> Creating a Stored Procedure</h2><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> SERVEROUTPUT <span class="token keyword">ON</span> SIZE <span class="token number">4000</span>

<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> MGR_EMP_COUNT
<span class="token punctuation">(</span>
	pmgrsearch <span class="token operator">IN</span> <span class="token keyword">INTEGER</span><span class="token punctuation">,</span>
	pename <span class="token keyword">OUT</span> VARCHAR2<span class="token punctuation">,</span> <span class="token comment">-- define pename to have the same type as emp.ename</span>
	pcount <span class="token keyword">OUT</span> <span class="token keyword">INTEGER</span>
<span class="token punctuation">)</span>
<span class="token operator">IS</span>
	<span class="token comment">-- No local variables to declare</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">SELECT</span> ename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> mgr <span class="token operator">=</span> pmgrsearch<span class="token punctuation">)</span> <span class="token keyword">INTO</span> pename<span class="token punctuation">,</span> pcount <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> empno <span class="token operator">=</span> pmgrsearch<span class="token punctuation">;</span>
EXCEPTION
	<span class="token keyword">WHEN</span> NO_DATA_FOUND <span class="token keyword">THEN</span>
		pename :<span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
		pcount :<span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>

<span class="token comment">/* Display the name for manager #7566 and the number of employees the manager manages */</span>

<span class="token keyword">DECLARE</span>
	mgrsearch <span class="token keyword">INTEGER</span> :<span class="token operator">=</span> <span class="token number">7566</span><span class="token punctuation">;</span>
	f_ename emp<span class="token punctuation">.</span>ename<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span> <span class="token comment">-- define f_ename to have the same type as emp.ename</span>
	a_count <span class="token keyword">INTEGER</span><span class="token punctuation">;</span>
<span class="token keyword">BEGIN</span>
	MGR_EMP_COUNT<span class="token punctuation">(</span>mgrsearch<span class="token punctuation">,</span> f_ename<span class="token punctuation">,</span> a_count<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">IF</span> a_count <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span>
		DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">'There is no manager with employee number '</span> <span class="token operator">||</span> mgrsearch <span class="token operator">||</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">ELSE</span>
		DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span>f_ename <span class="token operator">||</span> <span class="token string">' manages '</span> <span class="token operator">||</span> a_count <span class="token operator">||</span> <span class="token string">' employee(s).'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
EXCEPTION
	<span class="token keyword">WHEN</span> OTHERS <span class="token keyword">THEN</span>
		DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">'An unexpected error has occurred.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre></div><p>A stored procedure can be created using the syntax</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> procedure_name <span class="token punctuation">(</span>parameter_list<span class="token punctuation">)</span> 
<span class="token operator">IS</span>
<span class="token keyword">procedure</span> definition
</code></pre></div><p>Alternatively, to replace a procedure that already exists, use</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> procedure_name <span class="token punctuation">(</span>parameter_list<span class="token punctuation">)</span> 
<span class="token operator">IS</span>
<span class="token keyword">procedure</span> definition
</code></pre></div><p>Each parameter follows the format of a variable declaration in a PL/SQL declaration block but may include a direction. Syntax:</p><div class="language-sql extra-class"><pre class="language-sql"><code>variable direction <span class="token keyword">type</span>
</code></pre></div><p>Stored procedures allow three different parameter directions:</p><ul><li>Input parameters (the default type) — declared using <code>IN</code></li><li>Output parameters — declared using <code>OUT</code></li><li>Input/Output parameters — declared using <code>IN OUT</code></li></ul><p>If no parameter direction is specified, the default direction is <code>IN.</code></p><p>An <strong>input parameter</strong> is passed to the stored procedure from the calling program.</p><p>An <strong>output parameter</strong> is returned to the calling program from the calling program.</p><p>An <strong>input/output parameter</strong> has an initial value that is passed into the procedure from the calling program. The procedure can update the value and then the updated value is returned to the calling program.</p><p>An input parameter can also be made optional by supplying a default value for the parameter. The default value can be NULL.</p><p>E.g.</p><div class="language-sql extra-class"><pre class="language-sql"><code>parameter_name <span class="token keyword">type</span> <span class="token keyword">DEFAULT</span> default_value
</code></pre></div><p>It makes most sense to include all of the default parameters at the end of the parameter list.</p><p>The previous PL/SQL program counted the number of employees a specified manager has. This version repeats that same functionality, but using a stored procedure.</p><p>Note that a stored procedure can be called from outside of a PL/SQL block using the CALL statement.</p><p>E.g.</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CALL</span> procedure_name<span class="token punctuation">(</span>parameter_list<span class="token punctuation">)</span>
</code></pre></div><p>A stored procedure can also be called from within an anonymous PL/SQL block using standard function call notation.</p><p>E.g.</p><div class="language-sql extra-class"><pre class="language-sql"><code>procedure_name<span class="token punctuation">(</span>parameter_list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="deleting-a-stored-procedure"><a href="#deleting-a-stored-procedure" aria-hidden="true" class="header-anchor">#</a> Deleting a stored procedure</h3><p>A stored procedure can be deleted using</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">PROCEDURE</span> procedure_name
</code></pre></div><h2 id="creating-a-user-defined-function-udf"><a href="#creating-a-user-defined-function-udf" aria-hidden="true" class="header-anchor">#</a> Creating a User-Defined Function (UDF)</h2><p>A user-defined function can be created in much the same way as a stored procedure except using CREATE FUNCTION in place of CREATE PROCEDURE and including a return type before the IS clause. Again, the OR REPLACE clause can be included to replace the function if it already exists.</p><p>There are two primary differences between functions and stored procedures:</p><ul><li>A function always returns a value</li><li>A function should not make changes to the database (i.e., no INSERT, UPDATE, or DELETE statements)</li></ul><p>User-defined functions can be used just as any other Oracle function including within a SELECT statement.</p><p>A function has been created to assess whether an employees salary is average, above average, or below average. The function returns one of 'average', 'above average', or 'below average'. Then, the function is used within a SELECT statement to display the employee's name, salary, and whether the salary is average, above average, or below average.</p><h3 id="deleting-a-user-defined-function"><a href="#deleting-a-user-defined-function" aria-hidden="true" class="header-anchor">#</a> Deleting a user-defined function</h3><p>A user-defined function can be deleted using</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DROP</span> <span class="token keyword">FUNCTION</span> function_name
</code></pre></div><h2 id="cursor-for-loop-statement"><a href="#cursor-for-loop-statement" aria-hidden="true" class="header-anchor">#</a> CURSOR FOR Loop Statement</h2><p>The cursor FOR LOOP statement implicitly declares its loop index as a record variable of the row type that a specified cursor returns, and then opens a cursor. With each iteration, the cursor FOR LOOP statement fetches a row from the result set into the record. When there are no more rows to fetch, the cursor FOR LOOP statement closes the cursor. The cursor also closes if a statement inside the loop transfers control outside the loop or raises an exception.</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">FOR</span> <span class="token keyword">cursor</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token keyword">select</span> statement<span class="token punctuation">)</span>
<span class="token keyword">LOOP</span>
…
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="explicit-cursors"><a href="#explicit-cursors" aria-hidden="true" class="header-anchor">#</a> Explicit Cursors</h2><p>Use explicit cursors to retrieve data from SELECT statements that might retrieve multiple rows, or that might return no rows at all.</p><p>Unlike implicit cursors, explicit cursors must be explicitly declared in the program's <strong>Declaration Section</strong>.</p><h3 id="declaring-an-explicit-cursor"><a href="#declaring-an-explicit-cursor" aria-hidden="true" class="header-anchor">#</a> Declaring An Explicit Cursor</h3><p>To declare an explicit cursor, use the syntax:</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CURSOR</span> cursor_name <span class="token operator">IS</span> select_query<span class="token punctuation">;</span>
</code></pre></div><h3 id="opening-an-explicit-cursor"><a href="#opening-an-explicit-cursor" aria-hidden="true" class="header-anchor">#</a> Opening An Explicit Cursor</h3><p>Before being able to retrieve the row values from an explicit cursor, the cursor must be opened. Opening the explicit cursor causes the cursor's SELECT statement to execute. To open an explicit cursor, use the syntax:</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">OPEN</span> cursor_name<span class="token punctuation">;</span>
</code></pre></div><h3 id="fetching-the-data-rows"><a href="#fetching-the-data-rows" aria-hidden="true" class="header-anchor">#</a> Fetching The Data Rows</h3><p>Each row returned by the cursor's SELECT statement must be explicitly fetched to retrieve it. When the cursor is first opened, no rows have been retrieved. Use FETCH to retrieve the first and subsequent rows. The syntax is:</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">FETCH</span> cursor_name <span class="token keyword">INTO</span> variable_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</code></pre></div><p>There must be one variable for each column selected. When an attempt is made to fetch a row after the last row has been retrieved, no record is retrieved and an end condition is set. To test for this end condition, use the expression <code>cursor_name%NOTFOUND</code> (use <code>cursor_name%FOUND</code> to determine if a row has been retrieved).</p><p>Typically, cursors are fetched using a loop to iterate through all of the rows returned.</p><p>E.g.</p><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">FETCH</span> cursor_name <span class="token keyword">INTO</span> variable_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">WHILE</span> cursor_name<span class="token operator">%</span>FOUND <span class="token keyword">LOOP</span>
   <span class="token punctuation">.</span>
   <span class="token punctuation">.</span>
   <span class="token punctuation">.</span>
   <span class="token keyword">FETCH</span> cursor_name <span class="token keyword">INTO</span> variable_name<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>
</code></pre></div><p>The individual variable names in the <code>FETCH</code> can be replace by a <code>ROWTYPE</code> variable (which contains all of the columns of a cursor row). An example of each is given.</p><p>The first example displays each employee's name and indicates whether their salary is average, above average, or below average. The second example list each manager and then a list of their employees with their salary and commission (if applicable) underneath.</p><p>This example includes the <code>TO_CHAR</code> method to display currency information as text. The <code>TO_CHAR</code> function can be used to format numbers and dates by specifying a format model.</p></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/front-end-notebook/assets/js/6.3cd8cfde.js" defer></script><script src="/front-end-notebook/assets/js/app.6994e9bb.js" defer></script>
  </body>
</html>
