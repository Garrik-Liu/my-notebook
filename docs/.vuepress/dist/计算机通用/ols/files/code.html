<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SQL | Garrik 的笔记</title>
    <meta name="description" content="这里是 Garrik 的前端笔记本">
    
    
    <link rel="preload" href="/front-end-notebook/assets/css/97.styles.480fcdf7.css" as="style"><link rel="preload" href="/front-end-notebook/assets/js/app.252f4d3f.js" as="script"><link rel="preload" href="/front-end-notebook/assets/js/18.8ad8dbbc.js" as="script"><link rel="prefetch" href="/front-end-notebook/assets/js/49.171074f4.js"><link rel="prefetch" href="/front-end-notebook/assets/js/1.ae08be35.js"><link rel="prefetch" href="/front-end-notebook/assets/js/2.514d166b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/3.079e7be1.js"><link rel="prefetch" href="/front-end-notebook/assets/js/4.34f72b78.js"><link rel="prefetch" href="/front-end-notebook/assets/js/5.0586b341.js"><link rel="prefetch" href="/front-end-notebook/assets/js/6.68369358.js"><link rel="prefetch" href="/front-end-notebook/assets/js/7.8047d49f.js"><link rel="prefetch" href="/front-end-notebook/assets/js/8.5ed4e6ee.js"><link rel="prefetch" href="/front-end-notebook/assets/js/9.056e3fc6.js"><link rel="prefetch" href="/front-end-notebook/assets/js/10.f33a0f07.js"><link rel="prefetch" href="/front-end-notebook/assets/js/11.f9ea7937.js"><link rel="prefetch" href="/front-end-notebook/assets/js/12.d80e157f.js"><link rel="prefetch" href="/front-end-notebook/assets/js/13.4f3a371a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/14.017708a0.js"><link rel="prefetch" href="/front-end-notebook/assets/js/15.6c91bde3.js"><link rel="prefetch" href="/front-end-notebook/assets/js/16.9be555cd.js"><link rel="prefetch" href="/front-end-notebook/assets/js/17.30a35c61.js"><link rel="prefetch" href="/front-end-notebook/assets/js/19.a334987a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/20.c916aa57.js"><link rel="prefetch" href="/front-end-notebook/assets/js/21.f5d218b2.js"><link rel="prefetch" href="/front-end-notebook/assets/js/22.eb0e9e90.js"><link rel="prefetch" href="/front-end-notebook/assets/js/23.8e60d7a4.js"><link rel="prefetch" href="/front-end-notebook/assets/js/24.6952c4d0.js"><link rel="prefetch" href="/front-end-notebook/assets/js/25.80fccefd.js"><link rel="prefetch" href="/front-end-notebook/assets/js/26.ec6ab30b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/27.7b70120d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/28.2e0fd6b2.js"><link rel="prefetch" href="/front-end-notebook/assets/js/29.4166cad4.js"><link rel="prefetch" href="/front-end-notebook/assets/js/30.a290f3fc.js"><link rel="prefetch" href="/front-end-notebook/assets/js/31.b5879646.js"><link rel="prefetch" href="/front-end-notebook/assets/js/32.ed08362d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/33.95b3e145.js"><link rel="prefetch" href="/front-end-notebook/assets/js/34.98d74f2b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/35.cc4de216.js"><link rel="prefetch" href="/front-end-notebook/assets/js/36.6ade8fdc.js"><link rel="prefetch" href="/front-end-notebook/assets/js/37.fc88da97.js"><link rel="prefetch" href="/front-end-notebook/assets/js/38.2b05bb83.js"><link rel="prefetch" href="/front-end-notebook/assets/js/39.19da5ac5.js"><link rel="prefetch" href="/front-end-notebook/assets/js/40.f00203ca.js"><link rel="prefetch" href="/front-end-notebook/assets/js/41.a0d46148.js"><link rel="prefetch" href="/front-end-notebook/assets/js/42.cc82216c.js"><link rel="prefetch" href="/front-end-notebook/assets/js/43.fc64f9bf.js"><link rel="prefetch" href="/front-end-notebook/assets/js/44.87e0d073.js"><link rel="prefetch" href="/front-end-notebook/assets/js/45.ff2a469c.js"><link rel="prefetch" href="/front-end-notebook/assets/js/46.1142bb6b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/47.2afe6a61.js"><link rel="prefetch" href="/front-end-notebook/assets/js/48.98ca0b87.js"><link rel="prefetch" href="/front-end-notebook/assets/js/0.3b416106.js"><link rel="prefetch" href="/front-end-notebook/assets/js/50.ab80b171.js"><link rel="prefetch" href="/front-end-notebook/assets/js/51.5e504f40.js"><link rel="prefetch" href="/front-end-notebook/assets/js/52.86f63a4e.js"><link rel="prefetch" href="/front-end-notebook/assets/js/53.aafac3e8.js"><link rel="prefetch" href="/front-end-notebook/assets/js/54.605bf8ee.js"><link rel="prefetch" href="/front-end-notebook/assets/js/55.cc22ec7c.js"><link rel="prefetch" href="/front-end-notebook/assets/js/56.c15d2d75.js"><link rel="prefetch" href="/front-end-notebook/assets/js/57.a7d3a743.js"><link rel="prefetch" href="/front-end-notebook/assets/js/58.25a743e7.js"><link rel="prefetch" href="/front-end-notebook/assets/js/59.f7b7587b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/60.58fa9e10.js"><link rel="prefetch" href="/front-end-notebook/assets/js/61.ae649cee.js"><link rel="prefetch" href="/front-end-notebook/assets/js/62.a82ab773.js"><link rel="prefetch" href="/front-end-notebook/assets/js/63.aea9b4f1.js"><link rel="prefetch" href="/front-end-notebook/assets/js/64.4a8ea316.js"><link rel="prefetch" href="/front-end-notebook/assets/js/65.fa1e1992.js"><link rel="prefetch" href="/front-end-notebook/assets/js/66.91e5c6b3.js"><link rel="prefetch" href="/front-end-notebook/assets/js/67.0ae878d6.js"><link rel="prefetch" href="/front-end-notebook/assets/js/68.6f91b0a2.js"><link rel="prefetch" href="/front-end-notebook/assets/js/69.3d7ec5d7.js"><link rel="prefetch" href="/front-end-notebook/assets/js/70.842bf4ca.js"><link rel="prefetch" href="/front-end-notebook/assets/js/71.1ee8eb15.js"><link rel="prefetch" href="/front-end-notebook/assets/js/72.961584b9.js"><link rel="prefetch" href="/front-end-notebook/assets/js/73.28b79670.js"><link rel="prefetch" href="/front-end-notebook/assets/js/74.d520fc3a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/75.4cc24201.js"><link rel="prefetch" href="/front-end-notebook/assets/js/76.61d253d6.js"><link rel="prefetch" href="/front-end-notebook/assets/js/77.3cb28b09.js"><link rel="prefetch" href="/front-end-notebook/assets/js/78.bad02b83.js"><link rel="prefetch" href="/front-end-notebook/assets/js/79.d6b8b0fd.js"><link rel="prefetch" href="/front-end-notebook/assets/js/80.27548082.js"><link rel="prefetch" href="/front-end-notebook/assets/js/81.12864861.js"><link rel="prefetch" href="/front-end-notebook/assets/js/82.dd34f179.js"><link rel="prefetch" href="/front-end-notebook/assets/js/83.0cbae32d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/84.080897f3.js"><link rel="prefetch" href="/front-end-notebook/assets/js/85.6bfc3d2d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/86.7b9617be.js"><link rel="prefetch" href="/front-end-notebook/assets/js/87.eb0717ca.js"><link rel="prefetch" href="/front-end-notebook/assets/js/88.c98a87f2.js"><link rel="prefetch" href="/front-end-notebook/assets/js/89.86b9978a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/90.657c27e0.js"><link rel="prefetch" href="/front-end-notebook/assets/js/91.ee40782a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/92.d91ac8c3.js"><link rel="prefetch" href="/front-end-notebook/assets/js/93.f039a9cb.js"><link rel="prefetch" href="/front-end-notebook/assets/js/94.686d081f.js"><link rel="prefetch" href="/front-end-notebook/assets/js/95.8606abb1.js"><link rel="prefetch" href="/front-end-notebook/assets/js/96.96c651f8.js">
    <link rel="stylesheet" href="/front-end-notebook/assets/css/97.styles.480fcdf7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/front-end-notebook/" class="home-link router-link-active"><!----><span class="site-name">
      Garrik 的笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end-notebook/" class="nav-link">主页</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end-notebook/" class="nav-link">主页</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>SQL</span><!----></p><ul class="sidebar-group-items"></ul></div></li></ul></div><div class="page"><div class="content"><h3 id="sql"><a href="#sql" aria-hidden="true" class="header-anchor">#</a> SQL</h3><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">VIEW</span> emp_per_dept <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> dname<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>emp<span class="token punctuation">.</span>deptno<span class="token punctuation">)</span> <span class="token keyword">AS</span> num_emps
<span class="token keyword">FROM</span> emp <span class="token keyword">RIGHT</span> <span class="token keyword">JOIN</span> dept <span class="token keyword">ON</span> emp<span class="token punctuation">.</span>deptno <span class="token operator">=</span> dept<span class="token punctuation">.</span>deptno
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> dept<span class="token punctuation">.</span>deptno<span class="token punctuation">,</span> dname
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> dname <span class="token keyword">ASC</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> UPDATE_EMPLOYEE
<span class="token punctuation">(</span>
	pEmpno <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span>
	pEname <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span>
	pJob <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span>
	pMgr <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span>
	pHiredate <span class="token operator">IN</span> <span class="token keyword">DATE</span><span class="token punctuation">,</span>
	pSal <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span>
	pComm <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span>
	pDeptno <span class="token operator">IN</span> NUMBER
<span class="token punctuation">)</span>
<span class="token operator">IS</span>
<span class="token keyword">BEGIN</span>
	<span class="token keyword">UPDATE</span> emp <span class="token keyword">SET</span> ename <span class="token operator">=</span> pEname<span class="token punctuation">,</span>
		job <span class="token operator">=</span> pJob<span class="token punctuation">,</span>
		mgr <span class="token operator">=</span> pMgr<span class="token punctuation">,</span>
		hiredate <span class="token operator">=</span> pHiredate<span class="token punctuation">,</span>
		sal <span class="token operator">=</span> pSal<span class="token punctuation">,</span>
		comm <span class="token operator">=</span> pComm<span class="token punctuation">,</span>
		deptno <span class="token operator">=</span> pDeptno
	<span class="token keyword">WHERE</span> empno <span class="token operator">=</span> pEmpno<span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>

<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> PACKAGE emp_dept_package <span class="token operator">IS</span>
   <span class="token keyword">PROCEDURE</span> create_new_employee<span class="token punctuation">(</span>new_empno <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span> new_ename <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> new_job <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> 
         new_mgr <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> new_hiredate <span class="token operator">IN</span> <span class="token keyword">DATE</span><span class="token punctuation">,</span> new_sal <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span> new_comm <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span> 
         new_dept <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> new_dept_loc <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">PROCEDURE</span> create_department<span class="token punctuation">(</span>new_dname <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> new_loc <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">FUNCTION</span> find_employee<span class="token punctuation">(</span>ename_to_find VARCHAR2<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> NUMBER<span class="token punctuation">;</span>
   <span class="token keyword">FUNCTION</span> find_department<span class="token punctuation">(</span>dname_to_find <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> NUMBER<span class="token punctuation">;</span>
   <span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>

<span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> PACKAGE BODY emp_dept_package <span class="token operator">IS</span>
   last_deptno dept<span class="token punctuation">.</span>deptno<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span>

   <span class="token keyword">PROCEDURE</span> create_department<span class="token punctuation">(</span>new_dname <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> new_loc <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">)</span> <span class="token operator">IS</span>
      new_deptno dept<span class="token punctuation">.</span>deptno<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span>
   <span class="token keyword">BEGIN</span>
      <span class="token keyword">SELECT</span> <span class="token function">MAX</span><span class="token punctuation">(</span>deptno<span class="token punctuation">)</span> <span class="token keyword">INTO</span> last_deptno <span class="token keyword">FROM</span> dept<span class="token punctuation">;</span>
      new_deptno :<span class="token operator">=</span> last_deptno <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
      <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> dept <span class="token punctuation">(</span>deptno<span class="token punctuation">,</span> dname<span class="token punctuation">,</span> loc<span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>new_deptno<span class="token punctuation">,</span> new_dname<span class="token punctuation">,</span> new_loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
      last_deptno :<span class="token operator">=</span> new_deptno<span class="token punctuation">;</span>
   <span class="token keyword">END</span><span class="token punctuation">;</span>
   
   <span class="token keyword">FUNCTION</span> find_department<span class="token punctuation">(</span>dname_to_find <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> NUMBER <span class="token operator">IS</span>
      <span class="token keyword">CURSOR</span> dept_cursor <span class="token operator">IS</span> <span class="token keyword">SELECT</span> deptno <span class="token keyword">FROM</span> dept <span class="token keyword">WHERE</span> dname <span class="token operator">=</span> dname_to_find<span class="token punctuation">;</span>
      found_deptno dept<span class="token punctuation">.</span>deptno<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span>
   <span class="token keyword">BEGIN</span>
      <span class="token keyword">OPEN</span> dept_cursor<span class="token punctuation">;</span>
      <span class="token keyword">FETCH</span> dept_cursor <span class="token keyword">INTO</span> found_deptno<span class="token punctuation">;</span>
      <span class="token keyword">IF</span> dept_cursor<span class="token operator">%</span>NOTFOUND <span class="token keyword">THEN</span>
         found_deptno :<span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
      <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
      <span class="token keyword">CLOSE</span> dept_cursor<span class="token punctuation">;</span>
      <span class="token keyword">RETURN</span> found_deptno<span class="token punctuation">;</span>
   <span class="token keyword">END</span><span class="token punctuation">;</span>
   
   <span class="token keyword">FUNCTION</span> find_employee<span class="token punctuation">(</span>ename_to_find <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">)</span> <span class="token keyword">RETURN</span> NUMBER <span class="token operator">IS</span>
      <span class="token keyword">CURSOR</span> emp_cursor <span class="token operator">IS</span> <span class="token keyword">SELECT</span> empno <span class="token keyword">FROM</span> emp <span class="token keyword">WHERE</span> ename <span class="token operator">=</span> ename_to_find<span class="token punctuation">;</span>
      f_emp emp_cursor<span class="token operator">%</span>ROWTYPE<span class="token punctuation">;</span>
      found_empno emp<span class="token punctuation">.</span>empno<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span>
   <span class="token keyword">BEGIN</span>
      <span class="token keyword">OPEN</span> emp_cursor<span class="token punctuation">;</span>
      <span class="token keyword">FETCH</span> emp_cursor <span class="token keyword">INTO</span> f_emp<span class="token punctuation">;</span>
      <span class="token keyword">IF</span> emp_cursor<span class="token operator">%</span>FOUND <span class="token keyword">THEN</span>
         found_empno :<span class="token operator">=</span> f_emp<span class="token punctuation">.</span>empno<span class="token punctuation">;</span>
      <span class="token keyword">ELSE</span>
         found_empno :<span class="token operator">=</span> <span class="token boolean">NULL</span><span class="token punctuation">;</span>
      <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
      <span class="token keyword">CLOSE</span> emp_cursor<span class="token punctuation">;</span>
      <span class="token keyword">RETURN</span> found_empno<span class="token punctuation">;</span>
   <span class="token keyword">END</span><span class="token punctuation">;</span>
   
   <span class="token keyword">PROCEDURE</span> create_new_employee<span class="token punctuation">(</span>new_empno <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span> new_ename <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> new_job <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> 
         new_mgr <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> new_hiredate <span class="token operator">IN</span> <span class="token keyword">DATE</span><span class="token punctuation">,</span> new_sal <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span> new_comm <span class="token operator">IN</span> NUMBER<span class="token punctuation">,</span> 
         new_dept <span class="token operator">IN</span> VARCHAR2<span class="token punctuation">,</span> new_dept_loc VARCHAR2<span class="token punctuation">)</span> <span class="token operator">IS</span>
      new_deptno dept<span class="token punctuation">.</span>deptno<span class="token operator">%</span><span class="token keyword">TYPE</span><span class="token punctuation">;</span>
   <span class="token keyword">BEGIN</span>
      new_deptno :<span class="token operator">=</span> find_department<span class="token punctuation">(</span>new_dept<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">IF</span> new_deptno <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token keyword">THEN</span>
         create_department<span class="token punctuation">(</span>new_dept<span class="token punctuation">,</span> new_dept_loc<span class="token punctuation">)</span><span class="token punctuation">;</span>
         new_deptno :<span class="token operator">=</span> last_deptno<span class="token punctuation">;</span>
      <span class="token keyword">END</span> <span class="token keyword">IF</span><span class="token punctuation">;</span>
      <span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp <span class="token punctuation">(</span>empno<span class="token punctuation">,</span> ename<span class="token punctuation">,</span> job<span class="token punctuation">,</span> mgr<span class="token punctuation">,</span> hiredate<span class="token punctuation">,</span> sal<span class="token punctuation">,</span> comm<span class="token punctuation">,</span> deptno<span class="token punctuation">)</span>
      <span class="token keyword">VALUES</span> <span class="token punctuation">(</span>new_empno<span class="token punctuation">,</span> new_ename<span class="token punctuation">,</span> new_job<span class="token punctuation">,</span> find_employee<span class="token punctuation">(</span>new_mgr<span class="token punctuation">)</span><span class="token punctuation">,</span> new_hiredate<span class="token punctuation">,</span> new_sal<span class="token punctuation">,</span> new_comm<span class="token punctuation">,</span> new_deptno<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token keyword">END</span><span class="token punctuation">;</span>
<span class="token operator">/</span>
</code></pre></div><h3 id="editempproj-class"><a href="#editempproj-class" aria-hidden="true" class="header-anchor">#</a> EditEmpProj Class</h3><div class="language-c++ extra-class"><pre class="language-text"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace EditEmpProj
{
    public class Employee
    {
        public int EmpNo { get; set; }
        public string Ename { get; set; }
        public string Job { get; set; }
        public int? Mgr { get; set; }
        public DateTime Hiredate { get; set; }
        public decimal Sal { get; set; }
        public decimal? Comm { get; set; }
        public int DeptNo { get; set; }

        public Employee(int EmpNo, string Ename, string Job, int? Mgr, DateTime Hiredate, decimal Sal, decimal? Comm, int DeptNo)
        {
            this.EmpNo = EmpNo;
            this.Ename = Ename;
            this.Job = Job;
            this.Mgr = Mgr;
            this.Hiredate = Hiredate;
            this.Sal = Sal;
            this.Comm = Comm;
            this.DeptNo = DeptNo;
        }
    }
}
</code></pre></div><h3 id="editempproj-dao"><a href="#editempproj-dao" aria-hidden="true" class="header-anchor">#</a> EditEmpProj DAO</h3><div class="language-c++ extra-class"><pre class="language-text"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Data;
using System.Data.OracleClient;

namespace EditEmpProj
{
    public class EmployeeDAO
    {
        private string UserName { get; set; }
        private string Password { get; set; }

        public EmployeeDAO(string UserName, string Password)
        {
            this.UserName = UserName;
            this.Password = Password;
        }

        // The code here is used by several of the procedures below.  Note that the
        // SELECT statements used must include the SAME columns that are being read here.
        private Employee FillFromDataRow(DataRow dr)
        {
            int empno = Convert.ToInt32(dr[&quot;empno&quot;]);
            string ename = Convert.ToString(dr[&quot;ename&quot;]);
            string job = Convert.ToString(dr[&quot;job&quot;]);
            DateTime hiredate = Convert.ToDateTime(dr[&quot;hiredate&quot;]);
            decimal sal = Convert.ToDecimal(dr[&quot;sal&quot;]);
            int deptno = Convert.ToInt32(dr[&quot;deptno&quot;]);
            int? mgr;
            decimal? comm;
            if (dr.IsNull(&quot;mgr&quot;))
                mgr = null;
            else
                mgr = Convert.ToInt32(dr[&quot;mgr&quot;]);
            if (dr.IsNull(&quot;comm&quot;))
                comm = null;
            else
                comm = Convert.ToDecimal(dr[&quot;comm&quot;]);
            return new Employee(empno, ename, job, mgr, hiredate, sal, comm, deptno);
        }

        public List&lt;Employee&gt; FillFromDataTable(DataTable dt)
        {
            List&lt;Employee&gt; employees = new List&lt;Employee&gt;();

            foreach (DataRow dr in dt.Rows)
            {
                Employee employee = FillFromDataRow(dr);
                employees.Add(employee);
            }
            return employees;
        }

        public List&lt;Employee&gt; LoadAll()
        {
            OracleConnection conn = new OracleConnection(String.Format(&quot;Data Source=Neptune; User Id={0}; Password={1}&quot;, UserName, Password));
            OracleCommand cmd = new OracleCommand(&quot;SELECT empno, ename, job, mgr, hiredate, sal, comm, deptno FROM emp ORDER BY ename ASC&quot;, conn);
            OracleDataAdapter da = new OracleDataAdapter(cmd);
            DataTable dt = new DataTable();

            da.Fill(dt);
            return FillFromDataTable(dt);
        }

        public List&lt;Employee&gt; FindByDepartmentNo(int DeptNo)
        {
            OracleConnection conn = new OracleConnection(String.Format(&quot;Data Source=Neptune; User Id={0}; Password={1}&quot;, UserName, Password));
            OracleCommand cmd = new OracleCommand(&quot;SELECT empno, ename, job, mgr, hiredate, sal, comm, deptno FROM emp WHERE deptno = :deptno ORDER BY ename ASC&quot;, conn);
            OracleDataAdapter da = new OracleDataAdapter(cmd);
            DataTable dt = new DataTable();

            cmd.Parameters.AddWithValue(&quot;:deptno&quot;, DeptNo);
            da.Fill(dt);
            return FillFromDataTable(dt);
        }

        public Employee FindByEmployeeNo(int EmpNo)
        {
            OracleConnection conn = new OracleConnection(String.Format(&quot;Data Source=Neptune; User Id={0}; Password={1}&quot;, UserName, Password));
            OracleCommand cmd = new OracleCommand(&quot;SELECT empno, ename, job, mgr, hiredate, sal, comm, deptno FROM emp WHERE empno = :empno&quot;, conn);
            OracleDataAdapter da = new OracleDataAdapter(cmd);
            DataTable dt = new DataTable();

            cmd.Parameters.AddWithValue(&quot;:empno&quot;, EmpNo);
            da.Fill(dt);

            if (dt.Rows.Count &gt; 0)
            {
                DataRow dr = dt.Rows[0];
                Employee employee = FillFromDataRow(dr);
                return employee;
            }
            else
                return null;
        }

        public void SaveEmployee(Employee employee)
        {
            OracleConnection conn = new OracleConnection(String.Format(&quot;Data Source=Neptune; User Id={0}; Password={1}&quot;, UserName, Password));
            OracleCommand cmd = new OracleCommand(&quot;UPDATE_EMPLOYEE&quot;, conn);

            cmd.CommandType = CommandType.StoredProcedure;
            cmd.Parameters.AddWithValue(&quot;pEmpno&quot;, employee.EmpNo);
            cmd.Parameters.AddWithValue(&quot;pEname&quot;, employee.Ename);
            cmd.Parameters.AddWithValue(&quot;pJob&quot;, employee.Job);

            if (employee.Mgr.HasValue)
                cmd.Parameters.AddWithValue(&quot;pMgr&quot;, employee.Mgr.Value);
            else
                cmd.Parameters.AddWithValue(&quot;pMgr&quot;, DBNull.Value);
            cmd.Parameters.AddWithValue(&quot;pHiredate&quot;, employee.Hiredate);
            cmd.Parameters.AddWithValue(&quot;pSal&quot;, employee.Sal);
            if (employee.Comm.HasValue)
                cmd.Parameters.AddWithValue(&quot;pComm&quot;, employee.Comm.Value);
            else
                cmd.Parameters.AddWithValue(&quot;pComm&quot;, DBNull.Value);
            cmd.Parameters.AddWithValue(&quot;pDeptno&quot;, employee.DeptNo);

            conn.Open();
            try
            {
                cmd.ExecuteNonQuery();
            }
            finally
            {
                conn.Close();
            }
        }

        public void CreateEmployee(int EmpNo, string Ename, string Job, string Mname, DateTime Hiredate, decimal Sal, decimal? Comm, string Dname, string Loc)
        {
            OracleConnection conn = new OracleConnection(String.Format(&quot;Data Source=Neptune; User Id={0}; Password={1}&quot;, UserName, Password));
            OracleCommand cmd = new OracleCommand(&quot;emp_dept_package.create_new_employee&quot;, conn);
            OracleCommand cmdFindDept = new OracleCommand(&quot;emp_dept_package.find_department&quot;, conn);

            cmdFindDept.CommandType = CommandType.StoredProcedure;
            cmdFindDept.Parameters.AddWithValue(&quot;dname_to_find&quot;, Dname);
            cmdFindDept.Parameters.Add(&quot;found_deptno&quot;, OracleType.Int32).Direction = ParameterDirection.ReturnValue;

            conn.Open();
            try
            {
                if (null == Loc)
                {
                    cmdFindDept.ExecuteNonQuery();
                    if (Convert.IsDBNull(cmdFindDept.Parameters[&quot;found_deptno&quot;].Value))
                        throw new ArgumentException(&quot;Invalid Department Location&quot;);
                }

                cmd.CommandType = CommandType.StoredProcedure;
                cmd.Parameters.AddWithValue(&quot;new_empno&quot;, EmpNo);
                cmd.Parameters.AddWithValue(&quot;new_ename&quot;, Ename.ToUpper());
                cmd.Parameters.AddWithValue(&quot;new_job&quot;, Job.ToUpper());

                cmd.Parameters.AddWithValue(&quot;new_mgr&quot;, Mname.ToUpper()); // A &quot;&quot; value will be interpreted as NULL in Oracle
                cmd.Parameters.AddWithValue(&quot;new_hiredate&quot;, Hiredate);
                cmd.Parameters.AddWithValue(&quot;new_sal&quot;, Sal);
                if (Comm.HasValue)
                    cmd.Parameters.AddWithValue(&quot;new_comm&quot;, Comm.Value);
                else
                    cmd.Parameters.AddWithValue(&quot;new_comm&quot;, DBNull.Value);
                cmd.Parameters.AddWithValue(&quot;new_dept&quot;, Dname.ToUpper());
                cmd.Parameters.AddWithValue(&quot;new_dept_loc&quot;, Loc.ToUpper()); // A &quot;&quot; value will be interpreted as NULL in Oracle
                cmd.ExecuteNonQuery(); // Transaction is committed automatically (Auto Commit mode)
            }
            finally
            {
                conn.Close();
            }
        }
    }
}
</code></pre></div><h3 id="department-class"><a href="#department-class" aria-hidden="true" class="header-anchor">#</a> Department Class</h3><div class="language-c++ extra-class"><pre class="language-text"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;

namespace EditEmpProj
{
    public class Department
    {
        public int DeptNo { get; set; }
        public string Dname { get; set; }
        public string Loc { get; set; }

        public Department(int Deptno, string Dname, string Loc)
        {
            this.DeptNo = Deptno;
            this.Dname = Dname;
            this.Loc = Loc;
        }
    }
}
</code></pre></div><h3 id="departmemt-dao"><a href="#departmemt-dao" aria-hidden="true" class="header-anchor">#</a> Departmemt DAO</h3><div class="language-c++ extra-class"><pre class="language-text"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Data;
using System.Data.OracleClient;

namespace EditEmpProj
{
    public class DepartmentDAO
    {
        private string UserName { get; set; }
        private string Password { get; set; }

        public DepartmentDAO(string UserName, string Password)
        {
            this.UserName = UserName;
            this.Password = Password;
        }

        public List&lt;Department&gt; LoadAll()
        {
            OracleConnection conn = new OracleConnection(String.Format(&quot;Data Source=Neptune; User Id={0}; Password={1}&quot;, UserName, Password));
            OracleCommand cmd = new OracleCommand(&quot;SELECT deptno, dname, loc FROM dept&quot;, conn);
            OracleDataAdapter da = new OracleDataAdapter(cmd);
            DataTable dt = new DataTable();
            List&lt;Department&gt; departments = new List&lt;Department&gt;();

            da.Fill(dt);

            foreach(DataRow dr in dt.Rows)
            {
                int deptno = Convert.ToInt32(dr[&quot;deptno&quot;]);
                string dname = Convert.ToString(dr[&quot;dname&quot;]);
                string loc = Convert.ToString(dr[&quot;loc&quot;]);
                departments.Add(new Department(deptno, dname, loc));
            }
            return departments;
        }

        public List&lt;DepartmentInfo&gt; LoadAllDepartmentInfo()
        {
            OracleConnection conn = new OracleConnection(String.Format(&quot;Data Source=Neptune; User Id={0}; Password={1}&quot;, UserName, Password));
            OracleCommand cmd = new OracleCommand(&quot;SELECT deptno, dname, num_emps FROM emp_per_dept&quot;, conn);
            OracleDataAdapter da = new OracleDataAdapter(cmd);
            DataTable dt = new DataTable();
            List&lt;DepartmentInfo&gt; deptinfos = new List&lt;DepartmentInfo&gt;();

            da.Fill(dt);

            foreach (DataRow dr in dt.Rows)
            {
                int deptno = Convert.ToInt32(dr[&quot;deptno&quot;]);
                string dname = Convert.ToString(dr[&quot;dname&quot;]);
                int numemps = Convert.ToInt32(dr[&quot;num_emps&quot;]);
                deptinfos.Add(new DepartmentInfo(deptno, dname, numemps));
            }
            return deptinfos;
        }

        public bool DeleteDepartment(int DeptNo)
        {
            OracleConnection conn = new OracleConnection(String.Format(&quot;Data Source=Neptune; User Id={0}; Password={1}&quot;, UserName, Password));
            OracleCommand cmdDeleteEmployees = new OracleCommand(&quot;DELETE FROM emp WHERE deptno = :deptno&quot;, conn);
            OracleCommand cmdDeleteDepartment = new OracleCommand(&quot;DELETE FROM dept WHERE deptno = :deptno&quot;, conn);
            OracleTransaction trans;

            cmdDeleteEmployees.Parameters.AddWithValue(&quot;:deptno&quot;, DeptNo);
            cmdDeleteDepartment.Parameters.AddWithValue(&quot;:deptno&quot;, DeptNo);

            // Use transaction processing to make sure employees and department are deleted as part of the same transaction
            // Note that employees in the department cannot be deleted if there is an employee who is a manager to other employees outside of the department
            conn.Open();
            trans = conn.BeginTransaction();
            cmdDeleteEmployees.Transaction = trans;
            cmdDeleteDepartment.Transaction = trans;
            try
            {
                cmdDeleteEmployees.ExecuteNonQuery();
                cmdDeleteDepartment.ExecuteNonQuery();
                trans.Commit();
                return true;
            }
            catch (Exception)
            {
                trans.Rollback();
                return false;
            }
            finally
            {
                if (conn.State == ConnectionState.Open)
                    conn.Close();
            }
        }
    }
}
</code></pre></div><h3 id="home-page"><a href="#home-page" aria-hidden="true" class="header-anchor">#</a> Home Page</h3><div class="language-c++ extra-class"><pre class="language-text"><code>using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace EditEmpProj
{
    public partial class Home : BasePage
    {
        protected void Page_Load(object sender, EventArgs e)
        {
            if (!IsPostBack)
            {
                GetEmployeesData();
                GetDepartmentsData();
            }
        }

        protected void gvEmployees_RowCommand(object sender, GridViewCommandEventArgs e)
        {
            if (&quot;EDIT&quot; == e.CommandName)
            {
                int index = Convert.ToInt32(e.CommandArgument); // The row of the button that was clicked
                int empno = Convert.ToInt32(gvEmployees.Rows[index].Cells[1].Text); // Get the employee number from the second column of the grid view
                Response.Redirect(String.Format(&quot;~/EditEmployee.aspx?empno={0}&quot;, empno)); // Redirect using a URL-encoded parameter (?empno=value).
            }
        }

        protected void btnLogout_Click(object sender, EventArgs e)
        {
            Session.Abandon();
            Response.Redirect(&quot;~/Home.aspx&quot;);
        }

        private void GetEmployeesData()
        {
            LoginInfo login = (LoginInfo)Session[&quot;login&quot;];
            EmployeeDAO employeeDAO = new EmployeeDAO(login.UserName, login.Password);

            gvEmployees.DataSource = employeeDAO.LoadAll();
            gvEmployees.DataBind();
        }

        private void GetDepartmentsData()
        {
            LoginInfo login = (LoginInfo)Session[&quot;login&quot;];
            DepartmentDAO departmentDAO = new DepartmentDAO(login.UserName, login.Password);

            gvDepartments.DataSource = departmentDAO.LoadAllDepartmentInfo();
            gvDepartments.Columns[0].Visible = true; // Make sure the department number column is visible for binding so column will get a value
            gvDepartments.DataBind();
            gvDepartments.Columns[0].Visible = false; // Hide the department number column AFTER binding so column value will be present for RowCommand
        }

        protected void gvDepartments_RowCommand(object sender, GridViewCommandEventArgs e)
        {
            if (&quot;DELETE&quot; == e.CommandName)
            {
                LoginInfo login = (LoginInfo)Session[&quot;login&quot;];
                DepartmentDAO departmentDAO = new DepartmentDAO(login.UserName, login.Password);

                int index = Convert.ToInt32(e.CommandArgument); // The row of the button that was clicked
                int deptno = Convert.ToInt32(gvDepartments.Rows[index].Cells[0].Text); // Get the department number from the first (hidden) column of the grid view

                if (departmentDAO.DeleteDepartment(deptno))
                {
                    // Must reload grid data to show employees and department have been deleted
                    GetEmployeesData();
                    GetDepartmentsData();
                }
                else
                    lblNoDelete.Visible = true;
            }
        }

        protected void gvDepartments_RowDeleting(object sender, GridViewDeleteEventArgs e)
        {

        }
    }
}
</code></pre></div><p><img src="https://i.imgur.com/0XKvtbn.png" alt="Screen Shot 2018-08-16 at 11.37.48 AM"></p><h3 id="sys-refcursor"><a href="#sys-refcursor" aria-hidden="true" class="header-anchor">#</a> SYS_REFCURSOR</h3><p>To create a SYS_REFCURSOR, define a SYS_REFCURSOR variable and then OPEN a SELECT statement for that cursor. E.g.</p><div class="language-c++ extra-class"><pre class="language-text"><code>my_cursor SYS_REFCURSOR -- In the declarations section
BEGIN
   OPEN my_cursor FOR SELECT empno, ename, sal, job, deptno FROM emp ORDER BY ename ASC;
   Return my_cursor;
END;
</code></pre></div><p>Notice in the above example that the cursor is opened but not closed. The active cursor is returned to the ASP.NET program. There, an OracleDataReader object is created using the cursor to read the results.</p><div class="language-c++ extra-class"><pre class="language-text"><code>Dim cmd As New OracleCommand(&quot;emp_dept_package.get_employees&quot;, conn) ' Where conn is the OracleConnection object
Dim dr As OracleDataReader

cmd.CommandType = CommandType.StoredProcedure
cmd.Parameters.Add(&quot;emp_cursor&quot;, OracleType.Cursor).Direction = ParameterDirection.ReturnValue
conn.Open()
cmd.ExecuteNonQuery()

dr = cmd.ExecuteReader(CommandBehavior.CloseConnection)
</code></pre></div><p>A data grid can be filled from the OracleDataReader in much the same way it was filled from the DataTable. That is</p><div class="language-c++ extra-class"><pre class="language-text"><code>gv.DataSource = dr ' Where gv is the GridView control
gv.DataBind()
dr.Close() ' Also closes connection thanks to CommandBehaviour.CloseConnection
</code></pre></div><p>If OUT parameters are used, then multiple cursors can be returned from a stored procedure or function.</p></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/front-end-notebook/assets/js/18.8ad8dbbc.js" defer></script><script src="/front-end-notebook/assets/js/app.252f4d3f.js" defer></script>
  </body>
</html>
