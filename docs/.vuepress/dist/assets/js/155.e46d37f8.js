(window.webpackJsonp=window.webpackJsonp||[]).push([[155],{362:function(s,i,e){"use strict";e.r(i);var o=e(0),v=Object(o.a)({},(function(){var s=this,i=s.$createElement,e=s._self._c||i;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"cookie-session"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie-session"}},[s._v("#")]),s._v(" Cookie & Session")]),s._v(" "),e("h2",{attrs:{id:"会话技术"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#会话技术"}},[s._v("#")]),s._v(" 会话技术")]),s._v(" "),e("p",[s._v("什么是会话：")]),s._v(" "),e("ul",[e("li",[s._v("用户点开一个页面；")]),s._v(" "),e("li",[s._v("点击多个超链接，访问服务器资源；")]),s._v(" "),e("li",[s._v("关闭页面；")]),s._v(" "),e("li",[s._v("上面的整个过程，称之为会话；")])]),s._v(" "),e("p",[s._v("会话技术解决什么问题：")]),s._v(" "),e("ul",[e("li",[s._v("每个用户在使用浏览器与服务器进行会话的过程中；")]),s._v(" "),e("li",[s._v("不可避免的会产生一些数据；")]),s._v(" "),e("li",[s._v("程序需要有办法保存下这些数据；")]),s._v(" "),e("li",[s._v("也就是一种保存客户端对服务器的访问状态的机制；")]),s._v(" "),e("li",[s._v("会话技术就是用来做这个的；")])]),s._v(" "),e("p",[s._v("ServletContext 域存在的问题：")]),s._v(" "),e("ul",[e("li",[s._v("前面说过 ServletContext 域也可以存取每次请求相关的数据；")]),s._v(" "),e("li",[s._v("服务器提供服务时，ServletContext 域一直存在，它的生命周期比较长；")]),s._v(" "),e("li",[s._v("它会在整个服务器关闭的时候销毁；")]),s._v(" "),e("li",[s._v("当其接收到多个客户端发过来的请求时，会把各自的信息都存下来；")]),s._v(" "),e("li",[s._v("这容易造成各个客户端之间的数据混淆；")]),s._v(" "),e("li",[s._v("浪费服务器储存空间；")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-3-22-25-6.png",alt:"2020-2-3-22-25-6.png"}})]),s._v(" "),e("h2",{attrs:{id:"cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[s._v("#")]),s._v(" Cookie")]),s._v(" "),e("h3",{attrs:{id:"什么是-cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是-cookie"}},[s._v("#")]),s._v(" 什么是 Cookie")]),s._v(" "),e("ul",[e("li",[s._v("cookie 是客户端请求服务器时；")]),s._v(" "),e("li",[s._v("服务端记录的用户信息，并响应回来，存储在客户端；")]),s._v(" "),e("li",[s._v("下一次客户端发送请求时会将 cookie 一起发送；")]),s._v(" "),e("li",[s._v("具体过程：\n"),e("ul",[e("li",[s._v("客户端第一次访问服务器的时候, 不携带 cookie；")]),s._v(" "),e("li",[s._v("服务器接到请求后, 会记录用户的信息, 然后在响应头中设置 "),e("code",[s._v("set-cookie")]),s._v(" 头部. 客户端收到后进行储存；")]),s._v(" "),e("li",[s._v("下一次再请求服务器时请求头中会加上 "),e("code",[s._v("cookie")]),s._v(" 这一项；")]),s._v(" "),e("li",[s._v("服务器通过 "),e("code",[s._v("cookie")]),s._v(" 判断客户端是否曾经访问过该网站。")])])]),s._v(" "),e("li",[s._v("cookie 是有时限的。称为持久化时间：\n"),e("ul",[e("li",[s._v("通过属性 "),e("code",[s._v("maxAge")]),s._v(" 可以设置 cookie 的存储时间，超过时间后 cookie 会被删除；")]),s._v(" "),e("li",[s._v("如果不设置持久化时间，cookie 存在浏览器内存中，在会话结束后（页面关闭）cookie 就会被销毁；")]),s._v(" "),e("li",[s._v("持久化后，cookie 存在计算机磁盘文件中；")])])])]),s._v(" "),e("h3",{attrs:{id:"在-java-中使用-cookie"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-java-中使用-cookie"}},[s._v("#")]),s._v(" 在 Java 中使用 Cookie")]),s._v(" "),e("p",[e("strong",[s._v("创建 cookie")]),s._v("：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v('Cookie c = new Cookie("key", "value")')])])]),s._v(" "),e("p",[e("strong",[s._v("设置持久化时间")]),s._v("：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("cookie.setMaxAge(int second)")]),s._v(";")]),s._v(" "),e("li",[s._v("设置的时间单位为秒；")])]),s._v(" "),e("p",[e("strong",[s._v("响应给浏览器")]),s._v("：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("response.addCookie(cookie)")])])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-4-0-52-39.png",alt:"2020-2-4-0-52-39.png"}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-4-0-20-7.png",alt:"2020-2-4-0-20-7.png"}})]),s._v(" "),e("p",[e("strong",[s._v("设置 Cookie 的携带路径")]),s._v("：")]),s._v(" "),e("ul",[e("li",[s._v("对于不需要 cookie 信息的资源访问，携带 cookie 会造成数据传输量的加大，降低效率和速度；")]),s._v(" "),e("li",[s._v("默认情况下，会在访问与创建 cookie 的 Web 资源有相同路径的资源时，都携带 cookie 信息；\n"),e("ul",[e("li",[s._v("🌰 例如：创建 cookie 的 Servlet 地址是 "),e("code",[s._v("http://localhost:8080/xxx/CookieServlet")]),s._v(";")]),s._v(" "),e("li",[s._v("那么只要访问的资源，前面路径是 "),e("code",[s._v("http://localhost:8080/xxx/")]),s._v(" 那么都会携带上 cookie 信息；")]),s._v(" "),e("li",[s._v("比方说 "),e("code",[s._v("http://localhost:8080/xxx/LoginServlet")]),s._v(" 就会有 cookie 信息；")]),s._v(" "),e("li",[s._v("但是 "),e("code",[s._v("http://localhost:8080/xxx/product/BuyServlet")]),s._v(" 就没有；")])])]),s._v(" "),e("li",[s._v("设置携带路径：\n"),e("ul",[e("li",[e("code",[s._v("cookie.setPath(String path)")]),s._v("；\n"),e("ul",[e("li",[e("code",[s._v('cookie.setPath("/CookiePro/cookieServlet")')]),s._v("：只有访问 cookieServlet 才携带 cookie 信息；")]),s._v(" "),e("li",[e("code",[s._v('cookie.setPath("/CookiePro")')]),s._v("：访问指定的工程时，都会携带 cookie 信息；")]),s._v(" "),e("li",[e("code",[s._v('cookie.setPath("/")')]),s._v("：访问服务器下部署的所有工程时，都会携带 cookie 信息；")])])])])])]),s._v(" "),e("p",[e("strong",[s._v("删除 Cookie")]),s._v("：")]),s._v(" "),e("ul",[e("li",[s._v("把同名，同路径的 Cookie 的持久化时间设置为 0；")]),s._v(" "),e("li",[e("code",[s._v("cookie.setMaxAge(0)")]),s._v("；")])]),s._v(" "),e("p",[e("strong",[s._v("在服务器获取客户端携带的 Cookie")]),s._v("：")]),s._v(" "),e("ul",[e("li",[s._v("通过 Request 对象的 "),e("code",[s._v("getCookies()")]),s._v(" 方法获取所有的 cookie；")]),s._v(" "),e("li",[s._v("通过遍历，找出自己想要的那一个；")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-4-0-57-45.png",alt:"2020-2-4-0-57-45.png"}})]),s._v(" "),e("h2",{attrs:{id:"session"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[s._v("#")]),s._v(" Session")]),s._v(" "),e("h3",{attrs:{id:"什么是-session"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#什么是-session"}},[s._v("#")]),s._v(" 什么是 Session")]),s._v(" "),e("ul",[e("li",[s._v("session 和 cookie 的作用是一样的，也是存储用户信息。但是 session 是存储在服务器端的；")]),s._v(" "),e("li",[s._v("session 还需借助 cookie 将唯一标识 sessionID 存到客户端；")]),s._v(" "),e("li",[s._v("当客户端访问服务器时，会生成一个全局唯一标识 sessionID；")]),s._v(" "),e("li",[s._v("然后服务器会记录用户的信息然后存储到服务器 session 中，并将 id 响应给客户端；")]),s._v(" "),e("li",[s._v("服务器使用一种类似于散列表的结构来保存信息, 当程序需要为某个客户端的请求创建一个 session 时：\n"),e("ul",[e("li",[s._v("服务器首先检查这个客户端的请求里是否已包含了一个 session 标识 (session id)；\n"),e("ul",[e("li",[s._v("如果已包含则说明以前已经为此客户端创建过 session，服务器就按照 session id 把对应的 session 检索出来；")]),s._v(" "),e("li",[s._v("如果检索不到，会新建一个；")])])]),s._v(" "),e("li",[s._v("如果客户端请求不包含 session id；\n"),e("ul",[e("li",[s._v("则为此客户端创建一个 session 并且生成一个与此 session 相关联的 session id；")]),s._v(" "),e("li",[s._v("然后在本次响应中返回给客户端保存；")])])])])])]),s._v(" "),e("h3",{attrs:{id:"在-java-中使用-session"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#在-java-中使用-session"}},[s._v("#")]),s._v(" 在 Java 中使用 Session")]),s._v(" "),e("p",[e("strong",[s._v("获取 Session 对象")]),s._v("：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("HttpSession s = request.getSession()")]),s._v(" 获取当前会话的 Session 对象；\n"),e("ul",[e("li",[s._v("如果服务器没有当前会话的 Session 对象，那么就创建一个新的返回；")]),s._v(" "),e("li",[s._v("如果已经有了属于该会话的 Session 就直接返回；")]),s._v(" "),e("li",[s._v("本质就是根据 Session Id 来判断是否服务器已经有 Session 了；")])])])]),s._v(" "),e("p",[e("strong",[s._v("用 Session 存取数据")]),s._v("：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("session.setAttribute(String name, Object obj)")]),s._v(" 保存")]),s._v(" "),e("li",[e("code",[s._v("session.getAttribute(String name)")]),s._v(" 读取")]),s._v(" "),e("li",[e("code",[s._v("session.removeAttribute(String name)")]),s._v(" 删除")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-4-1-15-57.png",alt:"2020-2-4-1-15-57.png"}})]),s._v(" "),e("p",[e("strong",[s._v("Session 生命周期")]),s._v("：")]),s._v(" "),e("ul",[e("li",[s._v("创建：第一次执行 "),e("code",[s._v("request.getSession()")]),s._v(" 时创建；")]),s._v(" "),e("li",[s._v("销毁：\n"),e("ul",[e("li",[s._v("服务器关闭时销毁；")]),s._v(" "),e("li",[s._v("默认 30 分钟也销毁。在 web.xml 中，可以修改这个时间：\n"),e("ul",[e("li",[e("img",{attrs:{src:"https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-4-1-18-34.png",alt:"2020-2-4-1-18-34.png"}})])])]),s._v(" "),e("li",[s._v("手动销毁："),e("code",[s._v("session.invalidate()")]),s._v(" 方法主动销毁；")])])]),s._v(" "),e("li",[s._v("作用范围：默认在一次会话中，所有资源共用一个 session 对象；")]),s._v(" "),e("li",[s._v("JsessionID 的持久化：\n"),e("ul",[e("li",[s._v("当服务器把 session id 发给浏览器时，浏览器把 id 储存为 cookie，然后下次请求的时候再发给服务器；")]),s._v(" "),e("li",[s._v("但是，如果把浏览器关掉，断开会话；")]),s._v(" "),e("li",[s._v("默认 cookie 就被销毁了；")]),s._v(" "),e("li",[s._v("所以需要设置 cookie 持久化时间；\n"),e("img",{attrs:{src:"https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-2-4-19-4-13.png",alt:"2020-2-4-19-4-13.png"}})])])])])])}),[],!1,null,null,null);i.default=v.exports}}]);