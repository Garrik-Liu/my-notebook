<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络层 | Garrik 的笔记</title>
    <meta name="description" content="这里是 Garrik 的前端笔记本">
    
    
    <link rel="preload" href="/my-notebook/assets/css/0.styles.150b63c7.css" as="style"><link rel="preload" href="/my-notebook/assets/js/app.f28c00e1.js" as="script"><link rel="preload" href="/my-notebook/assets/js/2.a47e0c14.js" as="script"><link rel="preload" href="/my-notebook/assets/js/248.ccce8d4c.js" as="script"><link rel="prefetch" href="/my-notebook/assets/js/10.34de8f19.js"><link rel="prefetch" href="/my-notebook/assets/js/100.bf449377.js"><link rel="prefetch" href="/my-notebook/assets/js/101.6ddfac2b.js"><link rel="prefetch" href="/my-notebook/assets/js/102.5b840e50.js"><link rel="prefetch" href="/my-notebook/assets/js/103.76688ff4.js"><link rel="prefetch" href="/my-notebook/assets/js/104.21d50985.js"><link rel="prefetch" href="/my-notebook/assets/js/105.6cdcc9ce.js"><link rel="prefetch" href="/my-notebook/assets/js/106.30ff0177.js"><link rel="prefetch" href="/my-notebook/assets/js/107.61f8031d.js"><link rel="prefetch" href="/my-notebook/assets/js/108.66a7f009.js"><link rel="prefetch" href="/my-notebook/assets/js/109.20451072.js"><link rel="prefetch" href="/my-notebook/assets/js/11.70726a66.js"><link rel="prefetch" href="/my-notebook/assets/js/110.ac2d285c.js"><link rel="prefetch" href="/my-notebook/assets/js/111.5eba83d9.js"><link rel="prefetch" href="/my-notebook/assets/js/112.d94267cd.js"><link rel="prefetch" href="/my-notebook/assets/js/113.34b08c51.js"><link rel="prefetch" href="/my-notebook/assets/js/114.f9a9a52a.js"><link rel="prefetch" href="/my-notebook/assets/js/115.30b5b822.js"><link rel="prefetch" href="/my-notebook/assets/js/116.621b6c91.js"><link rel="prefetch" href="/my-notebook/assets/js/117.c4e43463.js"><link rel="prefetch" href="/my-notebook/assets/js/118.2f3fcc4a.js"><link rel="prefetch" href="/my-notebook/assets/js/119.f2b27009.js"><link rel="prefetch" href="/my-notebook/assets/js/12.d569d254.js"><link rel="prefetch" href="/my-notebook/assets/js/120.d456f163.js"><link rel="prefetch" href="/my-notebook/assets/js/121.c46c8b18.js"><link rel="prefetch" href="/my-notebook/assets/js/122.92e8005d.js"><link rel="prefetch" href="/my-notebook/assets/js/123.f7732494.js"><link rel="prefetch" href="/my-notebook/assets/js/124.befc6f3f.js"><link rel="prefetch" href="/my-notebook/assets/js/125.b6905de4.js"><link rel="prefetch" href="/my-notebook/assets/js/126.fa04f26d.js"><link rel="prefetch" href="/my-notebook/assets/js/127.4c3b1aa1.js"><link rel="prefetch" href="/my-notebook/assets/js/128.b685cf8d.js"><link rel="prefetch" href="/my-notebook/assets/js/129.f5750788.js"><link rel="prefetch" href="/my-notebook/assets/js/13.893acd5c.js"><link rel="prefetch" href="/my-notebook/assets/js/130.24d4f2f8.js"><link rel="prefetch" href="/my-notebook/assets/js/131.45fd9ae1.js"><link rel="prefetch" href="/my-notebook/assets/js/132.53584f9d.js"><link rel="prefetch" href="/my-notebook/assets/js/133.9e1b1ae7.js"><link rel="prefetch" href="/my-notebook/assets/js/134.948d4702.js"><link rel="prefetch" href="/my-notebook/assets/js/135.2aa670e4.js"><link rel="prefetch" href="/my-notebook/assets/js/136.f726f94d.js"><link rel="prefetch" href="/my-notebook/assets/js/137.0b33cfe4.js"><link rel="prefetch" href="/my-notebook/assets/js/138.d05b7fab.js"><link rel="prefetch" href="/my-notebook/assets/js/139.6dbabf93.js"><link rel="prefetch" href="/my-notebook/assets/js/14.ad94a836.js"><link rel="prefetch" href="/my-notebook/assets/js/140.62a474f3.js"><link rel="prefetch" href="/my-notebook/assets/js/141.85694e1e.js"><link rel="prefetch" href="/my-notebook/assets/js/142.e031ff58.js"><link rel="prefetch" href="/my-notebook/assets/js/143.3a07f68f.js"><link rel="prefetch" href="/my-notebook/assets/js/144.a3f9c93b.js"><link rel="prefetch" href="/my-notebook/assets/js/145.c480a484.js"><link rel="prefetch" href="/my-notebook/assets/js/146.44345633.js"><link rel="prefetch" href="/my-notebook/assets/js/147.81415986.js"><link rel="prefetch" href="/my-notebook/assets/js/148.9550240a.js"><link rel="prefetch" href="/my-notebook/assets/js/149.18fc8ed4.js"><link rel="prefetch" href="/my-notebook/assets/js/15.dbff8c48.js"><link rel="prefetch" href="/my-notebook/assets/js/150.9751c550.js"><link rel="prefetch" href="/my-notebook/assets/js/151.728318a7.js"><link rel="prefetch" href="/my-notebook/assets/js/152.2dfc1ff1.js"><link rel="prefetch" href="/my-notebook/assets/js/153.68bef311.js"><link rel="prefetch" href="/my-notebook/assets/js/154.02cc89c2.js"><link rel="prefetch" href="/my-notebook/assets/js/155.28f1ff7e.js"><link rel="prefetch" href="/my-notebook/assets/js/156.d4fb597a.js"><link rel="prefetch" href="/my-notebook/assets/js/157.0819d9d4.js"><link rel="prefetch" href="/my-notebook/assets/js/158.3db70100.js"><link rel="prefetch" href="/my-notebook/assets/js/159.42e6ef17.js"><link rel="prefetch" href="/my-notebook/assets/js/16.7811e5bf.js"><link rel="prefetch" href="/my-notebook/assets/js/160.a1d05ae9.js"><link rel="prefetch" href="/my-notebook/assets/js/161.97e0fe96.js"><link rel="prefetch" href="/my-notebook/assets/js/162.b0de8a8c.js"><link rel="prefetch" href="/my-notebook/assets/js/163.b512d850.js"><link rel="prefetch" href="/my-notebook/assets/js/164.5566ca85.js"><link rel="prefetch" href="/my-notebook/assets/js/165.03905c40.js"><link rel="prefetch" href="/my-notebook/assets/js/166.863cb8f6.js"><link rel="prefetch" href="/my-notebook/assets/js/167.fac65e85.js"><link rel="prefetch" href="/my-notebook/assets/js/168.3171fe38.js"><link rel="prefetch" href="/my-notebook/assets/js/169.b2075e11.js"><link rel="prefetch" href="/my-notebook/assets/js/17.a19562df.js"><link rel="prefetch" href="/my-notebook/assets/js/170.7d96e7b8.js"><link rel="prefetch" href="/my-notebook/assets/js/171.d7904e22.js"><link rel="prefetch" href="/my-notebook/assets/js/172.07a4c004.js"><link rel="prefetch" href="/my-notebook/assets/js/173.a5f18d32.js"><link rel="prefetch" href="/my-notebook/assets/js/174.26d341d5.js"><link rel="prefetch" href="/my-notebook/assets/js/175.90251472.js"><link rel="prefetch" href="/my-notebook/assets/js/176.3dd4d2df.js"><link rel="prefetch" href="/my-notebook/assets/js/177.02b1b92b.js"><link rel="prefetch" href="/my-notebook/assets/js/178.f09b4872.js"><link rel="prefetch" href="/my-notebook/assets/js/179.19b5ba2d.js"><link rel="prefetch" href="/my-notebook/assets/js/18.bcd4e985.js"><link rel="prefetch" href="/my-notebook/assets/js/180.0baea96e.js"><link rel="prefetch" href="/my-notebook/assets/js/181.26a8c4b7.js"><link rel="prefetch" href="/my-notebook/assets/js/182.b2d28135.js"><link rel="prefetch" href="/my-notebook/assets/js/183.83a20f34.js"><link rel="prefetch" href="/my-notebook/assets/js/184.1add6a2a.js"><link rel="prefetch" href="/my-notebook/assets/js/185.8200a59e.js"><link rel="prefetch" href="/my-notebook/assets/js/186.4a719c16.js"><link rel="prefetch" href="/my-notebook/assets/js/187.b9c79b4b.js"><link rel="prefetch" href="/my-notebook/assets/js/188.a343c656.js"><link rel="prefetch" href="/my-notebook/assets/js/189.62deaac9.js"><link rel="prefetch" href="/my-notebook/assets/js/19.7dcab44f.js"><link rel="prefetch" href="/my-notebook/assets/js/190.6439e3c5.js"><link rel="prefetch" href="/my-notebook/assets/js/191.c1014bc1.js"><link rel="prefetch" href="/my-notebook/assets/js/192.fa2eb536.js"><link rel="prefetch" href="/my-notebook/assets/js/193.643fe335.js"><link rel="prefetch" href="/my-notebook/assets/js/194.5ef83ef8.js"><link rel="prefetch" href="/my-notebook/assets/js/195.b5ad8f41.js"><link rel="prefetch" href="/my-notebook/assets/js/196.6bbf2d0e.js"><link rel="prefetch" href="/my-notebook/assets/js/197.7f74508c.js"><link rel="prefetch" href="/my-notebook/assets/js/198.cd2b6f82.js"><link rel="prefetch" href="/my-notebook/assets/js/199.8462b70c.js"><link rel="prefetch" href="/my-notebook/assets/js/20.0e550cf5.js"><link rel="prefetch" href="/my-notebook/assets/js/200.a4395edc.js"><link rel="prefetch" href="/my-notebook/assets/js/201.c93d4dec.js"><link rel="prefetch" href="/my-notebook/assets/js/202.7036a8b9.js"><link rel="prefetch" href="/my-notebook/assets/js/203.cfdf0b5a.js"><link rel="prefetch" href="/my-notebook/assets/js/204.59fecf15.js"><link rel="prefetch" href="/my-notebook/assets/js/205.15c59509.js"><link rel="prefetch" href="/my-notebook/assets/js/206.47f55a9f.js"><link rel="prefetch" href="/my-notebook/assets/js/207.12ebafa2.js"><link rel="prefetch" href="/my-notebook/assets/js/208.8becaedc.js"><link rel="prefetch" href="/my-notebook/assets/js/209.f3f407c4.js"><link rel="prefetch" href="/my-notebook/assets/js/21.1645463d.js"><link rel="prefetch" href="/my-notebook/assets/js/210.ec54b67c.js"><link rel="prefetch" href="/my-notebook/assets/js/211.265b51f5.js"><link rel="prefetch" href="/my-notebook/assets/js/212.80758341.js"><link rel="prefetch" href="/my-notebook/assets/js/213.9049927f.js"><link rel="prefetch" href="/my-notebook/assets/js/214.2a39ded7.js"><link rel="prefetch" href="/my-notebook/assets/js/215.12cba946.js"><link rel="prefetch" href="/my-notebook/assets/js/216.d60aa211.js"><link rel="prefetch" href="/my-notebook/assets/js/217.3224f7e2.js"><link rel="prefetch" href="/my-notebook/assets/js/218.347b6276.js"><link rel="prefetch" href="/my-notebook/assets/js/219.876634ad.js"><link rel="prefetch" href="/my-notebook/assets/js/22.35ae2ad4.js"><link rel="prefetch" href="/my-notebook/assets/js/220.06d90dc3.js"><link rel="prefetch" href="/my-notebook/assets/js/221.8b7ed9db.js"><link rel="prefetch" href="/my-notebook/assets/js/222.4a0091ad.js"><link rel="prefetch" href="/my-notebook/assets/js/223.f6d57fc3.js"><link rel="prefetch" href="/my-notebook/assets/js/224.a188cdba.js"><link rel="prefetch" href="/my-notebook/assets/js/225.1576cc63.js"><link rel="prefetch" href="/my-notebook/assets/js/226.b1ba487c.js"><link rel="prefetch" href="/my-notebook/assets/js/227.98ca5f0f.js"><link rel="prefetch" href="/my-notebook/assets/js/228.f93127f5.js"><link rel="prefetch" href="/my-notebook/assets/js/229.6d6b15fe.js"><link rel="prefetch" href="/my-notebook/assets/js/23.073b81c9.js"><link rel="prefetch" href="/my-notebook/assets/js/230.b218726a.js"><link rel="prefetch" href="/my-notebook/assets/js/231.e33c36f8.js"><link rel="prefetch" href="/my-notebook/assets/js/232.6e00dfcc.js"><link rel="prefetch" href="/my-notebook/assets/js/233.1844a768.js"><link rel="prefetch" href="/my-notebook/assets/js/234.10b1fde1.js"><link rel="prefetch" href="/my-notebook/assets/js/235.f9bd2557.js"><link rel="prefetch" href="/my-notebook/assets/js/236.6c95eb6f.js"><link rel="prefetch" href="/my-notebook/assets/js/237.dc005d32.js"><link rel="prefetch" href="/my-notebook/assets/js/238.3a87d60e.js"><link rel="prefetch" href="/my-notebook/assets/js/239.96fc9f41.js"><link rel="prefetch" href="/my-notebook/assets/js/24.7fd41179.js"><link rel="prefetch" href="/my-notebook/assets/js/240.b91408dc.js"><link rel="prefetch" href="/my-notebook/assets/js/241.feb248a0.js"><link rel="prefetch" href="/my-notebook/assets/js/242.40369ecb.js"><link rel="prefetch" href="/my-notebook/assets/js/243.294130ba.js"><link rel="prefetch" href="/my-notebook/assets/js/244.3ba765ef.js"><link rel="prefetch" href="/my-notebook/assets/js/245.0c12ecb9.js"><link rel="prefetch" href="/my-notebook/assets/js/246.be9faf05.js"><link rel="prefetch" href="/my-notebook/assets/js/247.162fa28b.js"><link rel="prefetch" href="/my-notebook/assets/js/249.dbcce1eb.js"><link rel="prefetch" href="/my-notebook/assets/js/25.4400d18b.js"><link rel="prefetch" href="/my-notebook/assets/js/250.f3c23faa.js"><link rel="prefetch" href="/my-notebook/assets/js/251.5417a578.js"><link rel="prefetch" href="/my-notebook/assets/js/252.b3fae458.js"><link rel="prefetch" href="/my-notebook/assets/js/253.fbcb2486.js"><link rel="prefetch" href="/my-notebook/assets/js/254.4ca33c45.js"><link rel="prefetch" href="/my-notebook/assets/js/255.f04e158e.js"><link rel="prefetch" href="/my-notebook/assets/js/256.77bfcb4f.js"><link rel="prefetch" href="/my-notebook/assets/js/257.891fa82a.js"><link rel="prefetch" href="/my-notebook/assets/js/258.38524b15.js"><link rel="prefetch" href="/my-notebook/assets/js/259.0db7634d.js"><link rel="prefetch" href="/my-notebook/assets/js/26.a6d79855.js"><link rel="prefetch" href="/my-notebook/assets/js/260.247187c9.js"><link rel="prefetch" href="/my-notebook/assets/js/261.32a00d5f.js"><link rel="prefetch" href="/my-notebook/assets/js/262.1df180f7.js"><link rel="prefetch" href="/my-notebook/assets/js/263.30c5758a.js"><link rel="prefetch" href="/my-notebook/assets/js/264.54d53460.js"><link rel="prefetch" href="/my-notebook/assets/js/27.1eb7a06d.js"><link rel="prefetch" href="/my-notebook/assets/js/28.8e889750.js"><link rel="prefetch" href="/my-notebook/assets/js/29.e3d1cf4d.js"><link rel="prefetch" href="/my-notebook/assets/js/3.db75fba4.js"><link rel="prefetch" href="/my-notebook/assets/js/30.d7a22f24.js"><link rel="prefetch" href="/my-notebook/assets/js/31.4fa00ee0.js"><link rel="prefetch" href="/my-notebook/assets/js/32.78209343.js"><link rel="prefetch" href="/my-notebook/assets/js/33.69c03eb1.js"><link rel="prefetch" href="/my-notebook/assets/js/34.948968e0.js"><link rel="prefetch" href="/my-notebook/assets/js/35.9a98473f.js"><link rel="prefetch" href="/my-notebook/assets/js/36.8602e2fd.js"><link rel="prefetch" href="/my-notebook/assets/js/37.6e857031.js"><link rel="prefetch" href="/my-notebook/assets/js/38.bf8a2e01.js"><link rel="prefetch" href="/my-notebook/assets/js/39.0e61b94f.js"><link rel="prefetch" href="/my-notebook/assets/js/4.e1550a9f.js"><link rel="prefetch" href="/my-notebook/assets/js/40.f8067581.js"><link rel="prefetch" href="/my-notebook/assets/js/41.4aaf933c.js"><link rel="prefetch" href="/my-notebook/assets/js/42.bcabb57f.js"><link rel="prefetch" href="/my-notebook/assets/js/43.2c9d59b4.js"><link rel="prefetch" href="/my-notebook/assets/js/44.c0c17bf7.js"><link rel="prefetch" href="/my-notebook/assets/js/45.d4a35803.js"><link rel="prefetch" href="/my-notebook/assets/js/46.0a7e6638.js"><link rel="prefetch" href="/my-notebook/assets/js/47.cbfe20cd.js"><link rel="prefetch" href="/my-notebook/assets/js/48.c765258a.js"><link rel="prefetch" href="/my-notebook/assets/js/49.c207b983.js"><link rel="prefetch" href="/my-notebook/assets/js/5.977f0fd9.js"><link rel="prefetch" href="/my-notebook/assets/js/50.c0839a66.js"><link rel="prefetch" href="/my-notebook/assets/js/51.4349b07f.js"><link rel="prefetch" href="/my-notebook/assets/js/52.33a81e31.js"><link rel="prefetch" href="/my-notebook/assets/js/53.67da664f.js"><link rel="prefetch" href="/my-notebook/assets/js/54.72fcfd7d.js"><link rel="prefetch" href="/my-notebook/assets/js/55.dd985fb9.js"><link rel="prefetch" href="/my-notebook/assets/js/56.58a1b1af.js"><link rel="prefetch" href="/my-notebook/assets/js/57.2c7aedf4.js"><link rel="prefetch" href="/my-notebook/assets/js/58.6cf12563.js"><link rel="prefetch" href="/my-notebook/assets/js/59.b9178b98.js"><link rel="prefetch" href="/my-notebook/assets/js/6.a8f6d556.js"><link rel="prefetch" href="/my-notebook/assets/js/60.b219a891.js"><link rel="prefetch" href="/my-notebook/assets/js/61.6d02e77c.js"><link rel="prefetch" href="/my-notebook/assets/js/62.966d937e.js"><link rel="prefetch" href="/my-notebook/assets/js/63.2481592d.js"><link rel="prefetch" href="/my-notebook/assets/js/64.604ea712.js"><link rel="prefetch" href="/my-notebook/assets/js/65.d01a3bb9.js"><link rel="prefetch" href="/my-notebook/assets/js/66.b339b157.js"><link rel="prefetch" href="/my-notebook/assets/js/67.f236482c.js"><link rel="prefetch" href="/my-notebook/assets/js/68.61d639ca.js"><link rel="prefetch" href="/my-notebook/assets/js/69.d39ede1c.js"><link rel="prefetch" href="/my-notebook/assets/js/7.525f5ddb.js"><link rel="prefetch" href="/my-notebook/assets/js/70.4f16a397.js"><link rel="prefetch" href="/my-notebook/assets/js/71.7c284010.js"><link rel="prefetch" href="/my-notebook/assets/js/72.df07b021.js"><link rel="prefetch" href="/my-notebook/assets/js/73.684160b7.js"><link rel="prefetch" href="/my-notebook/assets/js/74.23077dae.js"><link rel="prefetch" href="/my-notebook/assets/js/75.e4835728.js"><link rel="prefetch" href="/my-notebook/assets/js/76.cbf8e3d3.js"><link rel="prefetch" href="/my-notebook/assets/js/77.90523f0f.js"><link rel="prefetch" href="/my-notebook/assets/js/78.165b4504.js"><link rel="prefetch" href="/my-notebook/assets/js/79.6b240187.js"><link rel="prefetch" href="/my-notebook/assets/js/8.0e588b61.js"><link rel="prefetch" href="/my-notebook/assets/js/80.2cddeaa9.js"><link rel="prefetch" href="/my-notebook/assets/js/81.7263960b.js"><link rel="prefetch" href="/my-notebook/assets/js/82.0985faa1.js"><link rel="prefetch" href="/my-notebook/assets/js/83.6b4944b0.js"><link rel="prefetch" href="/my-notebook/assets/js/84.6d6cbff3.js"><link rel="prefetch" href="/my-notebook/assets/js/85.fe5df41c.js"><link rel="prefetch" href="/my-notebook/assets/js/86.73be2c0e.js"><link rel="prefetch" href="/my-notebook/assets/js/87.e43297a9.js"><link rel="prefetch" href="/my-notebook/assets/js/88.67ce926a.js"><link rel="prefetch" href="/my-notebook/assets/js/89.aa325b2e.js"><link rel="prefetch" href="/my-notebook/assets/js/9.87b57d0d.js"><link rel="prefetch" href="/my-notebook/assets/js/90.7ecfa92f.js"><link rel="prefetch" href="/my-notebook/assets/js/91.d7d8a645.js"><link rel="prefetch" href="/my-notebook/assets/js/92.91b7597e.js"><link rel="prefetch" href="/my-notebook/assets/js/93.4270d1fc.js"><link rel="prefetch" href="/my-notebook/assets/js/94.dd932251.js"><link rel="prefetch" href="/my-notebook/assets/js/95.76f7722a.js"><link rel="prefetch" href="/my-notebook/assets/js/96.25fd840d.js"><link rel="prefetch" href="/my-notebook/assets/js/97.2204e5b4.js"><link rel="prefetch" href="/my-notebook/assets/js/98.6f50837e.js"><link rel="prefetch" href="/my-notebook/assets/js/99.37cbb406.js">
    <link rel="stylesheet" href="/my-notebook/assets/css/0.styles.150b63c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-notebook/" class="home-link router-link-active"><!----> <span class="site-name">Garrik 的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-notebook/" class="nav-link">主页</a></div><div class="nav-item"><a href="https://github.com/Garrik-Liu/my-notebook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-notebook/" class="nav-link">主页</a></div><div class="nav-item"><a href="https://github.com/Garrik-Liu/my-notebook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>网络层</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#概述" class="sidebar-link">概述</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#虚电路-数据报网络" class="sidebar-link">虚电路 &amp; 数据报网络</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#路由器工作原理" class="sidebar-link">路由器工作原理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#路由器组成部分" class="sidebar-link">路由器组成部分</a></li></ul></li><li><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#网际协议-因特网中的转发和编制" class="sidebar-link">网际协议: 因特网中的转发和编制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#数据报格式" class="sidebar-link">数据报格式</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#ipv4-编址" class="sidebar-link">IPv4 编址</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#因特网控制报文协议" class="sidebar-link">因特网控制报文协议</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#ipv6" class="sidebar-link">IPv6</a></li></ul></li><li><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#路由选择算法" class="sidebar-link">路由选择算法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#链路状态路由选择算法" class="sidebar-link">链路状态路由选择算法</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#距离向量路由选择算法" class="sidebar-link">距离向量路由选择算法</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#层次路由选择" class="sidebar-link">层次路由选择</a></li></ul></li><li><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#因特网中的路由选择" class="sidebar-link">因特网中的路由选择</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/my-notebook/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E8%87%AA%E9%A1%B6%E5%90%91%E4%B8%8B/%E7%BD%91%E7%BB%9C%E5%B1%82.html#广播-多播路由选择" class="sidebar-link">广播 &amp; 多播路由选择</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="网络层"><a href="#网络层" class="header-anchor">#</a> 网络层</h1> <h2 id="概述"><a href="#概述" class="header-anchor">#</a> 概述</h2> <p>网络层的作用: 将分组从一台主机移动到另一台主机;</p> <p>为了实现这个目的, 需要两种网络层<strong>功能</strong>:</p> <ul><li><strong>转发</strong>: 在路由器上, 将从输入链路传入的分组, 移动到适当的输出链路上;</li> <li><strong>路游选择</strong>: 在整个网络范围中, 用『 <strong>路游选择算法 Routing Algorithm</strong> 』计算出, 分组从发送方到接收方所要走的最佳路径;</li></ul> <hr> <p>每台路由器都有一个『 <strong>转发表 forwarding table</strong> 』</p> <ul><li>发送到路由器的分组会有一个首部字段, 其用以指示该分组的输出链路;</li> <li>路由器将该首部字段的值, 作为索引在转发表中查询到对应的输出链路. 之后路由器就可以正确地转发该分组了;</li></ul> <p>转发表中的值由『 <strong>路由选择算法</strong> 』计算得出. 这张表揭示了『 <strong>路由选择</strong> 』和『 <strong>转发</strong> 』之间的关系.</p> <hr> <p>『 <strong>分组交换机</strong> 』是对分组交换设备的通用称呼, 其根据某个首部字段的值, 对分组进行转发:</p> <ul><li><strong>链路层交换机</strong> link-layer switch: 基于 &quot;链路层&quot; 的首部字段的值做转发决定;</li> <li><strong>路由器</strong> router: 基于 &quot;网络层&quot; 的首部字段的值做转发决定;</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-12-50-18.png" alt="2020-06-11-12-50-18"></p> <hr> <p>在『 <strong>因特网</strong> 』网络体系结构中, 网络层提供给上层一种『 <strong>尽力而为服务 best-effort service</strong> 』</p> <ul><li>对于因特网而言, 这基本上就等于没有服务, 网络层基本上不提供给运输层任何服务;</li> <li>但是除了因特网结构, 还有其他网络结构, 例如下图 👇 中的 ATM 结构. 在 ATM 结构中, 网络层提供服务;</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-14-08-08.png" alt="2020-06-11-14-08-08"></p> <p>尽力而为服务的『 <strong>好处</strong> 』是:</p> <ul><li>网络层不提供可靠的传输服务, 使得网络核心<strong>实现简单, 造价低廉</strong>;</li> <li><strong>运行方式灵活, 可以适应多种应用</strong>. 主机端根据需求, 自己负责需要的连接服务 ( 运输层, 应用层 )</li></ul> <h2 id="虚电路-数据报网络"><a href="#虚电路-数据报网络" class="header-anchor">#</a> 虚电路 &amp; 数据报网络</h2> <h2 id="路由器工作原理"><a href="#路由器工作原理" class="header-anchor">#</a> 路由器工作原理</h2> <blockquote><p>在计算机网络的语境中, 经常互换『 <strong>转发</strong> 』和『 <strong>交换</strong> 』这两个词.</p></blockquote> <h3 id="路由器组成部分"><a href="#路由器组成部分" class="header-anchor">#</a> 路由器组成部分</h3> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-14-13-15.png" alt="2020-06-11-14-13-15"></p> <p>上图中将路由器分成了 4 个组成部分:</p> <ul><li>输入端口;</li> <li>交换结构;</li> <li>输出端口;</li> <li>路由选择处理器;</li></ul> <h4 id="输入端口"><a href="#输入端口" class="header-anchor">#</a> 输入端口</h4> <p>输入端口主要执行三个功能:</p> <ul><li><strong>物理层功能</strong>: 将一条物理输入链路与路由器相连;</li> <li><strong>链路层功能</strong>: 对远端传来的链路层数据进行处理;</li> <li><strong>查找转发功能</strong>: 通过搜算转发表, 用输入分组的首部字段找到对应的『 输出端口 』. 然后把该分组发送进入『 交换结构 』;
<ul><li>转发表是由『 路由选择处理器 』计算和更新的;</li> <li>『 路由选择处理器 』通过一条『 独立总线 』将『 转发表 』复制给『 输入端口 』</li> <li>输入端口保存了一份『 转发表副本 』, 这样转发决策就可以在输入端口本地做出了;</li></ul></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-15-13-24.png" alt="2020-06-11-15-13-24"></p> <h4 id="交换结构"><a href="#交换结构" class="header-anchor">#</a> 交换结构</h4> <p>交换结构位于路由器的核心部位, 通过它就可以将分组实际地从输入端口『 交换 / 转发 』到输出端口;</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-15-23-24.png" alt="2020-06-11-15-23-24"></p> <p>交换实现的方式有很多种, 下面介绍三种:</p> <ul><li><strong>经内存交换</strong>:
<ul><li>最早的路由器就是传统的计算机, 交换的操作是在 CPU 的控制下完成的. 一个分组到达输入端口后, 会通过 interrupt 中断的方式向 CPU 发出信号. CUP 之后会把该分组复制到内存中, 然后 CPU 通过分组的首部查找对应的输出端口, 最后把分组再写入输出端口所用的内存中;</li> <li>现代使用内存交换的路由器, 把『 输出端口的查找 』和『 将分组储存进对应的内存位置 』交给『 输入端口 』处理.</li></ul></li> <li><strong>经总线交换</strong>:
<ul><li>输入端口通过一条『 共享的总线 』直接将分组传输给输出端口;</li> <li>单一总线每次只能传输一个分组, 如果同时多个分组到达路由器, 其他的就要等待. 所以路由器的交换带宽受限于总线传输速率;</li></ul></li> <li><strong>经互联网络交换</strong>:
<ul><li>通过使用更复杂的互联网络, 可以克服单一总线带来的带宽限制;</li> <li>采用互联网络的路由器可以同时转发多个分组;</li></ul></li></ul> <h4 id="输出端口"><a href="#输出端口" class="header-anchor">#</a> 输出端口</h4> <p>输出端口取出存放在『 输出端口内存 』中的『 分组 』, 并将其发送到『 输出链路 』上;</p> <ul><li>同输入端口一样, 输出端口也实现了『 物理层 』和『 链路层 』的功能;</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-15-44-53.png" alt="2020-06-11-15-44-53"></p> <h4 id="路由选择处理器"><a href="#路由选择处理器" class="header-anchor">#</a> 路由选择处理器</h4> <p>路由选择处理器, 执行『 <strong>路由选择协议</strong> 』维护『 <strong>路由选择表</strong> 』以及连接的『 <strong>链路状态信息</strong> 』, 并且为路由器计算『 <strong>转发表</strong> 』除此之外, 它还执行网络管理功能.</p> <p>这些内容的具体细节在后面讲.</p> <h2 id="网际协议-因特网中的转发和编制"><a href="#网际协议-因特网中的转发和编制" class="header-anchor">#</a> 网际协议: 因特网中的转发和编制</h2> <p>网络层中有三个重要组件:</p> <ul><li><strong>IP 协议</strong>: 定义了编址与转发的规则;</li> <li><strong>路由选择协议</strong>: 计算出分组传输的路径;</li> <li><strong>ICMP 协议</strong>: 报告数据报中的差错, 和对某些网络层信息请求进行相应;</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-16-05-41.png" alt="2020-06-11-16-05-41"></p> <p>这一章, 我们讲『 <strong>IP 协议</strong> 』也称为『 <strong>网际协议 Internet Protocol</strong> 』</p> <ul><li>版本上可以分为 IPv4 和 IPv6 这两种;</li> <li><ins>下面的内容先默认采用 IPv4,</ins> 在章节最后会讲解 IPv6;</li></ul> <p>IP 协议是网络层主要协议，它对数据提供『 尽力而为 Best-Effort Service 』的服务. 主要功能包括：</p> <ul><li>分组的分段和重组;</li> <li>无连接数据报传输;</li> <li>数据报路由;</li></ul> <h3 id="数据报格式"><a href="#数据报格式" class="header-anchor">#</a> 数据报格式</h3> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-16-22-07.png" alt="2020-06-11-16-22-07"></p> <p>IPv4 数据报中的关键字段如下:</p> <ul><li><strong>版本</strong>: 表示数据报的 IP 协议版本 ( E.g. IPv4 / IPv6 )</li> <li><strong>首部长度</strong>: 数据报中可以包含一些可变数量的选项, 所以首部长度是不固定的, 通过它可以确定『 有效载荷 』从哪里开始;</li> <li><strong>服务类型</strong>: 根据需求不同, 数据报也可以分成很多种类型 ( E.g. 实时数据报, 非实时数据报, etc. )</li> <li><strong>数据报长度</strong>: 数据报的总长度;</li> <li><strong>标识, 标志, 片偏移</strong>: 与 IP 分片相关的字段, 用以组装数据报;</li> <li><strong>寿命</strong>: 表示数据报生存时间;</li> <li><strong>协议</strong>: 表示该数据报, 在接收端应该被交给哪个『 运输层协议 』;</li> <li><strong>首部校验和</strong>: 用以检验 IP 数据报中的比特错误;</li> <li><strong>源 &amp; 目的 IP 地址</strong>: 表示源主机和目的主机的 IP 地址;</li> <li><strong>选项</strong>: 一些可选设置;</li> <li><strong>数据</strong>: 有效载荷, 大多数情况下是运输层的报文段, 但也可以承载其他类型数据, 如 ICMP 报文;</li></ul> <h4 id="ip-数据报分片"><a href="#ip-数据报分片" class="header-anchor">#</a> IP 数据报分片</h4> <p>链路层协议能够承载的『 帧的长度 』是有限制的, 一个链路层帧能够承载的最大数据量叫『 <strong>最大传送单元</strong> Maximum Transmission Unit, MTU 』</p> <p>为了让链路层能传输大数量的数据报, 路由器会将数据报『 切分 』成较小的数据报. 然后再一个个地封装进『 帧 』中. 被切分出的较小数据报被称为『 <strong>切片</strong> 』</p> <p>切片在到达目的端运输层之前需要进行组装, IPv4 设计者为了让『 网络核心 』尽量保持简单, 把切片组装的工作放在了『 端系统 』中, 而不是路由器.</p> <p>IPv4 数据报中的首部字段『 <strong>标识, 标志, 片偏移</strong> 』用于让接收方网络层组装数据报:</p> <ul><li><strong>标识</strong>:
<ul><li>在发送端生产数据报时, 会为其加上『 标识号 』</li> <li>当某路由器需要对数据报分片时, 每一个切片都具有与『 初始数据报 』相同的『 标识号 』</li> <li>接收方网络层, 通过『 标识号 』来判断哪些数据报是一个较大数据报的『 切片 』.</li></ul></li> <li><strong>标志</strong>:
<ul><li>通过将切片的『 标志 』设置为 <code>0</code> 来表示这是被切分的数据报的最后一片;</li> <li>其他的切片的『 标志 』设置为 <code>1</code></li></ul></li> <li><strong>片偏移</strong>:
<ul><li>通过『 偏移量 』来表示当前切片在初始数据报中的位置;</li> <li>接收方通过它可以有序地组装切片, 同时还可以判断是否有切片丢失;</li></ul></li></ul> <hr> <p>🌰 下面是一个例子, 将一个 4000 字节的数据报在路由器上被切分成 3 个独立的切片:</p> <ul><li>初始数据报的『 标识 』是 <code>777</code>;</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-11-16-40-31.png" alt="2020-06-11-16-40-31"></p> <h3 id="ipv4-编址"><a href="#ipv4-编址" class="header-anchor">#</a> IPv4 编址</h3> <ul><li>主机与物理链路之间的边界叫做『 <strong>接口</strong> interface 』</li> <li>路由器与多条物理链路相连. 因此 <strong>路由器有多个接口</strong>;</li></ul> <p>IP 协议要求每台主机和路由器的接口, 都要拥有自己的『 <strong>IP 地址</strong> 』</p> <ul><li>一个 IP 地址是与一个接口相关联的, 而不是与主机或路由器;</li></ul> <p>每个 IPv4 地址:</p> <ul><li>长度为 32 比特, 由 4 个字节组成, 字节间由 <code>.</code> 分隔开;</li> <li>共有 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="2.844ex" height="1.887ex" viewBox="0 -833.9 1257.1 833.9" style="vertical-align:0;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(500, 363) scale(0.707)"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g></g></g></svg></mjx-container> 约 40 亿个可能的 IP 地址;</li> <li>IP 地址按照『 <strong>点分十进制记法</strong> dotted-decimal notation 』书写, 也就是每个字节都用它的十进制形式书写:
<ul><li>E.g. <code>193.23.216.9</code></li> <li>上面地址的二进制格式为: <code>11000001 00100000 11011000 00001001</code></li></ul></li></ul> <h4 id="分类编址-无类别域间路由选择"><a href="#分类编址-无类别域间路由选择" class="header-anchor">#</a> 分类编址 &amp; 无类别域间路由选择</h4> <p>因特网中的每台主机和路由器上的接口都有唯一的 IP 地址, 这些地址不是随意分配的.</p> <p>在之前, IP 协议中采用『 <strong>分类编制</strong> classful addressing 』的编址方案:</p> <p>IP 地址由两个部分组成:</p> <ul><li><strong>网络号</strong>: 用于识别主机所在的网络;</li> <li><strong>主机号</strong>: 用于识别该网络中的主机;</li></ul> <p>根据 <strong>网路号的长度</strong>, 将 IP 地址分成如下几类:</p> <ul><li><strong>A 类地址</strong>:
<ul><li>网络号长度为 8 比特, 固定以 <code>0</code> 开头 ( <strong>类别位</strong> ) ;</li> <li>地址范围：<code>1.0.0.1 — 126.155.255.254</code></li> <li>保留给政府机构;</li></ul></li> <li><strong>B 类地址</strong>:
<ul><li>网络号长度为 16 比特, 固定以 <code>10</code> 开头;</li> <li>地址范围：<code>128.0.0.1 — 191.255.255.254</code></li> <li>分配给中等规模的公司;</li></ul></li> <li><strong>C 类地址</strong>:
<ul><li>网络号长度为 24 比特, 固定以 <code>110</code> 开头;</li> <li>地址范围：<code>192.0.0.1 — 223.255.255.254</code></li> <li>分配给任何需要的人;</li></ul></li> <li><strong>D 类地址</strong>:
<ul><li>不区分网络地址和主机地址;</li> <li>称为广播地址, 用于多点广播 Multicast;</li> <li>第 1 个字节前四位固定为 <code>1110</code>;</li> <li>D 类地址范围：<code>224.0.0.1 — 239.255.255.254</code></li></ul></li> <li><strong>E 类地址</strong>:
<ul><li>不区分网络地址和主机地址;</li> <li>为将来使用保留. 主要用于 Internet 试验和开发;</li> <li>第 1 个字节前四位固定为 <code>1111</code>;</li></ul></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-10-07-21.png" alt="2020-06-12-10-07-21"></p> <p>IP 地址还有如下规定:</p> <ul><li>主机号字节全为 <code>1</code> 的 IP 地址用于当前网络的『 <strong>广播地址</strong> 』给这个地址发数据, 所属网络中所有的主机都能收到;</li> <li>主机号字节全为 <code>0</code> 的 IP 地址表示『 <strong>当前网络本身</strong> 』这个地址是不可以分配给主机;</li> <li><code>0.0.0.0</code> 地址被用于表示一个无效的，未知的或者不可用的目标 ( 后面讲 ) ;</li> <li><strong>A 类地址中</strong>:
<ul><li><code>127.0.0.0 - 127.255.255.255</code> 是保留地址, 用以『 <strong>环回测试</strong> Loopback Test 』使用, 也就是主机发送通信给自身时使用的地址;
<ul><li>这些地址不会出现在网络中;</li> <li><code>127.0.0.1</code> 代表当前主机;</li> <li>当主机向环回地址发送分组时, 分组不会被入网络层之下, 经过运输层, 网络层后就又被传回来了;</li></ul></li> <li><code>10.X.X.X</code> 是私有地址, 即不能应用在互联网上，而被用在局域网络中的地址;
<ul><li>一般在中大型公司的内网中会使用 <code>10.X.X.X</code> 作为 IP 地址;</li></ul></li></ul></li> <li><strong>B 类地址中</strong>:
<ul><li><code>172.16.0.0 - 172.31.255.255</code> 是私有地址;</li> <li><code>169.254.X.X</code> 是保留地址 ( 这里不讲 )</li></ul></li> <li><strong>C 类地址中</strong>:
<ul><li><code>192.168.X.X</code> 是私有地址;
<ul><li>作为小型局域网使用的 IP 地址;</li></ul></li></ul></li></ul> <p>抛去上面 👆 提到的这些『 私有地址 』和『 保存地址 』, 每个分类中可以支持的『 <strong>最大网络数</strong> 』和『 <strong>最大主机数</strong> 』如下:</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-11-12-44.png" alt="2020-06-12-11-12-44"></p> <hr> <p>『 <strong>分类编址</strong> 』有一个很大的 <strong>缺陷</strong> 就是, 网络号与主机号 <ins>划分的粒度太大</ins>, 导致 <ins>地址空间的利用率太低</ins></p> <ul><li>🌰 一个 C 类子网所能容纳的最大主机数为 254 个, 这对于很多企业来说太小了, 但是对于家庭来说又太大了;</li> <li>🌰 一个 B 类子网能容纳的最大主机数为 65,534 个, 对于中小型企业来说又太多了;</li></ul> <p>为了解决这个问题, 就又引入了『 <strong>子网</strong> subnet 』的概念:</p> <ul><li>将原先的『 主机号 』从左向右划分出来一部分作为『 <strong>子网号</strong> 』
<ul><li>划分后, IP 地址就从『 两级结构 』变成了『 <strong>三级结构</strong> 』</li> <li>子网的网络地址格式采用『 <strong>斜线记法</strong> slash notation 』例如, <code>223.1.1.0/24</code>, 其中 <code>/24</code> 表示『 网络号 + 子网号 』所占的位数;</li></ul></li> <li>但是发送端发送分组时, 并不知道『 目的主机 』所属的网络是否进行了子网划分:
<ul><li>目的主机的『 IP 地址 』和发送的『 数据报首部 』, 都不包含任何和『 子网划分 』相关的信息;</li></ul></li></ul> <p>为了正确找到目的主机所属的网络, 引入了『 <strong>子网掩码</strong> network mask 』的概念:</p> <ul><li>子网掩码是一个 32 位的二进制码, 需要与目标 IP 地址组合起来使用. 可以用来辨别『 目的 IP 地址 』所属的『 网络地址 』</li> <li>一个子网的『 网络号 + 子网号 』与子网掩码对应的位, 都设置为 <code>1</code>, 剩下的位的值设置为 <code>0</code> <ul><li>也就是 <code>1</code> 的位数等于『 斜线记法 』格式的网络地址 <code>/</code> 后面的数字;</li></ul></li> <li>当属于这个子网的目标 IP 地址, 与子网的子网掩码进行『 和 AND 』运算, 的出来的结果就是『 目的主机所属的网络地址 』</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-14-53-48.png" alt="2020-06-12-14-53-48"></p> <p>对于没有划分子网的分类网络, 也都有自己的默认子网掩码:</p> <ul><li>A 类地址默认子网掩码: <code>255.0.0.0</code></li> <li>B 类地址默认子网掩码: <code>255.255.0.0</code></li> <li>C 类地址默认子网掩码: <code>255.255.255.0</code></li></ul> <p>在使用了子网划分后, 路由器中的『 <strong>路由表</strong> 』:</p> <ul><li>包含以下三个内容:
<ul><li>目的网络地址;</li> <li>子网掩码;</li> <li>下一跳地址;</li></ul></li> <li><strong>缺点</strong>: 因特网主干路由器上的路由表中项目数急剧增长;</li></ul> <hr> <p>一个更好的分址策略是『 <strong>无分类域间路由选择</strong> Classless Interdomain Routing, CIDR 』</p> <ul><li>CIDR 消除了传统的 A 类、B 类和 C 类地址以及划分子网的概念;</li> <li>地址格式采用『 <strong>斜线记法</strong> slash notation 』 <code>a.b.c.d/x</code>, <code>x</code> 表示地址中网络部分的位数;</li> <li>分类编址概念中的『 网络号 』和『 子网号 』组合在一起, 在 CIDR 中被称为『 <strong>网络前缀</strong> network-prefix 』
<ul><li>采用 CIDR 后, IP 地址又从『 三级结构 』变成了『 <strong>二级结构</strong> 』但是是无分类的;</li> <li>IP 地址由『 网络前缀 』和『 主机号 』这两个部分组成;</li></ul></li> <li>CIDR 把网络前缀都相同的连续的 IP 地址组成一个『 <strong>CIDR 地址块</strong> 』
<ul><li>只要知道 CIDR 地址块中任何一个地址，就可以知道这个地址块的『 起始地址（ 最小地址 ）』和『 结束地址 ( 最大地址 ) 』以及地址块中的『 地址数 』</li> <li>🌰 <code>128.14.35.7/20</code> 代表其中的前 20 位是网络前缀，而前缀后面的 12 位是主机号:
<ul><li>起始地址: <code>10000000 00001110 00100000 00000000</code></li> <li>结束地址: <code>10000000 00001110 00101111 11111111</code></li> <li>地址数: <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="13.847ex" height="2.207ex" viewBox="0 -893.3 6120.2 975.3" style="vertical-align:-0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(500, 363) scale(0.707)"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389, 0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(1389, 0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(2167, 0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path></g><g data-mml-node="mo" transform="translate(3167, 0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g><g data-mml-node="mo" transform="translate(3064.5, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(4120.2, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500, 0)"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(1000, 0)"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(1500, 0)"></path></g></g></g></svg></mjx-container></li></ul></li></ul></li></ul> <p>一个 CIDR 地址块中包含多个网络地址, 所以在路由表中就利用 CIDR 地址块来查找目的网络:</p> <ul><li>这被称为『 <strong>路由聚合</strong> route aggregation 』或者『 <strong>路由摘要</strong> route summarization 』</li> <li>它使得路由表中的一个项目可以表示原来传统分类地址的很多个路由。路由聚合也称为『 <strong>构成超网</strong> 』这有利于减少路由表的长度;</li> <li>路由表中项目, 改成由『 网络前缀 』和 『 下一跳地址 』组成:
<ul><li>路由器接收到『 数据报 』后, 将首部中的『 目标主机 IP 地址 』与路由表中的『 网络前缀 』做匹配, 然后选择匹配成功的路由;</li></ul></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-15-43-11.png" alt="2020-06-12-15-43-11"></p> <p>🌰 上图示例中:</p> <ul><li>Fly-By-Night-ISP 只需要向外界通告, 它接收所有目标地址前 20 位于 <code>200.23.16.0</code> 的前 20 为相匹配的数据报;</li> <li>外部也不需要知道在数据块 <code>200.23.16.0/20</code> 内部还有其他 8 个子网, 外部只要一股脑地把所有匹配的数据报都传过来就行;</li></ul> <h4 id="dhcp-动态主机配置协议"><a href="#dhcp-动态主机配置协议" class="header-anchor">#</a> DHCP 动态主机配置协议</h4> <p>一个组织获得一个『 网段 』后, 就可以给组织内的主机和路由器的『 接口 』逐个地分配『 IP 地址 』了;</p> <ul><li>地址地分配可以让网络管理员手动设置;</li> <li>但更多地是使用『 <strong>动态主机配置协议</strong> Dynamic Host Configuration, DHCP 』来完成;
<ul><li><ins>DHCP 可以自动给连入网络的接口分配 IP 地址.</ins> 网络管理员也可以通过设置 DHCP 让指定地某些接口每次都被分配到相同 IP 地址.</li> <li>DHCP 又被称为『 <strong>即插即用协议</strong> plug-and-play protocol 』因为它让一个主机自动地连接进一个网络;</li> <li>DHCP 协议广泛应用于会有主机频繁加入 / 离开的网络. E.g. 学校, 公司的无线局域网, 家庭网络, etc.</li></ul></li></ul> <hr> <p>DHCP 是一个『 <strong>客户-服务器协议</strong> 』</p> <ul><li>需要提供一个『 DHCP 服务器 』, 或『 DHCP 中继代理 』它知道 DHCP 服务器的地址;</li> <li>『 新来的主机 』需要向『 DHCP 服务器 』请求自己的『 IP 地址 』;</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-16-08-19.png" alt="2020-06-12-16-08-19"></p> <p>🌰 上图 👆 中『 DHCP 服务器 』连接在子网 <code>223.1.2/24</code> 上, 一台具备『 DHCP 中继代理 』服务的路由器, 为连接在子网 <code>223.1.1/24</code> 和 <code>223.1.3/24</code> 的主机提供 DHCP 服务;</p> <p><strong>获取 IP 地址的四步骤:</strong></p> <p>对于一台新到来的主机, 想要请求 DHCP 服务器获取 IP 地址需要经历 4 步:</p> <ul><li><strong>DHCP 服务器发现</strong>:
<ul><li>新到的主机刚开始并不知道 DHCP 服务器的 IP 地址;</li> <li>这时, DHCP 客户生成包含『 <strong>DHCP 发现报文</strong> 』的数据报;</li> <li>使用『 广播目的地址 』<code>255.255.255.255</code> 并使用 <code>0.0.0.0</code> 作为『 源地址 』</li> <li>然后将数据报传递给链路层, 链路层会将这个分组广播给所有连入该子网的主机;</li></ul></li> <li><strong>DHCP 服务器提供</strong>:
<ul><li>DHCP 服务器收到 DHCP 发现报文后, 用一个『 <strong>DHCP 提供报文</strong> 』向客户做出响应. 仍旧使用『 广播目的地址 』<code>255.255.255.255</code>;</li> <li>DHCP 提供报文中包含『 收到的发现报文的事务 ID 』『 向客户推荐的 IP 地址 』『 网络掩码 』『 IP 地址租用期 』</li></ul></li> <li><strong>DHCP 请求</strong>:
<ul><li>可能在子网中有多个 DHCP 服务器, 新来的主机可能同时收到多个 DHCP 提供报文;</li> <li>客户需要在这些响应回来的 DHCP 提供报文中选择一个, 并向选中的 DHCP 服务器发送一个『 <strong>DHCP 请求报文</strong> 』以作为响应;</li></ul></li> <li><strong>DHCP ACK</strong>:
<ul><li>DHCP 服务器用『 <strong>DHCP ACK 报文</strong> 』作为对客户的响应;</li> <li>客户接收到后, 就可以在租用期内使用分配的 IP 地址了;</li></ul></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-16-10-38.png" alt="2020-06-12-16-10-38"></p> <h4 id="网络地址转换"><a href="#网络地址转换" class="header-anchor">#</a> 网络地址转换</h4> <p>因为 IP 地址的数量是有限了, 随着因特网中主机数量的增多, 很难让每台主机都有一个全球唯一的 IP 地址. 所以需要将 IP 地址分为:</p> <ul><li><strong>全局 IP 地址</strong>: 必须是全球唯一的;</li> <li><strong>私有 IP 地址</strong>: 只要在同一个域里保持唯一便可，在不同域里可以重复;</li></ul> <p>下图 👇 是私有 IP 地址的可选范围:</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-17-05-30.png" alt="2020-06-12-17-05-30"></p> <p>但是『 私有 IP 地址 』只能在同一网络中作为唯一标识, 当主机要发送 / 接收分组到外部的『 全球因特网 』中时, 『 私 IP 有地址 』就不可以用作『 源地址 』, 或『 目的地址 』了</p> <p>需要使用『 <strong>网络地址转换</strong> Network Address Translator, NAT 』服务, 它是用以在『 私有 IP 地址 』和『 全局 IP 地址 』之间进行转换;</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-17-12-06.png" alt="2020-06-12-17-12-06"></p> <p>NAT 运行在路由器上, 在 NAT 路由器内部有一张自动生成的用于地址转换的『 <strong>NAT 转换表</strong> 』当有数据报经过路由器转发时, 路由器会根据『 转换表 』修改『 目的地址 』或者『 源地址 』</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-17-16-06.png" alt="2020-06-12-17-16-06"></p> <h3 id="因特网控制报文协议"><a href="#因特网控制报文协议" class="header-anchor">#</a> 因特网控制报文协议</h3> <p>『 <strong>因特网控制报文协议 ICMP</strong> 』用来在主机和路由器间来彼此沟通网络层的信息. 最常见的用途是『 <strong>差错报告</strong> 』</p> <ul><li>🌰 假如路由器不能为某个分组找到转发的路径, 该路由器就会向源主机发送一个 ICMP 报文以示错误;</li></ul> <p>从网络层次上来讲:</p> <ul><li>ICMP 协议位于 IP 协议之上;</li> <li>ICMP 报文是作为 IP 数据报的有效载荷承载的;</li> <li>接收方会将 ICMP 报文从 IP 数据报中分解出来, 然后传递给 ICMP 协议层处理. 只不过我们把 ICMP 协议层也算在网络层之中;</li></ul> <p><strong>ICMP 报文格式</strong></p> <ul><li>报文首部有『 类型字段 』和『 代码字段 』, 通过不同值的组合, 表示不同的报文类型;</li> <li>为了能确认引发差错的数据报, ICMP 报文数据部分包含, 引发这次 IMCP 报文生成的 IP 数据报的首部, 和有效载荷的前 8 个字节内容;</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-21-46-51.png" alt="2020-06-12-21-46-51"></p> <p>下图 👇 是一些常见的『 ICMP 消息类型 』, 及对应的类型值和代码值:</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-21-41-20.png" alt="2020-06-12-21-41-20"></p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-21-49-31.png" alt="2020-06-12-21-49-31"></p> <h3 id="ipv6"><a href="#ipv6" class="header-anchor">#</a> IPv6</h3> <p>因为 IPv4 的 32 比特长度的 IP 地址不够用, 所以为了应对更大的 IP 地址空间需求, 就开发出了 IPv6 协议. 同时 IPv6 的设计者也顺便改进强化了 IPv4 的很多方面.</p> <h4 id="ipv6-的地址表示"><a href="#ipv6-的地址表示" class="header-anchor">#</a> IPv6 的地址表示</h4> <p>IPv4 的地址长度为 32 位, 而 <strong>IPv6 的地址长度为 128 位</strong>. 这个地址长度甚至可以给地球上每一粒沙子都赋予唯一的 IP 地址;</p> <p><strong>128 位比特被分为 8 组, 每组 16 个比特, 用 16 进制表示. 每组之间用 <code>:</code> 冒号隔开</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">2001</span>:3CA1:010F:001A:121B:0000:0000:0010
</code></pre></div><hr> <p>IPv6 地址中可能会出现很多 <code>0</code>, 为了书写简便, 有如下的简写规则:</p> <ul><li>忽略前导 <code>0</code></li> <li>忽略全 <code>0</code>:
<ul><li>前后两个 <code>:</code> 合并为 <code>::</code></li> <li>但是注意一个地址最多只能有一个双冒号;</li></ul></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-13-11-23-59.png" alt="2020-06-13-11-23-59"></p> <h4 id="ipv6-数据报格式"><a href="#ipv6-数据报格式" class="header-anchor">#</a> IPv6 数据报格式</h4> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-22-01-48.png" alt="2020-06-12-22-01-48"></p> <ul><li><strong>版本</strong>: 标识 IP 版本号;</li> <li><strong>流量类型</strong>: 和 IPv4 中服务类型相似, 用以指出一个流中某些数据报的优先级;</li> <li><strong>流标签</strong>: 用于标识一条数据报的流;</li> <li><strong>有效载荷长度</strong>: 作为一个无符号整数, 表示数据报有效载荷的长度;</li> <li><strong>下一个首部</strong>: 标识数据报中的内容（ 有效载荷 ）需要交付给哪个协议 ( E.g. TCP / UDP ) 该字段使用与 IPv4 首部中协议字段相同的值;</li> <li><strong>跳限制</strong>: 转发数据报的每台路由器将对该字段的内容减 1，如果跳限制计数到达 0 时，则该数据报将被丢弃;</li> <li><strong>源地址 &amp; 目的地址</strong></li> <li><strong>数据</strong>: 有效载荷部分;</li> <li><strong>分片 / 重新组装</strong>: IPv6 不允许数据报在中间路由器上被分片 / 重组. 分片 / 重组操作只能在源 / 目的地主机上执行:
<ul><li>如果路由器接收到的 IPv6 数据报太大, 则只能丢弃;</li> <li>并且向发送方发送一个『 分组太大 』ICMP 差错报文;</li> <li>发送方收到 ICMP 报文后, 将数据报拆分成更小的数据报重新发送;</li></ul></li> <li><strong>首部校验和</strong></li> <li><strong>选项</strong></li></ul> <p>下图 👇 展示了 <strong>IPv4 和 IPv6 数据报的首部字段的对比</strong>:</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-06-12-22-09-06.png" alt="2020-06-12-22-09-06"></p> <h2 id="路由选择算法"><a href="#路由选择算法" class="header-anchor">#</a> 路由选择算法</h2> <h3 id="链路状态路由选择算法"><a href="#链路状态路由选择算法" class="header-anchor">#</a> 链路状态路由选择算法</h3> <h3 id="距离向量路由选择算法"><a href="#距离向量路由选择算法" class="header-anchor">#</a> 距离向量路由选择算法</h3> <h3 id="层次路由选择"><a href="#层次路由选择" class="header-anchor">#</a> 层次路由选择</h3> <h2 id="因特网中的路由选择"><a href="#因特网中的路由选择" class="header-anchor">#</a> 因特网中的路由选择</h2> <h2 id="广播-多播路由选择"><a href="#广播-多播路由选择" class="header-anchor">#</a> 广播 &amp; 多播路由选择</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">7/3/2020, 4:14:54 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/my-notebook/assets/js/app.f28c00e1.js" defer></script><script src="/my-notebook/assets/js/2.a47e0c14.js" defer></script><script src="/my-notebook/assets/js/248.ccce8d4c.js" defer></script>
  </body>
</html>
