<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>构建 API 接口 | Garrik 的笔记</title>
    <meta name="description" content="这里是 Garrik 的前端笔记本">
    
    
    <link rel="preload" href="/front-end-notebook/assets/css/47.styles.a900a631.css" as="style"><link rel="preload" href="/front-end-notebook/assets/js/app.1d6c1b09.js" as="script"><link rel="preload" href="/front-end-notebook/assets/js/34.abe68472.js" as="script"><link rel="prefetch" href="/front-end-notebook/assets/js/24.08f9b358.js"><link rel="prefetch" href="/front-end-notebook/assets/js/1.c29ae3b2.js"><link rel="prefetch" href="/front-end-notebook/assets/js/2.bcebbc1b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/3.41b08412.js"><link rel="prefetch" href="/front-end-notebook/assets/js/4.630738c1.js"><link rel="prefetch" href="/front-end-notebook/assets/js/5.a2a7de4a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/6.25d2a271.js"><link rel="prefetch" href="/front-end-notebook/assets/js/7.407eee17.js"><link rel="prefetch" href="/front-end-notebook/assets/js/8.e05cba33.js"><link rel="prefetch" href="/front-end-notebook/assets/js/9.9ae6dfd4.js"><link rel="prefetch" href="/front-end-notebook/assets/js/10.bd609ad2.js"><link rel="prefetch" href="/front-end-notebook/assets/js/11.e6ab09a6.js"><link rel="prefetch" href="/front-end-notebook/assets/js/12.58fc0886.js"><link rel="prefetch" href="/front-end-notebook/assets/js/13.0af47f9a.js"><link rel="prefetch" href="/front-end-notebook/assets/js/14.6b588b00.js"><link rel="prefetch" href="/front-end-notebook/assets/js/15.cbfd0813.js"><link rel="prefetch" href="/front-end-notebook/assets/js/16.f6b37904.js"><link rel="prefetch" href="/front-end-notebook/assets/js/17.18381f43.js"><link rel="prefetch" href="/front-end-notebook/assets/js/18.7d9dee60.js"><link rel="prefetch" href="/front-end-notebook/assets/js/19.cebdc9eb.js"><link rel="prefetch" href="/front-end-notebook/assets/js/20.02576000.js"><link rel="prefetch" href="/front-end-notebook/assets/js/21.61add938.js"><link rel="prefetch" href="/front-end-notebook/assets/js/22.5126371d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/23.55e8dfea.js"><link rel="prefetch" href="/front-end-notebook/assets/js/0.d8d181bf.js"><link rel="prefetch" href="/front-end-notebook/assets/js/25.a5671712.js"><link rel="prefetch" href="/front-end-notebook/assets/js/26.41468e57.js"><link rel="prefetch" href="/front-end-notebook/assets/js/27.9448c517.js"><link rel="prefetch" href="/front-end-notebook/assets/js/28.c077855e.js"><link rel="prefetch" href="/front-end-notebook/assets/js/29.1bea08f2.js"><link rel="prefetch" href="/front-end-notebook/assets/js/30.468cb5d9.js"><link rel="prefetch" href="/front-end-notebook/assets/js/31.3c8c6955.js"><link rel="prefetch" href="/front-end-notebook/assets/js/32.1da8ca4d.js"><link rel="prefetch" href="/front-end-notebook/assets/js/33.d7c0cb7f.js"><link rel="prefetch" href="/front-end-notebook/assets/js/35.ea93ddad.js"><link rel="prefetch" href="/front-end-notebook/assets/js/36.86a8a46f.js"><link rel="prefetch" href="/front-end-notebook/assets/js/37.6ba40a55.js"><link rel="prefetch" href="/front-end-notebook/assets/js/38.e8d1b70b.js"><link rel="prefetch" href="/front-end-notebook/assets/js/39.c1654825.js"><link rel="prefetch" href="/front-end-notebook/assets/js/40.2cd713b8.js"><link rel="prefetch" href="/front-end-notebook/assets/js/41.68626920.js"><link rel="prefetch" href="/front-end-notebook/assets/js/42.26b4a212.js"><link rel="prefetch" href="/front-end-notebook/assets/js/43.87c27475.js"><link rel="prefetch" href="/front-end-notebook/assets/js/44.7b3b5cae.js"><link rel="prefetch" href="/front-end-notebook/assets/js/45.f61cf4ee.js"><link rel="prefetch" href="/front-end-notebook/assets/js/46.97106d8d.js">
    <link rel="stylesheet" href="/front-end-notebook/assets/css/47.styles.a900a631.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/front-end-notebook/" class="home-link router-link-active"><!----><span class="site-name">
      Garrik 的笔记
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end-notebook/" class="nav-link">主页</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end-notebook/" class="nav-link">主页</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>构建 API 接口</span><!----></p><ul class="sidebar-group-items"><li><a href="/front-end-notebook/nodejs/Express/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%9E%84%E5%BB%BAAPI%E6%8E%A5%E5%8F%A3.html#express-驱动的-json-api-服务" class="sidebar-link">Express 驱动的 JSON API 服务</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/front-end-notebook/nodejs/Express/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%9E%84%E5%BB%BAAPI%E6%8E%A5%E5%8F%A3.html#curd-操作-api" class="sidebar-link">CURD 操作 API</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-notebook/nodejs/Express/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%9E%84%E5%BB%BAAPI%E6%8E%A5%E5%8F%A3.html#http-方法" class="sidebar-link">HTTP 方法</a></li><li class="sidebar-sub-header"><a href="/front-end-notebook/nodejs/Express/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%9E%84%E5%BB%BAAPI%E6%8E%A5%E5%8F%A3.html#通过-http-方法构建-crud-接口" class="sidebar-link">通过 HTTP 方法构建 CRUD 接口</a></li></ul></li><li><a href="/front-end-notebook/nodejs/Express/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%9E%84%E5%BB%BAAPI%E6%8E%A5%E5%8F%A3.html#api-版本控制" class="sidebar-link">API 版本控制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/front-end-notebook/nodejs/Express/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E6%9E%84%E5%BB%BAAPI%E6%8E%A5%E5%8F%A3.html#示例代码" class="sidebar-link">示例代码</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="构建-api-接口"><a href="#构建-api-接口" aria-hidden="true" class="header-anchor">#</a> 构建 API 接口</h1><blockquote><p>API (Application Programming Interface, 应用程序编程接口)</p></blockquote><p>其实 API 就是一种代码之间交互的一种方式, 例如，Express 中的 <code>app.use</code> 和 <code>app.get</code> 就属于在内部使用 API 。</p><h2 id="express-驱动的-json-api-服务"><a href="#express-驱动的-json-api-服务" aria-hidden="true" class="header-anchor">#</a> Express 驱动的 JSON API 服务</h2><p>使用 Express 构建 API 实现的原理非常简单：通过 中间件 和 内置函数 解析网络请求 并将 JSON 数据和 HTTP 状态码封装到 响应对象 并返回给 客户端。</p><blockquote><p>在这一篇里, API 返回的数据全部是 JSON.</p></blockquote><p>Express 构建 API 的基本流程：</p><ul><li>解析请求</li><li>设置 HTTP 状态码</li><li>返回响应数据</li></ul><h2 id="curd-操作-api"><a href="#curd-操作-api" aria-hidden="true" class="header-anchor">#</a> CURD 操作 API</h2><p>CURD 是对程序中 Create、Read、Update、Delete 四种业务动作的一个简称。(增删改查))</p><p>大多数的应用都会涉及到 CURD 操作。例如，对于一个图片分享应用来说，其中涉及图片的所有操作就是典型的 CRUD：</p><ul><li>用户上传照片的行为对应就是 create 操作。</li><li>用户浏览照片的行为就是 read 操作。</li><li>用户更新照片的行为就是 update 操作。</li><li>用户删除照片的行为就是 delete 操作。</li></ul><h3 id="http-方法"><a href="#http-方法" aria-hidden="true" class="header-anchor">#</a> HTTP 方法</h3><p>HTTP 方法明确了对请求 URI 所标识资源进行的操作，而且方法是区分大小写的。</p><p>常用方法:</p><ul><li>GET 是最常用的一个 HTTP 方法，它表示请求服务端资源。例如，加载网站首页、请求图片资源都使用的是 GET。虽然服务端的响应可能不同，但是 <strong>GET 请求并不会改变服务器的资源</strong>。例如，对某图片资源的一次或者多次请求并不会导致图片本身出现任何差别。</li><li>POST 是另一个常用的 HTTP 方法。例如，创建新博客、上传照片、注册用户、清空购物车等业务都是使用 POST 。与 GET 不同的是：<strong>每次 POST 请求都会导致服务端发生修改。</strong></li><li>PUT 方法用于对已有记录的修改，所有我觉得它应该被称为 &quot;UPDATE&quot; 更为合适。例如，修改博客标题、修改用户昵称等操作都是 PUT 操作。另外，PUT 还具备 POST 的功能：就是当要修改的记录不存在时可以进行新建操作（非必需）。其次 PUT 还具有 GET 方法的特点：对同一 URL 的一次或多次 PUT 请求后的结果是一致的。</li><li>DELETE 方法用于记录删除。例如，删除用户文章、删除网络照片。另外，与 PUT 一样同一删除请求无论是执行一次还是多次最终结果是一致的。</li></ul><h3 id="通过-http-方法构建-crud-接口"><a href="#通过-http-方法构建-crud-接口" aria-hidden="true" class="header-anchor">#</a> 通过 HTTP 方法构建 CRUD 接口</h3><p>CRUD 操作与之前四种 HTTP 方法存在对应关系：</p><ul><li>Create = POST</li><li>Read = GET</li><li>Update = PUT</li><li>Delete = DELETE</li></ul><h2 id="api-版本控制"><a href="#api-版本控制" aria-hidden="true" class="header-anchor">#</a> API 版本控制</h2><p>在 Express 中可以使用 Router 中间件来实现 API 版本管理</p><p>通过把路由绑定在 Router 实例上, 然后再把 Router 挂载在特定路径上可以实现 API 版本控制</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> api <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

api<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/getSome&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Some Message...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


module<span class="token punctuation">.</span>exports <span class="token operator">=</span> api<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> apiVersion1 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./api1.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&quot;/v1&quot;</span><span class="token punctuation">,</span> apiVersion1<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;App started on port 3000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="示例代码"><a href="#示例代码" aria-hidden="true" class="header-anchor">#</a> 示例代码</h2><p>实现一个指明 最大值 和 最小值, 返回随机数字的 API.</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/random/:min/:max'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> min <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>min<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> max <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 错误处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>min<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> error<span class="token punctuation">:</span> <span class="token string">&quot;Bad request.&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>max <span class="token operator">-</span> min<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> min<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span> result<span class="token punctuation">:</span> result <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;监听 3000 端口!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div><div class="page-edit"><!----><!----></div><!----></div></div></div>
    <script src="/front-end-notebook/assets/js/34.abe68472.js" defer></script><script src="/front-end-notebook/assets/js/app.1d6c1b09.js" defer></script>
  </body>
</html>
