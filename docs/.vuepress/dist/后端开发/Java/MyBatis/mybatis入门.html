<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mybatis 入门 | Garrik 的笔记</title>
    <meta name="description" content="这里是 Garrik 的前端笔记本">
    
    
    <link rel="preload" href="/my-notebook/assets/css/0.styles.150b63c7.css" as="style"><link rel="preload" href="/my-notebook/assets/js/app.f6b14fc8.js" as="script"><link rel="preload" href="/my-notebook/assets/js/2.a47e0c14.js" as="script"><link rel="preload" href="/my-notebook/assets/js/127.5643b8f1.js" as="script"><link rel="prefetch" href="/my-notebook/assets/js/10.c0025701.js"><link rel="prefetch" href="/my-notebook/assets/js/100.77f3390f.js"><link rel="prefetch" href="/my-notebook/assets/js/101.8d7b5a71.js"><link rel="prefetch" href="/my-notebook/assets/js/102.c0edacd5.js"><link rel="prefetch" href="/my-notebook/assets/js/103.21f83829.js"><link rel="prefetch" href="/my-notebook/assets/js/104.d29553ce.js"><link rel="prefetch" href="/my-notebook/assets/js/105.aa4e9f8c.js"><link rel="prefetch" href="/my-notebook/assets/js/106.0973d544.js"><link rel="prefetch" href="/my-notebook/assets/js/107.3cbb4eb9.js"><link rel="prefetch" href="/my-notebook/assets/js/108.4bdce89e.js"><link rel="prefetch" href="/my-notebook/assets/js/109.d9e5a443.js"><link rel="prefetch" href="/my-notebook/assets/js/11.ce9066e4.js"><link rel="prefetch" href="/my-notebook/assets/js/110.586e454e.js"><link rel="prefetch" href="/my-notebook/assets/js/111.2c9063ac.js"><link rel="prefetch" href="/my-notebook/assets/js/112.a4b595b5.js"><link rel="prefetch" href="/my-notebook/assets/js/113.9d9acf16.js"><link rel="prefetch" href="/my-notebook/assets/js/114.438192fc.js"><link rel="prefetch" href="/my-notebook/assets/js/115.e575ac2c.js"><link rel="prefetch" href="/my-notebook/assets/js/116.29047d29.js"><link rel="prefetch" href="/my-notebook/assets/js/117.a2f93a89.js"><link rel="prefetch" href="/my-notebook/assets/js/118.f0c5bad3.js"><link rel="prefetch" href="/my-notebook/assets/js/119.4dd189a0.js"><link rel="prefetch" href="/my-notebook/assets/js/12.db517654.js"><link rel="prefetch" href="/my-notebook/assets/js/120.7f9f67be.js"><link rel="prefetch" href="/my-notebook/assets/js/121.accdc5b8.js"><link rel="prefetch" href="/my-notebook/assets/js/122.a0e492f7.js"><link rel="prefetch" href="/my-notebook/assets/js/123.49f82f56.js"><link rel="prefetch" href="/my-notebook/assets/js/124.4ed929cb.js"><link rel="prefetch" href="/my-notebook/assets/js/125.2855edbc.js"><link rel="prefetch" href="/my-notebook/assets/js/126.51c36547.js"><link rel="prefetch" href="/my-notebook/assets/js/128.e50b36c2.js"><link rel="prefetch" href="/my-notebook/assets/js/129.d85b7d6d.js"><link rel="prefetch" href="/my-notebook/assets/js/13.9a0c5583.js"><link rel="prefetch" href="/my-notebook/assets/js/130.b8757adf.js"><link rel="prefetch" href="/my-notebook/assets/js/131.00759e81.js"><link rel="prefetch" href="/my-notebook/assets/js/132.41165fdf.js"><link rel="prefetch" href="/my-notebook/assets/js/133.14ea79dd.js"><link rel="prefetch" href="/my-notebook/assets/js/134.369b2f8e.js"><link rel="prefetch" href="/my-notebook/assets/js/135.f39cdc18.js"><link rel="prefetch" href="/my-notebook/assets/js/136.7596240d.js"><link rel="prefetch" href="/my-notebook/assets/js/137.4f61ff36.js"><link rel="prefetch" href="/my-notebook/assets/js/138.3016ae4c.js"><link rel="prefetch" href="/my-notebook/assets/js/139.a61b1901.js"><link rel="prefetch" href="/my-notebook/assets/js/14.fbf1f207.js"><link rel="prefetch" href="/my-notebook/assets/js/140.986b6706.js"><link rel="prefetch" href="/my-notebook/assets/js/141.57314423.js"><link rel="prefetch" href="/my-notebook/assets/js/142.5bed2b99.js"><link rel="prefetch" href="/my-notebook/assets/js/143.634f49aa.js"><link rel="prefetch" href="/my-notebook/assets/js/144.33815800.js"><link rel="prefetch" href="/my-notebook/assets/js/145.9a7d207f.js"><link rel="prefetch" href="/my-notebook/assets/js/146.334fba92.js"><link rel="prefetch" href="/my-notebook/assets/js/147.9da4bcec.js"><link rel="prefetch" href="/my-notebook/assets/js/148.9456ddaf.js"><link rel="prefetch" href="/my-notebook/assets/js/149.e64bd167.js"><link rel="prefetch" href="/my-notebook/assets/js/15.265341ca.js"><link rel="prefetch" href="/my-notebook/assets/js/150.5c18fb67.js"><link rel="prefetch" href="/my-notebook/assets/js/151.6f26d54e.js"><link rel="prefetch" href="/my-notebook/assets/js/152.6e2dff08.js"><link rel="prefetch" href="/my-notebook/assets/js/153.c71acec2.js"><link rel="prefetch" href="/my-notebook/assets/js/154.41b24240.js"><link rel="prefetch" href="/my-notebook/assets/js/155.1e4fce5d.js"><link rel="prefetch" href="/my-notebook/assets/js/156.f23bff93.js"><link rel="prefetch" href="/my-notebook/assets/js/157.29179a28.js"><link rel="prefetch" href="/my-notebook/assets/js/158.79a56df1.js"><link rel="prefetch" href="/my-notebook/assets/js/159.1487a005.js"><link rel="prefetch" href="/my-notebook/assets/js/16.b2b40e8b.js"><link rel="prefetch" href="/my-notebook/assets/js/160.11e374ab.js"><link rel="prefetch" href="/my-notebook/assets/js/161.1afe152f.js"><link rel="prefetch" href="/my-notebook/assets/js/162.a3c0b496.js"><link rel="prefetch" href="/my-notebook/assets/js/163.3c5bfcf4.js"><link rel="prefetch" href="/my-notebook/assets/js/164.5ae51574.js"><link rel="prefetch" href="/my-notebook/assets/js/165.70d67f5d.js"><link rel="prefetch" href="/my-notebook/assets/js/166.dd798024.js"><link rel="prefetch" href="/my-notebook/assets/js/167.a7488e6a.js"><link rel="prefetch" href="/my-notebook/assets/js/168.86712521.js"><link rel="prefetch" href="/my-notebook/assets/js/169.8b6c4ca1.js"><link rel="prefetch" href="/my-notebook/assets/js/17.44074a8d.js"><link rel="prefetch" href="/my-notebook/assets/js/170.f6a8e931.js"><link rel="prefetch" href="/my-notebook/assets/js/171.8015fbba.js"><link rel="prefetch" href="/my-notebook/assets/js/172.c5bbdac7.js"><link rel="prefetch" href="/my-notebook/assets/js/173.f3878756.js"><link rel="prefetch" href="/my-notebook/assets/js/174.b5cb2de6.js"><link rel="prefetch" href="/my-notebook/assets/js/175.aa064920.js"><link rel="prefetch" href="/my-notebook/assets/js/176.fb821dfa.js"><link rel="prefetch" href="/my-notebook/assets/js/177.4a762d9e.js"><link rel="prefetch" href="/my-notebook/assets/js/178.c319fefb.js"><link rel="prefetch" href="/my-notebook/assets/js/179.d370a909.js"><link rel="prefetch" href="/my-notebook/assets/js/18.482dad08.js"><link rel="prefetch" href="/my-notebook/assets/js/180.6e794302.js"><link rel="prefetch" href="/my-notebook/assets/js/181.06c30c63.js"><link rel="prefetch" href="/my-notebook/assets/js/182.2171df0f.js"><link rel="prefetch" href="/my-notebook/assets/js/183.bb3b377a.js"><link rel="prefetch" href="/my-notebook/assets/js/184.d246b6eb.js"><link rel="prefetch" href="/my-notebook/assets/js/185.832ef8a8.js"><link rel="prefetch" href="/my-notebook/assets/js/186.ea6f29c7.js"><link rel="prefetch" href="/my-notebook/assets/js/187.b99fd4ea.js"><link rel="prefetch" href="/my-notebook/assets/js/188.47ea80ea.js"><link rel="prefetch" href="/my-notebook/assets/js/189.6f248b90.js"><link rel="prefetch" href="/my-notebook/assets/js/19.ed451f4b.js"><link rel="prefetch" href="/my-notebook/assets/js/190.4794c621.js"><link rel="prefetch" href="/my-notebook/assets/js/191.95ccaf7d.js"><link rel="prefetch" href="/my-notebook/assets/js/192.7c79b8ef.js"><link rel="prefetch" href="/my-notebook/assets/js/193.2f87b3b0.js"><link rel="prefetch" href="/my-notebook/assets/js/194.e7c3dae8.js"><link rel="prefetch" href="/my-notebook/assets/js/195.a6096d64.js"><link rel="prefetch" href="/my-notebook/assets/js/196.9951793a.js"><link rel="prefetch" href="/my-notebook/assets/js/197.958354ca.js"><link rel="prefetch" href="/my-notebook/assets/js/198.f8cae668.js"><link rel="prefetch" href="/my-notebook/assets/js/199.43ba38da.js"><link rel="prefetch" href="/my-notebook/assets/js/20.f76bd7a0.js"><link rel="prefetch" href="/my-notebook/assets/js/200.9328cb1d.js"><link rel="prefetch" href="/my-notebook/assets/js/201.ad04d0a1.js"><link rel="prefetch" href="/my-notebook/assets/js/202.d8cd6e6c.js"><link rel="prefetch" href="/my-notebook/assets/js/203.a2539804.js"><link rel="prefetch" href="/my-notebook/assets/js/204.9ca0729d.js"><link rel="prefetch" href="/my-notebook/assets/js/205.ec23c8d6.js"><link rel="prefetch" href="/my-notebook/assets/js/206.99e142bd.js"><link rel="prefetch" href="/my-notebook/assets/js/207.6065af19.js"><link rel="prefetch" href="/my-notebook/assets/js/208.e12388ca.js"><link rel="prefetch" href="/my-notebook/assets/js/209.b1cd20eb.js"><link rel="prefetch" href="/my-notebook/assets/js/21.040d0bbd.js"><link rel="prefetch" href="/my-notebook/assets/js/210.f583552b.js"><link rel="prefetch" href="/my-notebook/assets/js/211.ce553a79.js"><link rel="prefetch" href="/my-notebook/assets/js/212.16e37776.js"><link rel="prefetch" href="/my-notebook/assets/js/213.8047b35a.js"><link rel="prefetch" href="/my-notebook/assets/js/214.7f97fe88.js"><link rel="prefetch" href="/my-notebook/assets/js/215.e5a8db96.js"><link rel="prefetch" href="/my-notebook/assets/js/216.27ea9987.js"><link rel="prefetch" href="/my-notebook/assets/js/217.43b4f8db.js"><link rel="prefetch" href="/my-notebook/assets/js/218.5bea85d5.js"><link rel="prefetch" href="/my-notebook/assets/js/219.75c758db.js"><link rel="prefetch" href="/my-notebook/assets/js/22.bbe98ab0.js"><link rel="prefetch" href="/my-notebook/assets/js/220.627d8878.js"><link rel="prefetch" href="/my-notebook/assets/js/221.40debd1b.js"><link rel="prefetch" href="/my-notebook/assets/js/222.ea9d13ee.js"><link rel="prefetch" href="/my-notebook/assets/js/223.f28d99ad.js"><link rel="prefetch" href="/my-notebook/assets/js/224.bcb32c8b.js"><link rel="prefetch" href="/my-notebook/assets/js/225.c4e4b351.js"><link rel="prefetch" href="/my-notebook/assets/js/226.5d5bca87.js"><link rel="prefetch" href="/my-notebook/assets/js/227.9c678089.js"><link rel="prefetch" href="/my-notebook/assets/js/228.ebb0614d.js"><link rel="prefetch" href="/my-notebook/assets/js/229.e90c46ac.js"><link rel="prefetch" href="/my-notebook/assets/js/23.d223944d.js"><link rel="prefetch" href="/my-notebook/assets/js/230.0da0f6d5.js"><link rel="prefetch" href="/my-notebook/assets/js/231.735e0fde.js"><link rel="prefetch" href="/my-notebook/assets/js/232.1e77f194.js"><link rel="prefetch" href="/my-notebook/assets/js/233.199a9395.js"><link rel="prefetch" href="/my-notebook/assets/js/234.a1265257.js"><link rel="prefetch" href="/my-notebook/assets/js/235.50d4a23d.js"><link rel="prefetch" href="/my-notebook/assets/js/236.a951ba7c.js"><link rel="prefetch" href="/my-notebook/assets/js/237.83ad8c25.js"><link rel="prefetch" href="/my-notebook/assets/js/238.75b437b7.js"><link rel="prefetch" href="/my-notebook/assets/js/239.f68612fd.js"><link rel="prefetch" href="/my-notebook/assets/js/24.3530251d.js"><link rel="prefetch" href="/my-notebook/assets/js/240.6b6492d2.js"><link rel="prefetch" href="/my-notebook/assets/js/241.fd6da12a.js"><link rel="prefetch" href="/my-notebook/assets/js/242.44f193b6.js"><link rel="prefetch" href="/my-notebook/assets/js/243.e47b15aa.js"><link rel="prefetch" href="/my-notebook/assets/js/244.744e1a8a.js"><link rel="prefetch" href="/my-notebook/assets/js/245.22de7bf9.js"><link rel="prefetch" href="/my-notebook/assets/js/246.7f69d5bd.js"><link rel="prefetch" href="/my-notebook/assets/js/247.8985d527.js"><link rel="prefetch" href="/my-notebook/assets/js/248.2ffefc49.js"><link rel="prefetch" href="/my-notebook/assets/js/249.22c9d06b.js"><link rel="prefetch" href="/my-notebook/assets/js/25.720818fe.js"><link rel="prefetch" href="/my-notebook/assets/js/250.c3030d2e.js"><link rel="prefetch" href="/my-notebook/assets/js/251.ff67dd3d.js"><link rel="prefetch" href="/my-notebook/assets/js/252.9430a818.js"><link rel="prefetch" href="/my-notebook/assets/js/253.16a114b9.js"><link rel="prefetch" href="/my-notebook/assets/js/254.76ca3df4.js"><link rel="prefetch" href="/my-notebook/assets/js/255.13bd26d3.js"><link rel="prefetch" href="/my-notebook/assets/js/256.7041f2b7.js"><link rel="prefetch" href="/my-notebook/assets/js/257.77e4fbd1.js"><link rel="prefetch" href="/my-notebook/assets/js/258.178f7389.js"><link rel="prefetch" href="/my-notebook/assets/js/259.d1d443df.js"><link rel="prefetch" href="/my-notebook/assets/js/26.99ef3965.js"><link rel="prefetch" href="/my-notebook/assets/js/260.4c632cc2.js"><link rel="prefetch" href="/my-notebook/assets/js/261.f201b81b.js"><link rel="prefetch" href="/my-notebook/assets/js/262.5a6704dc.js"><link rel="prefetch" href="/my-notebook/assets/js/263.77322765.js"><link rel="prefetch" href="/my-notebook/assets/js/264.d4886915.js"><link rel="prefetch" href="/my-notebook/assets/js/265.167a4aef.js"><link rel="prefetch" href="/my-notebook/assets/js/266.67ab9ac2.js"><link rel="prefetch" href="/my-notebook/assets/js/267.17521725.js"><link rel="prefetch" href="/my-notebook/assets/js/268.4438a5cd.js"><link rel="prefetch" href="/my-notebook/assets/js/269.322a6c75.js"><link rel="prefetch" href="/my-notebook/assets/js/27.ec242d59.js"><link rel="prefetch" href="/my-notebook/assets/js/270.8d5062b9.js"><link rel="prefetch" href="/my-notebook/assets/js/271.11ed0495.js"><link rel="prefetch" href="/my-notebook/assets/js/272.76c6a2c2.js"><link rel="prefetch" href="/my-notebook/assets/js/273.18d49c5b.js"><link rel="prefetch" href="/my-notebook/assets/js/274.b95056bd.js"><link rel="prefetch" href="/my-notebook/assets/js/275.99da3eb2.js"><link rel="prefetch" href="/my-notebook/assets/js/276.ca02126c.js"><link rel="prefetch" href="/my-notebook/assets/js/277.3477d8fe.js"><link rel="prefetch" href="/my-notebook/assets/js/278.32d440ea.js"><link rel="prefetch" href="/my-notebook/assets/js/279.d9538edb.js"><link rel="prefetch" href="/my-notebook/assets/js/28.815afc26.js"><link rel="prefetch" href="/my-notebook/assets/js/280.ffedd234.js"><link rel="prefetch" href="/my-notebook/assets/js/281.76df62f3.js"><link rel="prefetch" href="/my-notebook/assets/js/282.15254e57.js"><link rel="prefetch" href="/my-notebook/assets/js/283.8fda7e51.js"><link rel="prefetch" href="/my-notebook/assets/js/284.24ac499d.js"><link rel="prefetch" href="/my-notebook/assets/js/285.5f04e8cb.js"><link rel="prefetch" href="/my-notebook/assets/js/286.663ad4a8.js"><link rel="prefetch" href="/my-notebook/assets/js/287.cde00e2c.js"><link rel="prefetch" href="/my-notebook/assets/js/288.5ddf14b2.js"><link rel="prefetch" href="/my-notebook/assets/js/289.63292fbb.js"><link rel="prefetch" href="/my-notebook/assets/js/29.ce1d0494.js"><link rel="prefetch" href="/my-notebook/assets/js/290.91237993.js"><link rel="prefetch" href="/my-notebook/assets/js/291.acf533ee.js"><link rel="prefetch" href="/my-notebook/assets/js/292.8b2d3986.js"><link rel="prefetch" href="/my-notebook/assets/js/293.8df3f710.js"><link rel="prefetch" href="/my-notebook/assets/js/294.17b9b4f6.js"><link rel="prefetch" href="/my-notebook/assets/js/295.c7b18bd0.js"><link rel="prefetch" href="/my-notebook/assets/js/3.db75fba4.js"><link rel="prefetch" href="/my-notebook/assets/js/30.0d2b8590.js"><link rel="prefetch" href="/my-notebook/assets/js/31.9ccff63a.js"><link rel="prefetch" href="/my-notebook/assets/js/32.3266252e.js"><link rel="prefetch" href="/my-notebook/assets/js/33.3ecbb5e2.js"><link rel="prefetch" href="/my-notebook/assets/js/34.30e6a58b.js"><link rel="prefetch" href="/my-notebook/assets/js/35.4f8dfec1.js"><link rel="prefetch" href="/my-notebook/assets/js/36.98af820e.js"><link rel="prefetch" href="/my-notebook/assets/js/37.e4bdabe1.js"><link rel="prefetch" href="/my-notebook/assets/js/38.f106b4e6.js"><link rel="prefetch" href="/my-notebook/assets/js/39.40896d68.js"><link rel="prefetch" href="/my-notebook/assets/js/4.fb5cabdf.js"><link rel="prefetch" href="/my-notebook/assets/js/40.fd18c848.js"><link rel="prefetch" href="/my-notebook/assets/js/41.d55fedb9.js"><link rel="prefetch" href="/my-notebook/assets/js/42.d6d5275a.js"><link rel="prefetch" href="/my-notebook/assets/js/43.3117608e.js"><link rel="prefetch" href="/my-notebook/assets/js/44.00e7f729.js"><link rel="prefetch" href="/my-notebook/assets/js/45.475c0bd0.js"><link rel="prefetch" href="/my-notebook/assets/js/46.36e1361f.js"><link rel="prefetch" href="/my-notebook/assets/js/47.0ef6f1bf.js"><link rel="prefetch" href="/my-notebook/assets/js/48.a93a1ce1.js"><link rel="prefetch" href="/my-notebook/assets/js/49.d87dda75.js"><link rel="prefetch" href="/my-notebook/assets/js/5.977f0fd9.js"><link rel="prefetch" href="/my-notebook/assets/js/50.4c870102.js"><link rel="prefetch" href="/my-notebook/assets/js/51.d61dd667.js"><link rel="prefetch" href="/my-notebook/assets/js/52.6d0df08f.js"><link rel="prefetch" href="/my-notebook/assets/js/53.23c9cfcf.js"><link rel="prefetch" href="/my-notebook/assets/js/54.52f3b9b5.js"><link rel="prefetch" href="/my-notebook/assets/js/55.ab521108.js"><link rel="prefetch" href="/my-notebook/assets/js/56.1656096a.js"><link rel="prefetch" href="/my-notebook/assets/js/57.1436e1a2.js"><link rel="prefetch" href="/my-notebook/assets/js/58.7d6e8bb3.js"><link rel="prefetch" href="/my-notebook/assets/js/59.cf18669b.js"><link rel="prefetch" href="/my-notebook/assets/js/6.eb0e2122.js"><link rel="prefetch" href="/my-notebook/assets/js/60.2cfa0313.js"><link rel="prefetch" href="/my-notebook/assets/js/61.79238355.js"><link rel="prefetch" href="/my-notebook/assets/js/62.e4ff68fa.js"><link rel="prefetch" href="/my-notebook/assets/js/63.b245769e.js"><link rel="prefetch" href="/my-notebook/assets/js/64.f665699c.js"><link rel="prefetch" href="/my-notebook/assets/js/65.7a4048a7.js"><link rel="prefetch" href="/my-notebook/assets/js/66.8bc5fa28.js"><link rel="prefetch" href="/my-notebook/assets/js/67.58955c29.js"><link rel="prefetch" href="/my-notebook/assets/js/68.aadd39c8.js"><link rel="prefetch" href="/my-notebook/assets/js/69.8a466f22.js"><link rel="prefetch" href="/my-notebook/assets/js/7.e710c845.js"><link rel="prefetch" href="/my-notebook/assets/js/70.9ab5ddce.js"><link rel="prefetch" href="/my-notebook/assets/js/71.415441a0.js"><link rel="prefetch" href="/my-notebook/assets/js/72.d30b2a1e.js"><link rel="prefetch" href="/my-notebook/assets/js/73.276f5652.js"><link rel="prefetch" href="/my-notebook/assets/js/74.0a732260.js"><link rel="prefetch" href="/my-notebook/assets/js/75.d9410aa7.js"><link rel="prefetch" href="/my-notebook/assets/js/76.5b8b35bf.js"><link rel="prefetch" href="/my-notebook/assets/js/77.5af2df75.js"><link rel="prefetch" href="/my-notebook/assets/js/78.ca55a96e.js"><link rel="prefetch" href="/my-notebook/assets/js/79.82f7ac6c.js"><link rel="prefetch" href="/my-notebook/assets/js/8.d5e5bc3d.js"><link rel="prefetch" href="/my-notebook/assets/js/80.b8ece275.js"><link rel="prefetch" href="/my-notebook/assets/js/81.007f9b65.js"><link rel="prefetch" href="/my-notebook/assets/js/82.52a6e4c1.js"><link rel="prefetch" href="/my-notebook/assets/js/83.b4b6db26.js"><link rel="prefetch" href="/my-notebook/assets/js/84.2ad6a45f.js"><link rel="prefetch" href="/my-notebook/assets/js/85.ae64e99a.js"><link rel="prefetch" href="/my-notebook/assets/js/86.32c69392.js"><link rel="prefetch" href="/my-notebook/assets/js/87.fc245287.js"><link rel="prefetch" href="/my-notebook/assets/js/88.03957820.js"><link rel="prefetch" href="/my-notebook/assets/js/89.66162f61.js"><link rel="prefetch" href="/my-notebook/assets/js/9.d6aaf884.js"><link rel="prefetch" href="/my-notebook/assets/js/90.f1c3f635.js"><link rel="prefetch" href="/my-notebook/assets/js/91.371a8688.js"><link rel="prefetch" href="/my-notebook/assets/js/92.1e8051df.js"><link rel="prefetch" href="/my-notebook/assets/js/93.db0ff7c7.js"><link rel="prefetch" href="/my-notebook/assets/js/94.18f233ca.js"><link rel="prefetch" href="/my-notebook/assets/js/95.a0d75e25.js"><link rel="prefetch" href="/my-notebook/assets/js/96.4c59cbd8.js"><link rel="prefetch" href="/my-notebook/assets/js/97.7ed2d81f.js"><link rel="prefetch" href="/my-notebook/assets/js/98.d7269992.js"><link rel="prefetch" href="/my-notebook/assets/js/99.8e7a3f7e.js">
    <link rel="stylesheet" href="/my-notebook/assets/css/0.styles.150b63c7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/my-notebook/" class="home-link router-link-active"><!----> <span class="site-name">Garrik 的笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/my-notebook/" class="nav-link">主页</a></div><div class="nav-item"><a href="https://github.com/Garrik-Liu/my-notebook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/my-notebook/" class="nav-link">主页</a></div><div class="nav-item"><a href="https://github.com/Garrik-Liu/my-notebook" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Mybatis 入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#什么是持久层" class="sidebar-link">什么是持久层</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#什么是-mybatis" class="sidebar-link">什么是 Mybatis</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#第一个-mybatis-实例" class="sidebar-link">第一个 Mybatis 实例</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#mybatis-xml-方式的基本用法" class="sidebar-link">MyBatis XML 方式的基本用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#一个简单的权限控制需求" class="sidebar-link">一个简单的权限控制需求</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#select" class="sidebar-link">SELECT</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#insert" class="sidebar-link">INSERT</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#update" class="sidebar-link">UPDATE</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#delete" class="sidebar-link">DELETE</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#接口方法接收多个参数" class="sidebar-link">接口方法接收多个参数</a></li></ul></li><li><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#mybatis-注解方式的基本用法" class="sidebar-link">MyBatis 注解方式的基本用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#select-2" class="sidebar-link">@Select</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#insert-2" class="sidebar-link">@Insert</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#update-2" class="sidebar-link">@Update</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#delete-2" class="sidebar-link">@Delete</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#provider-注解" class="sidebar-link">Provider 注解</a></li></ul></li><li><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#mybatis-动态-sql" class="sidebar-link">MyBatis 动态 SQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#ognl-用法" class="sidebar-link">OGNL 用法</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#if" class="sidebar-link">if</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#choose" class="sidebar-link">choose</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#where-set-trim" class="sidebar-link">where, set, trim</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#foreach" class="sidebar-link">foreach</a></li><li class="sidebar-sub-header"><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#bind" class="sidebar-link">bind</a></li></ul></li><li><a href="/my-notebook/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91/Java/MyBatis/mybatis%E5%85%A5%E9%97%A8.html#mybatis-代码生成器" class="sidebar-link">MyBatis 代码生成器</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mybatis-入门"><a href="#mybatis-入门" class="header-anchor">#</a> Mybatis 入门</h1> <ul><li>框架是整个或部分系统的可重用设计；</li> <li>它是我们软件开发中的一套解决方案。不同的框架解决不同的问题；</li> <li>框架封装了很多细节，是开发者可以使用简单的方式去实现功能。提高了开发效率；</li></ul> <h2 id="什么是持久层"><a href="#什么是持久层" class="header-anchor">#</a> 什么是持久层</h2> <ul><li>J2EE 是在 SUN 公司领导下，多家公司参与共同制定的企业级分布式应用程序开发规范；</li> <li>J2EE 中将整个应用分成三层架构：
<ul><li>表现层：User Interface；</li> <li>业务逻辑层：Business Logic Layer；</li> <li>数据访问层：Data Access Layer；</li></ul></li> <li>持久层又被称为 “数据访问层”。也就是用来负责对数据库的访问和操作；</li> <li>之前我们一直使用 JDBC 作为持久层技术解决方案，用它来访问和操作数据库；</li> <li>我们还了解过 Apache 的 BDUtils，它是对 JDBC 的简单封装；</li></ul> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>注意：J2EE 的三层架构和 MVC 设计模式是有区别的：</p> <ul><li><strong>相同点</strong>：在 MVC 和三层架构中，视图层都用来展示数据给用户；</li> <li><strong>不同点</strong>：
<ul><li>MVC 中，Model 层中包含了 “业务逻辑” 和 “数据库代码”；</li> <li>三层架构中，数据访问层只用来处理和数据库相关操作；</li> <li>三层架构中，业务逻辑层处理业务逻辑；</li> <li>三层架构的 “业务逻辑层” + “数据访问层” = MVC 的 Model 层；</li></ul></li> <li>MVC 中的 Controller 主要负责，告诉 Model 处理什么数据，然后告诉 View 展示什么数据；</li> <li>🌰 拿用户登录举例：
<ul><li><strong>View</strong>：用户在网页访问到登录的 HTML 页面，输入用户名和密码，点击登录，发送给服务器一条 POST 请求；</li> <li><strong>Controller</strong>：POST 请求被服务器的 Servlet 处理，拿出请求中的用户名和密码参数，然后传递给对应的 Service 方法；</li> <li><strong>Model</strong>：Service 方法中，拿用户名和密码去数据库进行查找和比对：
<ul><li>匹配成功：把数据库中这个用户的其他信息查询出来，然后创建 User 对象，返回给 Servlet；</li> <li>匹配失败：返回失败信息给 Servlet；</li></ul></li> <li><strong>Controller</strong>：Servlet 拿到返回后，再对浏览器进行响应；</li> <li><strong>View</strong>：浏览器通过拿到的响应，绘制页面；</li></ul></li></ul></div> <h2 id="什么是-mybatis"><a href="#什么是-mybatis" class="header-anchor">#</a> 什么是 Mybatis</h2> <ul><li>MyBatis 几乎可以代替 JDBC，是一个支持普通 SQL 查询，存储过程和高级映射的，基于 Java 的<strong>持久层框架</strong>；</li> <li>MyBatis 对 JDBC 进行了封装，屏蔽了 JDBC API 的底层访问细节，使程序对于数据库的访问和操作更加简便；</li> <li>MyBatis 使用了 ORM 思想实现了对结果集的封装；
<ul><li>ORM：Object Relational Mapping 对象关系映射；</li> <li>把数据库表和实体类，数据库表中字段和实体类的属性对应起来。让我们可以通过操作实体类就实现操作数据库表；</li></ul></li></ul> <h2 id="第一个-mybatis-实例"><a href="#第一个-mybatis-实例" class="header-anchor">#</a> 第一个 Mybatis 实例</h2> <p>👇 下面先来看一下如何去使用 Mybatis：</p> <h4 id="创建项目"><a href="#创建项目" class="header-anchor">#</a> 创建项目</h4> <ul><li>用 IDEA 编译器；</li> <li>使用 Maven 创建一个空的 Java 项目</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-16-1-29.png" alt="2020-3-1-16-1-29.png"></p> <h4 id="引入依赖"><a href="#引入依赖" class="header-anchor">#</a> 引入依赖</h4> <ul><li>在项目目录中的 <code>pom.xml</code> 文件中引入依赖；
<ul><li>mybatis</li> <li>mysql</li></ul></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-16-3-34.png" alt="2020-3-1-16-3-34.png"></p> <h4 id="创建用户表"><a href="#创建用户表" class="header-anchor">#</a> 创建用户表</h4> <ul><li>在数据库中创建用户表 User；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-16-13-17.png" alt="2020-3-1-16-13-17.png"></p> <ul><li>之后填入一些数据：</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-16-13-56.png" alt="2020-3-1-16-13-56.png"></p> <h4 id="配置-mybatis"><a href="#配置-mybatis" class="header-anchor">#</a> 配置 Mybatis</h4> <ul><li>在项目目录下的 <code>/src/main/resources</code> 目录中创建 <code>SqlMapConfig.xml</code> 文件，作为 Mybatis 的配置文件；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-16-51-30.png" alt="2020-3-1-16-51-30.png"></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="token doctype">&lt;!DOCTYPE configuration
        PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 配置连接环境，默认使用 mysql --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 配置 mysql 数据库的连接 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mysql<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- mybatis 使用 jdbc 事务管理方式 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jdbc<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!-- mybatis 使用连接池方式来获取连接 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>pooled<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- 配置连接数据库所需属性 --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>driver<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.mysql.cj.jdbc.Driver<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>url<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>jdbc:mysql://localhost:3306/my_test_db<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>username<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>password<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>123456789<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h4 id="创建-user-实体类"><a href="#创建-user-实体类" class="header-anchor">#</a> 创建 User 实体类</h4> <ul><li>Mybatis 使用 ORM 对象关系映射的思想，实现了对查询结果集的封装；</li> <li>数据表会对应一个<strong>实体类</strong>；</li> <li>将数据表中的列名，和实体类的属性是一一对应的；</li> <li>在 <code>com.garrik.Domain</code> 包下，创建实体类 User；</li> <li>类里面按照数据表的列名，创建私有属性；</li> <li>并且为所有属性创建 Getter / Setter 方法；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-17-2-46.png" alt="2020-3-1-17-2-46.png"></p> <h4 id="创建-user-类相关操作的接口类"><a href="#创建-user-类相关操作的接口类" class="header-anchor">#</a> 创建 User 类相关操作的接口类</h4> <ul><li><p>在实际项目中，针对用户数据表我们会有很多 CRUD 操作；</p> <ul><li>在之前使用 JDBC 时，我们会先创建 DAO 接口类，在里面定义好所有需要的方法接口；</li> <li>然后再去实现 DAO 接口；</li> <li>在开发业务逻辑时，只需要使用 DAO 实现类，就可以完成增删改查的操作；</li></ul></li> <li><p>在 MyBatis 中，我们也用类似的思想；</p></li> <li><p>但我们只需要定义好接口，接口的实现类 Mybatis 会帮我去做；</p></li> <li><p>在 <code>com.garrik.Mapper</code> 包下，创建 <code>UserMapper</code> 类；</p></li> <li><p>在里面定义一个接口 <code>selectUser</code>。我们希望它可以查询所有的用户，然后放到一个集合里面返回；</p></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-17-17-4.png" alt="2020-3-1-17-17-4.png"></p> <ul><li>在 Mybatis 中，一种习惯是用 Mapper 作为接口类，和接口类对应的 XML 映射文件的后缀；</li> <li>但是用别的后缀名称也无所谓，例如 DAO 也是可以的；</li></ul> <h4 id="创建接口类对应的-mapper-映射文件"><a href="#创建接口类对应的-mapper-映射文件" class="header-anchor">#</a> 创建接口类对应的 Mapper 映射文件</h4> <ul><li><p>在 Mybatis 中，接口类需要有一个对应的映射文件；</p></li> <li><p>里面定义了每个接口应该执行什么样的 SQL 语句；</p></li> <li><p>以及定义返回的结果集的类型；</p></li> <li><p>在 <code>src/main/resources</code> 目录下创建 <code>com/garrik/Mapper</code> 目录；</p></li> <li><p>然后再在目录下创建 <code>UserMapper.xml</code> 文件；</p></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-17-26-42.png" alt="2020-3-1-17-26-42.png"></p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="token comment">&lt;!-- namespace 属性填写对应的接口类的全限定类名。也就是包路径 + 类名 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.garrik.Mapper.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!--  查询所有用户  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>selectAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.garrik.Domain.User<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT * FROM user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>&lt;mapper&gt;</code> 元素内的 <code>namespace</code> 内填写所对应接口类的 “全限定名称”。也就是接口类的 “包路径” + “类名”；</li> <li><code>&lt;select&gt;</code> 元素里定义了一个 SQL 的 SELECT 查询；</li> <li><code>&lt;select&gt;</code> 元素的 id 属性是值为，接口类的对应的方法名；</li> <li><code>resultType</code> 属性定义返回值的类型。此处就是实体类 User 的全限定名称；</li></ul> <h4 id="在-mybatis-配置文件中，配置映射文件"><a href="#在-mybatis-配置文件中，配置映射文件" class="header-anchor">#</a> 在 Mybatis 配置文件中，配置映射文件</h4> <ul><li>在写完了 <code>UserMapper.xml</code> 映射文件后；</li> <li>我们还要把新加的映射，配置到之前写的 Mybatis 配置文件中；</li> <li>在 <code>SqlMapConfig.xml</code> 文件中加上如下标签；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-17-45-14.png" alt="2020-3-1-17-45-14.png"></p> <ul><li>注意 <code>&lt;mapper&gt;</code> 的 <code>resource</code> 属性后写的是 “目录路径” 不是 “包路径”。需要用 <code>/</code> 表示目录层级关系；</li></ul> <h4 id="编写测试类，来执行查询"><a href="#编写测试类，来执行查询" class="header-anchor">#</a> 编写测试类，来执行查询</h4> <ul><li>接下来就可以进行测试刚刚配置好的方法了；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 读取配置文件</span>
<span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">&quot;SqlMapConfig.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SqlSessionFactoryBuilder</span> builder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个 SqlSession 对象</span>
<span class="token class-name">SqlSessionFactory</span> factory <span class="token operator">=</span> builder<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">SqlSession</span> session <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取 Mybatis 帮你创建的接口实现类</span>
<span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 调用方法，获取结果</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 关闭 sqlsession，关闭 InputStream</span>
session<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>通过 Resources 实例类，来读取 Mybatis 配置文件；</li> <li>然后使用 SqlSessionFactoryBuilder 来用刚刚读取的配置文件，创建 SqlSessionFactory 工厂对象，创建时它会在内部对配置进行解析；</li> <li>之后通过工厂对象创建一个 SqlSession 实例；</li> <li>将接口类的字节码，传入到实例的 <code>getMapper</code> 方法，可以获取到接口的实现类；</li> <li>之后就能使用刚刚定义的 <code>selectAll</code> 方法了；</li> <li>下面 👇 是调用结果；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-1-17-49-57.png" alt="2020-3-1-17-49-57.png"></p> <h2 id="mybatis-xml-方式的基本用法"><a href="#mybatis-xml-方式的基本用法" class="header-anchor">#</a> MyBatis XML 方式的基本用法</h2> <ul><li>MyBatis 使用 Java 的动态代理可以直接通过接口来调用相应的方法，不需要提供接口的实现类；</li> <li>接口可以配合 XML 使用，也可以配合注解来使用；</li> <li>XML 可以单独使用，但是注解必须在接口中使用；</li></ul> <h3 id="一个简单的权限控制需求"><a href="#一个简单的权限控制需求" class="header-anchor">#</a> 一个简单的权限控制需求</h3> <p>以下 👇 拿一个简单的权限控制需求来作为示例：</p> <ul><li>一个用户拥有若干角色；</li> <li>一个角色拥有若干权限（权限就是对某个资源的某种操作，增删改查）；</li> <li>这样就构成了 “用户-角色-权限” 的授权模型；</li> <li>模型中，用户与角色之间、角色与权限之间，一般是多对多的关系；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-2-11-2-11.png" alt="2020-3-2-11-2-11.png"></p> <h4 id="创建数据库"><a href="#创建数据库" class="header-anchor">#</a> 创建数据库</h4> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for sys_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>sys_role<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>sys_role<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>role_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色名'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>enabled<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'有效标志'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_by<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建人'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">3</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'角色表'</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of sys_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_role<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'管理员'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2016-04-01 17:02:14'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_role<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'普通用户'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2016-04-01 17:02:34'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for sys_user</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>user_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>user_password<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>user_email<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token string">'test@mybatis.tk'</span> <span class="token keyword">COMMENT</span> <span class="token string">'邮箱'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>user_info<span class="token punctuation">`</span> <span class="token keyword">text</span> <span class="token keyword">COMMENT</span> <span class="token string">'简介'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>head_img<span class="token punctuation">`</span> <span class="token keyword">blob</span> <span class="token keyword">COMMENT</span> <span class="token string">'头像'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">1035</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'用户表'</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of sys_user</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">,</span> <span class="token string">'admin@mybatis.tk'</span><span class="token punctuation">,</span> <span class="token string">'管理员用户'</span><span class="token punctuation">,</span> <span class="token number">0x1231231230</span><span class="token punctuation">,</span> <span class="token string">'2016-06-07 01:11:12'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_user<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1001'</span><span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">,</span> <span class="token string">'test@mybatis.tk'</span><span class="token punctuation">,</span> <span class="token string">'测试用户'</span><span class="token punctuation">,</span> <span class="token number">0x1231231230</span><span class="token punctuation">,</span> <span class="token string">'2016-06-07 00:00:00'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for sys_privilege</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>sys_privilege<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>sys_privilege<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>privilege_name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限名称'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>privilege_url<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限URL'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">6</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'权限表'</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of sys_privilege</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'用户管理'</span><span class="token punctuation">,</span> <span class="token string">'/users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'角色管理'</span><span class="token punctuation">,</span> <span class="token string">'/roles'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token string">'系统日志'</span><span class="token punctuation">,</span> <span class="token string">'/logs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'4'</span><span class="token punctuation">,</span> <span class="token string">'人员维护'</span><span class="token punctuation">,</span> <span class="token string">'/persons'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'5'</span><span class="token punctuation">,</span> <span class="token string">'单位维护'</span><span class="token punctuation">,</span> <span class="token string">'/companies'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for sys_user_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>sys_user_role<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>sys_user_role<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>user_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>role_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色ID'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'用户角色关联表'</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of sys_user_role</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_user_role<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_user_role<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_user_role<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1001'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Table structure for sys_role_privilege</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>sys_role_privilege<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>sys_role_privilege<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>role_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'角色ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>privilege_id<span class="token punctuation">`</span> <span class="token keyword">bigint</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'权限ID'</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'角色权限关联表'</span><span class="token punctuation">;</span>

<span class="token comment">-- ----------------------------</span>
<span class="token comment">-- Records of sys_role_privilege</span>
<span class="token comment">-- ----------------------------</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_role_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_role_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_role_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_role_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'4'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>sys_role_privilege<span class="token punctuation">`</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="创建实体类"><a href="#创建实体类" class="header-anchor">#</a> 创建实体类</h4> <p>对应着数据表，创建出它们的实体类；</p> <p>下面 👇 给出实体类 SysUser 的例子：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>garrik</span><span class="token punctuation">.</span><span class="token class-name">Domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">Date</span><span class="token punctuation">;</span>

<span class="token comment">/** 用户表 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SysUser</span> <span class="token punctuation">{</span>
  <span class="token comment">/** 用户ID */</span>
  <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
  <span class="token comment">/** 用户名 */</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
  <span class="token comment">/** 密码 */</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> userPassword<span class="token punctuation">;</span>
  <span class="token comment">/** 邮箱 */</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> userEmail<span class="token punctuation">;</span>
  <span class="token comment">/** 简介 */</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> userInfo<span class="token punctuation">;</span>
  <span class="token comment">/** 头像 */</span>
  <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> headImg<span class="token punctuation">;</span>
  <span class="token comment">/** 创建时间 */</span>
  <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>

  <span class="token comment">// 省略掉 Getter 和 Setter</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>Java 实体类中属性的命名方式习惯采用 “驼峰命名法”；</li> <li>数据表中的列名习惯采用 “下划线命名法”；</li> <li>在后面我们需要配置它们之间的映射关系；</li> <li>实体类中属性的数据类型<strong>不要使用基本类型</strong>；
<ul><li>🌰 <code>private int age</code> 默认情况下 <code>age</code> 的值为 0。当使用 <code>age</code> 属性时，它总是有一个值；</li> <li>某些情况下，无法实现 <code>age</code> 为 <code>null</code>。这样 <code>age != null</code> 判断总是为 <code>true</code>，可能会发生意外的 BUG；</li></ul></li></ul> <h3 id="select"><a href="#select" class="header-anchor">#</a> SELECT</h3> <ul><li>在开发业务时，数据库查询是很常见的一类操作；</li> <li>在之前使用 JDBC 时，要手动对结果集进行处理，将结果映射到具体的对象中去；</li> <li>使用 MyBatis 时，只需要在 XML 中添加一个 <code>select</code> 元素，写一个 SQL，再 做一些简单的配置，就可以将查询的结果直接映射到对象中；</li> <li>下面 👇 让我们对 SysUser 实体类，进行一些查询操作；</li></ul> <h4 id="定义接口"><a href="#定义接口" class="header-anchor">#</a> 定义接口</h4> <ul><li>假设我们要实现：
<ul><li>通过 id 查询用户操作；</li> <li>查询所有用户操作；</li></ul></li> <li>第一步，先定义好接口类；</li> <li>在 Mapper 包下面创建 <code>UserMapper</code></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-2-21-18-7.png" alt="2020-3-2-21-18-7.png"></p> <h4 id="编写映射文件"><a href="#编写映射文件" class="header-anchor">#</a> 编写映射文件</h4> <ul><li>第二步，编写接口类对应的映射配置文件；</li> <li>使用 <code>&lt;select&gt;</code> 标签来映射 SQL 查询语句；</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>
<span class="token doctype">&lt;!DOCTYPE mapper PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.garrik.Mapper.UserMapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 配置实体类属性和查询结果列的对应关系 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userMap<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.garrik.Domain.SysUser<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user_name<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userPassword<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user_password<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userEmail<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user_email<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userInfo<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>user_info<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>headImg<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>head_img<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>BLOB<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>createTime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>create_time<span class="token punctuation">&quot;</span></span> <span class="token attr-name">jdbcType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TIMESTAMP<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!--  根据 id 查询用户  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>selectById<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userMap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT *
        FROM sys_user
        WHERE id = #{id}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 查询所有的用户 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>selectAll<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.garrik.Domain.SysUser<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT id            AS id,
               user_name     AS userName,
               user_password AS userPassword,
               user_email    AS userEmail,
               user_info     AS userInfo,
               head_img      AS headImg,
               create_time   AS createTime
        FROM sys_user
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>&lt;mapper&gt;</code> 标签的 <code>namespace</code> 的属性值定义其所关联的 “接口类” 的 “全限定名称”；</li> <li><code>&lt;select&gt;</code> 标签的 <code>id</code> 的属性值为其对应的 “接口方法名”；</li> <li><code>&lt;select&gt;</code> 标签内部是 SQL 查询语句；</li> <li><code>#{id}</code> 是 SQL 中使用的预编译参数的一种方式，大括号中的 id 是传入的参数名；</li></ul> <p>上面 👆 对于两个方法，<code>&lt;select&gt;</code> 标签里面的内容略有不同，我们来详细看一下：</p> <ul><li>首先，因为数据表的列名采用 “下划线命名法”；</li> <li>实体类的属性名采用 “驼峰命名法”；</li> <li>所以命名上是不同的；</li> <li>我们需要在配置时，<strong>定义查询结果列的名称，和实体类的属性的映射关系</strong>；</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- 配置实体类属性和查询结果列的对应关系 --&gt;</span>
<span class="token operator">&lt;</span>resultMap id<span class="token operator">=</span><span class="token string">&quot;userMap&quot;</span> <span class="token keyword">type</span><span class="token operator">=</span><span class="token string">&quot;com.garrik.Domain.SysUser&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;id&quot;</span> <span class="token keyword">column</span><span class="token operator">=</span><span class="token string">&quot;id&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;userName&quot;</span> <span class="token keyword">column</span><span class="token operator">=</span><span class="token string">&quot;user_name&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;userPassword&quot;</span> <span class="token keyword">column</span><span class="token operator">=</span><span class="token string">&quot;user_password&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;userEmail&quot;</span> <span class="token keyword">column</span><span class="token operator">=</span><span class="token string">&quot;user_email&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;userInfo&quot;</span> <span class="token keyword">column</span><span class="token operator">=</span><span class="token string">&quot;user_info&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;headImg&quot;</span> <span class="token keyword">column</span><span class="token operator">=</span><span class="token string">&quot;head_img&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;BLOB&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>result property<span class="token operator">=</span><span class="token string">&quot;createTime&quot;</span> <span class="token keyword">column</span><span class="token operator">=</span><span class="token string">&quot;create_time&quot;</span> jdbcType<span class="token operator">=</span><span class="token string">&quot;TIMESTAMP&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>resultMap<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--  根据 id 查询用户  --&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">&quot;selectById&quot;</span> resultMap<span class="token operator">=</span><span class="token string">&quot;userMap&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">SELECT</span> <span class="token operator">*</span>
    <span class="token keyword">FROM</span> sys_user
    <span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token comment">#{id}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">&gt;</span>
</code></pre></div><hr> <ul><li>通过 <code>&lt;resultMap&gt;</code> 设置返回结果集的类型，实体类属性与查询结果列的对应关系；</li> <li><code>id</code> 属性定义 <code>&lt;resultMap&gt;</code> 的名称。<code>&lt;select&gt;</code> 通过这个名称，在 <code>resultMap</code> 属性中进行引用；</li> <li><code>type</code> 属性定义查询结果集所映射到的实体类；</li> <li><code>&lt;result&gt;</code> 标签中通过 <code>property</code> 和 <code>column</code> 两个属性来表示 “实体类属性”，和 “查询结果集列名” 的对应关系；</li> <li><code>&lt;result&gt;</code> 标签里的 <code>jdbcType</code> 属性定义当前列对应的 “数据库数据类型”
<ul><li>由于数据库对于时间数据，分为 date, time, datetime 类型，但是 Java 中一般都是 java.util.Date 类型；</li> <li>为了让 Mybatis 知道当前实体类的属性，映射到数据库中是什么数据类型。我们需要定义 <code>jdbcType</code> 属性；</li></ul></li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- 查询所有的用户 --&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">&quot;selectAll&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;com.garrik.Domain.SysUser&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">SELECT</span> id            <span class="token keyword">AS</span> id<span class="token punctuation">,</span>
            user_name     <span class="token keyword">AS</span> userName<span class="token punctuation">,</span>
            user_password <span class="token keyword">AS</span> userPassword<span class="token punctuation">,</span>
            user_email    <span class="token keyword">AS</span> userEmail<span class="token punctuation">,</span>
            user_info     <span class="token keyword">AS</span> userInfo<span class="token punctuation">,</span>
            head_img      <span class="token keyword">AS</span> headImg<span class="token punctuation">,</span>
            create_time   <span class="token keyword">AS</span> createTime
    <span class="token keyword">FROM</span> sys_user
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">&gt;</span>
</code></pre></div><ul><li>另一种方法是，通过 <code>resultType</code> 直接指定返回结果集映射的实体类；</li> <li>在 SQL 语句中，为所有列名和属性名不一致的列，通过 <code>AS</code> 设置别名。别名需要设置为对应的实体类属性名；</li> <li>这样查询结果的列名，和实体类的属性名一致了；</li></ul> <hr> <p>除此之外，还有一种方法是：</p> <ul><li>Mybatis 提供一个全局属性 <code>mapUnderscoreToCamelCase</code>；</li> <li>通过配置这个属性为 <code>true</code> ，可以自动将以下画线方式命名的数据库列映射到 Java 对象的驼峰式命名的属性中；</li> <li>想要使用该功能，需要在 MyBatis 的配置文件中增加如下配置：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mapUnderscoreToCamelCase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样配置完，上面的 <code>selectAll</code> 代码就可以写成这样：</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">-- 查询所有的用户 --&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">&quot;selectAll&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;com.garrik.Domain.SysUser&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">SELECT</span> id<span class="token punctuation">,</span>
        user_name<span class="token punctuation">,</span>
        user_password<span class="token punctuation">,</span>
        user_email<span class="token punctuation">,</span>
        user_info<span class="token punctuation">,</span>
        head_img<span class="token punctuation">,</span>
        create_time
    <span class="token keyword">FROM</span> sys_user
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">&gt;</span>
</code></pre></div><h4 id="在-mybatis-配置文件中配置映射关系"><a href="#在-mybatis-配置文件中配置映射关系" class="header-anchor">#</a> 在 Mybatis 配置文件中配置映射关系</h4> <ul><li>我们还需要在 Mybatis 配置文件中的 <code>&lt;mappers&gt;</code> 元素中配置所有的 Mapper；</li> <li>之前我们使用的是下面这种配置方式：</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-1-20-34.png" alt="2020-3-3-1-20-34.png"></p> <ul><li>需要将所有映射文件一一列举出来，如果增加了新的映射文件，还需要在此处进行配置，操作起来比较麻烦；</li></ul> <hr> <ul><li>另一种简便的配置方式如下：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>com.garrik.Mapper<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>这种配置方式会先查找 <code>com.garrik.Mapper</code> 包下所有的接口，循环对接口进行如下操作：
<ul><li>判断接口对应的命名空间是否已经存在，如果存在就抛出异常，不存在就继续进行接下来的操作；</li> <li>加载接口对应的 XML 映射文件，将接口全限定名转换为路径；
<ul><li>例如，将接口 <code>tk.mybatis.simple.mapper.UserMapper</code> 转换为 <code>tk/mybatis/simple/mapper/UserMapper.xml</code></li></ul></li> <li>然后搜索对应的 XML 资源，如果找到就解析 XML；</li> <li>处理接口中的注解方法；</li></ul></li></ul> <h4 id="多表查询"><a href="#多表查询" class="header-anchor">#</a> 多表查询</h4> <ul><li>在实际业务中，会经常遇到多表关联查询；</li> <li>关联查询结果的类型也会有多种情况；</li></ul> <p><strong>第一种：返回结果只包含一个数据表的信息</strong>：</p> <ul><li>假设我们想根据用户 id 获取用户拥有的所有角色；</li> <li>需要查询 sys_user、 sys_role 和 sys_user_role 这 3 个表；</li> <li>该方法写在任何一个对应的 Mapper 接口中都可以；</li> <li>下面将这个方法写到 UserMapper 中；</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--  通过用户 id 查询用户所拥有的角色  --&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">&quot;selectRolesByUserId&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;com.garrik.Domain.SysRole&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">SELECT</span> r<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
            r<span class="token punctuation">.</span>role_name   <span class="token keyword">AS</span> roleName<span class="token punctuation">,</span>
            r<span class="token punctuation">.</span>enabled<span class="token punctuation">,</span>
            r<span class="token punctuation">.</span>create_by   <span class="token keyword">AS</span> createBy<span class="token punctuation">,</span>
            r<span class="token punctuation">.</span>create_time <span class="token keyword">AS</span> createTime
    <span class="token keyword">FROM</span> sys_user u
              <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys_user_role ur <span class="token keyword">on</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> ur<span class="token punctuation">.</span>user_id
              <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys_role r <span class="token keyword">on</span> ur<span class="token punctuation">.</span>role_id <span class="token operator">=</span> r<span class="token punctuation">.</span>id
    <span class="token keyword">WHERE</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#{userId}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">&gt;</span>
</code></pre></div><ul><li>虽然这个多表关联的查询中涉及了 3 个表，但是返回的结果只有 sys_role 表中的信息；</li> <li>所以直接使用 SysRole 作为返回值类型即可；</li></ul> <hr> <p><strong>第二种：返回的结果包含多个数据表的信息</strong>：</p> <ul><li>以第一种情形为基础；</li> <li>假设查询的结果不仅要包含 sys_role 中的信息，还要包含当前用户的部分信息；</li> <li>可以直接在 SysRole 实体类中增加一个类型为 SysUser 的实例属性；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-1-16-48.png" alt="2020-3-3-1-16-48.png"></p> <ul><li>然后修改 XML 中的 selectRolesByUserId 方法；</li> <li>设置别名的时候，使用的是 <strong>“user.属性名”</strong>；</li> <li>user 是 SysRole 中刚刚增加的属性。userName 和 userEmail 是 SysUser 对象中的属性；</li> <li>通过这种方式可以直接将值赋给 user 字段中的属性；</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token comment">--  通过用户 id 查询用户所拥有的角色  --&gt;</span>
<span class="token operator">&lt;</span><span class="token keyword">select</span> id<span class="token operator">=</span><span class="token string">&quot;selectRolesByUserId&quot;</span> resultType<span class="token operator">=</span><span class="token string">&quot;com.garrik.Domain.SysRole&quot;</span><span class="token operator">&gt;</span>
    <span class="token keyword">SELECT</span> r<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
            r<span class="token punctuation">.</span>role_name   <span class="token keyword">AS</span> roleName<span class="token punctuation">,</span>
            r<span class="token punctuation">.</span>enabled<span class="token punctuation">,</span>
            r<span class="token punctuation">.</span>create_by   <span class="token keyword">AS</span> createBy<span class="token punctuation">,</span>
            r<span class="token punctuation">.</span>create_time <span class="token keyword">AS</span> createTime<span class="token punctuation">,</span>
            u<span class="token punctuation">.</span>user_name   <span class="token keyword">AS</span> <span class="token string">&quot;user.userName&quot;</span><span class="token punctuation">,</span>
            u<span class="token punctuation">.</span>user_email  <span class="token keyword">AS</span> <span class="token string">&quot;user.userEmail&quot;</span>
    <span class="token keyword">FROM</span> sys_user u
              <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys_user_role ur <span class="token keyword">on</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> ur<span class="token punctuation">.</span>user_id
              <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> sys_role r <span class="token keyword">on</span> ur<span class="token punctuation">.</span>role_id <span class="token operator">=</span> r<span class="token punctuation">.</span>id
    <span class="token keyword">WHERE</span> u<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token comment">#{userId}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token keyword">select</span><span class="token operator">&gt;</span>
</code></pre></div><h3 id="insert"><a href="#insert" class="header-anchor">#</a> INSERT</h3> <h4 id="一个简单的插入示例"><a href="#一个简单的插入示例" class="header-anchor">#</a> 一个简单的插入示例</h4> <p>下面 👇 实现一个插入新用户的功能；</p> <ul><li>通过 <code>&lt;insert&gt;</code> 标签来定义插入操作；</li> <li>先在 UserMapper 接口类中，新增方法 <code>int insert(SysUser sysUser)</code>；</li> <li>然后在 UserMapper.xml 添加如下代码：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>insert<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  INSERT INTO sys_user (id, user_name, user_password, user_email, user_info, head_img, create_time)
  VALUES (#{id}, #{userName}, #{userPassword}, #{userEmail}, #{userInfo}, #{headImg, jdbcType=BLOB},
          #{createTime, jdbcType=TIMESTAMP})
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>#{属性名}</code> 可以从参数中取出其对应属性的值。在这里我们的参数是 SysUser 类型的对象；</li></ul> <p>之后编写测试代码：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment">// 创建一个用户实例</span>
  <span class="token class-name">SysUser</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SysUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  user<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;Garrik&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  user<span class="token punctuation">.</span><span class="token function">setUserPassword</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  user<span class="token punctuation">.</span><span class="token function">setUserEmail</span><span class="token punctuation">(</span><span class="token string">&quot;garrikliu@gmail.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  user<span class="token punctuation">.</span><span class="token function">setUserInfo</span><span class="token punctuation">(</span><span class="token string">&quot;测试用户&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  user<span class="token punctuation">.</span><span class="token function">setHeadImg</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  user<span class="token punctuation">.</span><span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">int</span> result <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>需要注意，由于默认的 <code>sqlSessionFactory.openSession()</code> 是不自动提交更改到数据库的；</li> <li>我们需要手动执行 <code>commit</code> 进行提交；</li> <li><code>insert</code> 方法返回的 int 类型返回值，是执行的 SQL 语句影响的行数；</li></ul> <hr> <h4 id="获取主键"><a href="#获取主键" class="header-anchor">#</a> 获取主键</h4> <ul><li>上面 👆 代码中，我们手动设置了 id 的值；</li> <li>但是数据表中，id 作为主键，是一个自增的值。我们不需要手动去设置；</li></ul> <p>下面 👇 来做一些修改：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>insert<span class="token punctuation">&quot;</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    INSERT INTO sys_user (user_name, user_password, user_email, user_info, head_img, create_time)
    VALUES (#{userName}, #{userPassword}, #{userEmail}, #{userInfo}, #{headImg, jdbcType=BLOB},
            #{createTime, jdbcType=TIMESTAMP})
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>useGeneratedKeys</code> 设置为 <code>true</code> 后，MyBatis 会使用 JDBC 的 <code>getGeneratedKeys</code> 方法来取出 由数据库内部生成的主键</li> <li>获得主键值后将其赋值给 <code>keyProperty</code> 配置的参数 <code>id</code> 属性。也就是作为参数 SysUser 类型实例的 <code>id</code> 属性；</li> <li>由于要使用数据库返回 的主键值，所以 SQL 上下两部分的列中去掉了 <code>id</code> 列和对应的 <code>#{id}</code> 属性；</li> <li>在测试代码中，可以再 <code>insert</code> 方法执行完毕后，打印一下 <code>user.getId()</code> 的值，看一下是否能获取到返回的主键值；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-2-26-42.png" alt="2020-3-3-2-26-42.png"></p> <h4 id="使用-selectkey-返回主键的值"><a href="#使用-selectkey-返回主键的值" class="header-anchor">#</a> 使用 selectKey 返回主键的值</h4> <ul><li>上面这种回写主键的方法只适用于支持主键自增的数据库；</li> <li>有些数据库（如 Oracle） 不提供主键自增的功能；</li> <li>对于这种情况，可以使用 <code>＜selectKey＞</code> 标签来获取主键的值；</li> <li>这种方式不仅适用于不提供主键自增功能的数据库，也适用于提供主键自增功能的数据库；</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>insert<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    INSERT INTO sys_user (user_name, user_password, user_email, user_info, head_img, create_time)
    VALUES (#{userName}, #{userPassword}, #{userEmail}, #{userInfo}, #{headImg, jdbcType=BLOB},
    #{createTime, jdbcType=TIMESTAMP})
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectKey</span> <span class="token attr-name">keyColumn</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>long<span class="token punctuation">&quot;</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AFTER<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        SELECT LAST_INSERT_ID()
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectKey</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><code>keyColumn</code> 和 <code>keyProperty</code> 是一一对应的关系。前者指定数据表的列名，后者指定实体类的属性名；</li> <li><code>resultType</code> 用于设置返回值类型；</li> <li><code>order</code> 属性的设置和使用的数据库有关：
<ul><li>在 MySQL 数据库中，<code>order</code> 属性设置的值是 AFTER，因为当前记录的主键值在 <code>insert</code> 语句执行成功后才能获取到；</li> <li>而在 Oracle 数据库中，<code>order</code> 的值要设置为 BEFORE，这是因为 Oracle 中需要先从序列获取值，然后将值作为主键插入到数据库中。</li></ul></li> <li><code>selectKey</code> 元素中的内容。它的内容就是一个独立的 SQL 语句；</li> <li>在 MySQL 中，SQL 语句 <code>SELECT LAST_INSERT_ID()</code> 用于获取数据 库中最后插入的数据的 ID 值；</li> <li>不同的数据库，语句也不同，这里不展开；</li></ul> <h3 id="update"><a href="#update" class="header-anchor">#</a> UPDATE</h3> <ul><li>使用 <code>&lt;update&gt;</code> 标签执行更新操作；</li> <li>在 UserMapper 接口类中，新增 <code>int updateById(SysUser sysUser)</code> 方法；</li> <li>之后在 <code>UserMapper.xml</code> 文件中新增：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>updateById<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  UPDATE sys_user
  SET user_name     = #{userName},
      user_password = #{userPassword},
      user_email    = #{userEmail},
      user_info     = #{userInfo},
      head_img      = #{headImg, jdbcType=BLOB},
      create_time   = #{createTime, jdbcType=TIMESTAMP}
  WHERE id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>然后测试代码如下：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token class-name">SysUser</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  user<span class="token punctuation">.</span><span class="token function">setUserName</span><span class="token punctuation">(</span><span class="token string">&quot;Xiang&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> result <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">updateById</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getUserName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="delete"><a href="#delete" class="header-anchor">#</a> DELETE</h3> <ul><li>使用 <code>&lt;delete&gt;</code> 标签执行删除操作；</li> <li>在 UserMapper 接口类中，新增 <code>int deleteById(Long id)</code> 方法；</li> <li>之后在 <code>UserMapper.xml</code> 文件中添加：</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>deleteById<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    DELETE
    FROM sys_user
    WHERE id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>测试代码是：</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> result <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token number">1047</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 提交</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    sqlSession<span class="token punctuation">.</span><span class="token function">rollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="接口方法接收多个参数"><a href="#接口方法接收多个参数" class="header-anchor">#</a> 接口方法接收多个参数</h3> <ul><li>前面的例子里方法都只有一个参数；</li> <li>在实际应用中经常会遇到接口方法使用多个参数的情况；</li> <li>可以通过给参数配置 @Param 注解，在 SQL 部分就可以通过配置的注解值来使用参数；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-23-46.png" alt="2020-3-3-18-23-46.png"></p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-24-10.png" alt="2020-3-3-18-24-10.png"></p> <hr> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-24-26.png" alt="2020-3-3-18-24-26.png"></p> <ul><li>在 SQL 中，可以通过点取值方式 使用 <code>＃{user.id}</code> 和 <code>＃{role.enabled}</code> 从两个 JavaBean 中取出指定属性的值；</li></ul> <h2 id="mybatis-注解方式的基本用法"><a href="#mybatis-注解方式的基本用法" class="header-anchor">#</a> MyBatis 注解方式的基本用法</h2> <ul><li>MyBatis 注解方式就是将 SQL 语句直接写在接口方法上；</li> <li>一般情况下不建议使用注解方式；</li></ul> <h3 id="select-2"><a href="#select-2" class="header-anchor">#</a> @Select</h3> <p>现在让我们用注解的方式重新写 <code>UserMapper</code> 接口类中的 <code>selectById</code> 方法；</p> <ul><li>在接口方法上直接加注解；</li> <li>参数可以是字符串数组类型，也可以是字符串类型；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;SELECT * FROM sys_user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;WHERE id = #{id}&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">SysUser</span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ---- 或者 -----</span>

<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;SELECT * FROM sys_user WHERE id = #{id}&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">SysUser</span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>使用注解方式同样需要考虑数据表字段，和 Java 属性字段映射的问题</strong>：</p> <p>第一种是通过 SQL 语句使用<strong>别名</strong>来实现；</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;SELECT id,&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user_name AS userName,&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user_password AS userPassword,&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user_email AS userEmail,&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user_info AS userInfo,&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;head_img AS headImg,&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;create_time AS createTime&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;FROM sys_user&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;WHERE id = #{id}&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">SysUser</span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第二种是在 Mybatis 配置文件中<strong>设置 <code>mapUnderscoreToCamelCase</code> 为 true</strong>；</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>setting</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mapUnderscoreToCamelCase<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>第三种是<strong>使用 resultMap 方式</strong>；</p> <ul><li>XML 中的 <code>resultMap</code> 元素有一个对应的 Java 注解<code>@Results</code>，使用这个注解来实现属性映射；</li> <li><code>@Result</code> 注解对应着 XML 文件中的 <code>＜result＞</code> 元素</li> <li>把 <code>@Result</code> 注解写在对应的 <code>@Select</code> 注解之上就可以了；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;userName&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">&quot;user_name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;userPassword&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">&quot;user_password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;userEmail&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">&quot;user_email&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;userInfo&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">&quot;user_info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;headImg&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">&quot;head_img&quot;</span><span class="token punctuation">,</span> jdbcType <span class="token operator">=</span> <span class="token class-name">JdbcType</span><span class="token punctuation">.</span>BLOB<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">&quot;createTime&quot;</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">&quot;create_time&quot;</span><span class="token punctuation">,</span> jdbcType <span class="token operator">=</span> <span class="token class-name">JdbcType</span><span class="token punctuation">.</span>TIMESTAMP<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;SELECT * FROM sys_user&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;WHERE id = #{id}&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">SysUser</span> <span class="token function">selectById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>如果多个接口方法都需要使用同一个 <code>@Results</code> 注解的话；</li> <li>从 MyBatis 3.3.1 版本开始， <code>@Results</code> 注解增加了一个 <code>id</code> 属性，设置了 <code>id</code> 属性后，就可以通过 <code>id</code> 属性引用同一个 <code>@Results</code> 配置了；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-15-0-56.png" alt="2020-3-3-15-0-56.png"></p> <ul><li>使用 <code>@ResultMap</code> 注解引用即可，注解的参数值就是上面代码中设置的 <code>id</code> 的值；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-15-1-11.png" alt="2020-3-3-15-1-11.png"></p> <h3 id="insert-2"><a href="#insert-2" class="header-anchor">#</a> @Insert</h3> <p><code>@Insert</code> 注解本身是简单的，但如果需要返回主键的值，情况会变得稍微复杂一些；</p> <h4 id="不需要返回主键"><a href="#不需要返回主键" class="header-anchor">#</a> 不需要返回主键</h4> <ul><li>用注解的方式重写 UserMapper 的 <code>insert</code> 方法；</li> <li>这个方法和 XML 中的 SQL 完全一样，这里不做特别介绍；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;INSERT INTO sys_user&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;(user_name, user_password, user_email, user_info, head_img, create_time)&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;VALUES (&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{userName}, #{userPassword}, #{userEmail}, #{userInfo},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{headImg, jdbcType=BLOB},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{createTime, jdbcType=TIMESTAMP}&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;)&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="返回自增主键"><a href="#返回自增主键" class="header-anchor">#</a> 返回自增主键</h4> <ul><li>因为 <code>id</code> 主键是自增的；</li> <li>我们想要获取到它，并把它设置到创建的 SysUser 类型实例中；</li> <li>和使用 XML 的方式类似，我们需要设置 useGeneratedKeys 和 keyProperty 属性；</li> <li>增加一个 <code>@Options</code> 注解，在这个注解中设置 useGeneratedKeys 和 keyProperty 属性；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;INSERT INTO sys_user&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;(user_name, user_password, user_email, user_info, head_img, create_time)&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;VALUES (&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{userName}, #{userPassword}, #{userEmail}, #{userInfo},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{headImg, jdbcType=BLOB},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{createTime, jdbcType=TIMESTAMP}&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;)&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Options</span><span class="token punctuation">(</span>useGeneratedKeys <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="返回非自增主键"><a href="#返回非自增主键" class="header-anchor">#</a> 返回非自增主键</h4> <ul><li>使用 <code>@SelectKey</code> 注解，配置和 XML 中基本相同；</li> <li>其中 <code>before</code> 为 <code>false</code> 时功能等同于 <code>order = &quot;AFTER&quot;</code>，<code>before</code> 为 <code>true</code> 时功能等同于<code>order = &quot;BEFORE&quot;</code></li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;INSERT INTO sys_user&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;(user_name, user_password, user_email, user_info, head_img, create_time)&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;VALUES (&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{userName}, #{userPassword}, #{userEmail}, #{userInfo},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{headImg, jdbcType=BLOB},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;#{createTime, jdbcType=TIMESTAMP}&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;)&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SelectKey</span><span class="token punctuation">(</span>
    statement <span class="token operator">=</span> <span class="token string">&quot;SELECT LAST_INSERT_ID()&quot;</span><span class="token punctuation">,</span>
    keyColumn <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
    keyProperty <span class="token operator">=</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>
    resultType <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
    before <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="update-2"><a href="#update-2" class="header-anchor">#</a> @Update</h3> <ul><li>改写 UserMapper 接口类的 <code>updateById</code> 方法；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Update</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">&quot;UPDATE sys_user&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;SET user_name = #{userName},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user_password = #{userPassword},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user_email    = #{userEmail},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;user_info     = #{userInfo},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;head_img      = #{headImg, jdbcType=BLOB},&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;create_time   = #{createTime, jdbcType=TIMESTAMP}&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;WHERE id = #{id}&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">updateById</span><span class="token punctuation">(</span><span class="token class-name">SysUser</span> sysUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="delete-2"><a href="#delete-2" class="header-anchor">#</a> @Delete</h3> <ul><li>重写 UserMapper 接口类的 <code>deleteById</code> 方法；</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Delete</span><span class="token punctuation">(</span><span class="token string">&quot;DELETE FROM sys_user WHERE id = #{id}&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">deleteById</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="provider-注解"><a href="#provider-注解" class="header-anchor">#</a> Provider 注解</h3> <ul><li>除了上面 4 种注解可以使用简单的 SQL 外；</li> <li>MyBatis 还提供了 4 种 Provider 注解；</li> <li>分别是：
<ul><li>@SelectProvider；</li> <li>@InsertProvider；</li> <li>@UpdateProvider；</li> <li>@DeleteProvider；</li></ul></li> <li>它们同样可以实现查询、插入、更新、删除操作；</li></ul> <p>下面通过@SelectProvider 用法来了解 Provider 注解方式的基本用法：</p> <ul><li>创建 PrivilegeMapper 接口，添加 <code>selectById</code> 方法，代码如下：</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-15-28-49.png" alt="2020-3-3-15-28-49.png"></p> <ul><li>其中 PrivilegeProvider 类代码如下：</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-15-29-13.png" alt="2020-3-3-15-29-13.png"></p> <ul><li>Provider 注解中提供了两个必填属性 <code>type</code> 和 <code>method</code>；</li> <li><code>type</code> 配置的是一个<strong>包含 <code>method</code> 属性指定方法的 “类”</strong>；</li> <li>这个类必须有空的构造函数；</li> <li>这个类中对应的方法，返回的值就是要执行的 SQL 语句。所以方法返回数据类型必须是 String 类型；</li> <li>上面的代码，拼接 SQL 语句时使用了 <code>new SQL</code> 方法；</li> <li>也还可以直接返回 SQL 字符串；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-15-32-4.png" alt="2020-3-3-15-32-4.png"></p> <ul><li>SQL 较长或需要拼接时推荐使用 <code>new SQL</code> 的方式；</li></ul> <h2 id="mybatis-动态-sql"><a href="#mybatis-动态-sql" class="header-anchor">#</a> MyBatis 动态 SQL</h2> <ul><li>MyBatis 的强大特性之一便是它的动态 SQL；</li> <li>在实际开发中，经常会需要对不同的判断条件，来拼接 SQL 语句；</li> <li>MyBatis 采用了功能强大的 OGNL（Object-Graph Navigation Language）表达式语言；</li></ul> <h3 id="ognl-用法"><a href="#ognl-用法" class="header-anchor">#</a> OGNL 用法</h3> <p>MyBatis 常用的 OGNL 表达式如下：</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-17-28.png" alt="2020-3-3-18-17-28.png"></p> <h3 id="if"><a href="#if" class="header-anchor">#</a> if</h3> <h4 id="在-where-条件中使用-if"><a href="#在-where-条件中使用-if" class="header-anchor">#</a> 在 WHERE 条件中使用 if</h4> <ul><li>if 标签通常用于 WHERE 语句中，通过判断参数值来决定是否使用某个查询条件；</li> <li>假设现在有一个新的需求：实现一个用户管理高级查询功能，根据输入的条件去检索用户信息。需要支持以下三种情况：
<ul><li>当只输入用户名时，需要根据用户名进行模糊查询；</li> <li>当只输入邮箱时，根据邮箱进行完全匹配；</li> <li>当同时输入用户名和邮箱时，用这两个条件去查询匹配的用户；</li></ul></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-12-52.png" alt="2020-3-3-17-12-52.png"></p> <ul><li>if 标签有一个必填的属性 <code>test</code>；</li> <li><code>test</code> 的属性值是一个符合 OGNL 要求的判断表达式</li> <li>上面两个条件的属性类型都是 String，对字符串的判断首先需要判断字段是否为 null，然后再去判断是否为空；</li> <li>但在 OGNL 表达式中，这两个判断的顺序 不会影响判断的结果，也不会有空指针异常；</li> <li>注意 SQL 中 <code>where</code> 关键字后面的条件 <code>where 1=1</code>：
<ul><li>由于两个条件都是动态的，所以如果没有 1=1 这个默认条件，当两个 if 判断都不满足时，最后生成的 SQL 就会以 where 结束；</li> <li>加上 1=1 这个 条件就可以避免 SQL 语法错误导致的异常；</li> <li>这种写法并不美观，后面介绍 where 标签的用法，可以替代这种写法；</li></ul></li></ul> <h4 id="在-update-更新中使用-if"><a href="#在-update-更新中使用-if" class="header-anchor">#</a> 在 UPDATE 更新中使用 if</h4> <ul><li>现在要实现这样一个需求：
<ul><li>只更新有变化的字段；</li> <li>更新的时候不能将原来 有值但没有发生变化的字段更新为空或 null；</li></ul></li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-19-24.png" alt="2020-3-3-17-19-24.png"></p> <ul><li>需要注意的有两点：
<ul><li>第一点是每个 if 元素里面 SQL 语句后面的逗号；</li> <li>第二点就是 where 关键字前面的 <code>id=＃{id}</code> 这个条件；</li></ul></li> <li>原因是，如果所有的 if 判断都失败。最终的 SQL 语句是 <code>update sys_user set id=#{id} where id=#{id}</code> 如果 where 前面没有加 <code>id=＃{id}</code>，最后就会出错；</li> <li>如果前面的 if 判断结果成功，但因为每一行后面都有一个逗号。如果没有这个条件，最终的 SQL 是：<code>update sys_user set user_name=#{userName},where id=#{id}</code>。也会报错；</li></ul> <h4 id="在-insert-动态插入列中使用-if"><a href="#在-insert-动态插入列中使用-if" class="header-anchor">#</a> 在 INSERT 动态插入列中使用 if</h4> <ul><li>在数据库表中插入数据的时候，如果某一列的参数值不为空，就使用传入的值，如果传入参数为空，就使用数据库中的默认值；</li> <li>使用 if 就可以实现这种动态插入列的功能；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-27-1.png" alt="2020-3-3-17-27-1.png"></p> <ul><li>要注意，若在列的部分增加 if 条件，则 values 的部分也要增加相同的 if 条件，必须保证上下可以互相对应，完全匹配；</li> <li>如果参数没有给 userEmail 属性赋值，这样就会使用数据库的默认值；</li></ul> <h3 id="choose"><a href="#choose" class="header-anchor">#</a> choose</h3> <ul><li>上一节的 if 标签提供了基本的条件判断，但是它无法实现 if - else 的逻辑；</li> <li>要想实现这样的逻辑，就需要用到 <code>choose</code> <code>when</code> <code>otherwise</code> 标签；</li> <li>choose 元素中包含 when 和 otherwise 两个标签;</li> <li>一个 choose 中至少有一个 when，有 0 个或者 1 个 otherwise；</li></ul> <hr> <ul><li>在 sys_user 表中，除了主键 id 外，我们认为 user_name（用户名）也是唯一的，所有的用户名都不可以重复；</li> <li>现在进行如下查询：当参数 id 有值的时候优先使用 id 查询；</li> <li>当 id 没有值时 就去判断用户名是否有值，如果有值就用用户名查询；</li> <li>如果用户名也没有值，就使 SQL 查询无结果。</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-34-0.png" alt="2020-3-3-17-34-0.png"></p> <ul><li>when 相当于 if；</li> <li>otherwise 相当于 else；</li> <li>在以上查询中，如果没有 otherwise 这个限制条件，所有的用户都会被查询出来；</li></ul> <h3 id="where-set-trim"><a href="#where-set-trim" class="header-anchor">#</a> where, set, trim</h3> <h4 id="where"><a href="#where" class="header-anchor">#</a> where</h4> <p>where 标签的作用：</p> <ul><li>如果该标签包含的元素中有返回值，就插入一个 where；</li> <li>如果 where 后面的字符串是以 AND 和 OR 开头的，就将它们剔除；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-37-32.png" alt="2020-3-3-17-37-32.png"></p> <ul><li>当 if 条件都不满足的时候，where 元素中没有内容，所以在 SQL 中不会出现 where；</li> <li>如果 if 条件满足，where 元素的内容就是以 and 开头的条件，where 会自动去掉开头的 and，然后添加上一个 where；</li> <li>这种方式生成的 SQL 更干净、更贴切，不会在任何情况下都有 <code>where 1=1</code> 这样的条件。</li></ul> <h4 id="set"><a href="#set" class="header-anchor">#</a> set</h4> <p>set 标签的作用：</p> <ul><li>如果该标签包含的元素中有返回值，就插入一个 set；</li> <li>如果 set 后面的字符串是以逗号结尾的，就将这个逗号剔除；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-41-28.png" alt="2020-3-3-17-41-28.png"></p> <ul><li>在 set 标签的用法中，SQL 后面的逗号没有问题了，但是如果 set 元素中没有内容，照样会出现 SQL 错误；</li> <li>以为了避免错误产生，类似 <code>id=＃{id}</code> 这样必然存在的赋值仍然有保留的必要；</li></ul> <h4 id="trim"><a href="#trim" class="header-anchor">#</a> trim</h4> <ul><li>where 和 set 标签的功能都可以用 trim 标签来实现；</li> <li>trim 标签有如下属性：
<ul><li>prefix：当 trim 元素内包含内容时，会给内容增加 prefix 指定的前缀；</li> <li>prefixOverrides：当 trim 元素内包含内容时，会把内容中匹配的前缀字符串去掉；</li> <li>suffix：当 trim 元素内包含内容时，会给内容增加 suffix 指定的后缀；</li> <li>suffixOverrides：当 trim 元素内包含内容时，会把内容中匹配的后缀字符串去掉；</li></ul></li></ul> <hr> <p>where 标签对应 trim 的实现如下：</p> <ul><li>这里的 AND 和 OR 后面的空格不能省略；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-43-44.png" alt="2020-3-3-17-43-44.png"></p> <p>set 标签对应的 trim 实现如下：</p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-44-7.png" alt="2020-3-3-17-44-7.png"></p> <h3 id="foreach"><a href="#foreach" class="header-anchor">#</a> foreach</h3> <ul><li>foreach 可以对数组、Map 或实现了 Iterable 接口（如 List、Set）的对象进行遍历；</li> <li>数组在处理时会转换为 List 对象；</li></ul> <h4 id="foreach-实现-in-集合"><a href="#foreach-实现-in-集合" class="header-anchor">#</a> foreach 实现 in 集合</h4> <p>下面介绍如何根据传入的 “用户 id 集合” 查询出所有符合条件的用户；</p> <ul><li>首先在 UserMapper 接口中增加如下方法；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-48-2.png" alt="2020-3-3-17-48-2.png"></p> <ul><li>在 UserMapper.xml 中增加如下代码；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-17-50-36.png" alt="2020-3-3-17-50-36.png"></p> <ul><li><p>foreach 包含以下属性：</p> <ul><li>collection：必填，值为要迭代循环的对象的名字；</li> <li>item：变量名，当前正在被迭代的集合中的元素的引用；</li> <li>index：索引的属性名，在集合数组情况下值为当前索引值，当迭代循环的对象是 Map 类型时，这个值为 Map 的 key 值；</li> <li>open：整个循环内容开头的字符串。</li> <li>close：整个循环内容结尾的字符串。</li> <li>separator：每次循环的分隔符；</li></ul></li> <li><p>对于 collection 属性：</p> <ul><li>如果传入的是单参数且参数类型是一个 List 的时候，collection 属性值为 list；</li> <li>如果传入的是单参数且参数类型是一个 array 数组的时候，collection 的属性值为 array；</li> <li>list 和 array 都是参数默认的名字；</li> <li>推荐使用 @Param 来指定参数的名 字，这时 collection 就设置为通过 @Param 注解指定的名字；</li> <li>当有多个参数的时候，要使用 @Param 注解给每个参数指定一个名字。因此将 collection 设置为 @Param 注解指定的名字即可；</li> <li>如果参数是一个对象，这种情况下指定为对象的属性名即可。比如参数 student 里面有一个属性 courses 是一个集合，那 collection 的值为 <code>student.courses</code>；</li></ul></li></ul> <h4 id="foreach-实现批量插入"><a href="#foreach-实现批量插入" class="header-anchor">#</a> foreach 实现批量插入</h4> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-8-28.png" alt="2020-3-3-18-8-28.png"></p> <h4 id="foreach-实现动态-update"><a href="#foreach-实现动态-update" class="header-anchor">#</a> foreach 实现动态 UPDATE</h4> <ul><li>当参数是 Map 类型的时候，foreach 标签的 index 属性值对应的不是索引值，而是 Map 中 的 key；</li> <li>利用这个 key 可以实现动态 UPDATE；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-12-27.png" alt="2020-3-3-18-12-27.png"></p> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-10-48.png" alt="2020-3-3-18-10-48.png"></p> <ul><li>key 作为列名，对应的值作为该列的名字；</li></ul> <h3 id="bind"><a href="#bind" class="header-anchor">#</a> bind</h3> <ul><li>bind 标签可以使用 OGNL 表达式创建一个变量并将其绑定到上下文中；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-14-17.png" alt="2020-3-3-18-14-17.png"></p> <ul><li>在上面的例子中，我们使用到了 <code>concat</code> 函数拼接字符串；</li> <li>但是这个函数在不同的数据库中，表现是有区别的；</li> <li>为了抹除这种区别，我们可以使用 bind 作为替换；</li></ul> <p><img src="https://garrik-default-imgs.oss-accelerate.aliyuncs.com/imgs/2020-3-3-18-15-15.png" alt="2020-3-3-18-15-15.png"></p> <ul><li>bind 标签的两个属性都是必选项；
<ul><li>name 为绑定到上下文的变量名；</li> <li>value 为 OGNL 表达式；</li> <li>创建一个 bind 标签的变量后，就可以在下面直接使用；</li></ul></li></ul> <h2 id="mybatis-代码生成器"><a href="#mybatis-代码生成器" class="header-anchor">#</a> MyBatis 代码生成器</h2></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/3/2020, 6:25:57 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/my-notebook/assets/js/app.f6b14fc8.js" defer></script><script src="/my-notebook/assets/js/2.a47e0c14.js" defer></script><script src="/my-notebook/assets/js/127.5643b8f1.js" defer></script>
  </body>
</html>
